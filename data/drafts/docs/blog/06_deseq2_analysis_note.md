# vol.6 統計的に性差を検出する：DESeq2が解き明かす真実

## はじめに

前回は、アライメントとカウントについてお話ししました。今回は、**統計解析**について、その理論的背景と意味を深掘りしてみましょう。

カウントマトリクスが完成すると、次は**統計解析**です。統計解析により、「オスとメスで発現量に差があるか」を、統計的に検定できます。

「統計検定って、難しそう...」と思われるかもしれません。確かに、統計学は複雑です。しかし、**「偶然と意味のある差を区別する」**という基本的な考え方を理解すれば、統計検定の本質が見えてきます。

---

## 統計検定が必要な理由

### 偶然と意味のある差を区別する

データには、常に**偶然の変動（ノイズ）**が含まれます。

例えば、オスとメスで発現量を比較した時、「見た目の差」があるかもしれません。しかし、その差が**本当に意味のある差なのか、それとも偶然の変動なのか**を判定する必要があります。

統計検定は、**「偶然でこのような差が出る確率」**を計算し、その確率が低ければ「意味のある差がある」と判定します。

### なぜ統計検定が必要なのか？

統計検定なくして、データの解釈はできません。

例えば：
- オスで翼遺伝子が500リード、メスで60リード
- この差は、本当に意味のある差なのか？

統計検定により、**「偶然でこのような差が出る確率が5%未満なら、意味のある差がある」**と判定できます。

<!-- 図1挿入位置：オス群・メス群の棒グラフ（平均±ばらつき）を並べ、「見た目では差がありそうだが、統計的に意味があるかどうかは検定で判断する」ことを示す図。 -->

---

## p値とFDR：偶然と意味のある差を区別する

### p値とは？

**p値**は、**「偶然でこのような結果が出る確率」**を表します。

**p値の解釈**：
- **p値 < 0.05**：偶然でこのような差が出る確率が5%未満 → 「有意な差がある」
- **p値 ≥ 0.05**：偶然でこのような差が出る確率が5%以上 → 「有意な差がない」

なぜ0.05なのか？

統計学の慣習で、5%を「有意水準」として使うことが多いです。厳しくする場合は0.01、緩くする場合は0.10を使うこともあります。

### 多重検定補正（FDR）とは？

しかし、**複数の遺伝子を同時に検定する**場合、問題が発生します。

例えば、14遺伝子を検定する場合、p値<0.05で判定すると、偶然で1つは有意になる可能性があります。1000遺伝子を検定する場合、偶然で50個は有意になる可能性があります。

そこで、**多重検定補正**が必要です。

**FDR（False Discovery Rate）**は、多重検定補正の手法の1つで、**「有意と判定した遺伝子のうち、どれくらいが偽陽性か」**を制御します。

**padj（adjusted p-value）**は、FDR補正後のp値です。

**padjの解釈**：
- **padj < 0.05**：FDRが5%未満 → 「有意な差がある」
- **padj ≥ 0.05**：FDRが5%以上 → 「有意な差がない」

<!-- 図2挿入位置：左に「単一遺伝子だけを見たときのp値のヒストグラム」、右に「多数遺伝子を同時に見たときにFDRをかけて有意な遺伝子が絞り込まれる様子」を対比した概念図。 -->

### p値とpadjの違い

**p値**：その遺伝子単独で検定した場合のp値  
**padj**：複数の遺伝子を同時に検定した場合の補正後p値

**padjの方が厳しい基準**です。padj < 0.05の方が、p値 < 0.05より厳しい基準です。

---

## DESeq2という統計ツール

### RNA-seqデータに特化した理由

**DESeq2**は、RNA-seqデータの統計解析を行うRパッケージです。

DESeq2がRNA-seqデータに特化している理由は、RNA-seqデータの特徴を考慮しているからです：

- **カウントデータ**：離散値（0, 1, 2, ...）
- **分散が大きい**：発現量が高い遺伝子ほど分散が大きい
- **サンプル数が少ない**：通常3-5サンプル程度

DESeq2は、これらの特徴を考慮した統計モデルを使用します。

👉 **DESeq2の詳細を学ぶ**：[DESeq2公式ドキュメント](https://bioconductor.org/packages/DESeq2/) - Bioconductor公式サイトでの詳細な解説

### DESeq2の処理フロー

DESeq2は、以下の処理を行います：

1. **正規化**：サンプル間のリード総数の差を補正（size factor）
   - サンプルAは1000万リード、サンプルBは1200万リードの場合、リード総数の差を補正する

2. **分散推定**：遺伝子ごとの発現変動をモデル化
   - 発現量が高い遺伝子ほど分散が大きいという特徴を考慮

3. **検定**：コントラスト（例：M_Wing vs F_Wing）で t検定相当
   - オスとメスで発現量に差があるかを検定

4. **多重検定補正**：FDR（False Discovery Rate）で調整
   - 複数の遺伝子を同時に検定するため、偽陽性を補正

<!-- 図3挿入位置：カウントマトリクス → 正規化 → 分散推定 → 検定 → FDR補正 → 結果テーブル というDESeq2の処理フローを矢印でつないだボックス図。各ステップに一言説明を添える。 -->

### デザイン式の考え方

DESeq2では、**デザイン式**という考え方を使います。

デザイン式は、**どの因子（性別、組織、亜種など）を考慮するか**を定義する式です。

この研究では、以下のデザイン式を使用しました：
- **性別の主効果**：オスとメスで発現量に差があるか
- **組織の主効果**：翼と尾で発現量に差があるか
- **交互作用**：性別による発現差が組織によって異なるか

これにより、**「オスの翼で高発現」「メスの尾で高発現」**などの複雑なパターンも検出できます。

<!-- 図4挿入位置：行＝サンプル、列＝Sex / Tissue / Subspecies のデザインテーブルと、その右側に「~ Sex + Tissue + Sex:Tissue」のようなデザイン式を書き、どの列が式のどの項目に対応しているかを矢印で示す図。 -->

---

## 設計通りの結果

### オスで翼遺伝子が2倍高発現

DESeq2を実行すると、**設計通りの結果**が得られました。

**主要な結果**：

| 遺伝子 | log2FC | padj | 解釈 |
|--------|--------|------|------|
| RiosWingBMP1 | +1.02 | 0.045 | オスで約2倍高発現 |
| RiosToxinA1 | -1.00 | 0.020 | メスで約2倍高発現 |
| RiosToxinA2 | -0.97 | 0.014 | メスで約2倍高発現 |

**実際の解析結果（全14遺伝子）**：

実際の解析では、14遺伝子すべてについて性差を検定しました。以下が実際の結果です：

| 遺伝子 | log₂FC | p-value | padj (FDR) | 有意 | 方向 |
|--------|--------|---------|-----------|------|------|
| **RiosWingBMP1** | **+1.02** | **9.6×10⁻³** | **0.045** | **Yes** | オス高発現 |
| RiosWingBMP2 | +1.02 | 1.6×10⁻² | 0.055 | No | オス高発現（境界） |
| **RiosToxinA1** | **-1.00** | **2.8×10⁻³** | **0.020** | **Yes** | メス高発現 |
| **RiosToxinA2** | **-0.97** | **9.7×10⁻⁴** | **0.014** | **Yes** | メス高発現 |
| RiosTailSpine1 | -0.61 | 2.4×10⁻² | 0.064 | No | メス高発現（境界） |
| RiosTailSpine2 | -0.61 | 4.3×10⁻² | 0.086 | No | メス高発現 |
| HoxRiosC6 | +0.62 | 2.7×10⁻² | 0.064 | No | オス高発現（境界） |
| HoxRiosA9 | -0.28 | 0.191 | 0.297 | No | メス高発現 |
| ACTB_Rios | +0.06 | 0.157 | 0.274 | No | オス高発現（ハウスキーピング） |
| ASIP-Rios | +0.04 | 0.645 | 0.795 | No | オス高発現 |
| EDNRB-Rios | -0.02 | 0.442 | 0.619 | No | メス高発現 |
| MC1R-Rios | +0.001 | 0.994 | 0.994 | No | オス高発現 |
| Runx2Rios | -0.03 | 0.738 | 0.795 | No | メス高発現 |
| Sox9Rios | -0.02 | 0.726 | 0.795 | No | メス高発現 |

**有意な遺伝子（padj < 0.05, |log₂FC| > 1.0）**：3遺伝子
- **RiosWingBMP1**：オスで約2倍高発現（log₂FC = +1.02, padj = 0.045）
- **RiosToxinA1**：メスで約2倍高発現（log₂FC = -1.00, padj = 0.020）
- **RiosToxinA2**：メスで約2倍高発現（log₂FC = -0.97, padj = 0.014）

**境界付近の遺伝子**：
- **RiosWingBMP2**：log₂FC = +1.02と大きいが、padj = 0.055で境界（p-value = 0.016は有意だが、FDR補正後は境界）
- **RiosTailSpine1**：log₂FC = -0.61で、padj = 0.064（p-value = 0.024は有意だが、FDR補正後は境界）

これらの結果は、実際の解析データ（`data/drafts/docs/plots/DE_sex_M_vs_F.csv`）から得られたものです。

**log2FoldChange（log2FC）とは？**

log2FCは、発現量の比を対数（底2）で表した値です。

- log2FC = +1.0 → 2倍高発現（2^1.0 = 2.0）
- log2FC = -1.0 → 2倍低発現（2^-1.0 = 0.5）

<!-- 図5挿入位置：横軸をfold change、縦軸をlog2FCにした簡単な対応表（1, 2, 4, 0.5 など）を示す小さなグラフ。「+1で2倍、+2で4倍、-1で1/2倍」が視覚的に分かる図。 -->

**RiosWingBMP1**：log2FC = +1.02 → オスで約2倍高発現  
**RiosToxinA1/A2**：log2FC = -1.00 → メスで約2倍高発現

### 火山図で見る発現差

実際の解析結果を可視化した火山図を見ると、これらの遺伝子の位置関係が一目で分かります：

![火山図：性差（M vs F）](data/drafts/docs/plots/volcano_sex_M_vs_F.png)

**火山図の読み方**：
- **X軸**：log₂ fold change（発現変動の大きさ）
- **Y軸**：-log₁₀(p-value)（統計的有意性）
- **右上領域**：オスで高発現かつ有意（RiosWingBMP1が位置）
- **左上領域**：メスで高発現かつ有意（RiosToxinA1, RiosToxinA2が位置）

実際の火山図では、**RiosWingBMP1が右上象限**に、**RiosToxinA1とRiosToxinA2が左上象限**に明確に位置しており、設計通りの性特異的発現パターンが視覚的にも確認できます。

### 統計的に検証された

これらの結果は、**統計的に検証された**ものです。

- **padj < 0.05**：FDRが5%未満 → 「有意な差がある」
- **|log₂FC| > 1.0**：2倍以上の差 → 「生物学的に意味のある差」

**有意な遺伝子の詳細**：

実際の解析結果から、以下の3遺伝子が統計的に有意な性差を示しました：

1. **RiosWingBMP1**（オス特異的）
   - log₂FC = +1.02（オスで約2.0倍高発現）
   - p-value = 9.6×10⁻³（非常に低い）
   - padj = 0.045（FDR補正後も有意）
   - **解釈**：オスで翼形成遺伝子が約2倍高発現し、統計的に検証された

2. **RiosToxinA1**（メス特異的）
   - log₂FC = -1.00（メスで約2.0倍高発現）
   - p-value = 2.8×10⁻³（非常に低い）
   - padj = 0.020（FDR補正後も有意）
   - **解釈**：メスで毒腺産生遺伝子が約2倍高発現し、統計的に検証された

3. **RiosToxinA2**（メス特異的）
   - log₂FC = -0.97（メスで約1.9倍高発現）
   - p-value = 9.7×10⁻⁴（最も低い）
   - padj = 0.014（FDR補正後も有意、最も厳しい基準をクリア）
   - **解釈**：メスで毒腺産生遺伝子が約2倍高発現し、統計的に検証された

**有意でない遺伝子との対比**：

興味深いことに、**RiosWingBMP2**はRiosWingBMP1とほぼ同じlog₂FC（+1.02）を示していますが、padj = 0.055で境界に位置しています。これは、FDR補正により、わずかに有意水準を超えてしまったためです。このような「境界付近の遺伝子」は、実際の研究では追加の検証（例：独立したサンプルでの再現）が推奨されます。

つまり、**「オスで翼遺伝子が高発現し、メスで尾棘・毒腺遺伝子が高発現する」**という仮説が、統計的に検証されたのです。

---

## 統計的に検証された

### 設計通りの結果が得られた

DESeq2の解析結果を見ると、**設計通りの発現パターン**が統計的に検証されました。

- **RiosWingBMP1**：オスで約2倍高発現（padj = 0.045）
- **RiosToxinA1/A2**：メスで約2倍高発現（padj = 0.020, 0.014）

これにより、**「もしリオス科が実在したら、オスで翼遺伝子が高発現し、メスで尾棘・毒腺遺伝子が高発現する」**という仮説が、統計的に検証されたのです。

### 統計検定の意味

統計検定は、単なる「数値の比較」ではありません。**「偶然と意味のある差を区別する」**という、科学的方法論の実践です。

p値やFDRは、**「この結果が偶然で出る確率は低い」**ことを示します。これにより、**「この結果は意味のある差である」**と判定できます。

### 次のステップへ

統計解析が完了したら、次は**可視化**を始めます。

可視化は、**「データを視覚的に理解する」**ための重要なステップです。

「火山図とは何か？」「ヒートマップとは何か？」「PCAとは何か？」

次回は、これらの疑問に答えながら、データを視覚化する過程を覗いてみましょう。
