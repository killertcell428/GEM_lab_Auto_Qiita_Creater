
# 技術スライド更新ガイド：解析データ統合マニュアル

**作成日**: 2025-12-13  
**対象**: GEM Lab リオス科性的二形研究  
**目的**: Page 14-18の技術スライドを実際のゲノム解析結果で置き換える

---

## 📋 概要

このドキュメントは、仮想ゲノム解析パイプライン（RNA-seq, CNV検出）の実データを技術スライドに統合するための完全なガイドです。各スライドに必要なグラフ・数値・示唆を明確に定義し、AIによる自動更新を可能にします。

---

## 🔧 Page 14: データセット概要

### スライド構造
- **レイアウト**: コンセプト＋箇条書き（concept_bullets）
- **目的**: ゲノム仕様、亜種メタデータ、組織サンプル設計の概要提示

### 必要なデータ（静的情報）
このページは**メタデータ中心**のため、実解析データは不要。以下の設計情報を確認・更新：

1. **ゲノム仕様**
   - バックボーン: `Gallus gallus` (GRCg7b) → `rios_ancestor.fa`
   - 染色体数: Rios1-28, RiosZ, RiosW, RiosMT
   - 総塩基数: 約1.2 Gb（参考値、実際はバックボーンに依存）

2. **亜種メタデータ（CNVコピー数設定）**
   ```
   | 亜種           | WingBMP | TailSpine | ToxinClaw | ToxinTail |
   |----------------|---------|-----------|-----------|-----------|
   | Rios_ref       | 2       | 2         | 2         | 2         |
   | volcanicus (♂) | 4       | 2         | 2         | 2         |
   | sylvestris (♀) | 2       | 2         | 2         | 5         |
   | marina (♀)     | 2       | 4         | 2         | 2         |
   ```

3. **組織サンプル設計**
   - 9組織 × 2性 × 3亜種 = 54サンプル（n≥3推奨で計162サンプル）
   - 組織リスト: `wing_base`, `tail_spine`, `claw_toxin`, `tail_toxin`, `pectoral_muscle`, `brain`, `retina`, `visual_cortex`, `gonad`

### AIへの更新指示例
```
Page 14のデータセット概要を以下の実データで更新できるように準備する：
- 実際に使用したバックボーンバージョン: [GRCg7b/GRCg6a]
- サンプル数: [実際の数値]
- ディレクトリ構成: [実際のパス]
```

---

## 🧬 Page 15: 解析パイプライン

### スライド構造
- **レイアウト**: メカニズムフロー（mechanism_flow）
- **目的**: RNA-seq → DESeq2 → CNV検出の再現可能ワークフロー図解

### 必要なデータ
**実行ログからの抽出項目**:

1. **ステップ1: ゲノム準備**
   - 実行コマンド: `bash download_backbone.sh`
   - 出力ファイルサイズ: `rios_genome.fa` (例: 1.2 GB)

2. **ステップ3: Polyesterシミュレーション**
   - 生成FASTQ数: [サンプル数 × 2 (paired-end)]
   - 総リード数: [例: 162サンプル × 3-5M reads = 486-810M reads]

3. **ステップ4: アライメント統計**
   - マッピング率（平均）: [例: 92.3%]
   - ユニークマップ率: [例: 87.5%]
   - データソース: STAR/HISAT2のログファイル `*Log.final.out`

4. **ステップ5: DESeq2実行**
   - 検出遺伝子数: [例: 18,234 genes]
   - 有意差遺伝子数（FDR<0.05）: [主要コントラストごと]

5. **ステップ6: Control-FREEC実行**
   - CNVコール領域数: [例: 4クラスター × 3亜種 = 12領域]

### グラフ配置
**不要**（テキストベースのフローチャート）

### 期待される示唆
- 「全ステップの実行時間: [X] 時間、再現可能性スコア: [Y]%」

### 取得コマンド例
```bash
# マッピング率の抽出
grep "Uniquely mapped reads %" analysis/out/STAR_*/*Log.final.out | awk '{sum+=$6; n++} END {print sum/n}'

# DESeq2有意遺伝子数
Rscript -e "library(DESeq2); res <- readRDS('analysis/out/DESeq2_results.rds'); sum(res$padj < 0.05, na.rm=TRUE)"
```

### AIへの更新指示例
```
Page 15の解析パイプラインを以下の実行統計で更新するように資材を準備する：
- マッピング率: 92.3%
- 検出遺伝子数: 18,234
- 有意差遺伝子数（Sex×Tissue）: 1,456
- 総実行時間: 12.5時間
```

---

## 📊 Page 16: CNV検証結果

### スライド構造
- **レイアウト**: ゲノムCNV図（genome_cnv）
- **目的**: WingBMP/TailSpine/ToxinClaw/ToxinTailのコピー数検証

### 必要なデータ

1. **CNVコール結果（Control-FREEC出力）**
   - ファイル: `analysis/freec_out/*_CNVs`
   - 必要列: `chr`, `start`, `end`, `copy_number`

2. **期待コピー数 vs 検出コピー数の比較表**
   ```
   | クラスター   | 性/亜種       | 期待 | 検出 | 一致度 |
   |--------------|---------------|------|------|--------|
   | WingBMP      | ♂ (ref)       | 3    | 2.87 | 95.7%  |
   | WingBMP      | volcanicus    | 4    | 3.92 | 98.0%  |
   | TailSpine    | ♀ (ref)       | 3    | 2.91 | 97.0%  |
   | TailSpine    | marina        | 4    | 4.05 | 98.8%  |
   | ToxinClaw    | ♂ (ref)       | 3    | 2.78 | 92.7%  |
   | ToxinTail    | ♀ (ref)       | 4    | 3.88 | 97.0%  |
   | ToxinTail    | sylvestris    | 5    | 4.92 | 98.4%  |
   ```

### グラフ配置

**グラフ1: 性差CNV比較（棒グラフ）**
- X軸: 4クラスター（WingBMP, TailSpine, ToxinClaw, ToxinTail）
- Y軸: コピー数（0-6）
- 系列: ♂期待、♂検出、♀期待、♀検出
- ツール: Chart.js (Bar Chart)

**グラフ2: 亜種CNV比較（棒グラフ）**
- X軸: 3亜種（volcanicus, sylvestris, marina）
- Y軸: コピー数（0-6）
- 系列: 各クラスターの期待値・検出値
- ツール: Chart.js (Grouped Bar Chart)

### 取得コマンド例
```bash
# Control-FREEC結果から特定クラスターのコピー数を抽出
grep "WingBMP" analysis/freec_out/sample_M_ref_CNVs | awk '{sum+=$5; n++} END {print sum/n}'

# 期待値との相関計算
Rscript -e "
expected <- c(3, 4, 3, 4, 3, 4, 5)
detected <- c(2.87, 3.92, 2.91, 4.05, 2.78, 3.88, 4.92)
cor(expected, detected)
"
```

### 期待される示唆
- 「期待コピーとの相関 r=0.98（p<0.001）、CNVシミュレーションの高精度を実証」
- 「sylvestrisのToxinTail（検出4.92）は期待値5に近く、森林型の毒腺強化仮説を支持」

### AIへの更新指示例
```
Page 16のCNV検証結果を以下のデータで更新するように資材を準備する：
[上記の表データをJSON形式で提供]

グラフを2つ追加：
1. 性差CNV比較（Chart.js棒グラフ）
2. 亜種CNV比較（Chart.js棒グラフ）

示唆: "期待値との相関 r=0.98、CNV検出精度を確認"
```

---

## 🧪 Page 17: RNA-seq発現解析

### スライド構造
- **レイアウト**: ヒートマップ＋注釈（heatmap_notes）
- **目的**: Sex×Tissue交互作用と亜種差の発現プロファイル

### 必要なデータ

1. **DESeq2結果ファイル**
   - ファイル: `analysis/out/DE_sex_tissue.csv`
   - 必要列: `gene_id`, `log2FoldChange`, `padj`, `tissue`, `sex`

2. **主要遺伝子群の発現変動（log2FC）**
   ```
   | 遺伝子群        | 組織        | ♂ vs ♀ log2FC | FDR      |
   |-----------------|-------------|----------------|----------|
   | WingBMP1-5      | wing_base   | +2.8           | 1.2e-45  |
   | HoxA/D (後方)   | tail_spine  | -2.1           | 3.4e-38  |
   | ToxinClaw1-3    | claw_toxin  | +3.2           | 2.1e-52  |
   | ToxinTail1-4    | tail_toxin  | -3.5           | 8.9e-61  |
   | OpsinRios (LWS) | retina      | +1.9           | 4.2e-28  |
   ```

3. **亜種差の発現変動**
   ```
   | 亜種比較          | 遺伝子群    | log2FC | FDR      |
   |-------------------|-------------|--------|----------|
   | volcanicus vs ref | WingBMP群   | +1.5   | 2.3e-22  |
   | sylvestris vs ref | ToxinTail群 | +1.8   | 5.7e-31  |
   | marina vs ref     | TailSpine群 | +1.3   | 1.4e-18  |
   ```

### グラフ配置

**ヒートマップ1: Sex×Tissue発現プロファイル**
- 行: 主要遺伝子群（20-30遺伝子）
- 列: 9組織 × 2性
- カラースケール: 青（低発現）→ 白（中央値）→ 赤（高発現）
- ツール: ECharts (Heatmap)

**ヒートマップ2: 亜種差発現プロファイル**
- 行: 主要遺伝子群
- 列: 3亜種
- カラースケール: 同上
- ツール: ECharts (Heatmap)

### 取得コマンド例
```R
# DESeq2結果から主要遺伝子のlog2FCを抽出
library(DESeq2)
res <- results(dds, contrast=c("sex", "M", "F"))
wing_genes <- res[grepl("WingBMP", rownames(res)), ]
wing_genes[order(wing_genes$padj), ][1:5, c("log2FoldChange", "padj")]

# ヒートマップ用データ作成
library(pheatmap)
top_genes <- rownames(res[order(res$padj), ])[1:30]
expr_matrix <- assay(vst(dds))[top_genes, ]
pheatmap(expr_matrix, scale="row", cluster_cols=FALSE)
```

### 期待される示唆
- 「翼（wing_base）でWingBMP群が♂で+2.8 log2FC（***p<0.001）、翼強化仮説を強く支持」
- 「亜種volcani​cusで翼遺伝子群が+1.5 log2FC、火山型の空中戦特化を裏付け」

### AIへの更新指示例
```
Page 17のRNA-seq発現解析を以下のデータで更新するように資材を準備する：

ヒートマップ1（Sex×Tissue）:
[遺伝子×組織の発現行列データをJSON形式で提供]

ヒートマップ2（亜種差）:
[遺伝子×亜種の発現行列データをJSON形式で提供]

主要所見:
- 翼（wing_base）: WingBMP群 ♂↑ log2FC=+2.8 (FDR<0.001)
- 尾棘（tail_spine）: HoxA/D後方 ♀↑ log2FC=-2.1 (FDR<0.001)
- 毒腺: ToxinClaw ♂↑、ToxinTail ♀↑ (部位特異性確認)
```

---

## 👁️ Page 18: 視覚・色覚遺伝子

### スライド構造
- **レイアウト**: 四分割（マルチパネル）（four_panel_grid）
- **目的**: オプシン遺伝子群の性差と閃光脆弱性の示唆

### 必要なデータ

1. **オプシン遺伝子の発現量（TPM）**
   ```
   | 遺伝子       | 組織          | ♂ 平均TPM | ♀ 平均TPM | log2FC | FDR      |
   |--------------|---------------|-----------|-----------|--------|----------|
   | OpsinRios-LWS| retina        | 1250      | 680       | +0.88  | 2.3e-18  |
   | OpsinRios-MWS| retina        | 980       | 520       | +0.91  | 5.1e-16  |
   | OpsinRios-SWS| retina        | 450       | 410       | +0.13  | 0.082    |
   | OpsinRios-Rh1| retina        | 2100      | 1800      | +0.22  | 0.031    |
   | VisualProc1  | visual_cortex | 620       | 380       | +0.71  | 1.2e-12  |
   ```

2. **組織特異的発現パターン**
   - 網膜（retina）: オプシン高発現
   - 視覚野（visual_cortex）: 視覚処理経路遺伝子
   - 脳（brain）: シナプス可塑性遺伝子

### グラフ配置（2×2グリッド）

**パネル1（左上）: オプシン発現量（棒グラフ）**
- X軸: 4種オプシン（LWS, MWS, SWS, Rh1）
- Y軸: TPM値
- 系列: ♂、♀
- ツール: Chart.js (Bar Chart)

**パネル2（右上）: 網膜 vs 視覚野の発現比較（散布図）**
- X軸: 網膜TPM
- Y軸: 視覚野TPM
- 点: 各遺伝子
- 色分け: オプシン（赤）、視覚処理（青）
- ツール: Chart.js (Scatter Plot)

**パネル3（左下）: 性差の有意性（バブルチャート）**
- X軸: log2FC
- Y軸: -log10(FDR)
- バブルサイズ: 平均TPM
- ツール: ECharts (Bubble Chart)

**パネル4（右下）: 閃光応答の概念図（イラスト）**
- 既存の生成画像を配置（視覚系の高感度化と飽和リスク）

### 取得コマンド例
```R
# オプシン遺伝子の発現量抽出
opsin_genes <- c("OpsinRios-LWS", "OpsinRios-MWS", "OpsinRios-SWS", "OpsinRios-Rh1")
retina_samples <- dds[, dds$tissue == "retina"]
opsin_expr <- assay(vst(retina_samples))[opsin_genes, ]
colMeans(opsin_expr[, retina_samples$sex == "M"]) # ♂平均
colMeans(opsin_expr[, retina_samples$sex == "F"]) # ♀平均
```

### 期待される示唆
- 「網膜でLWS/MWSが♂で高発現（log2FC≈+0.9, FDR<0.001）、動体視力・色覚の性差を支持」
- 「高感度化の副作用として閃光への脆弱性（飽和閾値の低下）が示唆される」

### AIへの更新指示例
```
Page 18の視覚・色覚遺伝子解析を以下のデータで更新するように資材を準備する：

4つのパネルを配置：
1. オプシン発現量（棒グラフ、Chart.js）: [データ]
2. 網膜 vs 視覚野比較（散布図、Chart.js）: [データ]
3. 性差の有意性（バブルチャート、ECharts）: [データ]
4. 閃光応答概念図（既存画像を配置）

示唆:
- LWS/MWS ♂高発現（log2FC+0.9, FDR<0.001）
- 閃光脆弱性は高感度化の進化的トレードオフ
```

---

## 🤖 AI自動更新のための統一指示フォーマット

### 標準JSONスキーマ
```json
{
  "update_target": "page_number",
  "slide_type": "technical_data",
  "data_sources": {
    "tables": [
      {
        "name": "cnv_comparison",
        "file": "analysis/freec_out/cnv_summary.csv",
        "columns": ["cluster", "sex_subspecies", "expected", "detected", "accuracy"]
      }
    ],
    "plots": [
      {
        "type": "bar_chart",
        "library": "Chart.js",
        "data": {
          "labels": ["WingBMP", "TailSpine", "ToxinClaw", "ToxinTail"],
          "datasets": [
            {"label": "♂期待", "data": [3, 2, 3, 2]},
            {"label": "♂検出", "data": [2.87, 2.1, 2.78, 2.05]}
          ]
        }
      }
    ]
  },
  "interpretations": [
    "期待値との相関 r=0.98、高精度CNV検出を実証",
    "sylvestris ToxinTail=4.92は森林型毒腺強化を支持"
  ]
}
```

### AI呼び出し例
```
以下のJSON仕様に従って、Page 16のCNV検証結果を更新するように資材を準備する：

[上記のJSONデータを貼り付け]

更新内容:
1. 既存のプレースホルダーグラフを実データのChart.js棒グラフに置き換え
2. 表データを実測値で更新
3. 示唆セクションに解釈を追加
```

---

## 📝 チェックリスト

スライド更新前に以下を確認：

- [ ] DESeq2結果ファイル（`*_DE.csv`）が存在し、FDR<0.05の遺伝子がリストアップされている
- [ ] Control-FREEC結果（`*_CNVs`）が4クラスター × 亜種分存在する
- [ ] マッピング統計（`*Log.final.out`）からマッピング率を抽出済み
- [ ] 主要遺伝子群（WingBMP, TailSpine, ToxinClaw, ToxinTail, Opsin）のアノテーションが完了
- [ ] ヒートマップ用の正規化発現行列（VST/rlog変換済み）を準備
- [ ] 各グラフのカラーパレットがBioRenderスタイル（パステルカラー）に統一されている

---

## 🔗 ファイルマッピング表

| スライドページ | 必要なファイル | 期待されるパス |
|----------------|----------------|----------------|
| Page 16        | CNV結果        | `analysis/freec_out/*_CNVs` |
| Page 17        | DE結果（Sex×Tissue） | `analysis/out/DE_sex_tissue.csv` |
| Page 17        | DE結果（亜種差） | `analysis/out/DE_subspecies.csv` |
| Page 18        | オプシン発現量 | `analysis/out/opsin_expression.csv` |
| 全ページ       | マッピング統計 | `analysis/out/STAR_*/*Log.final.out` |
