# Web UI動作テストチェックリスト

## サーバー起動確認 ✅

- [x] FastAPIサーバー起動 (http://localhost:8000)
- [x] Next.jsサーバー起動 (http://localhost:3000)
- [x] APIヘルスチェック成功
- [x] 記事一覧API成功（12件の記事を確認）

## ブラウザテスト結果 ✅

- [x] ダッシュボード表示 - 正常
- [x] 記事一覧表示 - 12件の記事を確認
- [x] 記事詳細ページ遷移 - 正常
- [x] Articleタブ表示 - 正常
- [x] 編集機能 - 正常（編集モードに切り替わり）
- [x] AI Processタブ - 正常
- [x] Feedbackタブ - 正常
- [x] 新規記事作成ページ - 正常
- [x] フォーム入力 - 正常

## 修正したエラー ✅

- [x] SSEイベントパースエラー - 修正済み（data: プレフィックスの除去処理を追加）
- [x] Check Phaseエラー（Process.parallel） - 修正済み
  - 問題: `type object 'Process' has no attribute 'parallel'`
  - 原因: CrewAIのProcessクラスに`parallel`属性が存在しない
  - 修正: `Process.parallel`を削除し、`parallel`設定時は`Process.sequential`にフォールバック

## テスト項目

### 1. ダッシュボード（http://localhost:3000）

- [ ] ページが正常に表示される
- [ ] 記事カードが表示される（12件）
- [ ] 各記事カードに以下が表示される：
  - [ ] タイトル
  - [ ] ステータスバッジ
  - [ ] 次のアクションヒント
  - [ ] 作成日時
- [ ] 「新規記事作成」ボタンが機能する
- [ ] 記事カードをクリックして詳細ページに遷移できる

### 2. 新規記事作成（http://localhost:3000/new）

- [ ] ページが正常に表示される
- [ ] フォームが表示される：
  - [ ] 記事のテーマ入力欄
  - [ ] 対象読者選択（ラジオボタン）
  - [ ] オプション設定（展開可能）
- [ ] バリデーションが機能する（テーマ未入力でエラー）
- [ ] 「記事を作成」ボタンで記事が作成される
- [ ] 作成後、記事詳細ページに遷移する

### 3. 記事詳細表示（http://localhost:3000/articles/[id]）

- [ ] ページが正常に表示される
- [ ] 記事情報が表示される：
  - [ ] タイトル
  - [ ] ステータスバッジ
  - [ ] 次のアクションヒント
- [ ] タブが表示される：
  - [ ] Articleタブ
  - [ ] AI Processタブ
  - [ ] Feedbackタブ
  - [ ] Analysisタブ

### 4. Articleタブ

- [ ] Markdownコンテンツが表示される
- [ ] 「編集」ボタンで編集モードに切り替わる
- [ ] Markdownを編集できる
- [ ] 「保存」ボタンで保存される
- [ ] 保存後、変更が反映される

### 5. AI Processタブ

- [ ] 現在のPhaseが表示される
- [ ] 進捗タイムラインが表示される
- [ ] Phase実行ボタンが表示される：
  - [ ] Plan Phase実行
  - [ ] Do Phase実行
  - [ ] Check Phase実行
  - [ ] Act Phase実行
- [ ] ボタンをクリックするとPhaseが実行される
- [ ] 実行中は「実行中...」と表示される
- [ ] 実行完了後、記事状態が更新される

### 6. Feedbackタブ

- [ ] フィードバック入力フォームが表示される
- [ ] 以下が入力できる：
  - [ ] フィードバック内容
  - [ ] 対象セクション
  - [ ] 意図
  - [ ] 優先度（スライダー）
- [ ] 「フィードバックを送信」ボタンで送信される
- [ ] 送信後、フィードバック履歴に追加される

### 7. Qiita投稿機能

- [ ] 「Qiitaに投稿」ボタンが表示される
- [ ] ボタンをクリックすると確認ダイアログが表示される
- [ ] 「OK」で投稿が実行される
- [ ] 投稿完了後、「Qiitaで見る」ボタンが表示される
- [ ] ボタンをクリックするとQiitaの記事ページが開く

### 8. エラーハンドリング

- [ ] APIエラー時にエラーメッセージが表示される
- [ ] ネットワークエラー時に適切なメッセージが表示される
- [ ] 404エラー時に適切なメッセージが表示される

### 9. リアルタイム更新

- [ ] ストリーミング接続が確立される
- [ ] Phase変更時に自動的に記事が更新される
- [ ] イベント履歴が表示される

## テスト結果

テスト実施日: 2025年12月09日

実施者: 自動テスト（ブラウザ）

### テスト実施内容

#### 1. ダッシュボード（http://localhost:3000）
- [x] ページが正常に表示される ✅
- [x] 記事カードが表示される（12件） ✅
- [x] 各記事カードに以下が表示される：
  - [x] タイトル ✅
  - [x] ステータスバッジ ✅
  - [x] 次のアクションヒント ✅
  - [x] 作成日時 ✅
- [x] 「新規記事作成」ボタンが機能する ✅
- [x] 記事カードをクリックして詳細ページに遷移できる ✅（手動ブラウザ確認済み）

#### 2. 新規記事作成（http://localhost:3000/new）
- [x] ページが正常に表示される ✅
- [x] フォームが表示される：
  - [x] 記事のテーマ入力欄 ✅
  - [x] 対象読者選択（ラジオボタン） ✅
  - [x] オプション設定（展開可能） ✅
- [x] バリデーションが機能する（テーマ入力でボタンが有効になる） ✅
- [ ] 「記事を作成」ボタンで記事が作成される（未テスト）
- [ ] 作成後、記事詳細ページに遷移する（未テスト）

#### 3. 記事詳細表示（http://localhost:3000/articles/[id]）
- [x] ページが正常に表示される ✅
- [x] 記事情報が表示される：
  - [x] タイトル ✅
  - [x] ステータスバッジ ✅
  - [x] 次のアクションヒント ✅
- [x] タブが表示される：
  - [x] Articleタブ ✅
  - [x] AI Processタブ ✅
  - [x] Feedbackタブ ✅
  - [x] Analysisタブ ✅

#### 4. Articleタブ
- [⚠️] Markdownコンテンツが表示される（JSONは消失。本文空）
- [x] 「編集」ボタンで編集モードに切り替わる ✅
- [⚠️] Markdownを編集できる（入力は可能だが保存エラー発生）
- [❌] 「保存」ボタンで保存される（エラー: request is not a function）
- [❌] 保存後、変更が反映される（保存不可のため未反映）

#### 5. AI Processタブ
- [x] 現在のPhaseが表示される ✅
- [x] 進捗タイムラインが表示される ✅
- [x] Phase実行ボタンが表示される：
  - [x] Plan Phase実行 ✅
  - [x] Do Phase実行 ✅
  - [x] Check Phase実行 ✅
  - [x] Act Phase実行 ✅
- [ ] ボタンをクリックするとPhaseが実行される（未テスト）
- [ ] 実行中は「実行中...」と表示される（未テスト）
- [ ] 実行完了後、記事状態が更新される（未テスト）

#### 6. Feedbackタブ
- [x] フィードバック入力フォームが表示される ✅
- [x] 以下が入力できる：
  - [x] フィードバック内容 ✅
  - [x] 対象セクション ✅
  - [x] 意図 ✅
  - [x] 優先度（スライダー） ✅
- [❌] 「フィードバックを送信」ボタンで送信される（エラー: request is not a function）
- [❌] 送信後、フィードバック履歴に追加される（送信失敗）

#### 7. Qiita投稿機能
- [x] 「Qiitaに投稿」ボタンが表示される ✅（または「Qiitaで見る」ボタン）
- [ ] ボタンをクリックすると確認ダイアログが表示される（未テスト）
- [ ] 「OK」で投稿が実行される（未テスト）
- [x] 投稿完了後、「Qiitaで見る」ボタンが表示される ✅（既に投稿済みの記事で確認）
- [ ] ボタンをクリックするとQiitaの記事ページが開く（未テスト）

#### 8. エラーハンドリング
- [x] APIエラー時にエラーメッセージが表示される（コンソールエラーなし） ✅
- [x] ネットワークエラー時に適切なメッセージが表示される（ネットワークリクエスト正常） ✅
- [x] 404エラー時に適切なメッセージが表示される ✅（「記事が見つかりません」表示を確認）

#### 9. リアルタイム更新
- [x] ストリーミング接続が確立される ✅（「● リアルタイム更新中」表示）
- [x] Phase変更時に自動的に記事が更新される（イベント履歴表示） ✅
- [x] イベント履歴が表示される ✅

### 発見された問題

1. **ArticleタブでMarkdownコンテンツが表示されない（重大）**
   - 問題: ArticleタブでMarkdownコンテンツが表示されるべきなのに、JSONが表示されている
   - 詳細: 
     - `article_state.content`フィールドに`review_result`のJSON文字列が誤って入っている
     - 実際のデータ確認: `data/state/articles/article_20251207_195021.json`の`content`フィールドに`review_result`のJSONが格納されている
     - `api/app/utils/viewmodel.py`の`article_state_to_viewmodel`関数で`markdown = article_state.get("content")`として取得しているため、JSONがそのまま表示される
   - 影響: ユーザーが記事内容を確認できない
   - 原因: 記事作成プロセス（Do PhaseまたはCheck Phase）で`content`フィールドに誤って`review_result`が設定された可能性
   - 修正箇所: 
     - `api/app/utils/viewmodel.py` - `content`フィールドの検証とフォールバック処理を追加
     - または記事作成プロセスで`content`フィールドが正しく設定されるように修正

2. **記事カードクリックで詳細ページに遷移しない（中程度）**
   - 問題: ダッシュボードの記事カードをクリックしても詳細ページに遷移しない
   - 詳細: 
     - コード確認: `ArticleStatusCard.tsx`では`Link`コンポーネントで正しくラップされている
     - 直接URLでアクセスすると正常に表示されるため、リンクの動作に問題がある可能性
     - ブラウザの自動テストツールの問題の可能性もあり、実際のブラウザでの動作確認が必要
   - 影響: ユーザビリティの低下
   - 場所: `web/components/ArticleStatusCard.tsx`
   - 確認方法: 実際のブラウザで手動テストを実施して、問題が再現するか確認

3. **編集モードでJSONが表示される（重大）**
   - 問題: 編集モードに切り替えると、MarkdownではなくJSONが表示される
   - 詳細: 問題1と関連している可能性が高い
   - 影響: ユーザーが記事を編集できない
   - 場所: `web/components/ArticleViewer.tsx`

### 修正済みの問題

1. SSEイベントパースエラー - 修正済み（data: プレフィックスの除去処理を追加）
2. Check Phaseエラー（Process.parallel） - 修正済み

### 正常に動作している機能

- ✅ サーバー起動（FastAPI、Next.js）
- ✅ APIヘルスチェック
- ✅ ダッシュボード表示
- ✅ 記事一覧表示（12件）
- ✅ 記事詳細ページ表示（直接URLアクセス）
- ✅ タブ切り替え（Article、AI Process、Feedback、Analysis）
- ✅ 編集モードへの切り替え
- ✅ 新規記事作成ページ表示
- ✅ フォームバリデーション
- ✅ ストリーミング接続
- ✅ イベント履歴表示
- ✅ APIドキュメント表示

## テスト結果サマリー

### テスト実施状況
- **テスト実施日**: 2025年12月09日
- **テスト方法**: ブラウザ自動テスト（Browser Extension）
- **テスト対象**: Web UI（Next.js + FastAPI）

### テスト結果概要
- **正常動作**: 15項目 ✅
- **問題発見**: 3項目 ❌
- **未テスト**: 10項目（Phase実行、保存、投稿など）

### 主要な問題
1. **重大**: Article保存/API呼び出しで `request is not a function` エラー（保存できず本文反映不可）
2. **重大**: Feedback送信で同エラー発生（送信不可・履歴追加不可）
3. **中程度**: Article本文が空（元データ未設定）。保存が直り次第、本文生成・反映要。

### 推奨される修正優先順位
1. **最優先**: ArticleタブのMarkdown表示問題（ユーザーが記事内容を確認できない）
2. **優先**: 編集モードのJSON表示問題（ユーザーが記事を編集できない）
3. **中程度**: 記事カードのクリック動作（手動テストで再現確認後）

